/*! For license information please see cloveriiif.min.js.LICENSE.txt */
(()=>{var __webpack_modules__={9996:e=>{"use strict";var t=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===i}(e)}(e)},i="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function r(e,t){return!1!==t.clone&&t.isMergeableObject(e)?a((i=e,Array.isArray(i)?[]:{}),e,t):e;var i}function n(e,t,i){return e.concat(t).map((function(e){return r(e,i)}))}function s(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((function(t){return Object.propertyIsEnumerable.call(e,t)})):[]}(e))}function o(e,t){try{return t in e}catch(e){return!1}}function a(e,i,l){(l=l||{}).arrayMerge=l.arrayMerge||n,l.isMergeableObject=l.isMergeableObject||t,l.cloneUnlessOtherwiseSpecified=r;var c=Array.isArray(i);return c===Array.isArray(e)?c?l.arrayMerge(e,i,l):function(e,t,i){var n={};return i.isMergeableObject(e)&&s(e).forEach((function(t){n[t]=r(e[t],i)})),s(t).forEach((function(s){(function(e,t){return o(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))})(e,s)||(o(e,s)&&i.isMergeableObject(t[s])?n[s]=function(e,t){if(!t.customMerge)return a;var i=t.customMerge(e);return"function"==typeof i?i:a}(s,i)(e[s],t[s],i):n[s]=r(t[s],i))})),n}(e,i,l):r(i,l)}a.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,i){return a(e,i,t)}),{})};var l=a;e.exports=l},7837:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.attributeNames=t.elementNames=void 0,t.elementNames=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map((function(e){return[e.toLowerCase(),e]}))),t.attributeNames=new Map(["definitionURL","attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map((function(e){return[e.toLowerCase(),e]})))},7220:function(e,t,i){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},r.apply(this,arguments)},n=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,n)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.render=void 0;var a=o(i(9960)),l=i(5863),c=i(7837),u=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function h(e){return e.replace(/"/g,"&quot;")}var d=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function f(e,t){void 0===t&&(t={});for(var i=("length"in e?e:[e]),r="",n=0;n<i.length;n++)r+=p(i[n],t);return r}function p(e,t){switch(e.type){case a.Root:return f(e.children,t);case a.Doctype:case a.Directive:return"<".concat(e.data,">");case a.Comment:return"\x3c!--".concat(e.data,"--\x3e");case a.CDATA:return function(e){return"<![CDATA[".concat(e.children[0].data,"]]>")}(e);case a.Script:case a.Style:case a.Tag:return function(e,t){var i;"foreign"===t.xmlMode&&(e.name=null!==(i=c.elementNames.get(e.name))&&void 0!==i?i:e.name,e.parent&&g.has(e.parent.name)&&(t=r(r({},t),{xmlMode:!1}))),!t.xmlMode&&m.has(e.name)&&(t=r(r({},t),{xmlMode:"foreign"}));var n="<".concat(e.name),s=function(e,t){var i;if(e){var r=!1===(null!==(i=t.encodeEntities)&&void 0!==i?i:t.decodeEntities)?h:t.xmlMode||"utf8"!==t.encodeEntities?l.encodeXML:l.escapeAttribute;return Object.keys(e).map((function(i){var n,s,o=null!==(n=e[i])&&void 0!==n?n:"";return"foreign"===t.xmlMode&&(i=null!==(s=c.attributeNames.get(i))&&void 0!==s?s:i),t.emptyAttrs||t.xmlMode||""!==o?"".concat(i,'="').concat(r(o),'"'):i})).join(" ")}}(e.attribs,t);return s&&(n+=" ".concat(s)),0===e.children.length&&(t.xmlMode?!1!==t.selfClosingTags:t.selfClosingTags&&d.has(e.name))?(t.xmlMode||(n+=" "),n+="/>"):(n+=">",e.children.length>0&&(n+=f(e.children,t)),!t.xmlMode&&d.has(e.name)||(n+="</".concat(e.name,">"))),n}(e,t);case a.Text:return function(e,t){var i,r=e.data||"";return!1===(null!==(i=t.encodeEntities)&&void 0!==i?i:t.decodeEntities)||!t.xmlMode&&e.parent&&u.has(e.parent.name)||(r=t.xmlMode||"utf8"!==t.encodeEntities?(0,l.encodeXML)(r):(0,l.escapeText)(r)),r}(e,t)}}t.render=f,t.default=f;var g=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),m=new Set(["svg","math"])},9960:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Doctype=t.CDATA=t.Tag=t.Style=t.Script=t.Comment=t.Directive=t.Text=t.Root=t.isTag=t.ElementType=void 0,function(e){e.Root="root",e.Text="text",e.Directive="directive",e.Comment="comment",e.Script="script",e.Style="style",e.Tag="tag",e.CDATA="cdata",e.Doctype="doctype"}(i=t.ElementType||(t.ElementType={})),t.isTag=function(e){return e.type===i.Tag||e.type===i.Script||e.type===i.Style},t.Root=i.Root,t.Text=i.Text,t.Directive=i.Directive,t.Comment=i.Comment,t.Script=i.Script,t.Style=i.Style,t.Tag=i.Tag,t.CDATA=i.CDATA,t.Doctype=i.Doctype},7915:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,n)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.DomHandler=void 0;var s=i(9960),o=i(7790);n(i(7790),t);var a={withStartIndices:!1,withEndIndices:!1,xmlMode:!1},l=function(){function e(e,t,i){this.dom=[],this.root=new o.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,"function"==typeof t&&(i=t,t=a),"object"==typeof e&&(t=e,e=void 0),this.callback=null!=e?e:null,this.options=null!=t?t:a,this.elementCB=null!=i?i:null}return e.prototype.onparserinit=function(e){this.parser=e},e.prototype.onreset=function(){this.dom=[],this.root=new o.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null},e.prototype.onend=function(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))},e.prototype.onerror=function(e){this.handleCallback(e)},e.prototype.onclosetag=function(){this.lastNode=null;var e=this.tagStack.pop();this.options.withEndIndices&&(e.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(e)},e.prototype.onopentag=function(e,t){var i=this.options.xmlMode?s.ElementType.Tag:void 0,r=new o.Element(e,t,void 0,i);this.addNode(r),this.tagStack.push(r)},e.prototype.ontext=function(e){var t=this.lastNode;if(t&&t.type===s.ElementType.Text)t.data+=e,this.options.withEndIndices&&(t.endIndex=this.parser.endIndex);else{var i=new o.Text(e);this.addNode(i),this.lastNode=i}},e.prototype.oncomment=function(e){if(this.lastNode&&this.lastNode.type===s.ElementType.Comment)this.lastNode.data+=e;else{var t=new o.Comment(e);this.addNode(t),this.lastNode=t}},e.prototype.oncommentend=function(){this.lastNode=null},e.prototype.oncdatastart=function(){var e=new o.Text(""),t=new o.CDATA([e]);this.addNode(t),e.parent=t,this.lastNode=e},e.prototype.oncdataend=function(){this.lastNode=null},e.prototype.onprocessinginstruction=function(e,t){var i=new o.ProcessingInstruction(e,t);this.addNode(i)},e.prototype.handleCallback=function(e){if("function"==typeof this.callback)this.callback(e,this.dom);else if(e)throw e},e.prototype.addNode=function(e){var t=this.tagStack[this.tagStack.length-1],i=t.children[t.children.length-1];this.options.withStartIndices&&(e.startIndex=this.parser.startIndex),this.options.withEndIndices&&(e.endIndex=this.parser.endIndex),t.children.push(e),i&&(e.prev=i,i.next=e),e.parent=t,this.lastNode=null},e}();t.DomHandler=l,t.default=l},7790:function(e,t,i){"use strict";var r,n=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__assign||function(){return s=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},s.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.cloneNode=t.hasChildren=t.isDocument=t.isDirective=t.isComment=t.isText=t.isCDATA=t.isTag=t.Element=t.Document=t.CDATA=t.NodeWithChildren=t.ProcessingInstruction=t.Comment=t.Text=t.DataNode=t.Node=void 0;var o=i(9960),a=function(){function e(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}return Object.defineProperty(e.prototype,"parentNode",{get:function(){return this.parent},set:function(e){this.parent=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previousSibling",{get:function(){return this.prev},set:function(e){this.prev=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextSibling",{get:function(){return this.next},set:function(e){this.next=e},enumerable:!1,configurable:!0}),e.prototype.cloneNode=function(e){return void 0===e&&(e=!1),T(this,e)},e}();t.Node=a;var l=function(e){function t(t){var i=e.call(this)||this;return i.data=t,i}return n(t,e),Object.defineProperty(t.prototype,"nodeValue",{get:function(){return this.data},set:function(e){this.data=e},enumerable:!1,configurable:!0}),t}(a);t.DataNode=l;var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=o.ElementType.Text,t}return n(t,e),Object.defineProperty(t.prototype,"nodeType",{get:function(){return 3},enumerable:!1,configurable:!0}),t}(l);t.Text=c;var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=o.ElementType.Comment,t}return n(t,e),Object.defineProperty(t.prototype,"nodeType",{get:function(){return 8},enumerable:!1,configurable:!0}),t}(l);t.Comment=u;var h=function(e){function t(t,i){var r=e.call(this,i)||this;return r.name=t,r.type=o.ElementType.Directive,r}return n(t,e),Object.defineProperty(t.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),t}(l);t.ProcessingInstruction=h;var d=function(e){function t(t){var i=e.call(this)||this;return i.children=t,i}return n(t,e),Object.defineProperty(t.prototype,"firstChild",{get:function(){var e;return null!==(e=this.children[0])&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastChild",{get:function(){return this.children.length>0?this.children[this.children.length-1]:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"childNodes",{get:function(){return this.children},set:function(e){this.children=e},enumerable:!1,configurable:!0}),t}(a);t.NodeWithChildren=d;var f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=o.ElementType.CDATA,t}return n(t,e),Object.defineProperty(t.prototype,"nodeType",{get:function(){return 4},enumerable:!1,configurable:!0}),t}(d);t.CDATA=f;var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=o.ElementType.Root,t}return n(t,e),Object.defineProperty(t.prototype,"nodeType",{get:function(){return 9},enumerable:!1,configurable:!0}),t}(d);t.Document=p;var g=function(e){function t(t,i,r,n){void 0===r&&(r=[]),void 0===n&&(n="script"===t?o.ElementType.Script:"style"===t?o.ElementType.Style:o.ElementType.Tag);var s=e.call(this,r)||this;return s.name=t,s.attribs=i,s.type=n,s}return n(t,e),Object.defineProperty(t.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tagName",{get:function(){return this.name},set:function(e){this.name=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attributes",{get:function(){var e=this;return Object.keys(this.attribs).map((function(t){var i,r;return{name:t,value:e.attribs[t],namespace:null===(i=e["x-attribsNamespace"])||void 0===i?void 0:i[t],prefix:null===(r=e["x-attribsPrefix"])||void 0===r?void 0:r[t]}}))},enumerable:!1,configurable:!0}),t}(d);function m(e){return(0,o.isTag)(e)}function v(e){return e.type===o.ElementType.CDATA}function y(e){return e.type===o.ElementType.Text}function w(e){return e.type===o.ElementType.Comment}function E(e){return e.type===o.ElementType.Directive}function b(e){return e.type===o.ElementType.Root}function T(e,t){var i;if(void 0===t&&(t=!1),y(e))i=new c(e.data);else if(w(e))i=new u(e.data);else if(m(e)){var r=t?S(e.children):[],n=new g(e.name,s({},e.attribs),r);r.forEach((function(e){return e.parent=n})),null!=e.namespace&&(n.namespace=e.namespace),e["x-attribsNamespace"]&&(n["x-attribsNamespace"]=s({},e["x-attribsNamespace"])),e["x-attribsPrefix"]&&(n["x-attribsPrefix"]=s({},e["x-attribsPrefix"])),i=n}else if(v(e)){r=t?S(e.children):[];var o=new f(r);r.forEach((function(e){return e.parent=o})),i=o}else if(b(e)){r=t?S(e.children):[];var a=new p(r);r.forEach((function(e){return e.parent=a})),e["x-mode"]&&(a["x-mode"]=e["x-mode"]),i=a}else{if(!E(e))throw new Error("Not implemented yet: ".concat(e.type));var l=new h(e.name,e.data);null!=e["x-name"]&&(l["x-name"]=e["x-name"],l["x-publicId"]=e["x-publicId"],l["x-systemId"]=e["x-systemId"]),i=l}return i.startIndex=e.startIndex,i.endIndex=e.endIndex,null!=e.sourceCodeLocation&&(i.sourceCodeLocation=e.sourceCodeLocation),i}function S(e){for(var t=e.map((function(e){return T(e,!0)})),i=1;i<t.length;i++)t[i].prev=t[i-1],t[i-1].next=t[i];return t}t.Element=g,t.isTag=m,t.isCDATA=v,t.isText=y,t.isComment=w,t.isDirective=E,t.isDocument=b,t.hasChildren=function(e){return Object.prototype.hasOwnProperty.call(e,"children")},t.cloneNode=T},6996:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFeed=void 0;var r=i(3346),n=i(3905);t.getFeed=function(e){var t=l(h,e);return t?"feed"===t.name?function(e){var t,i=e.children,r={type:"atom",items:(0,n.getElementsByTagName)("entry",i).map((function(e){var t,i=e.children,r={media:a(i)};u(r,"id","id",i),u(r,"title","title",i);var n=null===(t=l("link",i))||void 0===t?void 0:t.attribs.href;n&&(r.link=n);var s=c("summary",i)||c("content",i);s&&(r.description=s);var o=c("updated",i);return o&&(r.pubDate=new Date(o)),r}))};u(r,"id","id",i),u(r,"title","title",i);var s=null===(t=l("link",i))||void 0===t?void 0:t.attribs.href;s&&(r.link=s),u(r,"description","subtitle",i);var o=c("updated",i);return o&&(r.updated=new Date(o)),u(r,"author","email",i,!0),r}(t):function(e){var t,i,r=null!==(i=null===(t=l("channel",e.children))||void 0===t?void 0:t.children)&&void 0!==i?i:[],s={type:e.name.substr(0,3),id:"",items:(0,n.getElementsByTagName)("item",e.children).map((function(e){var t=e.children,i={media:a(t)};u(i,"id","guid",t),u(i,"title","title",t),u(i,"link","link",t),u(i,"description","description",t);var r=c("pubDate",t)||c("dc:date",t);return r&&(i.pubDate=new Date(r)),i}))};u(s,"title","title",r),u(s,"link","link",r),u(s,"description","description",r);var o=c("lastBuildDate",r);return o&&(s.updated=new Date(o)),u(s,"author","managingEditor",r,!0),s}(t):null};var s=["url","type","lang"],o=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function a(e){return(0,n.getElementsByTagName)("media:content",e).map((function(e){for(var t=e.attribs,i={medium:t.medium,isDefault:!!t.isDefault},r=0,n=s;r<n.length;r++)t[c=n[r]]&&(i[c]=t[c]);for(var a=0,l=o;a<l.length;a++){var c;t[c=l[a]]&&(i[c]=parseInt(t[c],10))}return t.expression&&(i.expression=t.expression),i}))}function l(e,t){return(0,n.getElementsByTagName)(e,t,!0,1)[0]}function c(e,t,i){return void 0===i&&(i=!1),(0,r.textContent)((0,n.getElementsByTagName)(e,t,i,1)).trim()}function u(e,t,i,r,n){void 0===n&&(n=!1);var s=c(i,r,n);s&&(e[t]=s)}function h(e){return"rss"===e||"feed"===e||"rdf:RDF"===e}},4975:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uniqueSort=t.compareDocumentPosition=t.DocumentPosition=t.removeSubsets=void 0;var r,n=i(7915);function s(e,t){var i=[],s=[];if(e===t)return 0;for(var o=(0,n.hasChildren)(e)?e:e.parent;o;)i.unshift(o),o=o.parent;for(o=(0,n.hasChildren)(t)?t:t.parent;o;)s.unshift(o),o=o.parent;for(var a=Math.min(i.length,s.length),l=0;l<a&&i[l]===s[l];)l++;if(0===l)return r.DISCONNECTED;var c=i[l-1],u=c.children,h=i[l],d=s[l];return u.indexOf(h)>u.indexOf(d)?c===t?r.FOLLOWING|r.CONTAINED_BY:r.FOLLOWING:c===e?r.PRECEDING|r.CONTAINS:r.PRECEDING}t.removeSubsets=function(e){for(var t=e.length;--t>=0;){var i=e[t];if(t>0&&e.lastIndexOf(i,t-1)>=0)e.splice(t,1);else for(var r=i.parent;r;r=r.parent)if(e.includes(r)){e.splice(t,1);break}}return e},function(e){e[e.DISCONNECTED=1]="DISCONNECTED",e[e.PRECEDING=2]="PRECEDING",e[e.FOLLOWING=4]="FOLLOWING",e[e.CONTAINS=8]="CONTAINS",e[e.CONTAINED_BY=16]="CONTAINED_BY"}(r=t.DocumentPosition||(t.DocumentPosition={})),t.compareDocumentPosition=s,t.uniqueSort=function(e){return(e=e.filter((function(e,t,i){return!i.includes(e,t+1)}))).sort((function(e,t){var i=s(e,t);return i&r.PRECEDING?-1:i&r.FOLLOWING?1:0})),e}},9432:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,n)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.hasChildren=t.isDocument=t.isComment=t.isText=t.isCDATA=t.isTag=void 0,n(i(3346),t),n(i(5010),t),n(i(6765),t),n(i(8043),t),n(i(3905),t),n(i(4975),t),n(i(6996),t);var s=i(7915);Object.defineProperty(t,"isTag",{enumerable:!0,get:function(){return s.isTag}}),Object.defineProperty(t,"isCDATA",{enumerable:!0,get:function(){return s.isCDATA}}),Object.defineProperty(t,"isText",{enumerable:!0,get:function(){return s.isText}}),Object.defineProperty(t,"isComment",{enumerable:!0,get:function(){return s.isComment}}),Object.defineProperty(t,"isDocument",{enumerable:!0,get:function(){return s.isDocument}}),Object.defineProperty(t,"hasChildren",{enumerable:!0,get:function(){return s.hasChildren}})},3905:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getElementsByTagType=t.getElementsByTagName=t.getElementById=t.getElements=t.testElement=void 0;var r=i(7915),n=i(8043),s={tag_name:function(e){return"function"==typeof e?function(t){return(0,r.isTag)(t)&&e(t.name)}:"*"===e?r.isTag:function(t){return(0,r.isTag)(t)&&t.name===e}},tag_type:function(e){return"function"==typeof e?function(t){return e(t.type)}:function(t){return t.type===e}},tag_contains:function(e){return"function"==typeof e?function(t){return(0,r.isText)(t)&&e(t.data)}:function(t){return(0,r.isText)(t)&&t.data===e}}};function o(e,t){return"function"==typeof t?function(i){return(0,r.isTag)(i)&&t(i.attribs[e])}:function(i){return(0,r.isTag)(i)&&i.attribs[e]===t}}function a(e,t){return function(i){return e(i)||t(i)}}function l(e){var t=Object.keys(e).map((function(t){var i=e[t];return Object.prototype.hasOwnProperty.call(s,t)?s[t](i):o(t,i)}));return 0===t.length?null:t.reduce(a)}t.testElement=function(e,t){var i=l(e);return!i||i(t)},t.getElements=function(e,t,i,r){void 0===r&&(r=1/0);var s=l(e);return s?(0,n.filter)(s,t,i,r):[]},t.getElementById=function(e,t,i){return void 0===i&&(i=!0),Array.isArray(t)||(t=[t]),(0,n.findOne)(o("id",e),t,i)},t.getElementsByTagName=function(e,t,i,r){return void 0===i&&(i=!0),void 0===r&&(r=1/0),(0,n.filter)(s.tag_name(e),t,i,r)},t.getElementsByTagType=function(e,t,i,r){return void 0===i&&(i=!0),void 0===r&&(r=1/0),(0,n.filter)(s.tag_type(e),t,i,r)}},6765:(e,t)=>{"use strict";function i(e){if(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.parent){var t=e.parent.children,i=t.lastIndexOf(e);i>=0&&t.splice(i,1)}e.next=null,e.prev=null,e.parent=null}Object.defineProperty(t,"__esModule",{value:!0}),t.prepend=t.prependChild=t.append=t.appendChild=t.replaceElement=t.removeElement=void 0,t.removeElement=i,t.replaceElement=function(e,t){var i=t.prev=e.prev;i&&(i.next=t);var r=t.next=e.next;r&&(r.prev=t);var n=t.parent=e.parent;if(n){var s=n.children;s[s.lastIndexOf(e)]=t,e.parent=null}},t.appendChild=function(e,t){if(i(t),t.next=null,t.parent=e,e.children.push(t)>1){var r=e.children[e.children.length-2];r.next=t,t.prev=r}else t.prev=null},t.append=function(e,t){i(t);var r=e.parent,n=e.next;if(t.next=n,t.prev=e,e.next=t,t.parent=r,n){if(n.prev=t,r){var s=r.children;s.splice(s.lastIndexOf(n),0,t)}}else r&&r.children.push(t)},t.prependChild=function(e,t){if(i(t),t.parent=e,t.prev=null,1!==e.children.unshift(t)){var r=e.children[1];r.prev=t,t.next=r}else t.next=null},t.prepend=function(e,t){i(t);var r=e.parent;if(r){var n=r.children;n.splice(n.indexOf(e),0,t)}e.prev&&(e.prev.next=t),t.parent=r,t.prev=e.prev,t.next=e,e.prev=t}},8043:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findAll=t.existsOne=t.findOne=t.findOneChild=t.find=t.filter=void 0;var r=i(7915);function n(e,t,i,n){for(var s=[],o=[t],a=[0];;)if(a[0]>=o[0].length){if(1===a.length)return s;o.shift(),a.shift()}else{var l=o[0][a[0]++];if(e(l)&&(s.push(l),--n<=0))return s;i&&(0,r.hasChildren)(l)&&l.children.length>0&&(a.unshift(0),o.unshift(l.children))}}t.filter=function(e,t,i,r){return void 0===i&&(i=!0),void 0===r&&(r=1/0),n(e,Array.isArray(t)?t:[t],i,r)},t.find=n,t.findOneChild=function(e,t){return t.find(e)},t.findOne=function e(t,i,n){void 0===n&&(n=!0);for(var s=null,o=0;o<i.length&&!s;o++){var a=i[o];(0,r.isTag)(a)&&(t(a)?s=a:n&&a.children.length>0&&(s=e(t,a.children,!0)))}return s},t.existsOne=function e(t,i){return i.some((function(i){return(0,r.isTag)(i)&&(t(i)||e(t,i.children))}))},t.findAll=function(e,t){for(var i=[],n=[t],s=[0];;)if(s[0]>=n[0].length){if(1===n.length)return i;n.shift(),s.shift()}else{var o=n[0][s[0]++];(0,r.isTag)(o)&&(e(o)&&i.push(o),o.children.length>0&&(s.unshift(0),n.unshift(o.children)))}}},3346:function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.innerText=t.textContent=t.getText=t.getInnerHTML=t.getOuterHTML=void 0;var n=i(7915),s=r(i(7220)),o=i(9960);function a(e,t){return(0,s.default)(e,t)}t.getOuterHTML=a,t.getInnerHTML=function(e,t){return(0,n.hasChildren)(e)?e.children.map((function(e){return a(e,t)})).join(""):""},t.getText=function e(t){return Array.isArray(t)?t.map(e).join(""):(0,n.isTag)(t)?"br"===t.name?"\n":e(t.children):(0,n.isCDATA)(t)?e(t.children):(0,n.isText)(t)?t.data:""},t.textContent=function e(t){return Array.isArray(t)?t.map(e).join(""):(0,n.hasChildren)(t)&&!(0,n.isComment)(t)?e(t.children):(0,n.isText)(t)?t.data:""},t.innerText=function e(t){return Array.isArray(t)?t.map(e).join(""):(0,n.hasChildren)(t)&&(t.type===o.ElementType.Tag||(0,n.isCDATA)(t))?e(t.children):(0,n.isText)(t)?t.data:""}},5010:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.prevElementSibling=t.nextElementSibling=t.getName=t.hasAttrib=t.getAttributeValue=t.getSiblings=t.getParent=t.getChildren=void 0;var r=i(7915);function n(e){return(0,r.hasChildren)(e)?e.children:[]}function s(e){return e.parent||null}t.getChildren=n,t.getParent=s,t.getSiblings=function(e){var t=s(e);if(null!=t)return n(t);for(var i=[e],r=e.prev,o=e.next;null!=r;)i.unshift(r),r=r.prev;for(;null!=o;)i.push(o),o=o.next;return i},t.getAttributeValue=function(e,t){var i;return null===(i=e.attribs)||void 0===i?void 0:i[t]},t.hasAttrib=function(e,t){return null!=e.attribs&&Object.prototype.hasOwnProperty.call(e.attribs,t)&&null!=e.attribs[t]},t.getName=function(e){return e.name},t.nextElementSibling=function(e){for(var t=e.next;null!==t&&!(0,r.isTag)(t);)t=t.next;return t},t.prevElementSibling=function(e){for(var t=e.prev;null!==t&&!(0,r.isTag)(t);)t=t.prev;return t}},4076:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,n)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&r(t,e,i);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.decodeXML=t.decodeHTMLStrict=t.decodeHTMLAttribute=t.decodeHTML=t.determineBranch=t.EntityDecoder=t.DecodingMode=t.BinTrieFlags=t.fromCodePoint=t.replaceCodePoint=t.decodeCodePoint=t.xmlDecodeTree=t.htmlDecodeTree=void 0;var a=o(i(3704));t.htmlDecodeTree=a.default;var l=o(i(2060));t.xmlDecodeTree=l.default;var c=s(i(26));t.decodeCodePoint=c.default;var u,h,d,f,p=i(26);function g(e){return e>=u.ZERO&&e<=u.NINE}Object.defineProperty(t,"replaceCodePoint",{enumerable:!0,get:function(){return p.replaceCodePoint}}),Object.defineProperty(t,"fromCodePoint",{enumerable:!0,get:function(){return p.fromCodePoint}}),function(e){e[e.NUM=35]="NUM",e[e.SEMI=59]="SEMI",e[e.EQUALS=61]="EQUALS",e[e.ZERO=48]="ZERO",e[e.NINE=57]="NINE",e[e.LOWER_A=97]="LOWER_A",e[e.LOWER_F=102]="LOWER_F",e[e.LOWER_X=120]="LOWER_X",e[e.LOWER_Z=122]="LOWER_Z",e[e.UPPER_A=65]="UPPER_A",e[e.UPPER_F=70]="UPPER_F",e[e.UPPER_Z=90]="UPPER_Z"}(u||(u={})),function(e){e[e.VALUE_LENGTH=49152]="VALUE_LENGTH",e[e.BRANCH_LENGTH=16256]="BRANCH_LENGTH",e[e.JUMP_TABLE=127]="JUMP_TABLE"}(h=t.BinTrieFlags||(t.BinTrieFlags={})),function(e){e[e.EntityStart=0]="EntityStart",e[e.NumericStart=1]="NumericStart",e[e.NumericDecimal=2]="NumericDecimal",e[e.NumericHex=3]="NumericHex",e[e.NamedEntity=4]="NamedEntity"}(d||(d={})),function(e){e[e.Legacy=0]="Legacy",e[e.Strict=1]="Strict",e[e.Attribute=2]="Attribute"}(f=t.DecodingMode||(t.DecodingMode={}));var m=function(){function e(e,t,i){this.decodeTree=e,this.emitCodePoint=t,this.errors=i,this.state=d.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=f.Strict}return e.prototype.startEntity=function(e){this.decodeMode=e,this.state=d.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1},e.prototype.write=function(e,t){switch(this.state){case d.EntityStart:return e.charCodeAt(t)===u.NUM?(this.state=d.NumericStart,this.consumed+=1,this.stateNumericStart(e,t+1)):(this.state=d.NamedEntity,this.stateNamedEntity(e,t));case d.NumericStart:return this.stateNumericStart(e,t);case d.NumericDecimal:return this.stateNumericDecimal(e,t);case d.NumericHex:return this.stateNumericHex(e,t);case d.NamedEntity:return this.stateNamedEntity(e,t)}},e.prototype.stateNumericStart=function(e,t){return t>=e.length?-1:(32|e.charCodeAt(t))===u.LOWER_X?(this.state=d.NumericHex,this.consumed+=1,this.stateNumericHex(e,t+1)):(this.state=d.NumericDecimal,this.stateNumericDecimal(e,t))},e.prototype.addToNumericResult=function(e,t,i,r){if(t!==i){var n=i-t;this.result=this.result*Math.pow(r,n)+parseInt(e.substr(t,n),r),this.consumed+=n}},e.prototype.stateNumericHex=function(e,t){for(var i,r=t;t<e.length;){var n=e.charCodeAt(t);if(!(g(n)||(i=n,i>=u.UPPER_A&&i<=u.UPPER_F||i>=u.LOWER_A&&i<=u.LOWER_F)))return this.addToNumericResult(e,r,t,16),this.emitNumericEntity(n,3);t+=1}return this.addToNumericResult(e,r,t,16),-1},e.prototype.stateNumericDecimal=function(e,t){for(var i=t;t<e.length;){var r=e.charCodeAt(t);if(!g(r))return this.addToNumericResult(e,i,t,10),this.emitNumericEntity(r,2);t+=1}return this.addToNumericResult(e,i,t,10),-1},e.prototype.emitNumericEntity=function(e,t){var i;if(this.consumed<=t)return null===(i=this.errors)||void 0===i||i.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(e===u.SEMI)this.consumed+=1;else if(this.decodeMode===f.Strict)return 0;return this.emitCodePoint((0,c.replaceCodePoint)(this.result),this.consumed),this.errors&&(e!==u.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed},e.prototype.stateNamedEntity=function(e,t){for(var i=this.decodeTree,r=i[this.treeIndex],n=(r&h.VALUE_LENGTH)>>14;t<e.length;t++,this.excess++){var s=e.charCodeAt(t);if(this.treeIndex=y(i,r,this.treeIndex+Math.max(1,n),s),this.treeIndex<0)return 0===this.result||this.decodeMode===f.Attribute&&(0===n||((o=s)===u.EQUALS||function(e){return e>=u.UPPER_A&&e<=u.UPPER_Z||e>=u.LOWER_A&&e<=u.LOWER_Z||g(e)}(o)))?0:this.emitNotTerminatedNamedEntity();if(0!=(n=((r=i[this.treeIndex])&h.VALUE_LENGTH)>>14)){if(s===u.SEMI)return this.emitNamedEntityData(this.treeIndex,n,this.consumed+this.excess);this.decodeMode!==f.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}var o;return-1},e.prototype.emitNotTerminatedNamedEntity=function(){var e,t=this.result,i=(this.decodeTree[t]&h.VALUE_LENGTH)>>14;return this.emitNamedEntityData(t,i,this.consumed),null===(e=this.errors)||void 0===e||e.missingSemicolonAfterCharacterReference(),this.consumed},e.prototype.emitNamedEntityData=function(e,t,i){var r=this.decodeTree;return this.emitCodePoint(1===t?r[e]&~h.VALUE_LENGTH:r[e+1],i),3===t&&this.emitCodePoint(r[e+2],i),i},e.prototype.end=function(){var e;switch(this.state){case d.NamedEntity:return 0===this.result||this.decodeMode===f.Attribute&&this.result!==this.treeIndex?0:this.emitNotTerminatedNamedEntity();case d.NumericDecimal:return this.emitNumericEntity(0,2);case d.NumericHex:return this.emitNumericEntity(0,3);case d.NumericStart:return null===(e=this.errors)||void 0===e||e.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case d.EntityStart:return 0}},e}();function v(e){var t="",i=new m(e,(function(e){return t+=(0,c.fromCodePoint)(e)}));return function(e,r){for(var n=0,s=0;(s=e.indexOf("&",s))>=0;){t+=e.slice(n,s),i.startEntity(r);var o=i.write(e,s+1);if(o<0){n=s+i.end();break}n=s+o,s=0===o?n+1:n}var a=t+e.slice(n);return t="",a}}function y(e,t,i,r){var n=(t&h.BRANCH_LENGTH)>>7,s=t&h.JUMP_TABLE;if(0===n)return 0!==s&&r===s?i:-1;if(s){var o=r-s;return o<0||o>=n?-1:e[i+o]-1}for(var a=i,l=a+n-1;a<=l;){var c=a+l>>>1,u=e[c];if(u<r)a=c+1;else{if(!(u>r))return e[c+n];l=c-1}}return-1}t.EntityDecoder=m,t.determineBranch=y;var w=v(a.default),E=v(l.default);t.decodeHTML=function(e,t){return void 0===t&&(t=f.Legacy),w(e,t)},t.decodeHTMLAttribute=function(e){return w(e,f.Attribute)},t.decodeHTMLStrict=function(e){return w(e,f.Strict)},t.decodeXML=function(e){return E(e,f.Strict)}},26:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.replaceCodePoint=t.fromCodePoint=void 0;var r=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);function n(e){var t;return e>=55296&&e<=57343||e>1114111?65533:null!==(t=r.get(e))&&void 0!==t?t:e}t.fromCodePoint=null!==(i=String.fromCodePoint)&&void 0!==i?i:function(e){var t="";return e>65535&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|1023&e),t+String.fromCharCode(e)},t.replaceCodePoint=n,t.default=function(e){return(0,t.fromCodePoint)(n(e))}},7322:function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.encodeNonAsciiHTML=t.encodeHTML=void 0;var n=r(i(4021)),s=i(4625),o=/[\t\n!-,./:-@[-`\f{-}$\x80-\uFFFF]/g;function a(e,t){for(var i,r="",o=0;null!==(i=e.exec(t));){var a=i.index;r+=t.substring(o,a);var l=t.charCodeAt(a),c=n.default.get(l);if("object"==typeof c){if(a+1<t.length){var u=t.charCodeAt(a+1),h="number"==typeof c.n?c.n===u?c.o:void 0:c.n.get(u);if(void 0!==h){r+=h,o=e.lastIndex+=1;continue}}c=c.v}if(void 0!==c)r+=c,o=a+1;else{var d=(0,s.getCodePoint)(t,a);r+="&#x".concat(d.toString(16),";"),o=e.lastIndex+=Number(d!==l)}}return r+t.substr(o)}t.encodeHTML=function(e){return a(o,e)},t.encodeNonAsciiHTML=function(e){return a(s.xmlReplacer,e)}},4625:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.escapeText=t.escapeAttribute=t.escapeUTF8=t.escape=t.encodeXML=t.getCodePoint=t.xmlReplacer=void 0,t.xmlReplacer=/["&'<>$\x80-\uFFFF]/g;var i=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]);function r(e){for(var r,n="",s=0;null!==(r=t.xmlReplacer.exec(e));){var o=r.index,a=e.charCodeAt(o),l=i.get(a);void 0!==l?(n+=e.substring(s,o)+l,s=o+1):(n+="".concat(e.substring(s,o),"&#x").concat((0,t.getCodePoint)(e,o).toString(16),";"),s=t.xmlReplacer.lastIndex+=Number(55296==(64512&a)))}return n+e.substr(s)}function n(e,t){return function(i){for(var r,n=0,s="";r=e.exec(i);)n!==r.index&&(s+=i.substring(n,r.index)),s+=t.get(r[0].charCodeAt(0)),n=r.index+1;return s+i.substring(n)}}t.getCodePoint=null!=String.prototype.codePointAt?function(e,t){return e.codePointAt(t)}:function(e,t){return 55296==(64512&e.charCodeAt(t))?1024*(e.charCodeAt(t)-55296)+e.charCodeAt(t+1)-56320+65536:e.charCodeAt(t)},t.encodeXML=r,t.escape=r,t.escapeUTF8=n(/[&<>'"]/g,i),t.escapeAttribute=n(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),t.escapeText=n(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]]))},3704:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=new Uint16Array('ᵁ<Õıʊҝջאٵ۞ޢߖࠏ੊ઑඡ๭༉༦჊ረዡᐕᒝᓃᓟᔥ\0\0\0\0\0\0ᕫᛍᦍᰒᷝ὾⁠↰⊍⏀⏻⑂⠤⤒ⴈ⹈⿎〖㊺㘹㞬㣾㨨㩱㫠㬮ࠀEMabcfglmnoprstu\\bfms¦³¹ÈÏlig耻Æ䃆P耻&䀦cute耻Á䃁reve;䄂Āiyx}rc耻Â䃂;䐐r;쀀𝔄rave耻À䃀pha;䎑acr;䄀d;橓Āgp¡on;䄄f;쀀𝔸plyFunction;恡ing耻Å䃅Ācs¾Ãr;쀀𝒜ign;扔ilde耻Ã䃃ml耻Ä䃄ЀaceforsuåûþėĜĢħĪĀcrêòkslash;或Ŷöø;櫧ed;挆y;䐑ƀcrtąċĔause;戵noullis;愬a;䎒r;쀀𝔅pf;쀀𝔹eve;䋘còēmpeq;扎܀HOacdefhilorsuōőŖƀƞƢƵƷƺǜȕɳɸɾcy;䐧PY耻©䂩ƀcpyŝŢźute;䄆Ā;iŧŨ拒talDifferentialD;慅leys;愭ȀaeioƉƎƔƘron;䄌dil耻Ç䃇rc;䄈nint;戰ot;䄊ĀdnƧƭilla;䂸terDot;䂷òſi;䎧rcleȀDMPTǇǋǑǖot;抙inus;抖lus;投imes;抗oĀcsǢǸkwiseContourIntegral;戲eCurlyĀDQȃȏoubleQuote;思uote;怙ȀlnpuȞȨɇɕonĀ;eȥȦ户;橴ƀgitȯȶȺruent;扡nt;戯ourIntegral;戮ĀfrɌɎ;愂oduct;成nterClockwiseContourIntegral;戳oss;樯cr;쀀𝒞pĀ;Cʄʅ拓ap;才րDJSZacefiosʠʬʰʴʸˋ˗ˡ˦̳ҍĀ;oŹʥtrahd;椑cy;䐂cy;䐅cy;䐏ƀgrsʿ˄ˇger;怡r;憡hv;櫤Āayː˕ron;䄎;䐔lĀ;t˝˞戇a;䎔r;쀀𝔇Āaf˫̧Ācm˰̢riticalȀADGT̖̜̀̆cute;䂴oŴ̋̍;䋙bleAcute;䋝rave;䁠ilde;䋜ond;拄ferentialD;慆Ѱ̽\0\0\0͔͂\0Ѕf;쀀𝔻ƀ;DE͈͉͍䂨ot;惜qual;扐blèCDLRUVͣͲ΂ϏϢϸontourIntegraìȹoɴ͹\0\0ͻ»͉nArrow;懓Āeo·ΤftƀARTΐΖΡrrow;懐ightArrow;懔eåˊngĀLRΫτeftĀARγιrrow;柸ightArrow;柺ightArrow;柹ightĀATϘϞrrow;懒ee;抨pɁϩ\0\0ϯrrow;懑ownArrow;懕erticalBar;戥ǹABLRTaВЪаўѿͼrrowƀ;BUНОТ憓ar;椓pArrow;懵reve;䌑eft˒к\0ц\0ѐightVector;楐eeVector;楞ectorĀ;Bљњ憽ar;楖ightǔѧ\0ѱeeVector;楟ectorĀ;BѺѻ懁ar;楗eeĀ;A҆҇护rrow;憧ĀctҒҗr;쀀𝒟rok;䄐ࠀNTacdfglmopqstuxҽӀӄӋӞӢӧӮӵԡԯԶՒ՝ՠեG;䅊H耻Ð䃐cute耻É䃉ƀaiyӒӗӜron;䄚rc耻Ê䃊;䐭ot;䄖r;쀀𝔈rave耻È䃈ement;戈ĀapӺӾcr;䄒tyɓԆ\0\0ԒmallSquare;旻erySmallSquare;斫ĀgpԦԪon;䄘f;쀀𝔼silon;䎕uĀaiԼՉlĀ;TՂՃ橵ilde;扂librium;懌Āci՗՚r;愰m;橳a;䎗ml耻Ë䃋Āipժկsts;戃onentialE;慇ʀcfiosօֈ֍ֲ׌y;䐤r;쀀𝔉lledɓ֗\0\0֣mallSquare;旼erySmallSquare;斪Ͱֺ\0ֿ\0\0ׄf;쀀𝔽All;戀riertrf;愱cò׋؀JTabcdfgorstר׬ׯ׺؀ؒؖ؛؝أ٬ٲcy;䐃耻>䀾mmaĀ;d׷׸䎓;䏜reve;䄞ƀeiy؇،ؐdil;䄢rc;䄜;䐓ot;䄠r;쀀𝔊;拙pf;쀀𝔾eater̀EFGLSTصلَٖٛ٦qualĀ;Lؾؿ扥ess;招ullEqual;执reater;檢ess;扷lantEqual;橾ilde;扳cr;쀀𝒢;扫ЀAacfiosuڅڋږڛڞڪھۊRDcy;䐪Āctڐڔek;䋇;䁞irc;䄤r;愌lbertSpace;愋ǰگ\0ڲf;愍izontalLine;攀Āctۃۅòکrok;䄦mpńېۘownHumðįqual;扏܀EJOacdfgmnostuۺ۾܃܇܎ܚܞܡܨ݄ݸދޏޕcy;䐕lig;䄲cy;䐁cute耻Í䃍Āiyܓܘrc耻Î䃎;䐘ot;䄰r;愑rave耻Ì䃌ƀ;apܠܯܿĀcgܴܷr;䄪inaryI;慈lieóϝǴ݉\0ݢĀ;eݍݎ戬Āgrݓݘral;戫section;拂isibleĀCTݬݲomma;恣imes;恢ƀgptݿރވon;䄮f;쀀𝕀a;䎙cr;愐ilde;䄨ǫޚ\0ޞcy;䐆l耻Ï䃏ʀcfosuެ޷޼߂ߐĀiyޱ޵rc;䄴;䐙r;쀀𝔍pf;쀀𝕁ǣ߇\0ߌr;쀀𝒥rcy;䐈kcy;䐄΀HJacfosߤߨ߽߬߱ࠂࠈcy;䐥cy;䐌ppa;䎚Āey߶߻dil;䄶;䐚r;쀀𝔎pf;쀀𝕂cr;쀀𝒦րJTaceflmostࠥࠩࠬࡐࡣ঳সে্਷ੇcy;䐉耻<䀼ʀcmnpr࠷࠼ࡁࡄࡍute;䄹bda;䎛g;柪lacetrf;愒r;憞ƀaeyࡗ࡜ࡡron;䄽dil;䄻;䐛Āfsࡨ॰tԀACDFRTUVarࡾࢩࢱࣦ࣠ࣼयज़ΐ४Ānrࢃ࢏gleBracket;柨rowƀ;BR࢙࢚࢞憐ar;懤ightArrow;懆eiling;挈oǵࢷ\0ࣃbleBracket;柦nǔࣈ\0࣒eeVector;楡ectorĀ;Bࣛࣜ懃ar;楙loor;挊ightĀAV࣯ࣵrrow;憔ector;楎Āerँगeƀ;AVउऊऐ抣rrow;憤ector;楚iangleƀ;BEतथऩ抲ar;槏qual;抴pƀDTVषूौownVector;楑eeVector;楠ectorĀ;Bॖॗ憿ar;楘ectorĀ;B॥०憼ar;楒ightáΜs̀EFGLSTॾঋকঝঢভqualGreater;拚ullEqual;扦reater;扶ess;檡lantEqual;橽ilde;扲r;쀀𝔏Ā;eঽা拘ftarrow;懚idot;䄿ƀnpw৔ਖਛgȀLRlr৞৷ਂਐeftĀAR০৬rrow;柵ightArrow;柷ightArrow;柶eftĀarγਊightáοightáϊf;쀀𝕃erĀLRਢਬeftArrow;憙ightArrow;憘ƀchtਾੀੂòࡌ;憰rok;䅁;扪Ѐacefiosuਗ਼੝੠੷੼અઋ઎p;椅y;䐜Ādl੥੯iumSpace;恟lintrf;愳r;쀀𝔐nusPlus;戓pf;쀀𝕄cò੶;䎜ҀJacefostuણધભીଔଙඑ඗ඞcy;䐊cute;䅃ƀaey઴હાron;䅇dil;䅅;䐝ƀgswે૰଎ativeƀMTV૓૟૨ediumSpace;怋hiĀcn૦૘ë૙eryThiî૙tedĀGL૸ଆreaterGreateòٳessLesóੈLine;䀊r;쀀𝔑ȀBnptଢନଷ଺reak;恠BreakingSpace;䂠f;愕ڀ;CDEGHLNPRSTV୕ୖ୪୼஡௫ఄ౞಄ದ೘ൡඅ櫬Āou୛୤ngruent;扢pCap;扭oubleVerticalBar;戦ƀlqxஃஊ஛ement;戉ualĀ;Tஒஓ扠ilde;쀀≂̸ists;戄reater΀;EFGLSTஶஷ஽௉௓௘௥扯qual;扱ullEqual;쀀≧̸reater;쀀≫̸ess;批lantEqual;쀀⩾̸ilde;扵umpń௲௽ownHump;쀀≎̸qual;쀀≏̸eĀfsఊధtTriangleƀ;BEచఛడ拪ar;쀀⧏̸qual;括s̀;EGLSTవశ఼ౄోౘ扮qual;扰reater;扸ess;쀀≪̸lantEqual;쀀⩽̸ilde;扴estedĀGL౨౹reaterGreater;쀀⪢̸essLess;쀀⪡̸recedesƀ;ESಒಓಛ技qual;쀀⪯̸lantEqual;拠ĀeiಫಹverseElement;戌ghtTriangleƀ;BEೋೌ೒拫ar;쀀⧐̸qual;拭ĀquೝഌuareSuĀbp೨೹setĀ;E೰ೳ쀀⊏̸qual;拢ersetĀ;Eഃആ쀀⊐̸qual;拣ƀbcpഓതൎsetĀ;Eഛഞ쀀⊂⃒qual;抈ceedsȀ;ESTലള഻െ抁qual;쀀⪰̸lantEqual;拡ilde;쀀≿̸ersetĀ;E൘൛쀀⊃⃒qual;抉ildeȀ;EFT൮൯൵ൿ扁qual;扄ullEqual;扇ilde;扉erticalBar;戤cr;쀀𝒩ilde耻Ñ䃑;䎝܀Eacdfgmoprstuvලෂ෉෕ෛ෠෧෼ขภยา฿ไlig;䅒cute耻Ó䃓Āiy෎ීrc耻Ô䃔;䐞blac;䅐r;쀀𝔒rave耻Ò䃒ƀaei෮ෲ෶cr;䅌ga;䎩cron;䎟pf;쀀𝕆enCurlyĀDQฎบoubleQuote;怜uote;怘;橔Āclวฬr;쀀𝒪ash耻Ø䃘iŬื฼de耻Õ䃕es;樷ml耻Ö䃖erĀBP๋๠Āar๐๓r;怾acĀek๚๜;揞et;掴arenthesis;揜Ҁacfhilors๿ງຊຏຒດຝະ໼rtialD;戂y;䐟r;쀀𝔓i;䎦;䎠usMinus;䂱Āipຢອncareplanåڝf;愙Ȁ;eio຺ູ໠໤檻cedesȀ;EST່້໏໚扺qual;檯lantEqual;扼ilde;找me;怳Ādp໩໮uct;戏ortionĀ;aȥ໹l;戝Āci༁༆r;쀀𝒫;䎨ȀUfos༑༖༛༟OT耻"䀢r;쀀𝔔pf;愚cr;쀀𝒬؀BEacefhiorsu༾གྷཇའཱིྦྷྪྭ႖ႩႴႾarr;椐G耻®䂮ƀcnrཎནབute;䅔g;柫rĀ;tཛྷཝ憠l;椖ƀaeyཧཬཱron;䅘dil;䅖;䐠Ā;vླྀཹ愜erseĀEUྂྙĀlq྇ྎement;戋uilibrium;懋pEquilibrium;楯r»ཹo;䎡ghtЀACDFTUVa࿁࿫࿳ဢဨၛႇϘĀnr࿆࿒gleBracket;柩rowƀ;BL࿜࿝࿡憒ar;懥eftArrow;懄eiling;按oǵ࿹\0စbleBracket;柧nǔည\0နeeVector;楝ectorĀ;Bဝသ懂ar;楕loor;挋Āerိ၃eƀ;AVဵံြ抢rrow;憦ector;楛iangleƀ;BEၐၑၕ抳ar;槐qual;抵pƀDTVၣၮၸownVector;楏eeVector;楜ectorĀ;Bႂႃ憾ar;楔ectorĀ;B႑႒懀ar;楓Āpuႛ႞f;愝ndImplies;楰ightarrow;懛ĀchႹႼr;愛;憱leDelayed;槴ڀHOacfhimoqstuფჱჷჽᄙᄞᅑᅖᅡᅧᆵᆻᆿĀCcჩხHcy;䐩y;䐨FTcy;䐬cute;䅚ʀ;aeiyᄈᄉᄎᄓᄗ檼ron;䅠dil;䅞rc;䅜;䐡r;쀀𝔖ortȀDLRUᄪᄴᄾᅉownArrow»ОeftArrow»࢚ightArrow»࿝pArrow;憑gma;䎣allCircle;战pf;쀀𝕊ɲᅭ\0\0ᅰt;戚areȀ;ISUᅻᅼᆉᆯ斡ntersection;抓uĀbpᆏᆞsetĀ;Eᆗᆘ抏qual;抑ersetĀ;Eᆨᆩ抐qual;抒nion;抔cr;쀀𝒮ar;拆ȀbcmpᇈᇛሉላĀ;sᇍᇎ拐etĀ;Eᇍᇕqual;抆ĀchᇠህeedsȀ;ESTᇭᇮᇴᇿ扻qual;檰lantEqual;扽ilde;承Tháྌ;我ƀ;esሒሓሣ拑rsetĀ;Eሜም抃qual;抇et»ሓրHRSacfhiorsሾቄ቉ቕ቞ቱቶኟዂወዑORN耻Þ䃞ADE;愢ĀHc቎ቒcy;䐋y;䐦Ābuቚቜ;䀉;䎤ƀaeyብቪቯron;䅤dil;䅢;䐢r;쀀𝔗Āeiቻ኉ǲኀ\0ኇefore;戴a;䎘Ācn኎ኘkSpace;쀀  Space;怉ldeȀ;EFTካኬኲኼ戼qual;扃ullEqual;扅ilde;扈pf;쀀𝕋ipleDot;惛Āctዖዛr;쀀𝒯rok;䅦ૡዷጎጚጦ\0ጬጱ\0\0\0\0\0ጸጽ፷ᎅ\0᏿ᐄᐊᐐĀcrዻጁute耻Ú䃚rĀ;oጇገ憟cir;楉rǣጓ\0጖y;䐎ve;䅬Āiyጞጣrc耻Û䃛;䐣blac;䅰r;쀀𝔘rave耻Ù䃙acr;䅪Ādiፁ፩erĀBPፈ፝Āarፍፐr;䁟acĀekፗፙ;揟et;掵arenthesis;揝onĀ;P፰፱拃lus;抎Āgp፻፿on;䅲f;쀀𝕌ЀADETadps᎕ᎮᎸᏄϨᏒᏗᏳrrowƀ;BDᅐᎠᎤar;椒ownArrow;懅ownArrow;憕quilibrium;楮eeĀ;AᏋᏌ报rrow;憥ownáϳerĀLRᏞᏨeftArrow;憖ightArrow;憗iĀ;lᏹᏺ䏒on;䎥ing;䅮cr;쀀𝒰ilde;䅨ml耻Ü䃜ҀDbcdefosvᐧᐬᐰᐳᐾᒅᒊᒐᒖash;披ar;櫫y;䐒ashĀ;lᐻᐼ抩;櫦Āerᑃᑅ;拁ƀbtyᑌᑐᑺar;怖Ā;iᑏᑕcalȀBLSTᑡᑥᑪᑴar;戣ine;䁼eparator;杘ilde;所ThinSpace;怊r;쀀𝔙pf;쀀𝕍cr;쀀𝒱dash;抪ʀcefosᒧᒬᒱᒶᒼirc;䅴dge;拀r;쀀𝔚pf;쀀𝕎cr;쀀𝒲Ȁfiosᓋᓐᓒᓘr;쀀𝔛;䎞pf;쀀𝕏cr;쀀𝒳ҀAIUacfosuᓱᓵᓹᓽᔄᔏᔔᔚᔠcy;䐯cy;䐇cy;䐮cute耻Ý䃝Āiyᔉᔍrc;䅶;䐫r;쀀𝔜pf;쀀𝕐cr;쀀𝒴ml;䅸ЀHacdefosᔵᔹᔿᕋᕏᕝᕠᕤcy;䐖cute;䅹Āayᕄᕉron;䅽;䐗ot;䅻ǲᕔ\0ᕛoWidtè૙a;䎖r;愨pf;愤cr;쀀𝒵௡ᖃᖊᖐ\0ᖰᖶᖿ\0\0\0\0ᗆᗛᗫᙟ᙭\0ᚕ᚛ᚲᚹ\0ᚾcute耻á䃡reve;䄃̀;Ediuyᖜᖝᖡᖣᖨᖭ戾;쀀∾̳;房rc耻â䃢te肻´̆;䐰lig耻æ䃦Ā;r²ᖺ;쀀𝔞rave耻à䃠ĀepᗊᗖĀfpᗏᗔsym;愵èᗓha;䎱ĀapᗟcĀclᗤᗧr;䄁g;樿ɤᗰ\0\0ᘊʀ;adsvᗺᗻᗿᘁᘇ戧nd;橕;橜lope;橘;橚΀;elmrszᘘᘙᘛᘞᘿᙏᙙ戠;榤e»ᘙsdĀ;aᘥᘦ戡ѡᘰᘲᘴᘶᘸᘺᘼᘾ;榨;榩;榪;榫;榬;榭;榮;榯tĀ;vᙅᙆ戟bĀ;dᙌᙍ抾;榝Āptᙔᙗh;戢»¹arr;捼Āgpᙣᙧon;䄅f;쀀𝕒΀;Eaeiop዁ᙻᙽᚂᚄᚇᚊ;橰cir;橯;扊d;手s;䀧roxĀ;e዁ᚒñᚃing耻å䃥ƀctyᚡᚦᚨr;쀀𝒶;䀪mpĀ;e዁ᚯñʈilde耻ã䃣ml耻ä䃤Āciᛂᛈoninôɲnt;樑ࠀNabcdefiklnoprsu᛭ᛱᜰ᜼ᝃᝈ᝸᝽០៦ᠹᡐᜍ᤽᥈ᥰot;櫭Ācrᛶ᜞kȀcepsᜀᜅᜍᜓong;扌psilon;䏶rime;怵imĀ;e᜚᜛戽q;拍Ŷᜢᜦee;抽edĀ;gᜬᜭ挅e»ᜭrkĀ;t፜᜷brk;掶Āoyᜁᝁ;䐱quo;怞ʀcmprtᝓ᝛ᝡᝤᝨausĀ;eĊĉptyv;榰séᜌnoõēƀahwᝯ᝱ᝳ;䎲;愶een;扬r;쀀𝔟g΀costuvwឍឝឳេ៕៛៞ƀaiuបពរðݠrc;旯p»፱ƀdptឤឨឭot;樀lus;樁imes;樂ɱឹ\0\0ើcup;樆ar;昅riangleĀdu៍្own;施p;斳plus;樄eåᑄåᒭarow;植ƀako៭ᠦᠵĀcn៲ᠣkƀlst៺֫᠂ozenge;槫riangleȀ;dlr᠒᠓᠘᠝斴own;斾eft;旂ight;斸k;搣Ʊᠫ\0ᠳƲᠯ\0ᠱ;斒;斑4;斓ck;斈ĀeoᠾᡍĀ;qᡃᡆ쀀=⃥uiv;쀀≡⃥t;挐Ȁptwxᡙᡞᡧᡬf;쀀𝕓Ā;tᏋᡣom»Ꮜtie;拈؀DHUVbdhmptuvᢅᢖᢪᢻᣗᣛᣬ᣿ᤅᤊᤐᤡȀLRlrᢎᢐᢒᢔ;敗;敔;敖;敓ʀ;DUduᢡᢢᢤᢦᢨ敐;敦;敩;敤;敧ȀLRlrᢳᢵᢷᢹ;敝;敚;敜;教΀;HLRhlrᣊᣋᣍᣏᣑᣓᣕ救;敬;散;敠;敫;敢;敟ox;槉ȀLRlrᣤᣦᣨᣪ;敕;敒;攐;攌ʀ;DUduڽ᣷᣹᣻᣽;敥;敨;攬;攴inus;抟lus;択imes;抠ȀLRlrᤙᤛᤝ᤟;敛;敘;攘;攔΀;HLRhlrᤰᤱᤳᤵᤷ᤻᤹攂;敪;敡;敞;攼;攤;攜Āevģ᥂bar耻¦䂦Ȁceioᥑᥖᥚᥠr;쀀𝒷mi;恏mĀ;e᜚᜜lƀ;bhᥨᥩᥫ䁜;槅sub;柈Ŭᥴ᥾lĀ;e᥹᥺怢t»᥺pƀ;Eeįᦅᦇ;檮Ā;qۜۛೡᦧ\0᧨ᨑᨕᨲ\0ᨷᩐ\0\0᪴\0\0᫁\0\0ᬡᬮ᭍᭒\0᯽\0ᰌƀcpr᦭ᦲ᧝ute;䄇̀;abcdsᦿᧀᧄ᧊᧕᧙戩nd;橄rcup;橉Āau᧏᧒p;橋p;橇ot;橀;쀀∩︀Āeo᧢᧥t;恁îړȀaeiu᧰᧻ᨁᨅǰ᧵\0᧸s;橍on;䄍dil耻ç䃧rc;䄉psĀ;sᨌᨍ橌m;橐ot;䄋ƀdmnᨛᨠᨦil肻¸ƭptyv;榲t脀¢;eᨭᨮ䂢räƲr;쀀𝔠ƀceiᨽᩀᩍy;䑇ckĀ;mᩇᩈ朓ark»ᩈ;䏇r΀;Ecefms᩟᩠ᩢᩫ᪤᪪᪮旋;槃ƀ;elᩩᩪᩭ䋆q;扗eɡᩴ\0\0᪈rrowĀlr᩼᪁eft;憺ight;憻ʀRSacd᪒᪔᪖᪚᪟»ཇ;擈st;抛irc;抚ash;抝nint;樐id;櫯cir;槂ubsĀ;u᪻᪼晣it»᪼ˬ᫇᫔᫺\0ᬊonĀ;eᫍᫎ䀺Ā;qÇÆɭ᫙\0\0᫢aĀ;t᫞᫟䀬;䁀ƀ;fl᫨᫩᫫戁îᅠeĀmx᫱᫶ent»᫩eóɍǧ᫾\0ᬇĀ;dኻᬂot;橭nôɆƀfryᬐᬔᬗ;쀀𝕔oäɔ脀©;sŕᬝr;愗Āaoᬥᬩrr;憵ss;朗Ācuᬲᬷr;쀀𝒸Ābpᬼ᭄Ā;eᭁᭂ櫏;櫑Ā;eᭉᭊ櫐;櫒dot;拯΀delprvw᭠᭬᭷ᮂᮬᯔ᯹arrĀlr᭨᭪;椸;椵ɰ᭲\0\0᭵r;拞c;拟arrĀ;p᭿ᮀ憶;椽̀;bcdosᮏᮐᮖᮡᮥᮨ截rcap;橈Āauᮛᮞp;橆p;橊ot;抍r;橅;쀀∪︀Ȁalrv᮵ᮿᯞᯣrrĀ;mᮼᮽ憷;椼yƀevwᯇᯔᯘqɰᯎ\0\0ᯒreã᭳uã᭵ee;拎edge;拏en耻¤䂤earrowĀlrᯮ᯳eft»ᮀight»ᮽeäᯝĀciᰁᰇoninôǷnt;戱lcty;挭ঀAHabcdefhijlorstuwz᰸᰻᰿ᱝᱩᱵᲊᲞᲬᲷ᳻᳿ᴍᵻᶑᶫᶻ᷆᷍rò΁ar;楥Ȁglrs᱈ᱍ᱒᱔ger;怠eth;愸òᄳhĀ;vᱚᱛ怐»ऊūᱡᱧarow;椏aã̕Āayᱮᱳron;䄏;䐴ƀ;ao̲ᱼᲄĀgrʿᲁr;懊tseq;橷ƀglmᲑᲔᲘ耻°䂰ta;䎴ptyv;榱ĀirᲣᲨsht;楿;쀀𝔡arĀlrᲳᲵ»ࣜ»သʀaegsv᳂͸᳖᳜᳠mƀ;oș᳊᳔ndĀ;ș᳑uit;晦amma;䏝in;拲ƀ;io᳧᳨᳸䃷de脀÷;o᳧ᳰntimes;拇nø᳷cy;䑒cɯᴆ\0\0ᴊrn;挞op;挍ʀlptuwᴘᴝᴢᵉᵕlar;䀤f;쀀𝕕ʀ;emps̋ᴭᴷᴽᵂqĀ;d͒ᴳot;扑inus;戸lus;戔quare;抡blebarwedgåúnƀadhᄮᵝᵧownarrowóᲃarpoonĀlrᵲᵶefôᲴighôᲶŢᵿᶅkaro÷གɯᶊ\0\0ᶎrn;挟op;挌ƀcotᶘᶣᶦĀryᶝᶡ;쀀𝒹;䑕l;槶rok;䄑Ādrᶰᶴot;拱iĀ;fᶺ᠖斿Āah᷀᷃ròЩaòྦangle;榦Āci᷒ᷕy;䑟grarr;柿ऀDacdefglmnopqrstuxḁḉḙḸոḼṉṡṾấắẽỡἪἷὄ὎὚ĀDoḆᴴoôᲉĀcsḎḔute耻é䃩ter;橮ȀaioyḢḧḱḶron;䄛rĀ;cḭḮ扖耻ê䃪lon;払;䑍ot;䄗ĀDrṁṅot;扒;쀀𝔢ƀ;rsṐṑṗ檚ave耻è䃨Ā;dṜṝ檖ot;檘Ȁ;ilsṪṫṲṴ檙nters;揧;愓Ā;dṹṺ檕ot;檗ƀapsẅẉẗcr;䄓tyƀ;svẒẓẕ戅et»ẓpĀ1;ẝẤĳạả;怄;怅怃ĀgsẪẬ;䅋p;怂ĀgpẴẸon;䄙f;쀀𝕖ƀalsỄỎỒrĀ;sỊị拕l;槣us;橱iƀ;lvỚớở䎵on»ớ;䏵ȀcsuvỪỳἋἣĀioữḱrc»Ḯɩỹ\0\0ỻíՈantĀglἂἆtr»ṝess»Ṻƀaeiἒ἖Ἒls;䀽st;扟vĀ;DȵἠD;橸parsl;槥ĀDaἯἳot;打rr;楱ƀcdiἾὁỸr;愯oô͒ĀahὉὋ;䎷耻ð䃰Āmrὓὗl耻ë䃫o;悬ƀcipὡὤὧl;䀡sôծĀeoὬὴctatioîՙnentialåչৡᾒ\0ᾞ\0ᾡᾧ\0\0ῆῌ\0ΐ\0ῦῪ \0 ⁚llingdotseñṄy;䑄male;晀ƀilrᾭᾳ῁lig;耀ﬃɩᾹ\0\0᾽g;耀ﬀig;耀ﬄ;쀀𝔣lig;耀ﬁlig;쀀fjƀaltῙ῜ῡt;晭ig;耀ﬂns;斱of;䆒ǰ΅\0ῳf;쀀𝕗ĀakֿῷĀ;vῼ´拔;櫙artint;樍Āao‌⁕Ācs‑⁒α‚‰‸⁅⁈\0⁐β•‥‧‪‬\0‮耻½䂽;慓耻¼䂼;慕;慙;慛Ƴ‴\0‶;慔;慖ʴ‾⁁\0\0⁃耻¾䂾;慗;慜5;慘ƶ⁌\0⁎;慚;慝8;慞l;恄wn;挢cr;쀀𝒻ࢀEabcdefgijlnorstv₂₉₟₥₰₴⃰⃵⃺⃿℃ℒℸ̗ℾ⅒↞Ā;lٍ₇;檌ƀcmpₐₕ₝ute;䇵maĀ;dₜ᳚䎳;檆reve;䄟Āiy₪₮rc;䄝;䐳ot;䄡Ȁ;lqsؾق₽⃉ƀ;qsؾٌ⃄lanô٥Ȁ;cdl٥⃒⃥⃕c;檩otĀ;o⃜⃝檀Ā;l⃢⃣檂;檄Ā;e⃪⃭쀀⋛︀s;檔r;쀀𝔤Ā;gٳ؛mel;愷cy;䑓Ȁ;Eajٚℌℎℐ;檒;檥;檤ȀEaesℛℝ℩ℴ;扩pĀ;p℣ℤ檊rox»ℤĀ;q℮ℯ檈Ā;q℮ℛim;拧pf;쀀𝕘Āci⅃ⅆr;愊mƀ;el٫ⅎ⅐;檎;檐茀>;cdlqr׮ⅠⅪⅮⅳⅹĀciⅥⅧ;檧r;橺ot;拗Par;榕uest;橼ʀadelsↄⅪ←ٖ↛ǰ↉\0↎proø₞r;楸qĀlqؿ↖lesó₈ií٫Āen↣↭rtneqq;쀀≩︀Å↪ԀAabcefkosy⇄⇇⇱⇵⇺∘∝∯≨≽ròΠȀilmr⇐⇔⇗⇛rsðᒄf»․ilôکĀdr⇠⇤cy;䑊ƀ;cwࣴ⇫⇯ir;楈;憭ar;意irc;䄥ƀalr∁∎∓rtsĀ;u∉∊晥it»∊lip;怦con;抹r;쀀𝔥sĀew∣∩arow;椥arow;椦ʀamopr∺∾≃≞≣rr;懿tht;戻kĀlr≉≓eftarrow;憩ightarrow;憪f;쀀𝕙bar;怕ƀclt≯≴≸r;쀀𝒽asè⇴rok;䄧Ābp⊂⊇ull;恃hen»ᱛૡ⊣\0⊪\0⊸⋅⋎\0⋕⋳\0\0⋸⌢⍧⍢⍿\0⎆⎪⎴cute耻í䃭ƀ;iyݱ⊰⊵rc耻î䃮;䐸Ācx⊼⊿y;䐵cl耻¡䂡ĀfrΟ⋉;쀀𝔦rave耻ì䃬Ȁ;inoܾ⋝⋩⋮Āin⋢⋦nt;樌t;戭fin;槜ta;愩lig;䄳ƀaop⋾⌚⌝ƀcgt⌅⌈⌗r;䄫ƀelpܟ⌏⌓inåގarôܠh;䄱f;抷ed;䆵ʀ;cfotӴ⌬⌱⌽⍁are;愅inĀ;t⌸⌹戞ie;槝doô⌙ʀ;celpݗ⍌⍐⍛⍡al;抺Āgr⍕⍙eróᕣã⍍arhk;樗rod;樼Ȁcgpt⍯⍲⍶⍻y;䑑on;䄯f;쀀𝕚a;䎹uest耻¿䂿Āci⎊⎏r;쀀𝒾nʀ;EdsvӴ⎛⎝⎡ӳ;拹ot;拵Ā;v⎦⎧拴;拳Ā;iݷ⎮lde;䄩ǫ⎸\0⎼cy;䑖l耻ï䃯̀cfmosu⏌⏗⏜⏡⏧⏵Āiy⏑⏕rc;䄵;䐹r;쀀𝔧ath;䈷pf;쀀𝕛ǣ⏬\0⏱r;쀀𝒿rcy;䑘kcy;䑔Ѐacfghjos␋␖␢␧␭␱␵␻ppaĀ;v␓␔䎺;䏰Āey␛␠dil;䄷;䐺r;쀀𝔨reen;䄸cy;䑅cy;䑜pf;쀀𝕜cr;쀀𝓀஀ABEHabcdefghjlmnoprstuv⑰⒁⒆⒍⒑┎┽╚▀♎♞♥♹♽⚚⚲⛘❝❨➋⟀⠁⠒ƀart⑷⑺⑼rò৆òΕail;椛arr;椎Ā;gঔ⒋;檋ar;楢ॣ⒥\0⒪\0⒱\0\0\0\0\0⒵Ⓔ\0ⓆⓈⓍ\0⓹ute;䄺mptyv;榴raîࡌbda;䎻gƀ;dlࢎⓁⓃ;榑åࢎ;檅uo耻«䂫rЀ;bfhlpst࢙ⓞⓦⓩ⓫⓮⓱⓵Ā;f࢝ⓣs;椟s;椝ë≒p;憫l;椹im;楳l;憢ƀ;ae⓿─┄檫il;椙Ā;s┉┊檭;쀀⪭︀ƀabr┕┙┝rr;椌rk;杲Āak┢┬cĀek┨┪;䁻;䁛Āes┱┳;榋lĀdu┹┻;榏;榍Ȁaeuy╆╋╖╘ron;䄾Ādi═╔il;䄼ìࢰâ┩;䐻Ȁcqrs╣╦╭╽a;椶uoĀ;rนᝆĀdu╲╷har;楧shar;楋h;憲ʀ;fgqs▋▌উ◳◿扤tʀahlrt▘▤▷◂◨rrowĀ;t࢙□aé⓶arpoonĀdu▯▴own»њp»०eftarrows;懇ightƀahs◍◖◞rrowĀ;sࣴࢧarpoonó྘quigarro÷⇰hreetimes;拋ƀ;qs▋ও◺lanôবʀ;cdgsব☊☍☝☨c;檨otĀ;o☔☕橿Ā;r☚☛檁;檃Ā;e☢☥쀀⋚︀s;檓ʀadegs☳☹☽♉♋pproøⓆot;拖qĀgq♃♅ôউgtò⒌ôছiíলƀilr♕࣡♚sht;楼;쀀𝔩Ā;Eজ♣;檑š♩♶rĀdu▲♮Ā;l॥♳;楪lk;斄cy;䑙ʀ;achtੈ⚈⚋⚑⚖rò◁orneòᴈard;楫ri;旺Āio⚟⚤dot;䅀ustĀ;a⚬⚭掰che»⚭ȀEaes⚻⚽⛉⛔;扨pĀ;p⛃⛄檉rox»⛄Ā;q⛎⛏檇Ā;q⛎⚻im;拦Ѐabnoptwz⛩⛴⛷✚✯❁❇❐Ānr⛮⛱g;柬r;懽rëࣁgƀlmr⛿✍✔eftĀar০✇ightá৲apsto;柼ightá৽parrowĀlr✥✩efô⓭ight;憬ƀafl✶✹✽r;榅;쀀𝕝us;樭imes;樴š❋❏st;戗áፎƀ;ef❗❘᠀旊nge»❘arĀ;l❤❥䀨t;榓ʀachmt❳❶❼➅➇ròࢨorneòᶌarĀ;d྘➃;業;怎ri;抿̀achiqt➘➝ੀ➢➮➻quo;怹r;쀀𝓁mƀ;egল➪➬;檍;檏Ābu┪➳oĀ;rฟ➹;怚rok;䅂萀<;cdhilqrࠫ⟒☹⟜⟠⟥⟪⟰Āci⟗⟙;檦r;橹reå◲mes;拉arr;楶uest;橻ĀPi⟵⟹ar;榖ƀ;ef⠀भ᠛旃rĀdu⠇⠍shar;楊har;楦Āen⠗⠡rtneqq;쀀≨︀Å⠞܀Dacdefhilnopsu⡀⡅⢂⢎⢓⢠⢥⢨⣚⣢⣤ઃ⣳⤂Dot;戺Ȁclpr⡎⡒⡣⡽r耻¯䂯Āet⡗⡙;時Ā;e⡞⡟朠se»⡟Ā;sျ⡨toȀ;dluျ⡳⡷⡻owîҌefôएðᏑker;斮Āoy⢇⢌mma;権;䐼ash;怔asuredangle»ᘦr;쀀𝔪o;愧ƀcdn⢯⢴⣉ro耻µ䂵Ȁ;acdᑤ⢽⣀⣄sôᚧir;櫰ot肻·Ƶusƀ;bd⣒ᤃ⣓戒Ā;uᴼ⣘;横ţ⣞⣡p;櫛ò−ðઁĀdp⣩⣮els;抧f;쀀𝕞Āct⣸⣽r;쀀𝓂pos»ᖝƀ;lm⤉⤊⤍䎼timap;抸ఀGLRVabcdefghijlmoprstuvw⥂⥓⥾⦉⦘⧚⧩⨕⨚⩘⩝⪃⪕⪤⪨⬄⬇⭄⭿⮮ⰴⱧⱼ⳩Āgt⥇⥋;쀀⋙̸Ā;v⥐௏쀀≫⃒ƀelt⥚⥲⥶ftĀar⥡⥧rrow;懍ightarrow;懎;쀀⋘̸Ā;v⥻ే쀀≪⃒ightarrow;懏ĀDd⦎⦓ash;抯ash;抮ʀbcnpt⦣⦧⦬⦱⧌la»˞ute;䅄g;쀀∠⃒ʀ;Eiop඄⦼⧀⧅⧈;쀀⩰̸d;쀀≋̸s;䅉roø඄urĀ;a⧓⧔普lĀ;s⧓ସǳ⧟\0⧣p肻 ଷmpĀ;e௹ఀʀaeouy⧴⧾⨃⨐⨓ǰ⧹\0⧻;橃on;䅈dil;䅆ngĀ;dൾ⨊ot;쀀⩭̸p;橂;䐽ash;怓΀;Aadqsxஒ⨩⨭⨻⩁⩅⩐rr;懗rĀhr⨳⨶k;椤Ā;oᏲᏰot;쀀≐̸uiöୣĀei⩊⩎ar;椨í஘istĀ;s஠டr;쀀𝔫ȀEest௅⩦⩹⩼ƀ;qs஼⩭௡ƀ;qs஼௅⩴lanô௢ií௪Ā;rஶ⪁»ஷƀAap⪊⪍⪑rò⥱rr;憮ar;櫲ƀ;svྍ⪜ྌĀ;d⪡⪢拼;拺cy;䑚΀AEadest⪷⪺⪾⫂⫅⫶⫹rò⥦;쀀≦̸rr;憚r;急Ȁ;fqs఻⫎⫣⫯tĀar⫔⫙rro÷⫁ightarro÷⪐ƀ;qs఻⪺⫪lanôౕĀ;sౕ⫴»శiíౝĀ;rవ⫾iĀ;eచథiäඐĀpt⬌⬑f;쀀𝕟膀¬;in⬙⬚⬶䂬nȀ;Edvஉ⬤⬨⬮;쀀⋹̸ot;쀀⋵̸ǡஉ⬳⬵;拷;拶iĀ;vಸ⬼ǡಸ⭁⭃;拾;拽ƀaor⭋⭣⭩rȀ;ast୻⭕⭚⭟lleì୻l;쀀⫽⃥;쀀∂̸lint;樔ƀ;ceಒ⭰⭳uåಥĀ;cಘ⭸Ā;eಒ⭽ñಘȀAait⮈⮋⮝⮧rò⦈rrƀ;cw⮔⮕⮙憛;쀀⤳̸;쀀↝̸ghtarrow»⮕riĀ;eೋೖ΀chimpqu⮽⯍⯙⬄୸⯤⯯Ȁ;cerല⯆ഷ⯉uå൅;쀀𝓃ortɭ⬅\0\0⯖ará⭖mĀ;e൮⯟Ā;q൴൳suĀbp⯫⯭å೸åഋƀbcp⯶ⰑⰙȀ;Ees⯿ⰀഢⰄ抄;쀀⫅̸etĀ;eഛⰋqĀ;qണⰀcĀ;eലⰗñസȀ;EesⰢⰣൟⰧ抅;쀀⫆̸etĀ;e൘ⰮqĀ;qൠⰣȀgilrⰽⰿⱅⱇìௗlde耻ñ䃱çృiangleĀlrⱒⱜeftĀ;eచⱚñదightĀ;eೋⱥñ೗Ā;mⱬⱭ䎽ƀ;esⱴⱵⱹ䀣ro;愖p;怇ҀDHadgilrsⲏⲔⲙⲞⲣⲰⲶⳓⳣash;抭arr;椄p;쀀≍⃒ash;抬ĀetⲨⲬ;쀀≥⃒;쀀>⃒nfin;槞ƀAetⲽⳁⳅrr;椂;쀀≤⃒Ā;rⳊⳍ쀀<⃒ie;쀀⊴⃒ĀAtⳘⳜrr;椃rie;쀀⊵⃒im;쀀∼⃒ƀAan⳰⳴ⴂrr;懖rĀhr⳺⳽k;椣Ā;oᏧᏥear;椧ቓ᪕\0\0\0\0\0\0\0\0\0\0\0\0\0ⴭ\0ⴸⵈⵠⵥ⵲ⶄᬇ\0\0ⶍⶫ\0ⷈⷎ\0ⷜ⸙⸫⸾⹃Ācsⴱ᪗ute耻ó䃳ĀiyⴼⵅrĀ;c᪞ⵂ耻ô䃴;䐾ʀabios᪠ⵒⵗǈⵚlac;䅑v;樸old;榼lig;䅓Ācr⵩⵭ir;榿;쀀𝔬ͯ⵹\0\0⵼\0ⶂn;䋛ave耻ò䃲;槁Ābmⶈ෴ar;榵Ȁacitⶕ⶘ⶥⶨrò᪀Āir⶝ⶠr;榾oss;榻nå๒;槀ƀaeiⶱⶵⶹcr;䅍ga;䏉ƀcdnⷀⷅǍron;䎿;榶pf;쀀𝕠ƀaelⷔ⷗ǒr;榷rp;榹΀;adiosvⷪⷫⷮ⸈⸍⸐⸖戨rò᪆Ȁ;efmⷷⷸ⸂⸅橝rĀ;oⷾⷿ愴f»ⷿ耻ª䂪耻º䂺gof;抶r;橖lope;橗;橛ƀclo⸟⸡⸧ò⸁ash耻ø䃸l;折iŬⸯ⸴de耻õ䃵esĀ;aǛ⸺s;樶ml耻ö䃶bar;挽ૡ⹞\0⹽\0⺀⺝\0⺢⺹\0\0⻋ຜ\0⼓\0\0⼫⾼\0⿈rȀ;astЃ⹧⹲຅脀¶;l⹭⹮䂶leìЃɩ⹸\0\0⹻m;櫳;櫽y;䐿rʀcimpt⺋⺏⺓ᡥ⺗nt;䀥od;䀮il;怰enk;怱r;쀀𝔭ƀimo⺨⺰⺴Ā;v⺭⺮䏆;䏕maô੶ne;明ƀ;tv⺿⻀⻈䏀chfork»´;䏖Āau⻏⻟nĀck⻕⻝kĀ;h⇴⻛;愎ö⇴sҀ;abcdemst⻳⻴ᤈ⻹⻽⼄⼆⼊⼎䀫cir;樣ir;樢Āouᵀ⼂;樥;橲n肻±ຝim;樦wo;樧ƀipu⼙⼠⼥ntint;樕f;쀀𝕡nd耻£䂣Ԁ;Eaceinosu່⼿⽁⽄⽇⾁⾉⾒⽾⾶;檳p;檷uå໙Ā;c໎⽌̀;acens່⽙⽟⽦⽨⽾pproø⽃urlyeñ໙ñ໎ƀaes⽯⽶⽺pprox;檹qq;檵im;拨iíໟmeĀ;s⾈ຮ怲ƀEas⽸⾐⽺ð⽵ƀdfp໬⾙⾯ƀals⾠⾥⾪lar;挮ine;挒urf;挓Ā;t໻⾴ï໻rel;抰Āci⿀⿅r;쀀𝓅;䏈ncsp;怈̀fiopsu⿚⋢⿟⿥⿫⿱r;쀀𝔮pf;쀀𝕢rime;恗cr;쀀𝓆ƀaeo⿸〉〓tĀei⿾々rnionóڰnt;樖stĀ;e【】䀿ñἙô༔઀ABHabcdefhilmnoprstux぀けさすムㄎㄫㅇㅢㅲㆎ㈆㈕㈤㈩㉘㉮㉲㊐㊰㊷ƀartぇおがròႳòϝail;検aròᱥar;楤΀cdenqrtとふへみわゔヌĀeuねぱ;쀀∽̱te;䅕iãᅮmptyv;榳gȀ;del࿑らるろ;榒;榥å࿑uo耻»䂻rր;abcfhlpstw࿜ガクシスゼゾダッデナp;極Ā;f࿠ゴs;椠;椳s;椞ë≝ð✮l;楅im;楴l;憣;憝Āaiパフil;椚oĀ;nホボ戶aló༞ƀabrョリヮrò៥rk;杳ĀakンヽcĀekヹ・;䁽;䁝Āes㄂㄄;榌lĀduㄊㄌ;榎;榐Ȁaeuyㄗㄜㄧㄩron;䅙Ādiㄡㄥil;䅗ì࿲âヺ;䑀Ȁclqsㄴㄷㄽㅄa;椷dhar;楩uoĀ;rȎȍh;憳ƀacgㅎㅟངlȀ;ipsླྀㅘㅛႜnåႻarôྩt;断ƀilrㅩဣㅮsht;楽;쀀𝔯ĀaoㅷㆆrĀduㅽㅿ»ѻĀ;l႑ㆄ;楬Ā;vㆋㆌ䏁;䏱ƀgns㆕ㇹㇼht̀ahlrstㆤㆰ㇂㇘㇤㇮rrowĀ;t࿜ㆭaéトarpoonĀduㆻㆿowîㅾp»႒eftĀah㇊㇐rrowó࿪arpoonóՑightarrows;應quigarro÷ニhreetimes;拌g;䋚ingdotseñἲƀahm㈍㈐㈓rò࿪aòՑ;怏oustĀ;a㈞㈟掱che»㈟mid;櫮Ȁabpt㈲㈽㉀㉒Ānr㈷㈺g;柭r;懾rëဃƀafl㉇㉊㉎r;榆;쀀𝕣us;樮imes;樵Āap㉝㉧rĀ;g㉣㉤䀩t;榔olint;樒arò㇣Ȁachq㉻㊀Ⴜ㊅quo;怺r;쀀𝓇Ābu・㊊oĀ;rȔȓƀhir㊗㊛㊠reåㇸmes;拊iȀ;efl㊪ၙᠡ㊫方tri;槎luhar;楨;愞ൡ㋕㋛㋟㌬㌸㍱\0㍺㎤\0\0㏬㏰\0㐨㑈㑚㒭㒱㓊㓱\0㘖\0\0㘳cute;䅛quï➺Ԁ;Eaceinpsyᇭ㋳㋵㋿㌂㌋㌏㌟㌦㌩;檴ǰ㋺\0㋼;檸on;䅡uåᇾĀ;dᇳ㌇il;䅟rc;䅝ƀEas㌖㌘㌛;檶p;檺im;择olint;樓iíሄ;䑁otƀ;be㌴ᵇ㌵担;橦΀Aacmstx㍆㍊㍗㍛㍞㍣㍭rr;懘rĀhr㍐㍒ë∨Ā;oਸ਼਴t耻§䂧i;䀻war;椩mĀin㍩ðnuóñt;朶rĀ;o㍶⁕쀀𝔰Ȁacoy㎂㎆㎑㎠rp;景Āhy㎋㎏cy;䑉;䑈rtɭ㎙\0\0㎜iäᑤaraì⹯耻­䂭Āgm㎨㎴maƀ;fv㎱㎲㎲䏃;䏂Ѐ;deglnprካ㏅㏉㏎㏖㏞㏡㏦ot;橪Ā;q኱ኰĀ;E㏓㏔檞;檠Ā;E㏛㏜檝;檟e;扆lus;樤arr;楲aròᄽȀaeit㏸㐈㐏㐗Āls㏽㐄lsetmé㍪hp;樳parsl;槤Ādlᑣ㐔e;挣Ā;e㐜㐝檪Ā;s㐢㐣檬;쀀⪬︀ƀflp㐮㐳㑂tcy;䑌Ā;b㐸㐹䀯Ā;a㐾㐿槄r;挿f;쀀𝕤aĀdr㑍ЂesĀ;u㑔㑕晠it»㑕ƀcsu㑠㑹㒟Āau㑥㑯pĀ;sᆈ㑫;쀀⊓︀pĀ;sᆴ㑵;쀀⊔︀uĀbp㑿㒏ƀ;esᆗᆜ㒆etĀ;eᆗ㒍ñᆝƀ;esᆨᆭ㒖etĀ;eᆨ㒝ñᆮƀ;afᅻ㒦ְrť㒫ֱ»ᅼaròᅈȀcemt㒹㒾㓂㓅r;쀀𝓈tmîñiì㐕aræᆾĀar㓎㓕rĀ;f㓔ឿ昆Āan㓚㓭ightĀep㓣㓪psiloîỠhé⺯s»⡒ʀbcmnp㓻㕞ሉ㖋㖎Ҁ;Edemnprs㔎㔏㔑㔕㔞㔣㔬㔱㔶抂;櫅ot;檽Ā;dᇚ㔚ot;櫃ult;櫁ĀEe㔨㔪;櫋;把lus;檿arr;楹ƀeiu㔽㕒㕕tƀ;en㔎㕅㕋qĀ;qᇚ㔏eqĀ;q㔫㔨m;櫇Ābp㕚㕜;櫕;櫓c̀;acensᇭ㕬㕲㕹㕻㌦pproø㋺urlyeñᇾñᇳƀaes㖂㖈㌛pproø㌚qñ㌗g;晪ڀ123;Edehlmnps㖩㖬㖯ሜ㖲㖴㗀㗉㗕㗚㗟㗨㗭耻¹䂹耻²䂲耻³䂳;櫆Āos㖹㖼t;檾ub;櫘Ā;dሢ㗅ot;櫄sĀou㗏㗒l;柉b;櫗arr;楻ult;櫂ĀEe㗤㗦;櫌;抋lus;櫀ƀeiu㗴㘉㘌tƀ;enሜ㗼㘂qĀ;qሢ㖲eqĀ;q㗧㗤m;櫈Ābp㘑㘓;櫔;櫖ƀAan㘜㘠㘭rr;懙rĀhr㘦㘨ë∮Ā;oਫ਩war;椪lig耻ß䃟௡㙑㙝㙠ዎ㙳㙹\0㙾㛂\0\0\0\0\0㛛㜃\0㜉㝬\0\0\0㞇ɲ㙖\0\0㙛get;挖;䏄rë๟ƀaey㙦㙫㙰ron;䅥dil;䅣;䑂lrec;挕r;쀀𝔱Ȁeiko㚆㚝㚵㚼ǲ㚋\0㚑eĀ4fኄኁaƀ;sv㚘㚙㚛䎸ym;䏑Ācn㚢㚲kĀas㚨㚮pproø዁im»ኬsðኞĀas㚺㚮ð዁rn耻þ䃾Ǭ̟㛆⋧es膀×;bd㛏㛐㛘䃗Ā;aᤏ㛕r;樱;樰ƀeps㛡㛣㜀á⩍Ȁ;bcf҆㛬㛰㛴ot;挶ir;櫱Ā;o㛹㛼쀀𝕥rk;櫚á㍢rime;怴ƀaip㜏㜒㝤dåቈ΀adempst㜡㝍㝀㝑㝗㝜㝟ngleʀ;dlqr㜰㜱㜶㝀㝂斵own»ᶻeftĀ;e⠀㜾ñम;扜ightĀ;e㊪㝋ñၚot;旬inus;樺lus;樹b;槍ime;樻ezium;揢ƀcht㝲㝽㞁Āry㝷㝻;쀀𝓉;䑆cy;䑛rok;䅧Āio㞋㞎xô᝷headĀlr㞗㞠eftarro÷ࡏightarrow»ཝऀAHabcdfghlmoprstuw㟐㟓㟗㟤㟰㟼㠎㠜㠣㠴㡑㡝㡫㢩㣌㣒㣪㣶ròϭar;楣Ācr㟜㟢ute耻ú䃺òᅐrǣ㟪\0㟭y;䑞ve;䅭Āiy㟵㟺rc耻û䃻;䑃ƀabh㠃㠆㠋ròᎭlac;䅱aòᏃĀir㠓㠘sht;楾;쀀𝔲rave耻ù䃹š㠧㠱rĀlr㠬㠮»ॗ»ႃlk;斀Āct㠹㡍ɯ㠿\0\0㡊rnĀ;e㡅㡆挜r»㡆op;挏ri;旸Āal㡖㡚cr;䅫肻¨͉Āgp㡢㡦on;䅳f;쀀𝕦̀adhlsuᅋ㡸㡽፲㢑㢠ownáᎳarpoonĀlr㢈㢌efô㠭ighô㠯iƀ;hl㢙㢚㢜䏅»ᏺon»㢚parrows;懈ƀcit㢰㣄㣈ɯ㢶\0\0㣁rnĀ;e㢼㢽挝r»㢽op;挎ng;䅯ri;旹cr;쀀𝓊ƀdir㣙㣝㣢ot;拰lde;䅩iĀ;f㜰㣨»᠓Āam㣯㣲rò㢨l耻ü䃼angle;榧ހABDacdeflnoprsz㤜㤟㤩㤭㦵㦸㦽㧟㧤㧨㧳㧹㧽㨁㨠ròϷarĀ;v㤦㤧櫨;櫩asèϡĀnr㤲㤷grt;榜΀eknprst㓣㥆㥋㥒㥝㥤㦖appá␕othinçẖƀhir㓫⻈㥙opô⾵Ā;hᎷ㥢ïㆍĀiu㥩㥭gmá㎳Ābp㥲㦄setneqĀ;q㥽㦀쀀⊊︀;쀀⫋︀setneqĀ;q㦏㦒쀀⊋︀;쀀⫌︀Āhr㦛㦟etá㚜iangleĀlr㦪㦯eft»थight»ၑy;䐲ash»ံƀelr㧄㧒㧗ƀ;beⷪ㧋㧏ar;抻q;扚lip;拮Ābt㧜ᑨaòᑩr;쀀𝔳tré㦮suĀbp㧯㧱»ജ»൙pf;쀀𝕧roð໻tré㦴Ācu㨆㨋r;쀀𝓋Ābp㨐㨘nĀEe㦀㨖»㥾nĀEe㦒㨞»㦐igzag;榚΀cefoprs㨶㨻㩖㩛㩔㩡㩪irc;䅵Ādi㩀㩑Ābg㩅㩉ar;機eĀ;qᗺ㩏;扙erp;愘r;쀀𝔴pf;쀀𝕨Ā;eᑹ㩦atèᑹcr;쀀𝓌ૣណ㪇\0㪋\0㪐㪛\0\0㪝㪨㪫㪯\0\0㫃㫎\0㫘ៜ៟tré៑r;쀀𝔵ĀAa㪔㪗ròσrò৶;䎾ĀAa㪡㪤ròθrò৫að✓is;拻ƀdptឤ㪵㪾Āfl㪺ឩ;쀀𝕩imåឲĀAa㫇㫊ròώròਁĀcq㫒ីr;쀀𝓍Āpt៖㫜ré។Ѐacefiosu㫰㫽㬈㬌㬑㬕㬛㬡cĀuy㫶㫻te耻ý䃽;䑏Āiy㬂㬆rc;䅷;䑋n耻¥䂥r;쀀𝔶cy;䑗pf;쀀𝕪cr;쀀𝓎Ācm㬦㬩y;䑎l耻ÿ䃿Ԁacdefhiosw㭂㭈㭔㭘㭤㭩㭭㭴㭺㮀cute;䅺Āay㭍㭒ron;䅾;䐷ot;䅼Āet㭝㭡træᕟa;䎶r;쀀𝔷cy;䐶grarr;懝pf;쀀𝕫cr;쀀𝓏Ājn㮅㮇;怍j;怌'.split("").map((function(e){return e.charCodeAt(0)})))},2060:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=new Uint16Array("Ȁaglq\tɭ\0\0p;䀦os;䀧t;䀾t;䀼uot;䀢".split("").map((function(e){return e.charCodeAt(0)})))},4021:(e,t)=>{"use strict";function i(e){for(var t=1;t<e.length;t++)e[t][0]+=e[t-1][0]+1;return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=new Map(i([[9,"&Tab;"],[0,"&NewLine;"],[22,"&excl;"],[0,"&quot;"],[0,"&num;"],[0,"&dollar;"],[0,"&percnt;"],[0,"&amp;"],[0,"&apos;"],[0,"&lpar;"],[0,"&rpar;"],[0,"&ast;"],[0,"&plus;"],[0,"&comma;"],[1,"&period;"],[0,"&sol;"],[10,"&colon;"],[0,"&semi;"],[0,{v:"&lt;",n:8402,o:"&nvlt;"}],[0,{v:"&equals;",n:8421,o:"&bne;"}],[0,{v:"&gt;",n:8402,o:"&nvgt;"}],[0,"&quest;"],[0,"&commat;"],[26,"&lbrack;"],[0,"&bsol;"],[0,"&rbrack;"],[0,"&Hat;"],[0,"&lowbar;"],[0,"&DiacriticalGrave;"],[5,{n:106,o:"&fjlig;"}],[20,"&lbrace;"],[0,"&verbar;"],[0,"&rbrace;"],[34,"&nbsp;"],[0,"&iexcl;"],[0,"&cent;"],[0,"&pound;"],[0,"&curren;"],[0,"&yen;"],[0,"&brvbar;"],[0,"&sect;"],[0,"&die;"],[0,"&copy;"],[0,"&ordf;"],[0,"&laquo;"],[0,"&not;"],[0,"&shy;"],[0,"&circledR;"],[0,"&macr;"],[0,"&deg;"],[0,"&PlusMinus;"],[0,"&sup2;"],[0,"&sup3;"],[0,"&acute;"],[0,"&micro;"],[0,"&para;"],[0,"&centerdot;"],[0,"&cedil;"],[0,"&sup1;"],[0,"&ordm;"],[0,"&raquo;"],[0,"&frac14;"],[0,"&frac12;"],[0,"&frac34;"],[0,"&iquest;"],[0,"&Agrave;"],[0,"&Aacute;"],[0,"&Acirc;"],[0,"&Atilde;"],[0,"&Auml;"],[0,"&angst;"],[0,"&AElig;"],[0,"&Ccedil;"],[0,"&Egrave;"],[0,"&Eacute;"],[0,"&Ecirc;"],[0,"&Euml;"],[0,"&Igrave;"],[0,"&Iacute;"],[0,"&Icirc;"],[0,"&Iuml;"],[0,"&ETH;"],[0,"&Ntilde;"],[0,"&Ograve;"],[0,"&Oacute;"],[0,"&Ocirc;"],[0,"&Otilde;"],[0,"&Ouml;"],[0,"&times;"],[0,"&Oslash;"],[0,"&Ugrave;"],[0,"&Uacute;"],[0,"&Ucirc;"],[0,"&Uuml;"],[0,"&Yacute;"],[0,"&THORN;"],[0,"&szlig;"],[0,"&agrave;"],[0,"&aacute;"],[0,"&acirc;"],[0,"&atilde;"],[0,"&auml;"],[0,"&aring;"],[0,"&aelig;"],[0,"&ccedil;"],[0,"&egrave;"],[0,"&eacute;"],[0,"&ecirc;"],[0,"&euml;"],[0,"&igrave;"],[0,"&iacute;"],[0,"&icirc;"],[0,"&iuml;"],[0,"&eth;"],[0,"&ntilde;"],[0,"&ograve;"],[0,"&oacute;"],[0,"&ocirc;"],[0,"&otilde;"],[0,"&ouml;"],[0,"&div;"],[0,"&oslash;"],[0,"&ugrave;"],[0,"&uacute;"],[0,"&ucirc;"],[0,"&uuml;"],[0,"&yacute;"],[0,"&thorn;"],[0,"&yuml;"],[0,"&Amacr;"],[0,"&amacr;"],[0,"&Abreve;"],[0,"&abreve;"],[0,"&Aogon;"],[0,"&aogon;"],[0,"&Cacute;"],[0,"&cacute;"],[0,"&Ccirc;"],[0,"&ccirc;"],[0,"&Cdot;"],[0,"&cdot;"],[0,"&Ccaron;"],[0,"&ccaron;"],[0,"&Dcaron;"],[0,"&dcaron;"],[0,"&Dstrok;"],[0,"&dstrok;"],[0,"&Emacr;"],[0,"&emacr;"],[2,"&Edot;"],[0,"&edot;"],[0,"&Eogon;"],[0,"&eogon;"],[0,"&Ecaron;"],[0,"&ecaron;"],[0,"&Gcirc;"],[0,"&gcirc;"],[0,"&Gbreve;"],[0,"&gbreve;"],[0,"&Gdot;"],[0,"&gdot;"],[0,"&Gcedil;"],[1,"&Hcirc;"],[0,"&hcirc;"],[0,"&Hstrok;"],[0,"&hstrok;"],[0,"&Itilde;"],[0,"&itilde;"],[0,"&Imacr;"],[0,"&imacr;"],[2,"&Iogon;"],[0,"&iogon;"],[0,"&Idot;"],[0,"&imath;"],[0,"&IJlig;"],[0,"&ijlig;"],[0,"&Jcirc;"],[0,"&jcirc;"],[0,"&Kcedil;"],[0,"&kcedil;"],[0,"&kgreen;"],[0,"&Lacute;"],[0,"&lacute;"],[0,"&Lcedil;"],[0,"&lcedil;"],[0,"&Lcaron;"],[0,"&lcaron;"],[0,"&Lmidot;"],[0,"&lmidot;"],[0,"&Lstrok;"],[0,"&lstrok;"],[0,"&Nacute;"],[0,"&nacute;"],[0,"&Ncedil;"],[0,"&ncedil;"],[0,"&Ncaron;"],[0,"&ncaron;"],[0,"&napos;"],[0,"&ENG;"],[0,"&eng;"],[0,"&Omacr;"],[0,"&omacr;"],[2,"&Odblac;"],[0,"&odblac;"],[0,"&OElig;"],[0,"&oelig;"],[0,"&Racute;"],[0,"&racute;"],[0,"&Rcedil;"],[0,"&rcedil;"],[0,"&Rcaron;"],[0,"&rcaron;"],[0,"&Sacute;"],[0,"&sacute;"],[0,"&Scirc;"],[0,"&scirc;"],[0,"&Scedil;"],[0,"&scedil;"],[0,"&Scaron;"],[0,"&scaron;"],[0,"&Tcedil;"],[0,"&tcedil;"],[0,"&Tcaron;"],[0,"&tcaron;"],[0,"&Tstrok;"],[0,"&tstrok;"],[0,"&Utilde;"],[0,"&utilde;"],[0,"&Umacr;"],[0,"&umacr;"],[0,"&Ubreve;"],[0,"&ubreve;"],[0,"&Uring;"],[0,"&uring;"],[0,"&Udblac;"],[0,"&udblac;"],[0,"&Uogon;"],[0,"&uogon;"],[0,"&Wcirc;"],[0,"&wcirc;"],[0,"&Ycirc;"],[0,"&ycirc;"],[0,"&Yuml;"],[0,"&Zacute;"],[0,"&zacute;"],[0,"&Zdot;"],[0,"&zdot;"],[0,"&Zcaron;"],[0,"&zcaron;"],[19,"&fnof;"],[34,"&imped;"],[63,"&gacute;"],[65,"&jmath;"],[142,"&circ;"],[0,"&caron;"],[16,"&breve;"],[0,"&DiacriticalDot;"],[0,"&ring;"],[0,"&ogon;"],[0,"&DiacriticalTilde;"],[0,"&dblac;"],[51,"&DownBreve;"],[127,"&Alpha;"],[0,"&Beta;"],[0,"&Gamma;"],[0,"&Delta;"],[0,"&Epsilon;"],[0,"&Zeta;"],[0,"&Eta;"],[0,"&Theta;"],[0,"&Iota;"],[0,"&Kappa;"],[0,"&Lambda;"],[0,"&Mu;"],[0,"&Nu;"],[0,"&Xi;"],[0,"&Omicron;"],[0,"&Pi;"],[0,"&Rho;"],[1,"&Sigma;"],[0,"&Tau;"],[0,"&Upsilon;"],[0,"&Phi;"],[0,"&Chi;"],[0,"&Psi;"],[0,"&ohm;"],[7,"&alpha;"],[0,"&beta;"],[0,"&gamma;"],[0,"&delta;"],[0,"&epsi;"],[0,"&zeta;"],[0,"&eta;"],[0,"&theta;"],[0,"&iota;"],[0,"&kappa;"],[0,"&lambda;"],[0,"&mu;"],[0,"&nu;"],[0,"&xi;"],[0,"&omicron;"],[0,"&pi;"],[0,"&rho;"],[0,"&sigmaf;"],[0,"&sigma;"],[0,"&tau;"],[0,"&upsi;"],[0,"&phi;"],[0,"&chi;"],[0,"&psi;"],[0,"&omega;"],[7,"&thetasym;"],[0,"&Upsi;"],[2,"&phiv;"],[0,"&piv;"],[5,"&Gammad;"],[0,"&digamma;"],[18,"&kappav;"],[0,"&rhov;"],[3,"&epsiv;"],[0,"&backepsilon;"],[10,"&IOcy;"],[0,"&DJcy;"],[0,"&GJcy;"],[0,"&Jukcy;"],[0,"&DScy;"],[0,"&Iukcy;"],[0,"&YIcy;"],[0,"&Jsercy;"],[0,"&LJcy;"],[0,"&NJcy;"],[0,"&TSHcy;"],[0,"&KJcy;"],[1,"&Ubrcy;"],[0,"&DZcy;"],[0,"&Acy;"],[0,"&Bcy;"],[0,"&Vcy;"],[0,"&Gcy;"],[0,"&Dcy;"],[0,"&IEcy;"],[0,"&ZHcy;"],[0,"&Zcy;"],[0,"&Icy;"],[0,"&Jcy;"],[0,"&Kcy;"],[0,"&Lcy;"],[0,"&Mcy;"],[0,"&Ncy;"],[0,"&Ocy;"],[0,"&Pcy;"],[0,"&Rcy;"],[0,"&Scy;"],[0,"&Tcy;"],[0,"&Ucy;"],[0,"&Fcy;"],[0,"&KHcy;"],[0,"&TScy;"],[0,"&CHcy;"],[0,"&SHcy;"],[0,"&SHCHcy;"],[0,"&HARDcy;"],[0,"&Ycy;"],[0,"&SOFTcy;"],[0,"&Ecy;"],[0,"&YUcy;"],[0,"&YAcy;"],[0,"&acy;"],[0,"&bcy;"],[0,"&vcy;"],[0,"&gcy;"],[0,"&dcy;"],[0,"&iecy;"],[0,"&zhcy;"],[0,"&zcy;"],[0,"&icy;"],[0,"&jcy;"],[0,"&kcy;"],[0,"&lcy;"],[0,"&mcy;"],[0,"&ncy;"],[0,"&ocy;"],[0,"&pcy;"],[0,"&rcy;"],[0,"&scy;"],[0,"&tcy;"],[0,"&ucy;"],[0,"&fcy;"],[0,"&khcy;"],[0,"&tscy;"],[0,"&chcy;"],[0,"&shcy;"],[0,"&shchcy;"],[0,"&hardcy;"],[0,"&ycy;"],[0,"&softcy;"],[0,"&ecy;"],[0,"&yucy;"],[0,"&yacy;"],[1,"&iocy;"],[0,"&djcy;"],[0,"&gjcy;"],[0,"&jukcy;"],[0,"&dscy;"],[0,"&iukcy;"],[0,"&yicy;"],[0,"&jsercy;"],[0,"&ljcy;"],[0,"&njcy;"],[0,"&tshcy;"],[0,"&kjcy;"],[1,"&ubrcy;"],[0,"&dzcy;"],[7074,"&ensp;"],[0,"&emsp;"],[0,"&emsp13;"],[0,"&emsp14;"],[1,"&numsp;"],[0,"&puncsp;"],[0,"&ThinSpace;"],[0,"&hairsp;"],[0,"&NegativeMediumSpace;"],[0,"&zwnj;"],[0,"&zwj;"],[0,"&lrm;"],[0,"&rlm;"],[0,"&dash;"],[2,"&ndash;"],[0,"&mdash;"],[0,"&horbar;"],[0,"&Verbar;"],[1,"&lsquo;"],[0,"&CloseCurlyQuote;"],[0,"&lsquor;"],[1,"&ldquo;"],[0,"&CloseCurlyDoubleQuote;"],[0,"&bdquo;"],[1,"&dagger;"],[0,"&Dagger;"],[0,"&bull;"],[2,"&nldr;"],[0,"&hellip;"],[9,"&permil;"],[0,"&pertenk;"],[0,"&prime;"],[0,"&Prime;"],[0,"&tprime;"],[0,"&backprime;"],[3,"&lsaquo;"],[0,"&rsaquo;"],[3,"&oline;"],[2,"&caret;"],[1,"&hybull;"],[0,"&frasl;"],[10,"&bsemi;"],[7,"&qprime;"],[7,{v:"&MediumSpace;",n:8202,o:"&ThickSpace;"}],[0,"&NoBreak;"],[0,"&af;"],[0,"&InvisibleTimes;"],[0,"&ic;"],[72,"&euro;"],[46,"&tdot;"],[0,"&DotDot;"],[37,"&complexes;"],[2,"&incare;"],[4,"&gscr;"],[0,"&hamilt;"],[0,"&Hfr;"],[0,"&Hopf;"],[0,"&planckh;"],[0,"&hbar;"],[0,"&imagline;"],[0,"&Ifr;"],[0,"&lagran;"],[0,"&ell;"],[1,"&naturals;"],[0,"&numero;"],[0,"&copysr;"],[0,"&weierp;"],[0,"&Popf;"],[0,"&Qopf;"],[0,"&realine;"],[0,"&real;"],[0,"&reals;"],[0,"&rx;"],[3,"&trade;"],[1,"&integers;"],[2,"&mho;"],[0,"&zeetrf;"],[0,"&iiota;"],[2,"&bernou;"],[0,"&Cayleys;"],[1,"&escr;"],[0,"&Escr;"],[0,"&Fouriertrf;"],[1,"&Mellintrf;"],[0,"&order;"],[0,"&alefsym;"],[0,"&beth;"],[0,"&gimel;"],[0,"&daleth;"],[12,"&CapitalDifferentialD;"],[0,"&dd;"],[0,"&ee;"],[0,"&ii;"],[10,"&frac13;"],[0,"&frac23;"],[0,"&frac15;"],[0,"&frac25;"],[0,"&frac35;"],[0,"&frac45;"],[0,"&frac16;"],[0,"&frac56;"],[0,"&frac18;"],[0,"&frac38;"],[0,"&frac58;"],[0,"&frac78;"],[49,"&larr;"],[0,"&ShortUpArrow;"],[0,"&rarr;"],[0,"&darr;"],[0,"&harr;"],[0,"&updownarrow;"],[0,"&nwarr;"],[0,"&nearr;"],[0,"&LowerRightArrow;"],[0,"&LowerLeftArrow;"],[0,"&nlarr;"],[0,"&nrarr;"],[1,{v:"&rarrw;",n:824,o:"&nrarrw;"}],[0,"&Larr;"],[0,"&Uarr;"],[0,"&Rarr;"],[0,"&Darr;"],[0,"&larrtl;"],[0,"&rarrtl;"],[0,"&LeftTeeArrow;"],[0,"&mapstoup;"],[0,"&map;"],[0,"&DownTeeArrow;"],[1,"&hookleftarrow;"],[0,"&hookrightarrow;"],[0,"&larrlp;"],[0,"&looparrowright;"],[0,"&harrw;"],[0,"&nharr;"],[1,"&lsh;"],[0,"&rsh;"],[0,"&ldsh;"],[0,"&rdsh;"],[1,"&crarr;"],[0,"&cularr;"],[0,"&curarr;"],[2,"&circlearrowleft;"],[0,"&circlearrowright;"],[0,"&leftharpoonup;"],[0,"&DownLeftVector;"],[0,"&RightUpVector;"],[0,"&LeftUpVector;"],[0,"&rharu;"],[0,"&DownRightVector;"],[0,"&dharr;"],[0,"&dharl;"],[0,"&RightArrowLeftArrow;"],[0,"&udarr;"],[0,"&LeftArrowRightArrow;"],[0,"&leftleftarrows;"],[0,"&upuparrows;"],[0,"&rightrightarrows;"],[0,"&ddarr;"],[0,"&leftrightharpoons;"],[0,"&Equilibrium;"],[0,"&nlArr;"],[0,"&nhArr;"],[0,"&nrArr;"],[0,"&DoubleLeftArrow;"],[0,"&DoubleUpArrow;"],[0,"&DoubleRightArrow;"],[0,"&dArr;"],[0,"&DoubleLeftRightArrow;"],[0,"&DoubleUpDownArrow;"],[0,"&nwArr;"],[0,"&neArr;"],[0,"&seArr;"],[0,"&swArr;"],[0,"&lAarr;"],[0,"&rAarr;"],[1,"&zigrarr;"],[6,"&larrb;"],[0,"&rarrb;"],[15,"&DownArrowUpArrow;"],[7,"&loarr;"],[0,"&roarr;"],[0,"&hoarr;"],[0,"&forall;"],[0,"&comp;"],[0,{v:"&part;",n:824,o:"&npart;"}],[0,"&exist;"],[0,"&nexist;"],[0,"&empty;"],[1,"&Del;"],[0,"&Element;"],[0,"&NotElement;"],[1,"&ni;"],[0,"&notni;"],[2,"&prod;"],[0,"&coprod;"],[0,"&sum;"],[0,"&minus;"],[0,"&MinusPlus;"],[0,"&dotplus;"],[1,"&Backslash;"],[0,"&lowast;"],[0,"&compfn;"],[1,"&radic;"],[2,"&prop;"],[0,"&infin;"],[0,"&angrt;"],[0,{v:"&ang;",n:8402,o:"&nang;"}],[0,"&angmsd;"],[0,"&angsph;"],[0,"&mid;"],[0,"&nmid;"],[0,"&DoubleVerticalBar;"],[0,"&NotDoubleVerticalBar;"],[0,"&and;"],[0,"&or;"],[0,{v:"&cap;",n:65024,o:"&caps;"}],[0,{v:"&cup;",n:65024,o:"&cups;"}],[0,"&int;"],[0,"&Int;"],[0,"&iiint;"],[0,"&conint;"],[0,"&Conint;"],[0,"&Cconint;"],[0,"&cwint;"],[0,"&ClockwiseContourIntegral;"],[0,"&awconint;"],[0,"&there4;"],[0,"&becaus;"],[0,"&ratio;"],[0,"&Colon;"],[0,"&dotminus;"],[1,"&mDDot;"],[0,"&homtht;"],[0,{v:"&sim;",n:8402,o:"&nvsim;"}],[0,{v:"&backsim;",n:817,o:"&race;"}],[0,{v:"&ac;",n:819,o:"&acE;"}],[0,"&acd;"],[0,"&VerticalTilde;"],[0,"&NotTilde;"],[0,{v:"&eqsim;",n:824,o:"&nesim;"}],[0,"&sime;"],[0,"&NotTildeEqual;"],[0,"&cong;"],[0,"&simne;"],[0,"&ncong;"],[0,"&ap;"],[0,"&nap;"],[0,"&ape;"],[0,{v:"&apid;",n:824,o:"&napid;"}],[0,"&backcong;"],[0,{v:"&asympeq;",n:8402,o:"&nvap;"}],[0,{v:"&bump;",n:824,o:"&nbump;"}],[0,{v:"&bumpe;",n:824,o:"&nbumpe;"}],[0,{v:"&doteq;",n:824,o:"&nedot;"}],[0,"&doteqdot;"],[0,"&efDot;"],[0,"&erDot;"],[0,"&Assign;"],[0,"&ecolon;"],[0,"&ecir;"],[0,"&circeq;"],[1,"&wedgeq;"],[0,"&veeeq;"],[1,"&triangleq;"],[2,"&equest;"],[0,"&ne;"],[0,{v:"&Congruent;",n:8421,o:"&bnequiv;"}],[0,"&nequiv;"],[1,{v:"&le;",n:8402,o:"&nvle;"}],[0,{v:"&ge;",n:8402,o:"&nvge;"}],[0,{v:"&lE;",n:824,o:"&nlE;"}],[0,{v:"&gE;",n:824,o:"&ngE;"}],[0,{v:"&lnE;",n:65024,o:"&lvertneqq;"}],[0,{v:"&gnE;",n:65024,o:"&gvertneqq;"}],[0,{v:"&ll;",n:new Map(i([[824,"&nLtv;"],[7577,"&nLt;"]]))}],[0,{v:"&gg;",n:new Map(i([[824,"&nGtv;"],[7577,"&nGt;"]]))}],[0,"&between;"],[0,"&NotCupCap;"],[0,"&nless;"],[0,"&ngt;"],[0,"&nle;"],[0,"&nge;"],[0,"&lesssim;"],[0,"&GreaterTilde;"],[0,"&nlsim;"],[0,"&ngsim;"],[0,"&LessGreater;"],[0,"&gl;"],[0,"&NotLessGreater;"],[0,"&NotGreaterLess;"],[0,"&pr;"],[0,"&sc;"],[0,"&prcue;"],[0,"&sccue;"],[0,"&PrecedesTilde;"],[0,{v:"&scsim;",n:824,o:"&NotSucceedsTilde;"}],[0,"&NotPrecedes;"],[0,"&NotSucceeds;"],[0,{v:"&sub;",n:8402,o:"&NotSubset;"}],[0,{v:"&sup;",n:8402,o:"&NotSuperset;"}],[0,"&nsub;"],[0,"&nsup;"],[0,"&sube;"],[0,"&supe;"],[0,"&NotSubsetEqual;"],[0,"&NotSupersetEqual;"],[0,{v:"&subne;",n:65024,o:"&varsubsetneq;"}],[0,{v:"&supne;",n:65024,o:"&varsupsetneq;"}],[1,"&cupdot;"],[0,"&UnionPlus;"],[0,{v:"&sqsub;",n:824,o:"&NotSquareSubset;"}],[0,{v:"&sqsup;",n:824,o:"&NotSquareSuperset;"}],[0,"&sqsube;"],[0,"&sqsupe;"],[0,{v:"&sqcap;",n:65024,o:"&sqcaps;"}],[0,{v:"&sqcup;",n:65024,o:"&sqcups;"}],[0,"&CirclePlus;"],[0,"&CircleMinus;"],[0,"&CircleTimes;"],[0,"&osol;"],[0,"&CircleDot;"],[0,"&circledcirc;"],[0,"&circledast;"],[1,"&circleddash;"],[0,"&boxplus;"],[0,"&boxminus;"],[0,"&boxtimes;"],[0,"&dotsquare;"],[0,"&RightTee;"],[0,"&dashv;"],[0,"&DownTee;"],[0,"&bot;"],[1,"&models;"],[0,"&DoubleRightTee;"],[0,"&Vdash;"],[0,"&Vvdash;"],[0,"&VDash;"],[0,"&nvdash;"],[0,"&nvDash;"],[0,"&nVdash;"],[0,"&nVDash;"],[0,"&prurel;"],[1,"&LeftTriangle;"],[0,"&RightTriangle;"],[0,{v:"&LeftTriangleEqual;",n:8402,o:"&nvltrie;"}],[0,{v:"&RightTriangleEqual;",n:8402,o:"&nvrtrie;"}],[0,"&origof;"],[0,"&imof;"],[0,"&multimap;"],[0,"&hercon;"],[0,"&intcal;"],[0,"&veebar;"],[1,"&barvee;"],[0,"&angrtvb;"],[0,"&lrtri;"],[0,"&bigwedge;"],[0,"&bigvee;"],[0,"&bigcap;"],[0,"&bigcup;"],[0,"&diam;"],[0,"&sdot;"],[0,"&sstarf;"],[0,"&divideontimes;"],[0,"&bowtie;"],[0,"&ltimes;"],[0,"&rtimes;"],[0,"&leftthreetimes;"],[0,"&rightthreetimes;"],[0,"&backsimeq;"],[0,"&curlyvee;"],[0,"&curlywedge;"],[0,"&Sub;"],[0,"&Sup;"],[0,"&Cap;"],[0,"&Cup;"],[0,"&fork;"],[0,"&epar;"],[0,"&lessdot;"],[0,"&gtdot;"],[0,{v:"&Ll;",n:824,o:"&nLl;"}],[0,{v:"&Gg;",n:824,o:"&nGg;"}],[0,{v:"&leg;",n:65024,o:"&lesg;"}],[0,{v:"&gel;",n:65024,o:"&gesl;"}],[2,"&cuepr;"],[0,"&cuesc;"],[0,"&NotPrecedesSlantEqual;"],[0,"&NotSucceedsSlantEqual;"],[0,"&NotSquareSubsetEqual;"],[0,"&NotSquareSupersetEqual;"],[2,"&lnsim;"],[0,"&gnsim;"],[0,"&precnsim;"],[0,"&scnsim;"],[0,"&nltri;"],[0,"&NotRightTriangle;"],[0,"&nltrie;"],[0,"&NotRightTriangleEqual;"],[0,"&vellip;"],[0,"&ctdot;"],[0,"&utdot;"],[0,"&dtdot;"],[0,"&disin;"],[0,"&isinsv;"],[0,"&isins;"],[0,{v:"&isindot;",n:824,o:"&notindot;"}],[0,"&notinvc;"],[0,"&notinvb;"],[1,{v:"&isinE;",n:824,o:"&notinE;"}],[0,"&nisd;"],[0,"&xnis;"],[0,"&nis;"],[0,"&notnivc;"],[0,"&notnivb;"],[6,"&barwed;"],[0,"&Barwed;"],[1,"&lceil;"],[0,"&rceil;"],[0,"&LeftFloor;"],[0,"&rfloor;"],[0,"&drcrop;"],[0,"&dlcrop;"],[0,"&urcrop;"],[0,"&ulcrop;"],[0,"&bnot;"],[1,"&profline;"],[0,"&profsurf;"],[1,"&telrec;"],[0,"&target;"],[5,"&ulcorn;"],[0,"&urcorn;"],[0,"&dlcorn;"],[0,"&drcorn;"],[2,"&frown;"],[0,"&smile;"],[9,"&cylcty;"],[0,"&profalar;"],[7,"&topbot;"],[6,"&ovbar;"],[1,"&solbar;"],[60,"&angzarr;"],[51,"&lmoustache;"],[0,"&rmoustache;"],[2,"&OverBracket;"],[0,"&bbrk;"],[0,"&bbrktbrk;"],[37,"&OverParenthesis;"],[0,"&UnderParenthesis;"],[0,"&OverBrace;"],[0,"&UnderBrace;"],[2,"&trpezium;"],[4,"&elinters;"],[59,"&blank;"],[164,"&circledS;"],[55,"&boxh;"],[1,"&boxv;"],[9,"&boxdr;"],[3,"&boxdl;"],[3,"&boxur;"],[3,"&boxul;"],[3,"&boxvr;"],[7,"&boxvl;"],[7,"&boxhd;"],[7,"&boxhu;"],[7,"&boxvh;"],[19,"&boxH;"],[0,"&boxV;"],[0,"&boxdR;"],[0,"&boxDr;"],[0,"&boxDR;"],[0,"&boxdL;"],[0,"&boxDl;"],[0,"&boxDL;"],[0,"&boxuR;"],[0,"&boxUr;"],[0,"&boxUR;"],[0,"&boxuL;"],[0,"&boxUl;"],[0,"&boxUL;"],[0,"&boxvR;"],[0,"&boxVr;"],[0,"&boxVR;"],[0,"&boxvL;"],[0,"&boxVl;"],[0,"&boxVL;"],[0,"&boxHd;"],[0,"&boxhD;"],[0,"&boxHD;"],[0,"&boxHu;"],[0,"&boxhU;"],[0,"&boxHU;"],[0,"&boxvH;"],[0,"&boxVh;"],[0,"&boxVH;"],[19,"&uhblk;"],[3,"&lhblk;"],[3,"&block;"],[8,"&blk14;"],[0,"&blk12;"],[0,"&blk34;"],[13,"&square;"],[8,"&blacksquare;"],[0,"&EmptyVerySmallSquare;"],[1,"&rect;"],[0,"&marker;"],[2,"&fltns;"],[1,"&bigtriangleup;"],[0,"&blacktriangle;"],[0,"&triangle;"],[2,"&blacktriangleright;"],[0,"&rtri;"],[3,"&bigtriangledown;"],[0,"&blacktriangledown;"],[0,"&dtri;"],[2,"&blacktriangleleft;"],[0,"&ltri;"],[6,"&loz;"],[0,"&cir;"],[32,"&tridot;"],[2,"&bigcirc;"],[8,"&ultri;"],[0,"&urtri;"],[0,"&lltri;"],[0,"&EmptySmallSquare;"],[0,"&FilledSmallSquare;"],[8,"&bigstar;"],[0,"&star;"],[7,"&phone;"],[49,"&female;"],[1,"&male;"],[29,"&spades;"],[2,"&clubs;"],[1,"&hearts;"],[0,"&diamondsuit;"],[3,"&sung;"],[2,"&flat;"],[0,"&natural;"],[0,"&sharp;"],[163,"&check;"],[3,"&cross;"],[8,"&malt;"],[21,"&sext;"],[33,"&VerticalSeparator;"],[25,"&lbbrk;"],[0,"&rbbrk;"],[84,"&bsolhsub;"],[0,"&suphsol;"],[28,"&LeftDoubleBracket;"],[0,"&RightDoubleBracket;"],[0,"&lang;"],[0,"&rang;"],[0,"&Lang;"],[0,"&Rang;"],[0,"&loang;"],[0,"&roang;"],[7,"&longleftarrow;"],[0,"&longrightarrow;"],[0,"&longleftrightarrow;"],[0,"&DoubleLongLeftArrow;"],[0,"&DoubleLongRightArrow;"],[0,"&DoubleLongLeftRightArrow;"],[1,"&longmapsto;"],[2,"&dzigrarr;"],[258,"&nvlArr;"],[0,"&nvrArr;"],[0,"&nvHarr;"],[0,"&Map;"],[6,"&lbarr;"],[0,"&bkarow;"],[0,"&lBarr;"],[0,"&dbkarow;"],[0,"&drbkarow;"],[0,"&DDotrahd;"],[0,"&UpArrowBar;"],[0,"&DownArrowBar;"],[2,"&Rarrtl;"],[2,"&latail;"],[0,"&ratail;"],[0,"&lAtail;"],[0,"&rAtail;"],[0,"&larrfs;"],[0,"&rarrfs;"],[0,"&larrbfs;"],[0,"&rarrbfs;"],[2,"&nwarhk;"],[0,"&nearhk;"],[0,"&hksearow;"],[0,"&hkswarow;"],[0,"&nwnear;"],[0,"&nesear;"],[0,"&seswar;"],[0,"&swnwar;"],[8,{v:"&rarrc;",n:824,o:"&nrarrc;"}],[1,"&cudarrr;"],[0,"&ldca;"],[0,"&rdca;"],[0,"&cudarrl;"],[0,"&larrpl;"],[2,"&curarrm;"],[0,"&cularrp;"],[7,"&rarrpl;"],[2,"&harrcir;"],[0,"&Uarrocir;"],[0,"&lurdshar;"],[0,"&ldrushar;"],[2,"&LeftRightVector;"],[0,"&RightUpDownVector;"],[0,"&DownLeftRightVector;"],[0,"&LeftUpDownVector;"],[0,"&LeftVectorBar;"],[0,"&RightVectorBar;"],[0,"&RightUpVectorBar;"],[0,"&RightDownVectorBar;"],[0,"&DownLeftVectorBar;"],[0,"&DownRightVectorBar;"],[0,"&LeftUpVectorBar;"],[0,"&LeftDownVectorBar;"],[0,"&LeftTeeVector;"],[0,"&RightTeeVector;"],[0,"&RightUpTeeVector;"],[0,"&RightDownTeeVector;"],[0,"&DownLeftTeeVector;"],[0,"&DownRightTeeVector;"],[0,"&LeftUpTeeVector;"],[0,"&LeftDownTeeVector;"],[0,"&lHar;"],[0,"&uHar;"],[0,"&rHar;"],[0,"&dHar;"],[0,"&luruhar;"],[0,"&ldrdhar;"],[0,"&ruluhar;"],[0,"&rdldhar;"],[0,"&lharul;"],[0,"&llhard;"],[0,"&rharul;"],[0,"&lrhard;"],[0,"&udhar;"],[0,"&duhar;"],[0,"&RoundImplies;"],[0,"&erarr;"],[0,"&simrarr;"],[0,"&larrsim;"],[0,"&rarrsim;"],[0,"&rarrap;"],[0,"&ltlarr;"],[1,"&gtrarr;"],[0,"&subrarr;"],[1,"&suplarr;"],[0,"&lfisht;"],[0,"&rfisht;"],[0,"&ufisht;"],[0,"&dfisht;"],[5,"&lopar;"],[0,"&ropar;"],[4,"&lbrke;"],[0,"&rbrke;"],[0,"&lbrkslu;"],[0,"&rbrksld;"],[0,"&lbrksld;"],[0,"&rbrkslu;"],[0,"&langd;"],[0,"&rangd;"],[0,"&lparlt;"],[0,"&rpargt;"],[0,"&gtlPar;"],[0,"&ltrPar;"],[3,"&vzigzag;"],[1,"&vangrt;"],[0,"&angrtvbd;"],[6,"&ange;"],[0,"&range;"],[0,"&dwangle;"],[0,"&uwangle;"],[0,"&angmsdaa;"],[0,"&angmsdab;"],[0,"&angmsdac;"],[0,"&angmsdad;"],[0,"&angmsdae;"],[0,"&angmsdaf;"],[0,"&angmsdag;"],[0,"&angmsdah;"],[0,"&bemptyv;"],[0,"&demptyv;"],[0,"&cemptyv;"],[0,"&raemptyv;"],[0,"&laemptyv;"],[0,"&ohbar;"],[0,"&omid;"],[0,"&opar;"],[1,"&operp;"],[1,"&olcross;"],[0,"&odsold;"],[1,"&olcir;"],[0,"&ofcir;"],[0,"&olt;"],[0,"&ogt;"],[0,"&cirscir;"],[0,"&cirE;"],[0,"&solb;"],[0,"&bsolb;"],[3,"&boxbox;"],[3,"&trisb;"],[0,"&rtriltri;"],[0,{v:"&LeftTriangleBar;",n:824,o:"&NotLeftTriangleBar;"}],[0,{v:"&RightTriangleBar;",n:824,o:"&NotRightTriangleBar;"}],[11,"&iinfin;"],[0,"&infintie;"],[0,"&nvinfin;"],[4,"&eparsl;"],[0,"&smeparsl;"],[0,"&eqvparsl;"],[5,"&blacklozenge;"],[8,"&RuleDelayed;"],[1,"&dsol;"],[9,"&bigodot;"],[0,"&bigoplus;"],[0,"&bigotimes;"],[1,"&biguplus;"],[1,"&bigsqcup;"],[5,"&iiiint;"],[0,"&fpartint;"],[2,"&cirfnint;"],[0,"&awint;"],[0,"&rppolint;"],[0,"&scpolint;"],[0,"&npolint;"],[0,"&pointint;"],[0,"&quatint;"],[0,"&intlarhk;"],[10,"&pluscir;"],[0,"&plusacir;"],[0,"&simplus;"],[0,"&plusdu;"],[0,"&plussim;"],[0,"&plustwo;"],[1,"&mcomma;"],[0,"&minusdu;"],[2,"&loplus;"],[0,"&roplus;"],[0,"&Cross;"],[0,"&timesd;"],[0,"&timesbar;"],[1,"&smashp;"],[0,"&lotimes;"],[0,"&rotimes;"],[0,"&otimesas;"],[0,"&Otimes;"],[0,"&odiv;"],[0,"&triplus;"],[0,"&triminus;"],[0,"&tritime;"],[0,"&intprod;"],[2,"&amalg;"],[0,"&capdot;"],[1,"&ncup;"],[0,"&ncap;"],[0,"&capand;"],[0,"&cupor;"],[0,"&cupcap;"],[0,"&capcup;"],[0,"&cupbrcap;"],[0,"&capbrcup;"],[0,"&cupcup;"],[0,"&capcap;"],[0,"&ccups;"],[0,"&ccaps;"],[2,"&ccupssm;"],[2,"&And;"],[0,"&Or;"],[0,"&andand;"],[0,"&oror;"],[0,"&orslope;"],[0,"&andslope;"],[1,"&andv;"],[0,"&orv;"],[0,"&andd;"],[0,"&ord;"],[1,"&wedbar;"],[6,"&sdote;"],[3,"&simdot;"],[2,{v:"&congdot;",n:824,o:"&ncongdot;"}],[0,"&easter;"],[0,"&apacir;"],[0,{v:"&apE;",n:824,o:"&napE;"}],[0,"&eplus;"],[0,"&pluse;"],[0,"&Esim;"],[0,"&Colone;"],[0,"&Equal;"],[1,"&ddotseq;"],[0,"&equivDD;"],[0,"&ltcir;"],[0,"&gtcir;"],[0,"&ltquest;"],[0,"&gtquest;"],[0,{v:"&leqslant;",n:824,o:"&nleqslant;"}],[0,{v:"&geqslant;",n:824,o:"&ngeqslant;"}],[0,"&lesdot;"],[0,"&gesdot;"],[0,"&lesdoto;"],[0,"&gesdoto;"],[0,"&lesdotor;"],[0,"&gesdotol;"],[0,"&lap;"],[0,"&gap;"],[0,"&lne;"],[0,"&gne;"],[0,"&lnap;"],[0,"&gnap;"],[0,"&lEg;"],[0,"&gEl;"],[0,"&lsime;"],[0,"&gsime;"],[0,"&lsimg;"],[0,"&gsiml;"],[0,"&lgE;"],[0,"&glE;"],[0,"&lesges;"],[0,"&gesles;"],[0,"&els;"],[0,"&egs;"],[0,"&elsdot;"],[0,"&egsdot;"],[0,"&el;"],[0,"&eg;"],[2,"&siml;"],[0,"&simg;"],[0,"&simlE;"],[0,"&simgE;"],[0,{v:"&LessLess;",n:824,o:"&NotNestedLessLess;"}],[0,{v:"&GreaterGreater;",n:824,o:"&NotNestedGreaterGreater;"}],[1,"&glj;"],[0,"&gla;"],[0,"&ltcc;"],[0,"&gtcc;"],[0,"&lescc;"],[0,"&gescc;"],[0,"&smt;"],[0,"&lat;"],[0,{v:"&smte;",n:65024,o:"&smtes;"}],[0,{v:"&late;",n:65024,o:"&lates;"}],[0,"&bumpE;"],[0,{v:"&PrecedesEqual;",n:824,o:"&NotPrecedesEqual;"}],[0,{v:"&sce;",n:824,o:"&NotSucceedsEqual;"}],[2,"&prE;"],[0,"&scE;"],[0,"&precneqq;"],[0,"&scnE;"],[0,"&prap;"],[0,"&scap;"],[0,"&precnapprox;"],[0,"&scnap;"],[0,"&Pr;"],[0,"&Sc;"],[0,"&subdot;"],[0,"&supdot;"],[0,"&subplus;"],[0,"&supplus;"],[0,"&submult;"],[0,"&supmult;"],[0,"&subedot;"],[0,"&supedot;"],[0,{v:"&subE;",n:824,o:"&nsubE;"}],[0,{v:"&supE;",n:824,o:"&nsupE;"}],[0,"&subsim;"],[0,"&supsim;"],[2,{v:"&subnE;",n:65024,o:"&varsubsetneqq;"}],[0,{v:"&supnE;",n:65024,o:"&varsupsetneqq;"}],[2,"&csub;"],[0,"&csup;"],[0,"&csube;"],[0,"&csupe;"],[0,"&subsup;"],[0,"&supsub;"],[0,"&subsub;"],[0,"&supsup;"],[0,"&suphsub;"],[0,"&supdsub;"],[0,"&forkv;"],[0,"&topfork;"],[0,"&mlcp;"],[8,"&Dashv;"],[1,"&Vdashl;"],[0,"&Barv;"],[0,"&vBar;"],[0,"&vBarv;"],[1,"&Vbar;"],[0,"&Not;"],[0,"&bNot;"],[0,"&rnmid;"],[0,"&cirmid;"],[0,"&midcir;"],[0,"&topcir;"],[0,"&nhpar;"],[0,"&parsim;"],[9,{v:"&parsl;",n:8421,o:"&nparsl;"}],[44343,{n:new Map(i([[56476,"&Ascr;"],[1,"&Cscr;"],[0,"&Dscr;"],[2,"&Gscr;"],[2,"&Jscr;"],[0,"&Kscr;"],[2,"&Nscr;"],[0,"&Oscr;"],[0,"&Pscr;"],[0,"&Qscr;"],[1,"&Sscr;"],[0,"&Tscr;"],[0,"&Uscr;"],[0,"&Vscr;"],[0,"&Wscr;"],[0,"&Xscr;"],[0,"&Yscr;"],[0,"&Zscr;"],[0,"&ascr;"],[0,"&bscr;"],[0,"&cscr;"],[0,"&dscr;"],[1,"&fscr;"],[1,"&hscr;"],[0,"&iscr;"],[0,"&jscr;"],[0,"&kscr;"],[0,"&lscr;"],[0,"&mscr;"],[0,"&nscr;"],[1,"&pscr;"],[0,"&qscr;"],[0,"&rscr;"],[0,"&sscr;"],[0,"&tscr;"],[0,"&uscr;"],[0,"&vscr;"],[0,"&wscr;"],[0,"&xscr;"],[0,"&yscr;"],[0,"&zscr;"],[52,"&Afr;"],[0,"&Bfr;"],[1,"&Dfr;"],[0,"&Efr;"],[0,"&Ffr;"],[0,"&Gfr;"],[2,"&Jfr;"],[0,"&Kfr;"],[0,"&Lfr;"],[0,"&Mfr;"],[0,"&Nfr;"],[0,"&Ofr;"],[0,"&Pfr;"],[0,"&Qfr;"],[1,"&Sfr;"],[0,"&Tfr;"],[0,"&Ufr;"],[0,"&Vfr;"],[0,"&Wfr;"],[0,"&Xfr;"],[0,"&Yfr;"],[1,"&afr;"],[0,"&bfr;"],[0,"&cfr;"],[0,"&dfr;"],[0,"&efr;"],[0,"&ffr;"],[0,"&gfr;"],[0,"&hfr;"],[0,"&ifr;"],[0,"&jfr;"],[0,"&kfr;"],[0,"&lfr;"],[0,"&mfr;"],[0,"&nfr;"],[0,"&ofr;"],[0,"&pfr;"],[0,"&qfr;"],[0,"&rfr;"],[0,"&sfr;"],[0,"&tfr;"],[0,"&ufr;"],[0,"&vfr;"],[0,"&wfr;"],[0,"&xfr;"],[0,"&yfr;"],[0,"&zfr;"],[0,"&Aopf;"],[0,"&Bopf;"],[1,"&Dopf;"],[0,"&Eopf;"],[0,"&Fopf;"],[0,"&Gopf;"],[1,"&Iopf;"],[0,"&Jopf;"],[0,"&Kopf;"],[0,"&Lopf;"],[0,"&Mopf;"],[1,"&Oopf;"],[3,"&Sopf;"],[0,"&Topf;"],[0,"&Uopf;"],[0,"&Vopf;"],[0,"&Wopf;"],[0,"&Xopf;"],[0,"&Yopf;"],[1,"&aopf;"],[0,"&bopf;"],[0,"&copf;"],[0,"&dopf;"],[0,"&eopf;"],[0,"&fopf;"],[0,"&gopf;"],[0,"&hopf;"],[0,"&iopf;"],[0,"&jopf;"],[0,"&kopf;"],[0,"&lopf;"],[0,"&mopf;"],[0,"&nopf;"],[0,"&oopf;"],[0,"&popf;"],[0,"&qopf;"],[0,"&ropf;"],[0,"&sopf;"],[0,"&topf;"],[0,"&uopf;"],[0,"&vopf;"],[0,"&wopf;"],[0,"&xopf;"],[0,"&yopf;"],[0,"&zopf;"]]))}],[8906,"&fflig;"],[0,"&filig;"],[0,"&fllig;"],[0,"&ffilig;"],[0,"&ffllig;"]]))},5863:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decodeXMLStrict=t.decodeHTML5Strict=t.decodeHTML4Strict=t.decodeHTML5=t.decodeHTML4=t.decodeHTMLAttribute=t.decodeHTMLStrict=t.decodeHTML=t.decodeXML=t.DecodingMode=t.EntityDecoder=t.encodeHTML5=t.encodeHTML4=t.encodeNonAsciiHTML=t.encodeHTML=t.escapeText=t.escapeAttribute=t.escapeUTF8=t.escape=t.encodeXML=t.encode=t.decodeStrict=t.decode=t.EncodingMode=t.EntityLevel=void 0;var r,n,s=i(4076),o=i(7322),a=i(4625);function l(e,t){if(void 0===t&&(t=r.XML),("number"==typeof t?t:t.level)===r.HTML){var i="object"==typeof t?t.mode:void 0;return(0,s.decodeHTML)(e,i)}return(0,s.decodeXML)(e)}!function(e){e[e.XML=0]="XML",e[e.HTML=1]="HTML"}(r=t.EntityLevel||(t.EntityLevel={})),function(e){e[e.UTF8=0]="UTF8",e[e.ASCII=1]="ASCII",e[e.Extensive=2]="Extensive",e[e.Attribute=3]="Attribute",e[e.Text=4]="Text"}(n=t.EncodingMode||(t.EncodingMode={})),t.decode=l,t.decodeStrict=function(e,t){var i;void 0===t&&(t=r.XML);var n="number"==typeof t?{level:t}:t;return null!==(i=n.mode)&&void 0!==i||(n.mode=s.DecodingMode.Strict),l(e,n)},t.encode=function(e,t){void 0===t&&(t=r.XML);var i="number"==typeof t?{level:t}:t;return i.mode===n.UTF8?(0,a.escapeUTF8)(e):i.mode===n.Attribute?(0,a.escapeAttribute)(e):i.mode===n.Text?(0,a.escapeText)(e):i.level===r.HTML?i.mode===n.ASCII?(0,o.encodeNonAsciiHTML)(e):(0,o.encodeHTML)(e):(0,a.encodeXML)(e)};var c=i(4625);Object.defineProperty(t,"encodeXML",{enumerable:!0,get:function(){return c.encodeXML}}),Object.defineProperty(t,"escape",{enumerable:!0,get:function(){return c.escape}}),Object.defineProperty(t,"escapeUTF8",{enumerable:!0,get:function(){return c.escapeUTF8}}),Object.defineProperty(t,"escapeAttribute",{enumerable:!0,get:function(){return c.escapeAttribute}}),Object.defineProperty(t,"escapeText",{enumerable:!0,get:function(){return c.escapeText}});var u=i(7322);Object.defineProperty(t,"encodeHTML",{enumerable:!0,get:function(){return u.encodeHTML}}),Object.defineProperty(t,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return u.encodeNonAsciiHTML}}),Object.defineProperty(t,"encodeHTML4",{enumerable:!0,get:function(){return u.encodeHTML}}),Object.defineProperty(t,"encodeHTML5",{enumerable:!0,get:function(){return u.encodeHTML}});var h=i(4076);Object.defineProperty(t,"EntityDecoder",{enumerable:!0,get:function(){return h.EntityDecoder}}),Object.defineProperty(t,"DecodingMode",{enumerable:!0,get:function(){return h.DecodingMode}}),Object.defineProperty(t,"decodeXML",{enumerable:!0,get:function(){return h.decodeXML}}),Object.defineProperty(t,"decodeHTML",{enumerable:!0,get:function(){return h.decodeHTML}}),Object.defineProperty(t,"decodeHTMLStrict",{enumerable:!0,get:function(){return h.decodeHTMLStrict}}),Object.defineProperty(t,"decodeHTMLAttribute",{enumerable:!0,get:function(){return h.decodeHTMLAttribute}}),Object.defineProperty(t,"decodeHTML4",{enumerable:!0,get:function(){return h.decodeHTML}}),Object.defineProperty(t,"decodeHTML5",{enumerable:!0,get:function(){return h.decodeHTML}}),Object.defineProperty(t,"decodeHTML4Strict",{enumerable:!0,get:function(){return h.decodeHTMLStrict}}),Object.defineProperty(t,"decodeHTML5Strict",{enumerable:!0,get:function(){return h.decodeHTMLStrict}}),Object.defineProperty(t,"decodeXMLStrict",{enumerable:!0,get:function(){return h.decodeXML}})},763:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,n)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&r(t,e,i);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var o=s(i(9889)),a=i(4076),l=new Set(["input","option","optgroup","select","button","datalist","textarea"]),c=new Set(["p"]),u=new Set(["thead","tbody"]),h=new Set(["dd","dt"]),d=new Set(["rt","rp"]),f=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",c],["h1",c],["h2",c],["h3",c],["h4",c],["h5",c],["h6",c],["select",l],["input",l],["output",l],["button",l],["datalist",l],["textarea",l],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",h],["dt",h],["address",c],["article",c],["aside",c],["blockquote",c],["details",c],["div",c],["dl",c],["fieldset",c],["figcaption",c],["figure",c],["footer",c],["form",c],["header",c],["hr",c],["main",c],["nav",c],["ol",c],["pre",c],["section",c],["table",c],["ul",c],["rt",d],["rp",d],["tbody",u],["tfoot",u]]),p=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),g=new Set(["math","svg"]),m=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),v=/\s|\//,y=function(){function e(e,t){var i,r,n,s,a;void 0===t&&(t={}),this.options=t,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=null!=e?e:{},this.lowerCaseTagNames=null!==(i=t.lowerCaseTags)&&void 0!==i?i:!t.xmlMode,this.lowerCaseAttributeNames=null!==(r=t.lowerCaseAttributeNames)&&void 0!==r?r:!t.xmlMode,this.tokenizer=new(null!==(n=t.Tokenizer)&&void 0!==n?n:o.default)(this.options,this),null===(a=(s=this.cbs).onparserinit)||void 0===a||a.call(s,this)}return e.prototype.ontext=function(e,t){var i,r,n=this.getSlice(e,t);this.endIndex=t-1,null===(r=(i=this.cbs).ontext)||void 0===r||r.call(i,n),this.startIndex=t},e.prototype.ontextentity=function(e){var t,i,r=this.tokenizer.getSectionStart();this.endIndex=r-1,null===(i=(t=this.cbs).ontext)||void 0===i||i.call(t,(0,a.fromCodePoint)(e)),this.startIndex=r},e.prototype.isVoidElement=function(e){return!this.options.xmlMode&&p.has(e)},e.prototype.onopentagname=function(e,t){this.endIndex=t;var i=this.getSlice(e,t);this.lowerCaseTagNames&&(i=i.toLowerCase()),this.emitOpenTag(i)},e.prototype.emitOpenTag=function(e){var t,i,r,n;this.openTagStart=this.startIndex,this.tagname=e;var s=!this.options.xmlMode&&f.get(e);if(s)for(;this.stack.length>0&&s.has(this.stack[this.stack.length-1]);){var o=this.stack.pop();null===(i=(t=this.cbs).onclosetag)||void 0===i||i.call(t,o,!0)}this.isVoidElement(e)||(this.stack.push(e),g.has(e)?this.foreignContext.push(!0):m.has(e)&&this.foreignContext.push(!1)),null===(n=(r=this.cbs).onopentagname)||void 0===n||n.call(r,e),this.cbs.onopentag&&(this.attribs={})},e.prototype.endOpenTag=function(e){var t,i;this.startIndex=this.openTagStart,this.attribs&&(null===(i=(t=this.cbs).onopentag)||void 0===i||i.call(t,this.tagname,this.attribs,e),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""},e.prototype.onopentagend=function(e){this.endIndex=e,this.endOpenTag(!1),this.startIndex=e+1},e.prototype.onclosetag=function(e,t){var i,r,n,s,o,a;this.endIndex=t;var l=this.getSlice(e,t);if(this.lowerCaseTagNames&&(l=l.toLowerCase()),(g.has(l)||m.has(l))&&this.foreignContext.pop(),this.isVoidElement(l))this.options.xmlMode||"br"!==l||(null===(r=(i=this.cbs).onopentagname)||void 0===r||r.call(i,"br"),null===(s=(n=this.cbs).onopentag)||void 0===s||s.call(n,"br",{},!0),null===(a=(o=this.cbs).onclosetag)||void 0===a||a.call(o,"br",!1));else{var c=this.stack.lastIndexOf(l);if(-1!==c)if(this.cbs.onclosetag)for(var u=this.stack.length-c;u--;)this.cbs.onclosetag(this.stack.pop(),0!==u);else this.stack.length=c;else this.options.xmlMode||"p"!==l||(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=t+1},e.prototype.onselfclosingtag=function(e){this.endIndex=e,this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?(this.closeCurrentTag(!1),this.startIndex=e+1):this.onopentagend(e)},e.prototype.closeCurrentTag=function(e){var t,i,r=this.tagname;this.endOpenTag(e),this.stack[this.stack.length-1]===r&&(null===(i=(t=this.cbs).onclosetag)||void 0===i||i.call(t,r,!e),this.stack.pop())},e.prototype.onattribname=function(e,t){this.startIndex=e;var i=this.getSlice(e,t);this.attribname=this.lowerCaseAttributeNames?i.toLowerCase():i},e.prototype.onattribdata=function(e,t){this.attribvalue+=this.getSlice(e,t)},e.prototype.onattribentity=function(e){this.attribvalue+=(0,a.fromCodePoint)(e)},e.prototype.onattribend=function(e,t){var i,r;this.endIndex=t,null===(r=(i=this.cbs).onattribute)||void 0===r||r.call(i,this.attribname,this.attribvalue,e===o.QuoteType.Double?'"':e===o.QuoteType.Single?"'":e===o.QuoteType.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""},e.prototype.getInstructionName=function(e){var t=e.search(v),i=t<0?e:e.substr(0,t);return this.lowerCaseTagNames&&(i=i.toLowerCase()),i},e.prototype.ondeclaration=function(e,t){this.endIndex=t;var i=this.getSlice(e,t);if(this.cbs.onprocessinginstruction){var r=this.getInstructionName(i);this.cbs.onprocessinginstruction("!".concat(r),"!".concat(i))}this.startIndex=t+1},e.prototype.onprocessinginstruction=function(e,t){this.endIndex=t;var i=this.getSlice(e,t);if(this.cbs.onprocessinginstruction){var r=this.getInstructionName(i);this.cbs.onprocessinginstruction("?".concat(r),"?".concat(i))}this.startIndex=t+1},e.prototype.oncomment=function(e,t,i){var r,n,s,o;this.endIndex=t,null===(n=(r=this.cbs).oncomment)||void 0===n||n.call(r,this.getSlice(e,t-i)),null===(o=(s=this.cbs).oncommentend)||void 0===o||o.call(s),this.startIndex=t+1},e.prototype.oncdata=function(e,t,i){var r,n,s,o,a,l,c,u,h,d;this.endIndex=t;var f=this.getSlice(e,t-i);this.options.xmlMode||this.options.recognizeCDATA?(null===(n=(r=this.cbs).oncdatastart)||void 0===n||n.call(r),null===(o=(s=this.cbs).ontext)||void 0===o||o.call(s,f),null===(l=(a=this.cbs).oncdataend)||void 0===l||l.call(a)):(null===(u=(c=this.cbs).oncomment)||void 0===u||u.call(c,"[CDATA[".concat(f,"]]")),null===(d=(h=this.cbs).oncommentend)||void 0===d||d.call(h)),this.startIndex=t+1},e.prototype.onend=function(){var e,t;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(var i=this.stack.length;i>0;this.cbs.onclosetag(this.stack[--i],!0));}null===(t=(e=this.cbs).onend)||void 0===t||t.call(e)},e.prototype.reset=function(){var e,t,i,r;null===(t=(e=this.cbs).onreset)||void 0===t||t.call(e),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,null===(r=(i=this.cbs).onparserinit)||void 0===r||r.call(i,this),this.buffers.length=0,this.bufferOffset=0,this.writeIndex=0,this.ended=!1},e.prototype.parseComplete=function(e){this.reset(),this.end(e)},e.prototype.getSlice=function(e,t){for(;e-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();for(var i=this.buffers[0].slice(e-this.bufferOffset,t-this.bufferOffset);t-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),i+=this.buffers[0].slice(0,t-this.bufferOffset);return i},e.prototype.shiftBuffer=function(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()},e.prototype.write=function(e){var t,i;this.ended?null===(i=(t=this.cbs).onerror)||void 0===i||i.call(t,new Error(".write() after done!")):(this.buffers.push(e),this.tokenizer.running&&(this.tokenizer.write(e),this.writeIndex++))},e.prototype.end=function(e){var t,i;this.ended?null===(i=(t=this.cbs).onerror)||void 0===i||i.call(t,new Error(".end() after done!")):(e&&this.write(e),this.ended=!0,this.tokenizer.end())},e.prototype.pause=function(){this.tokenizer.pause()},e.prototype.resume=function(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()},e.prototype.parseChunk=function(e){this.write(e)},e.prototype.done=function(e){this.end(e)},e}();t.Parser=y},9889:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QuoteType=void 0;var r,n,s,o=i(4076);function a(e){return e===r.Space||e===r.NewLine||e===r.Tab||e===r.FormFeed||e===r.CarriageReturn}function l(e){return e===r.Slash||e===r.Gt||a(e)}function c(e){return e>=r.Zero&&e<=r.Nine}!function(e){e[e.Tab=9]="Tab",e[e.NewLine=10]="NewLine",e[e.FormFeed=12]="FormFeed",e[e.CarriageReturn=13]="CarriageReturn",e[e.Space=32]="Space",e[e.ExclamationMark=33]="ExclamationMark",e[e.Number=35]="Number",e[e.Amp=38]="Amp",e[e.SingleQuote=39]="SingleQuote",e[e.DoubleQuote=34]="DoubleQuote",e[e.Dash=45]="Dash",e[e.Slash=47]="Slash",e[e.Zero=48]="Zero",e[e.Nine=57]="Nine",e[e.Semi=59]="Semi",e[e.Lt=60]="Lt",e[e.Eq=61]="Eq",e[e.Gt=62]="Gt",e[e.Questionmark=63]="Questionmark",e[e.UpperA=65]="UpperA",e[e.LowerA=97]="LowerA",e[e.UpperF=70]="UpperF",e[e.LowerF=102]="LowerF",e[e.UpperZ=90]="UpperZ",e[e.LowerZ=122]="LowerZ",e[e.LowerX=120]="LowerX",e[e.OpeningSquareBracket=91]="OpeningSquareBracket"}(r||(r={})),function(e){e[e.Text=1]="Text",e[e.BeforeTagName=2]="BeforeTagName",e[e.InTagName=3]="InTagName",e[e.InSelfClosingTag=4]="InSelfClosingTag",e[e.BeforeClosingTagName=5]="BeforeClosingTagName",e[e.InClosingTagName=6]="InClosingTagName",e[e.AfterClosingTagName=7]="AfterClosingTagName",e[e.BeforeAttributeName=8]="BeforeAttributeName",e[e.InAttributeName=9]="InAttributeName",e[e.AfterAttributeName=10]="AfterAttributeName",e[e.BeforeAttributeValue=11]="BeforeAttributeValue",e[e.InAttributeValueDq=12]="InAttributeValueDq",e[e.InAttributeValueSq=13]="InAttributeValueSq",e[e.InAttributeValueNq=14]="InAttributeValueNq",e[e.BeforeDeclaration=15]="BeforeDeclaration",e[e.InDeclaration=16]="InDeclaration",e[e.InProcessingInstruction=17]="InProcessingInstruction",e[e.BeforeComment=18]="BeforeComment",e[e.CDATASequence=19]="CDATASequence",e[e.InSpecialComment=20]="InSpecialComment",e[e.InCommentLike=21]="InCommentLike",e[e.BeforeSpecialS=22]="BeforeSpecialS",e[e.SpecialStartSequence=23]="SpecialStartSequence",e[e.InSpecialTag=24]="InSpecialTag",e[e.BeforeEntity=25]="BeforeEntity",e[e.BeforeNumericEntity=26]="BeforeNumericEntity",e[e.InNamedEntity=27]="InNamedEntity",e[e.InNumericEntity=28]="InNumericEntity",e[e.InHexEntity=29]="InHexEntity"}(n||(n={})),function(e){e[e.NoValue=0]="NoValue",e[e.Unquoted=1]="Unquoted",e[e.Single=2]="Single",e[e.Double=3]="Double"}(s=t.QuoteType||(t.QuoteType={}));var u={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101])},h=function(){function e(e,t){var i=e.xmlMode,r=void 0!==i&&i,s=e.decodeEntities,a=void 0===s||s;this.cbs=t,this.state=n.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=n.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.trieIndex=0,this.trieCurrent=0,this.entityResult=0,this.entityExcess=0,this.xmlMode=r,this.decodeEntities=a,this.entityTrie=r?o.xmlDecodeTree:o.htmlDecodeTree}return e.prototype.reset=function(){this.state=n.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=n.Text,this.currentSequence=void 0,this.running=!0,this.offset=0},e.prototype.write=function(e){this.offset+=this.buffer.length,this.buffer=e,this.parse()},e.prototype.end=function(){this.running&&this.finish()},e.prototype.pause=function(){this.running=!1},e.prototype.resume=function(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()},e.prototype.getIndex=function(){return this.index},e.prototype.getSectionStart=function(){return this.sectionStart},e.prototype.stateText=function(e){e===r.Lt||!this.decodeEntities&&this.fastForwardTo(r.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=n.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&e===r.Amp&&(this.state=n.BeforeEntity)},e.prototype.stateSpecialStartSequence=function(e){var t=this.sequenceIndex===this.currentSequence.length;if(t?l(e):(32|e)===this.currentSequence[this.sequenceIndex]){if(!t)return void this.sequenceIndex++}else this.isSpecial=!1;this.sequenceIndex=0,this.state=n.InTagName,this.stateInTagName(e)},e.prototype.stateInSpecialTag=function(e){if(this.sequenceIndex===this.currentSequence.length){if(e===r.Gt||a(e)){var t=this.index-this.currentSequence.length;if(this.sectionStart<t){var i=this.index;this.index=t,this.cbs.ontext(this.sectionStart,t),this.index=i}return this.isSpecial=!1,this.sectionStart=t+2,void this.stateInClosingTagName(e)}this.sequenceIndex=0}(32|e)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:0===this.sequenceIndex?this.currentSequence===u.TitleEnd?this.decodeEntities&&e===r.Amp&&(this.state=n.BeforeEntity):this.fastForwardTo(r.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=Number(e===r.Lt)},e.prototype.stateCDATASequence=function(e){e===u.Cdata[this.sequenceIndex]?++this.sequenceIndex===u.Cdata.length&&(this.state=n.InCommentLike,this.currentSequence=u.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=n.InDeclaration,this.stateInDeclaration(e))},e.prototype.fastForwardTo=function(e){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===e)return!0;return this.index=this.buffer.length+this.offset-1,!1},e.prototype.stateInCommentLike=function(e){e===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===u.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=n.Text):0===this.sequenceIndex?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):e!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)},e.prototype.isTagStartChar=function(e){return this.xmlMode?!l(e):function(e){return e>=r.LowerA&&e<=r.LowerZ||e>=r.UpperA&&e<=r.UpperZ}(e)},e.prototype.startSpecial=function(e,t){this.isSpecial=!0,this.currentSequence=e,this.sequenceIndex=t,this.state=n.SpecialStartSequence},e.prototype.stateBeforeTagName=function(e){if(e===r.ExclamationMark)this.state=n.BeforeDeclaration,this.sectionStart=this.index+1;else if(e===r.Questionmark)this.state=n.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(e)){var t=32|e;this.sectionStart=this.index,this.xmlMode||t!==u.TitleEnd[2]?this.state=this.xmlMode||t!==u.ScriptEnd[2]?n.InTagName:n.BeforeSpecialS:this.startSpecial(u.TitleEnd,3)}else e===r.Slash?this.state=n.BeforeClosingTagName:(this.state=n.Text,this.stateText(e))},e.prototype.stateInTagName=function(e){l(e)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=n.BeforeAttributeName,this.stateBeforeAttributeName(e))},e.prototype.stateBeforeClosingTagName=function(e){a(e)||(e===r.Gt?this.state=n.Text:(this.state=this.isTagStartChar(e)?n.InClosingTagName:n.InSpecialComment,this.sectionStart=this.index))},e.prototype.stateInClosingTagName=function(e){(e===r.Gt||a(e))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=n.AfterClosingTagName,this.stateAfterClosingTagName(e))},e.prototype.stateAfterClosingTagName=function(e){(e===r.Gt||this.fastForwardTo(r.Gt))&&(this.state=n.Text,this.baseState=n.Text,this.sectionStart=this.index+1)},e.prototype.stateBeforeAttributeName=function(e){e===r.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=n.InSpecialTag,this.sequenceIndex=0):this.state=n.Text,this.baseState=this.state,this.sectionStart=this.index+1):e===r.Slash?this.state=n.InSelfClosingTag:a(e)||(this.state=n.InAttributeName,this.sectionStart=this.index)},e.prototype.stateInSelfClosingTag=function(e){e===r.Gt?(this.cbs.onselfclosingtag(this.index),this.state=n.Text,this.baseState=n.Text,this.sectionStart=this.index+1,this.isSpecial=!1):a(e)||(this.state=n.BeforeAttributeName,this.stateBeforeAttributeName(e))},e.prototype.stateInAttributeName=function(e){(e===r.Eq||l(e))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=-1,this.state=n.AfterAttributeName,this.stateAfterAttributeName(e))},e.prototype.stateAfterAttributeName=function(e){e===r.Eq?this.state=n.BeforeAttributeValue:e===r.Slash||e===r.Gt?(this.cbs.onattribend(s.NoValue,this.index),this.state=n.BeforeAttributeName,this.stateBeforeAttributeName(e)):a(e)||(this.cbs.onattribend(s.NoValue,this.index),this.state=n.InAttributeName,this.sectionStart=this.index)},e.prototype.stateBeforeAttributeValue=function(e){e===r.DoubleQuote?(this.state=n.InAttributeValueDq,this.sectionStart=this.index+1):e===r.SingleQuote?(this.state=n.InAttributeValueSq,this.sectionStart=this.index+1):a(e)||(this.sectionStart=this.index,this.state=n.InAttributeValueNq,this.stateInAttributeValueNoQuotes(e))},e.prototype.handleInAttributeValue=function(e,t){e===t||!this.decodeEntities&&this.fastForwardTo(t)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(t===r.DoubleQuote?s.Double:s.Single,this.index),this.state=n.BeforeAttributeName):this.decodeEntities&&e===r.Amp&&(this.baseState=this.state,this.state=n.BeforeEntity)},e.prototype.stateInAttributeValueDoubleQuotes=function(e){this.handleInAttributeValue(e,r.DoubleQuote)},e.prototype.stateInAttributeValueSingleQuotes=function(e){this.handleInAttributeValue(e,r.SingleQuote)},e.prototype.stateInAttributeValueNoQuotes=function(e){a(e)||e===r.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(s.Unquoted,this.index),this.state=n.BeforeAttributeName,this.stateBeforeAttributeName(e)):this.decodeEntities&&e===r.Amp&&(this.baseState=this.state,this.state=n.BeforeEntity)},e.prototype.stateBeforeDeclaration=function(e){e===r.OpeningSquareBracket?(this.state=n.CDATASequence,this.sequenceIndex=0):this.state=e===r.Dash?n.BeforeComment:n.InDeclaration},e.prototype.stateInDeclaration=function(e){(e===r.Gt||this.fastForwardTo(r.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=n.Text,this.sectionStart=this.index+1)},e.prototype.stateInProcessingInstruction=function(e){(e===r.Gt||this.fastForwardTo(r.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=n.Text,this.sectionStart=this.index+1)},e.prototype.stateBeforeComment=function(e){e===r.Dash?(this.state=n.InCommentLike,this.currentSequence=u.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=n.InDeclaration},e.prototype.stateInSpecialComment=function(e){(e===r.Gt||this.fastForwardTo(r.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=n.Text,this.sectionStart=this.index+1)},e.prototype.stateBeforeSpecialS=function(e){var t=32|e;t===u.ScriptEnd[3]?this.startSpecial(u.ScriptEnd,4):t===u.StyleEnd[3]?this.startSpecial(u.StyleEnd,4):(this.state=n.InTagName,this.stateInTagName(e))},e.prototype.stateBeforeEntity=function(e){this.entityExcess=1,this.entityResult=0,e===r.Number?this.state=n.BeforeNumericEntity:e===r.Amp||(this.trieIndex=0,this.trieCurrent=this.entityTrie[0],this.state=n.InNamedEntity,this.stateInNamedEntity(e))},e.prototype.stateInNamedEntity=function(e){if(this.entityExcess+=1,this.trieIndex=(0,o.determineBranch)(this.entityTrie,this.trieCurrent,this.trieIndex+1,e),this.trieIndex<0)return this.emitNamedEntity(),void this.index--;this.trieCurrent=this.entityTrie[this.trieIndex];var t=this.trieCurrent&o.BinTrieFlags.VALUE_LENGTH;if(t){var i=(t>>14)-1;if(this.allowLegacyEntity()||e===r.Semi){var n=this.index-this.entityExcess+1;n>this.sectionStart&&this.emitPartial(this.sectionStart,n),this.entityResult=this.trieIndex,this.trieIndex+=i,this.entityExcess=0,this.sectionStart=this.index+1,0===i&&this.emitNamedEntity()}else this.trieIndex+=i}},e.prototype.emitNamedEntity=function(){if(this.state=this.baseState,0!==this.entityResult)switch((this.entityTrie[this.entityResult]&o.BinTrieFlags.VALUE_LENGTH)>>14){case 1:this.emitCodePoint(this.entityTrie[this.entityResult]&~o.BinTrieFlags.VALUE_LENGTH);break;case 2:this.emitCodePoint(this.entityTrie[this.entityResult+1]);break;case 3:this.emitCodePoint(this.entityTrie[this.entityResult+1]),this.emitCodePoint(this.entityTrie[this.entityResult+2])}},e.prototype.stateBeforeNumericEntity=function(e){(32|e)===r.LowerX?(this.entityExcess++,this.state=n.InHexEntity):(this.state=n.InNumericEntity,this.stateInNumericEntity(e))},e.prototype.emitNumericEntity=function(e){var t=this.index-this.entityExcess-1;t+2+Number(this.state===n.InHexEntity)!==this.index&&(t>this.sectionStart&&this.emitPartial(this.sectionStart,t),this.sectionStart=this.index+Number(e),this.emitCodePoint((0,o.replaceCodePoint)(this.entityResult))),this.state=this.baseState},e.prototype.stateInNumericEntity=function(e){e===r.Semi?this.emitNumericEntity(!0):c(e)?(this.entityResult=10*this.entityResult+(e-r.Zero),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},e.prototype.stateInHexEntity=function(e){e===r.Semi?this.emitNumericEntity(!0):c(e)?(this.entityResult=16*this.entityResult+(e-r.Zero),this.entityExcess++):function(e){return e>=r.UpperA&&e<=r.UpperF||e>=r.LowerA&&e<=r.LowerF}(e)?(this.entityResult=16*this.entityResult+((32|e)-r.LowerA+10),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},e.prototype.allowLegacyEntity=function(){return!this.xmlMode&&(this.baseState===n.Text||this.baseState===n.InSpecialTag)},e.prototype.cleanup=function(){this.running&&this.sectionStart!==this.index&&(this.state===n.Text||this.state===n.InSpecialTag&&0===this.sequenceIndex?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):this.state!==n.InAttributeValueDq&&this.state!==n.InAttributeValueSq&&this.state!==n.InAttributeValueNq||(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))},e.prototype.shouldContinue=function(){return this.index<this.buffer.length+this.offset&&this.running},e.prototype.parse=function(){for(;this.shouldContinue();){var e=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case n.Text:this.stateText(e);break;case n.SpecialStartSequence:this.stateSpecialStartSequence(e);break;case n.InSpecialTag:this.stateInSpecialTag(e);break;case n.CDATASequence:this.stateCDATASequence(e);break;case n.InAttributeValueDq:this.stateInAttributeValueDoubleQuotes(e);break;case n.InAttributeName:this.stateInAttributeName(e);break;case n.InCommentLike:this.stateInCommentLike(e);break;case n.InSpecialComment:this.stateInSpecialComment(e);break;case n.BeforeAttributeName:this.stateBeforeAttributeName(e);break;case n.InTagName:this.stateInTagName(e);break;case n.InClosingTagName:this.stateInClosingTagName(e);break;case n.BeforeTagName:this.stateBeforeTagName(e);break;case n.AfterAttributeName:this.stateAfterAttributeName(e);break;case n.InAttributeValueSq:this.stateInAttributeValueSingleQuotes(e);break;case n.BeforeAttributeValue:this.stateBeforeAttributeValue(e);break;case n.BeforeClosingTagName:this.stateBeforeClosingTagName(e);break;case n.AfterClosingTagName:this.stateAfterClosingTagName(e);break;case n.BeforeSpecialS:this.stateBeforeSpecialS(e);break;case n.InAttributeValueNq:this.stateInAttributeValueNoQuotes(e);break;case n.InSelfClosingTag:this.stateInSelfClosingTag(e);break;case n.InDeclaration:this.stateInDeclaration(e);break;case n.BeforeDeclaration:this.stateBeforeDeclaration(e);break;case n.BeforeComment:this.stateBeforeComment(e);break;case n.InProcessingInstruction:this.stateInProcessingInstruction(e);break;case n.InNamedEntity:this.stateInNamedEntity(e);break;case n.BeforeEntity:this.stateBeforeEntity(e);break;case n.InHexEntity:this.stateInHexEntity(e);break;case n.InNumericEntity:this.stateInNumericEntity(e);break;default:this.stateBeforeNumericEntity(e)}this.index++}this.cleanup()},e.prototype.finish=function(){this.state===n.InNamedEntity&&this.emitNamedEntity(),this.sectionStart<this.index&&this.handleTrailingData(),this.cbs.onend()},e.prototype.handleTrailingData=function(){var e=this.buffer.length+this.offset;this.state===n.InCommentLike?this.currentSequence===u.CdataEnd?this.cbs.oncdata(this.sectionStart,e,0):this.cbs.oncomment(this.sectionStart,e,0):this.state===n.InNumericEntity&&this.allowLegacyEntity()||this.state===n.InHexEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===n.InTagName||this.state===n.BeforeAttributeName||this.state===n.BeforeAttributeValue||this.state===n.AfterAttributeName||this.state===n.InAttributeName||this.state===n.InAttributeValueSq||this.state===n.InAttributeValueDq||this.state===n.InAttributeValueNq||this.state===n.InClosingTagName||this.cbs.ontext(this.sectionStart,e)},e.prototype.emitPartial=function(e,t){this.baseState!==n.Text&&this.baseState!==n.InSpecialTag?this.cbs.onattribdata(e,t):this.cbs.ontext(e,t)},e.prototype.emitCodePoint=function(e){this.baseState!==n.Text&&this.baseState!==n.InSpecialTag?this.cbs.onattribentity(e):this.cbs.ontextentity(e)},e}();t.default=h},3719:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,n)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&r(t,e,i);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomUtils=t.parseFeed=t.getFeed=t.ElementType=t.Tokenizer=t.createDomStream=t.parseDOM=t.parseDocument=t.DefaultHandler=t.DomHandler=t.Parser=void 0;var a=i(763),l=i(763);Object.defineProperty(t,"Parser",{enumerable:!0,get:function(){return l.Parser}});var c=i(7915),u=i(7915);function h(e,t){var i=new c.DomHandler(void 0,t);return new a.Parser(i,t).end(e),i.root}function d(e,t){return h(e,t).children}Object.defineProperty(t,"DomHandler",{enumerable:!0,get:function(){return u.DomHandler}}),Object.defineProperty(t,"DefaultHandler",{enumerable:!0,get:function(){return u.DomHandler}}),t.parseDocument=h,t.parseDOM=d,t.createDomStream=function(e,t,i){var r=new c.DomHandler(e,t,i);return new a.Parser(r,t)};var f=i(9889);Object.defineProperty(t,"Tokenizer",{enumerable:!0,get:function(){return o(f).default}}),t.ElementType=s(i(9960));var p=i(9432),g=i(9432);Object.defineProperty(t,"getFeed",{enumerable:!0,get:function(){return g.getFeed}});var m={xmlMode:!0};t.parseFeed=function(e,t){return void 0===t&&(t=m),(0,p.getFeed)(d(e,t))},t.DomUtils=s(i(9432))},9821:(e,t,i)=>{"use strict";const r=i(4579).parse,n=i(7799).compile,s=i(7094).segment,o=i(1105);e.exports={parse:r,compile:n,segment:s,hls:o}},7799:e=>{"use strict";function t(e,t){this.message=e,this.error=t}function i(e){const t=r(function(e){return Math.floor(e/60/60)}(e),2),i=r(function(e){return Math.floor(e/60)%60}(e),2),n=r(function(e){return Math.floor(e%60)}(e),2),s=r(function(e){return Math.floor(1e3*(e%1).toFixed(4))}(e),3);return`${t}:${i}:${n}.${s}`}function r(e,t){let i=`${e}`;for(;i.length<t;)i=`0${i}`;return i}t.prototype=Object.create(Error.prototype),e.exports={CompilerError:t,compile:function(e){if(!e)throw new t("Input must be non-null");if("object"!=typeof e)throw new t("Input must be an object");if(Array.isArray(e))throw new t("Input cannot be array");if(!e.valid)throw new t("Input must be valid");let r="WEBVTT\n";if(e.meta){if("object"!=typeof e.meta||Array.isArray(e.meta))throw new t("Metadata must be an object");Object.entries(e.meta).forEach((e=>{if("string"!=typeof e[1])throw new t(`Metadata value for "${e[0]}" must be string`);r+=`${e[0]}: ${e[1]}\n`}))}let n=null;return e.cues.forEach(((e,s)=>{if(n&&n>e.start)throw new t(`Cue number ${s} is not in chronological order`);n=e.start,r+="\n",r+=function(e){if("object"!=typeof e)throw new t("Cue malformed: not of type object");if("string"!=typeof e.identifier&&"number"!=typeof e.identifier&&null!==e.identifier)throw new t(`Cue malformed: identifier value is not a string.\n    ${JSON.stringify(e)}`);if(isNaN(e.start))throw new t(`Cue malformed: null start value.\n    ${JSON.stringify(e)}`);if(isNaN(e.end))throw new t(`Cue malformed: null end value.\n    ${JSON.stringify(e)}`);if(e.start>=e.end)throw new t(`Cue malformed: start timestamp greater than end\n    ${JSON.stringify(e)}`);if("string"!=typeof e.text)throw new t(`Cue malformed: null text value.\n    ${JSON.stringify(e)}`);if("string"!=typeof e.styles)throw new t(`Cue malformed: null styles value.\n    ${JSON.stringify(e)}`);let r="";e.identifier.length>0&&(r+=`${e.identifier}\n`);return r+=`${i(e.start)} --\x3e ${i(e.end)}`,r+=e.styles?` ${e.styles}`:"",r+=`\n${e.text}`,r}(e),r+="\n"})),r}}},1105:(e,t,i)=>{"use strict";const r=i(7094).segment;function n(e,t){return`${"0".repeat(Math.max(0,t-e.toString().length))}${e}`}function s(e){return`${e}.vtt`}function o(e){const t=(e%1).toFixed(3);e=Math.round(e-t);const i=Math.floor(e/3600),r=Math.floor((e-3600*i)/60),s=e-3600*i-60*r;return`${n(i,2)}:${n(r,2)}:${n(s,2)}.${n(1e3*t,3)}`}e.exports={hlsSegment:function(e,t,i){void 0===i&&(i="900000");const n=r(e,t),a=[];return n.forEach(((e,t)=>{const r=`WEBVTT\nX-TIMESTAMP-MAP=MPEGTS:${i},LOCAL:00:00:00.000\n\n${function(e){const t=[];return e.forEach((e=>{t.push(function(e){const t=[];e.identifier&&t.push(e.identifier);const i=o(e.start),r=o(e.end),n=e.styles?`${e.styles}`:"";return t.push(`${i} --\x3e ${r} ${n}`),t.push(e.text),t.join("\n")}(e))})),t.join("\n\n")}(e.cues)}\n`,n=s(t);a.push({filename:n,content:r})})),a},hlsSegmentPlaylist:function(e,t){const i=r(e,t),n=function(e){const t=[];return e.forEach(((e,i)=>{t.push(`#EXTINF:${e.duration.toFixed(5)},\n${s(i)}`)})),t.join("\n")}(i);return`#EXTM3U\n#EXT-X-TARGETDURATION:${Math.round(function(e){let t=0;return e.forEach((e=>{e.duration>t&&(t=e.duration)})),t}(i))}\n#EXT-X-VERSION:3\n#EXT-X-MEDIA-SEQUENCE:0\n#EXT-X-PLAYLIST-TYPE:VOD\n${n}\n#EXT-X-ENDLIST\n`}}},4579:e=>{"use strict";function t(e,t){this.message=e,this.error=t}t.prototype=Object.create(Error.prototype);const i=/([0-9]+)?:?([0-9]{2}):([0-9]{2}\.[0-9]{2,3})/;function r(e){return i.test(e)}function n(e){const t=e.match(i);let r=60*parseFloat(t[1]||0)*60;return r+=60*parseFloat(t[2]),r+=parseFloat(t[3]),r}e.exports={ParserError:t,parse:function(e,s){s||(s={});const{meta:o=!1,strict:a=!0}=s;if("string"!=typeof e)throw new t("Input must be a string");const l=(e=(e=(e=e.trim()).replace(/\r\n/g,"\n")).replace(/\r/g,"\n")).split("\n\n"),c=l.shift();if(!c.startsWith("WEBVTT"))throw new t('Must start with "WEBVTT"');const u=c.split("\n"),h=u[0].replace("WEBVTT","");if(h.length>0&&" "!==h[0]&&"\t"!==h[0])throw new t("Header comment must start with space or tab");if(0===l.length&&1===u.length)return{valid:!0,strict:a,cues:[],errors:[]};if(!o&&u.length>1&&""!==u[1])throw new t("Missing blank line after signature");const{cues:d,errors:f}=function(e,s){const o=[],a=e.map(((e,a)=>{try{return function(e,s,o){let a="",l=0,c=.01,u="",h="";const d=e.split("\n").filter(Boolean);if(d.length>0&&d[0].trim().startsWith("NOTE"))return null;if(1===d.length&&!d[0].includes("--\x3e"))throw new t(`Cue identifier cannot be standalone (cue #${s})`);if(d.length>1&&!d[0].includes("--\x3e")&&!d[1].includes("--\x3e"))throw new t(`Cue identifier needs to be followed by timestamp (cue #${s})`);d.length>1&&d[1].includes("--\x3e")&&(a=d.shift());const f="string"==typeof d[0]&&d[0].split(" --\x3e ");if(2!==f.length||!r(f[0])||!r(f[1]))throw new t(`Invalid cue timestamp (cue #${s})`);if(l=n(f[0]),c=n(f[1]),o){if(l>c)throw new t(`Start timestamp greater than end (cue #${s})`);if(c<=l)throw new t(`End must be greater than start (cue #${s})`)}if(!o&&c<l)throw new t(`End must be greater or equal to start when not strict (cue #${s})`);return h=f[1].replace(i,"").trim(),d.shift(),u=d.join("\n"),!!u&&{identifier:a,start:l,end:c,text:u,styles:h}}(e,a,s)}catch(e){return o.push(e),null}})).filter(Boolean);return{cues:a,errors:o}}(l,a);if(a&&f.length>0)throw f[0];const p=o?function(e){const t={};return e.slice(1).forEach((e=>{const i=e.indexOf(":"),r=e.slice(0,i).trim(),n=e.slice(i+1).trim();t[r]=n})),Object.keys(t).length>0?t:null}(u):null,g={valid:0===f.length,strict:a,cues:d,errors:f};return o&&(g.meta=p),g}}},7094:(e,t,i)=>{"use strict";const r=i(4579).parse;function n(e,t){return e+(t-e%t)}e.exports={segment:function(e,t){t=t||10;const i=r(e),s=[];let o=[],a=null,l=0,c=0;return i.cues.forEach(((e,r)=>{const u=0===r,h=r===i.cues.length-1,d=e.start,f=e.end,p=h?1/0:i.cues[r+1].start,g=u?f:f-d,m=u?0:d-i.cues[r-1].end;l=l+g+m,s.length,a&&(o.push(a),l+=a.end-c,a=null),o.push(e);let v=p-f<t&&m<t&&l>t;if(function(e,t,i,r){const s=n(r,t);return(r<=t||s+e<i)&&i-e>=t}(c,t,p,m)){const e=function(e,t,i,r,s){let o=i;return r>i&&(o=n(r-i,i)),o=e?parseFloat((t-s).toFixed(2)):Math.round(o),o}(h,f,t,l,c);s.push({duration:e,cues:o}),c+=e,l=0,o=[]}else v=!1;v&&(a=e)})),s}}},9203:function(module,exports){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,$,fullScreenApi;function OpenSeadragon(e){return new OpenSeadragon.Viewer(e)}!function(e){e.version={versionStr:"2.4.2",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("2",10)};var t,i={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},r=Object.prototype.toString,n=Object.prototype.hasOwnProperty;e.isFunction=function(t){return"function"===e.type(t)},e.isArray=Array.isArray||function(t){return"array"===e.type(t)},e.isWindow=function(e){return e&&"object"==typeof e&&"setInterval"in e},e.type=function(e){return null==e?String(e):i[r.call(e)]||"object"},e.isPlainObject=function(t){if(!t||"object"!==OpenSeadragon.type(t)||t.nodeType||e.isWindow(t))return!1;if(t.constructor&&!n.call(t,"constructor")&&!n.call(t.constructor.prototype,"isPrototypeOf"))return!1;var i;for(var r in t)i=r;return void 0===i||n.call(t,i)},e.isEmptyObject=function(e){for(var t in e)return!1;return!0},e.freezeObject=function(t){return Object.freeze?e.freezeObject=Object.freeze:e.freezeObject=function(e){return e},e.freezeObject(t)},e.supportsCanvas=(t=document.createElement("canvas"),!(!e.isFunction(t.getContext)||!t.getContext("2d"))),e.isCanvasTainted=function(e){var t=!1;try{e.getContext("2d").getImageData(0,0,1,1)}catch(e){t=!0}return t},e.pixelDensityRatio=function(){if(e.supportsCanvas){var t=document.createElement("canvas").getContext("2d"),i=window.devicePixelRatio||1,r=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return Math.max(i,1)/r}return 1}()}(OpenSeadragon),function($){$.extend=function(){var e,t,i,r,n,s,o=arguments[0]||{},a=arguments.length,l=!1,c=1;for("boolean"==typeof o&&(l=o,o=arguments[1]||{},c=2),"object"==typeof o||OpenSeadragon.isFunction(o)||(o={}),a===c&&(o=this,--c);c<a;c++)if(null!==(e=arguments[c])||void 0!==e)for(t in e)i=o[t],o!==(r=e[t])&&(l&&r&&(OpenSeadragon.isPlainObject(r)||(n=OpenSeadragon.isArray(r)))?(n?(n=!1,s=i&&OpenSeadragon.isArray(i)?i:[]):s=i&&OpenSeadragon.isPlainObject(i)?i:{},o[t]=OpenSeadragon.extend(l,s,r)):void 0!==r&&(o[t]=r));return o};var isIOSDevice=function(){if("object"!=typeof navigator)return!1;var e=navigator.userAgent;return"string"==typeof e&&(-1!==e.indexOf("iPhone")||-1!==e.indexOf("iPad")||-1!==e.indexOf("iPod"))};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(e,t){return function(){var i=arguments;return void 0===i&&(i=[]),t.apply(e,i)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(e){return"string"==typeof e&&(e=document.getElementById(e)),e},getElementPosition:function(e){var t,i,r=new $.Point;for(i=getOffsetParent(e=$.getElement(e),t="fixed"==$.getElementStyle(e).position);i;)r.x+=e.offsetLeft,r.y+=e.offsetTop,t&&(r=r.plus($.getPageScroll())),i=getOffsetParent(e=i,t="fixed"==$.getElementStyle(e).position);return r},getElementOffset:function(e){var t,i,r=(e=$.getElement(e))&&e.ownerDocument,n={top:0,left:0};return r?(t=r.documentElement,void 0!==e.getBoundingClientRect&&(n=e.getBoundingClientRect()),i=r==r.window?r:9===r.nodeType&&(r.defaultView||r.parentWindow),new $.Point(n.left+(i.pageXOffset||t.scrollLeft)-(t.clientLeft||0),n.top+(i.pageYOffset||t.scrollTop)-(t.clientTop||0))):new $.Point},getElementSize:function(e){return e=$.getElement(e),new $.Point(e.clientWidth,e.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(e){return(e=$.getElement(e)).currentStyle}:function(e){return e=$.getElement(e),window.getComputedStyle(e,"")},getCssPropertyWithVendorPrefix:function(e){var t={};return $.getCssPropertyWithVendorPrefix=function(e){if(void 0!==t[e])return t[e];var i=document.createElement("div").style,r=null;if(void 0!==i[e])r=e;else for(var n=["Webkit","Moz","MS","O","webkit","moz","ms","o"],s=$.capitalizeFirstLetter(e),o=0;o<n.length;o++){var a=n[o]+s;if(void 0!==i[a]){r=a;break}}return t[e]=r,r},$.getCssPropertyWithVendorPrefix(e)},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},positiveModulo:function(e,t){var i=e%t;return i<0&&(i+=t),i},pointInElement:function(e,t){e=$.getElement(e);var i=$.getElementOffset(e),r=$.getElementSize(e);return t.x>=i.x&&t.x<i.x+r.x&&t.y<i.y+r.y&&t.y>=i.y},getEvent:function(e){return $.getEvent=e?function(e){return e}:function(){return window.event},$.getEvent(e)},getMousePosition:function(e){if("number"==typeof e.pageX)$.getMousePosition=function(e){var t=new $.Point;return e=$.getEvent(e),t.x=e.pageX,t.y=e.pageY,t};else{if("number"!=typeof e.clientX)throw new Error("Unknown event mouse position, no known technique.");$.getMousePosition=function(e){var t=new $.Point;return e=$.getEvent(e),t.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,t.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop,t}}return $.getMousePosition(e)},getPageScroll:function(){var e=document.documentElement||{},t=document.body||{};if("number"==typeof window.pageXOffset)$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(t.scrollLeft||t.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!e.scrollLeft&&!e.scrollTop)return new $.Point(0,0);$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return $.getPageScroll()},setPageScroll:function(e){if(void 0!==window.scrollTo)$.setPageScroll=function(e){window.scrollTo(e.x,e.y)};else{var t=$.getPageScroll();if(t.x===e.x&&t.y===e.y)return;document.body.scrollLeft=e.x,document.body.scrollTop=e.y;var i=$.getPageScroll();if(i.x!==t.x&&i.y!==t.y)return void($.setPageScroll=function(e){document.body.scrollLeft=e.x,document.body.scrollTop=e.y});if(document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y,(i=$.getPageScroll()).x!==t.x&&i.y!==t.y)return void($.setPageScroll=function(e){document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y});$.setPageScroll=function(e){}}return $.setPageScroll(e)},getWindowSize:function(){var e=document.documentElement||{},t=document.body||{};if("number"==typeof window.innerWidth)$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(e.clientWidth||e.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!t.clientWidth&&!t.clientHeight)throw new Error("Unknown window size, no known technique.");$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)}}return $.getWindowSize()},makeCenteredNode:function(e){e=$.getElement(e);var t=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(t[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(t[1].style,{display:"table-row"}),$.extend(t[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),t[0].appendChild(t[1]),t[1].appendChild(t[2]),t[2].appendChild(e),t[0]},makeNeutralElement:function(e){var t=document.createElement(e),i=t.style;return i.background="transparent none",i.border="none",i.margin="0px",i.padding="0px",i.position="static",t},now:function(){return Date.now?$.now=Date.now:$.now=function(){return(new Date).getTime()},$.now()},makeTransparentImage:function(e){return $.makeTransparentImage=function(e){var t=$.makeNeutralElement("img");return t.src=e,t},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(e){var t=$.makeNeutralElement("img"),i=null;return(i=$.makeNeutralElement("span")).style.display="inline-block",t.onload=function(){i.style.width=i.style.width||t.width+"px",i.style.height=i.style.height||t.height+"px",t.onload=null,t=null},t.src=e,i.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e+"', sizingMethod='scale')",i}),$.makeTransparentImage(e)},setElementOpacity:function(e,t,i){var r;e=$.getElement(e),i&&!$.Browser.alpha&&(t=Math.round(t)),$.Browser.opacity?e.style.opacity=t<1?t:"":t<1?(r="alpha(opacity="+Math.round(100*t)+")",e.style.filter=r):e.style.filter=""},setElementTouchActionNone:function(e){void 0!==(e=$.getElement(e)).style.touchAction?e.style.touchAction="none":void 0!==e.style.msTouchAction&&(e.style.msTouchAction="none")},addClass:function(e,t){(e=$.getElement(e)).className?-1===(" "+e.className+" ").indexOf(" "+t+" ")&&(e.className+=" "+t):e.className=t},indexOf:function(e,t,i){return Array.prototype.indexOf?this.indexOf=function(e,t,i){return e.indexOf(t,i)}:this.indexOf=function(e,t,i){var r,n,s=i||0;if(!e)throw new TypeError;if(0===(n=e.length)||s>=n)return-1;for(s<0&&(s=n-Math.abs(s)),r=s;r<n;r++)if(e[r]===t)return r;return-1},this.indexOf(e,t,i)},removeClass:function(e,t){var i,r,n=[];for(i=(e=$.getElement(e)).className.split(/\s+/),r=0;r<i.length;r++)i[r]&&i[r]!==t&&n.push(i[r]);e.className=n.join(" ")},addEvent:function(){if(window.addEventListener)return function(e,t,i,r){(e=$.getElement(e)).addEventListener(t,i,r)};if(window.attachEvent)return function(e,t,i,r){(e=$.getElement(e)).attachEvent("on"+t,i)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(e,t,i,r){(e=$.getElement(e)).removeEventListener(t,i,r)};if(window.detachEvent)return function(e,t,i,r){(e=$.getElement(e)).detachEvent("on"+t,i)};throw new Error("No known event model.")}(),cancelEvent:function(e){(e=$.getEvent(e)).preventDefault?$.cancelEvent=function(e){e.preventDefault()}:$.cancelEvent=function(e){(e=$.getEvent(e)).cancel=!0,e.returnValue=!1},$.cancelEvent(e)},stopEvent:function(e){(e=$.getEvent(e)).stopPropagation?$.stopEvent=function(e){e.stopPropagation()}:$.stopEvent=function(e){(e=$.getEvent(e)).cancelBubble=!0},$.stopEvent(e)},createCallback:function(e,t){var i,r=[];for(i=2;i<arguments.length;i++)r.push(arguments[i]);return function(){var i,n=r.concat([]);for(i=0;i<arguments.length;i++)n.push(arguments[i]);return t.apply(e,n)}},getUrlParameter:function(e){return URLPARAMS[e]||null},getUrlProtocol:function(e){var t=e.match(/^([a-z]+:)\/\//i);return null===t?window.location.protocol:t[1].toLowerCase()},createAjaxRequest:function(e){var t;try{t=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(e){t=!1}if(t)window.XMLHttpRequest?$.createAjaxRequest=function(e){return e?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");$.createAjaxRequest=function(){return new XMLHttpRequest}}return $.createAjaxRequest(e)},makeAjaxRequest:function(e,t,i){var r,n,s;$.isPlainObject(e)&&(t=e.success,i=e.error,r=e.withCredentials,n=e.headers,s=e.responseType||null,e=e.url);var o=$.getUrlProtocol(e),a=$.createAjaxRequest("file:"===o);if(!$.isFunction(t))throw new Error("makeAjaxRequest requires a success callback");a.onreadystatechange=function(){4==a.readyState&&(a.onreadystatechange=function(){},a.status>=200&&a.status<300||0===a.status&&"http:"!==o&&"https:"!==o?t(a):($.console.log("AJAX request returned %d: %s",a.status,e),$.isFunction(i)&&i(a)))};try{if(a.open("GET",e,!0),s&&(a.responseType=s),n)for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&n[l]&&a.setRequestHeader(l,n[l]);r&&(a.withCredentials=!0),a.send(null)}catch(r){var c=r.message;if($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10&&void 0!==r.number&&-2147024891==r.number&&(c+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"),$.console.log("%s while making AJAX request: %s",r.name,c),a.onreadystatechange=function(){},window.XDomainRequest){var u=new window.XDomainRequest;if(u){u.onload=function(e){$.isFunction(t)&&t({responseText:u.responseText,status:200,statusText:"OK"})},u.onerror=function(e){$.isFunction(i)&&i({responseText:u.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{u.open("GET",e),u.send()}catch(e){$.isFunction(i)&&i(a,r)}}}else $.isFunction(i)&&i(a,r)}return a},jsonp:function(e){var t,i=e.url,r=document.head||document.getElementsByTagName("head")[0]||document.documentElement,n=e.callbackName||"openseadragon"+$.now(),s=window[n],o="$1"+n+"$2",a=e.param||"callback",l=e.callback;i=i.replace(/(\=)\?(&|$)|\?\?/i,o),i+=(/\?/.test(i)?"&":"?")+a+"="+n,window[n]=function(e){if(s)window[n]=s;else try{delete window[n]}catch(e){}l&&$.isFunction(l)&&l(e)},t=document.createElement("script"),void 0===e.async&&!1===e.async||(t.async="async"),e.scriptCharset&&(t.charset=e.scriptCharset),t.src=i,t.onload=t.onreadystatechange=function(e,i){(i||!t.readyState||/loaded|complete/.test(t.readyState))&&(t.onload=t.onreadystatechange=null,r&&t.parentNode&&r.removeChild(t),t=void 0)},r.insertBefore(t,r.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(e){if(window.DOMParser)$.parseXml=function(e){return(new DOMParser).parseFromString(e,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");$.parseXml=function(e){var t=null;return(t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e),t}}return $.parseXml(e)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(e){return!!FILEFORMATS[(e=e||"").toLowerCase()]}});var nullfunction=function(e){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};function getOffsetParent(e,t){return t&&e!=document.body?document.body:e.offsetParent}!function(){var e=navigator.appVersion,t=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(t.substring(t.indexOf("MSIE")+5,t.indexOf(";",t.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(t.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(t.substring(t.indexOf("Firefox")+8))):t.indexOf("Safari")>=0?($.Browser.vendor=t.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(t.substring(t.substring(0,t.indexOf("Safari")).lastIndexOf("/")+1,t.indexOf("Safari")))):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(t)&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(e)}var i,r,n,s=window.location.search.substring(1).split("&");for(n=0;n<s.length;n++)if((r=(i=s[n]).indexOf("="))>0){var o=i.substring(0,r),a=i.substring(r+1);try{URLPARAMS[o]=decodeURIComponent(a)}catch(e){$.console.error("Ignoring malformed URL parameter: %s=%s",o,a)}}$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)}(),function(e){var t=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame,i=e.cancelAnimationFrame||e.mozCancelAnimationFrame||e.webkitCancelAnimationFrame||e.msCancelAnimationFrame;if(t&&i)$.requestAnimationFrame=function(){return t.apply(e,arguments)},$.cancelAnimationFrame=function(){return i.apply(e,arguments)};else{var r,n=[],s=[],o=0;$.requestAnimationFrame=function(e){return n.push([++o,e]),r||(r=setInterval((function(){if(n.length){var e=$.now(),t=s;for(s=n,n=t;s.length;)s.shift()[1](e)}else clearInterval(r),r=void 0}),20)),o},$.cancelAnimationFrame=function(e){var t,i;for(t=0,i=n.length;t<i;t+=1)if(n[t][0]===e)return void n.splice(t,1);for(t=0,i=s.length;t<i;t+=1)if(s[t][0]===e)return void s.splice(t,1)}}}(window)}(OpenSeadragon),__WEBPACK_AMD_DEFINE_ARRAY__=[],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=function(){return OpenSeadragon})?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__),$=OpenSeadragon,fullScreenApi={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""},document.exitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.fullscreenElement},fullScreenApi.requestFullScreen=function(e){return e.requestFullscreen()},fullScreenApi.exitFullScreen=function(){document.exitFullscreen()},fullScreenApi.fullScreenEventName="fullscreenchange",fullScreenApi.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.msFullscreenElement},fullScreenApi.requestFullScreen=function(e){return e.msRequestFullscreen()},fullScreenApi.exitFullScreen=function(){document.msExitFullscreen()},fullScreenApi.fullScreenEventName="MSFullscreenChange",fullScreenApi.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.webkitFullscreenElement},fullScreenApi.requestFullScreen=function(e){return e.webkitRequestFullscreen()},fullScreenApi.exitFullScreen=function(){document.webkitExitFullscreen()},fullScreenApi.fullScreenEventName="webkitfullscreenchange",fullScreenApi.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},fullScreenApi.requestFullScreen=function(e){return e.webkitRequestFullScreen()},fullScreenApi.exitFullScreen=function(){document.webkitCancelFullScreen()},fullScreenApi.fullScreenEventName="webkitfullscreenchange",fullScreenApi.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.mozFullScreenElement},fullScreenApi.requestFullScreen=function(e){return e.mozRequestFullScreen()},fullScreenApi.exitFullScreen=function(){document.mozCancelFullScreen()},fullScreenApi.fullScreenEventName="mozfullscreenchange",fullScreenApi.fullScreenErrorEventName="mozfullscreenerror"),fullScreenApi.isFullScreen=function(){return null!==fullScreenApi.getFullScreenElement()},fullScreenApi.cancelFullScreen=function(){$.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),fullScreenApi.exitFullScreen()},$.extend($,fullScreenApi),function(e){e.EventSource=function(){this.events={}},e.EventSource.prototype={addOnceHandler:function(e,t,i,r){var n=this;r=r||1;var s=0,o=function(i){++s===r&&n.removeHandler(e,o),t(i)};this.addHandler(e,o,i)},addHandler:function(t,i,r){var n=this.events[t];n||(this.events[t]=n=[]),i&&e.isFunction(i)&&(n[n.length]={handler:i,userData:r||null})},removeHandler:function(t,i){var r,n=this.events[t],s=[];if(n&&e.isArray(n)){for(r=0;r<n.length;r++)n[r].handler!==i&&s.push(n[r]);this.events[t]=s}},removeAllHandlers:function(e){if(e)this.events[e]=[];else for(var t in this.events)this.events[t]=[]},getHandler:function(e){var t=this.events[e];return t&&t.length?(t=1===t.length?[t[0]]:Array.apply(null,t),function(e,i){var r,n=t.length;for(r=0;r<n;r++)t[r]&&(i.eventSource=e,i.userData=t[r].userData,t[r].handler(i))}):null},raiseEvent:function(e,t){var i=this.getHandler(e);i&&(t||(t={}),i(this,t))}}}(OpenSeadragon),function(e){var t,i,r,n,s,o,a=[],l={};function c(t){var i,r=l[t.hash],n=r.activePointersLists.length;for(i=0;i<n;i++)r.activePointersLists[i].captureCount>0&&(e.removeEvent(e.MouseTracker.captureElement,"mousemove",r.mousemovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"mouseup",r.mouseupcaptured,!0),e.removeEvent(e.MouseTracker.captureElement,e.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",r.pointermovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,e.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",r.pointerupcaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"touchmove",r.touchmovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"touchend",r.touchendcaptured,!0),r.activePointersLists[i].captureCount=0);for(i=0;i<n;i++)r.activePointersLists.pop()}function u(t){var i,r,n=l[t.hash];if(n.tracking){for(r=0;r<e.MouseTracker.subscribeEvents.length;r++)i=e.MouseTracker.subscribeEvents[r],e.removeEvent(t.element,i,n[i],!1);c(t),n.tracking=!1}}function h(t,i){var r=l[t.hash];if("pointerevent"===i)return{upName:e.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:r.pointerupcaptured,moveName:e.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:r.pointermovecaptured};if("mouse"===i)return{upName:"mouseup",upHandler:r.mouseupcaptured,moveName:"mousemove",moveHandler:r.mousemovecaptured};if("touch"===i)return{upName:"touchend",upHandler:r.touchendcaptured,moveName:"touchmove",moveHandler:r.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function d(t,i,r){var n,s=t.getActivePointersListByType(i);s.captureCount+=r||1,1===s.captureCount&&(e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?t.element.setCapture(!0):(n=h(t,e.MouseTracker.havePointerEvents?"pointerevent":i),V&&q(window.top)&&e.addEvent(window.top,n.upName,n.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,n.upName,n.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,n.moveName,n.moveHandler,!0)))}function f(t,i,r){var n,s=t.getActivePointersListByType(i);s.captureCount-=r||1,0===s.captureCount&&(e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?t.element.releaseCapture():(n=h(t,e.MouseTracker.havePointerEvents?"pointerevent":i),V&&q(window.top)&&e.removeEvent(window.top,n.upName,n.upHandler,!0),e.removeEvent(e.MouseTracker.captureElement,n.moveName,n.moveHandler,!0),e.removeEvent(e.MouseTracker.captureElement,n.upName,n.upHandler,!0)))}function p(t){var i;if(e.MouseTracker.unprefixedPointerEvents)i=t.pointerType;else switch(t.pointerType){case 2:i="touch";break;case 3:i="pen";break;case 4:i="mouse";break;default:i=""}return i}function g(t){return e.getMousePosition(t)}function m(e,t){return v(g(e),t)}function v(t,i){var r=e.getElementOffset(i);return t.minus(r)}function y(t,i){return new e.Point((t.x+i.x)/2,(t.y+i.y)/2)}function w(t,i){var r={target:(i=e.getEvent(i)).target||i.srcElement,type:"wheel",shiftKey:i.shiftKey||!1,clientX:i.clientX,clientY:i.clientY,pageX:i.pageX?i.pageX:i.clientX,pageY:i.pageY?i.pageY:i.clientY,deltaMode:"MozMousePixelScroll"==i.type?0:1,deltaX:0,deltaZ:0};"mousewheel"==e.MouseTracker.wheelEventName?r.deltaY=-i.wheelDelta/e.DEFAULT_SETTINGS.pixelsPerWheelLine:r.deltaY=i.detail,E(t,r,i)}function E(t,i,r){var n;n=i.deltaY<0?1:-1,t.scrollHandler&&!1===t.scrollHandler({eventSource:t,pointerType:"mouse",position:m(i,t.element),scroll:n,shift:i.shiftKey,isTouchEvent:!1,originalEvent:r,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(r)}function b(e,t){if(e===t)return!1;for(;t&&t!==e;)t=t.parentNode;return t===e}function T(t,i){$(t,i,[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:g(i),currentTime:e.now()}])}function S(t,i){H(t,i,[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:g(i),currentTime:e.now()}])}function x(t){return e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?1===t?0:2===t?2:4===t?1:-1:t}function R(t,i){j(t,i=e.getEvent(i),[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:g(i),currentTime:e.now()}],x(i.button))&&f(t,"mouse")}function C(t,i){G(t,i=e.getEvent(i),[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:g(i),currentTime:e.now()}])}function A(e,t,i){var r,n=i.getLength(),s=[];if("touch"===i.type||i.contacts>0){for(r=0;r<n;r++)s.push(i.getByIndex(r));s.length>0&&(j(e,t,s,0),i.captureCount=1,f(e,i.type),H(e,t,s))}}function k(t,i){var r,n,s,o,l=i.changedTouches.length,c=[];for(r=e.now(),n=0;n<l;n++)c.push({id:i.changedTouches[n].identifier,type:"touch",currentPos:g(i.changedTouches[n]),currentTime:r});for(j(t,i,c,0)&&f(t,"touch",l),H(t,i,c),n=0;n<a.length;n++)if(a[n]!==t&&a[n].isTracking()&&b(a[n].element,t.element)){for(o=[],s=0;s<l;s++)o.push({id:i.changedTouches[s].identifier,type:"touch",currentPos:g(i.changedTouches[s]),currentTime:r});H(a[n],i,o)}e.cancelEvent(i)}function L(t,i){var r,n=i.changedTouches.length,s=[];for(r=0;r<n;r++)s.push({id:i.changedTouches[r].identifier,type:"touch",currentPos:g(i.changedTouches[r]),currentTime:e.now()});G(t,i,s),e.cancelEvent(i)}function I(t,i){i.currentTarget===i.relatedTarget||b(i.currentTarget,i.relatedTarget)||$(t,i,[{id:i.pointerId,type:p(i),isPrimary:i.isPrimary,currentPos:g(i),currentTime:e.now()}])}function P(t,i){i.currentTarget===i.relatedTarget||b(i.currentTarget,i.relatedTarget)||H(t,i,[{id:i.pointerId,type:p(i),isPrimary:i.isPrimary,currentPos:g(i),currentTime:e.now()}])}function _(t,i){var r;z(t,i,[r={id:i.pointerId,type:p(i),isPrimary:i.isPrimary,currentPos:g(i),currentTime:e.now()}],i.button)&&(e.stopEvent(i),d(t,r.type)),(t.clickHandler||t.dblClickHandler||t.pressHandler||t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.cancelEvent(i)}function D(e,t){O(e,t)}function O(t,i){var r;j(t,i,[r={id:i.pointerId,type:p(i),isPrimary:i.isPrimary,currentPos:g(i),currentTime:e.now()}],i.button)&&f(t,r.type)}function M(e,t){F(e,t)}function F(t,i){G(t,i,[{id:i.pointerId,type:p(i),isPrimary:i.isPrimary,currentPos:g(i),currentTime:e.now()}])}function N(e,t){!function(e,t,i){j(e,t,i,0),H(e,t,i)}(e,t,[{id:t.pointerId,type:p(t)}])}function B(e,t){return Object.prototype.hasOwnProperty.call(t,"isPrimary")||(0===e.getLength()?t.isPrimary=!0:t.isPrimary=!1),t.speed=0,t.direction=0,t.contactPos=t.currentPos,t.contactTime=t.currentTime,t.lastPos=t.currentPos,t.lastTime=t.currentTime,e.add(t)}function U(e,t){var i,r;return e.getById(t.id)?(i=e.removeById(t.id),Object.prototype.hasOwnProperty.call(t,"isPrimary")||(r=e.getPrimary())||(r=e.getByIndex(0))&&(r.isPrimary=!0)):i=e.getLength(),i}function $(t,i,r){var n,s,o,a=t.getActivePointersListByType(r[0].type),l=r.length;for(n=0;n<l;n++)s=r[n],(o=a.getById(s.id))?(o.insideElement=!0,o.lastPos=o.currentPos,o.lastTime=o.currentTime,o.currentPos=s.currentPos,o.currentTime=s.currentTime,s=o):(s.captured=!1,s.insideElementPressed=!1,s.insideElement=!0,B(a,s)),t.enterHandler&&!1===t.enterHandler({eventSource:t,pointerType:s.type,position:v(s.currentPos,t.element),buttons:a.buttons,pointers:t.getActivePointerCount(),insideElementPressed:s.insideElementPressed,buttonDownAny:0!==a.buttons,isTouchEvent:"touch"===s.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i)}function H(t,i,r){var n,s,o,a=t.getActivePointersListByType(r[0].type),l=r.length;for(n=0;n<l;n++)s=r[n],(o=a.getById(s.id))&&(o.captured?(o.insideElement=!1,o.lastPos=o.currentPos,o.lastTime=o.currentTime,o.currentPos=s.currentPos,o.currentTime=s.currentTime):U(a,o),s=o),t.exitHandler&&!1===t.exitHandler({eventSource:t,pointerType:s.type,position:s.currentPos&&v(s.currentPos,t.element),buttons:a.buttons,pointers:t.getActivePointerCount(),insideElementPressed:!!o&&o.insideElementPressed,buttonDownAny:0!==a.buttons,isTouchEvent:"touch"===s.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i)}function z(t,i,r,n){var s,o,a,c=l[t.hash],u=t.getActivePointersListByType(r[0].type),h=r.length;void 0!==i.buttons?u.buttons=i.buttons:e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?0===n?u.buttons+=1:1===n?u.buttons+=4:2===n?u.buttons+=2:3===n?u.buttons+=8:4===n?u.buttons+=16:5===n&&(u.buttons+=32):0===n?u.buttons|=1:1===n?u.buttons|=4:2===n?u.buttons|=2:3===n?u.buttons|=8:4===n?u.buttons|=16:5===n&&(u.buttons|=32);var d=t.getActivePointersListsExceptType(r[0].type);for(s=0;s<d.length;s++)A(t,i,d[s]);if(0!==n)return t.nonPrimaryPressHandler&&!1===t.nonPrimaryPressHandler({eventSource:t,pointerType:r[0].type,position:v(r[0].currentPos,t.element),button:n,buttons:u.buttons,isTouchEvent:"touch"===r[0].type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i),!1;for(s=0;s<h;s++)o=r[s],(a=u.getById(o.id))?(a.captured=!0,a.insideElementPressed=!0,a.insideElement=!0,a.contactPos=o.currentPos,a.contactTime=o.currentTime,a.lastPos=a.currentPos,a.lastTime=a.currentTime,a.currentPos=o.currentPos,a.currentTime=o.currentTime,o=a):(o.captured=!0,o.insideElementPressed=!0,o.insideElement=!0,B(u,o)),u.addContact(),(t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.addPoint(t,o),1===u.contacts?t.pressHandler&&!1===t.pressHandler({eventSource:t,pointerType:o.type,position:v(o.contactPos,t.element),buttons:u.buttons,isTouchEvent:"touch"===o.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i):2===u.contacts&&t.pinchHandler&&"touch"===o.type&&(c.pinchGPoints=u.asArray(),c.lastPinchDist=c.currentPinchDist=c.pinchGPoints[0].currentPos.distanceTo(c.pinchGPoints[1].currentPos),c.lastPinchCenter=c.currentPinchCenter=y(c.pinchGPoints[0].currentPos,c.pinchGPoints[1].currentPos));return!0}function j(t,i,r,n){var s,o,a,c,u,h,d=l[t.hash],f=t.getActivePointersListByType(r[0].type),p=r.length,g=!1,m=!1;if(void 0!==i.buttons?f.buttons=i.buttons:e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?0===n?f.buttons-=1:1===n?f.buttons-=4:2===n?f.buttons-=2:3===n?f.buttons-=8:4===n?f.buttons-=16:5===n&&(f.buttons-=32):0===n?f.buttons^=-2:1===n?f.buttons^=-5:2===n?f.buttons^=-3:3===n?f.buttons^=-9:4===n?f.buttons^=-17:5===n&&(f.buttons^=-33),0!==n){t.nonPrimaryReleaseHandler&&!1===t.nonPrimaryReleaseHandler({eventSource:t,pointerType:r[0].type,position:v(r[0].currentPos,t.element),button:n,buttons:f.buttons,isTouchEvent:"touch"===r[0].type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i);var w=t.getActivePointersListByType("mouse");return A(t,i,w),!1}if(void 0===r[0].currentPos)return A(t,i,f),!1;for(a=0;a<p;a++)c=r[a],(u=f.getById(c.id))&&(u.captured&&(u.captured=!1,g=!0,m=!0),u.lastPos=u.currentPos,u.lastTime=u.currentTime,u.currentPos=c.currentPos,u.currentTime=c.currentTime,u.insideElement||U(f,u),s=u.currentPos,o=u.currentTime,m?(f.removeContact(),(t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.removePoint(t,u),0===f.contacts?(t.releaseHandler&&!1===t.releaseHandler({eventSource:t,pointerType:u.type,position:v(s,t.element),buttons:f.buttons,insideElementPressed:u.insideElementPressed,insideElementReleased:u.insideElement,isTouchEvent:"touch"===u.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i),t.dragEndHandler&&!u.currentPos.equals(u.contactPos)&&!1===t.dragEndHandler({eventSource:t,pointerType:u.type,position:v(u.currentPos,t.element),speed:u.speed,direction:u.direction,shift:i.shiftKey,isTouchEvent:"touch"===u.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i),(t.clickHandler||t.dblClickHandler)&&u.insideElement&&(h=o-u.contactTime<=t.clickTimeThreshold&&u.contactPos.distanceTo(s)<=t.clickDistThreshold,t.clickHandler&&!1===t.clickHandler({eventSource:t,pointerType:u.type,position:v(u.currentPos,t.element),quick:h,shift:i.shiftKey,isTouchEvent:"touch"===u.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i),t.dblClickHandler&&h&&(f.clicks++,1===f.clicks?(d.lastClickPos=s,d.dblClickTimeOut=setTimeout((function(){f.clicks=0}),t.dblClickTimeThreshold)):2===f.clicks&&(clearTimeout(d.dblClickTimeOut),f.clicks=0,d.lastClickPos.distanceTo(s)<=t.dblClickDistThreshold&&!1===t.dblClickHandler({eventSource:t,pointerType:u.type,position:v(u.currentPos,t.element),shift:i.shiftKey,isTouchEvent:"touch"===u.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i),d.lastClickPos=null)))):2===f.contacts&&t.pinchHandler&&"touch"===u.type&&(d.pinchGPoints=f.asArray(),d.lastPinchDist=d.currentPinchDist=d.pinchGPoints[0].currentPos.distanceTo(d.pinchGPoints[1].currentPos),d.lastPinchCenter=d.currentPinchCenter=y(d.pinchGPoints[0].currentPos,d.pinchGPoints[1].currentPos))):t.releaseHandler&&!1===t.releaseHandler({eventSource:t,pointerType:u.type,position:v(s,t.element),buttons:f.buttons,insideElementPressed:u.insideElementPressed,insideElementReleased:u.insideElement,isTouchEvent:"touch"===u.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i));return g}function G(t,i,r){var n,s,o,a,c,u=l[t.hash],h=t.getActivePointersListByType(r[0].type),d=r.length;for(void 0!==i.buttons&&(h.buttons=i.buttons),n=0;n<d;n++)s=r[n],(o=h.getById(s.id))?(Object.prototype.hasOwnProperty.call(s,"isPrimary")&&(o.isPrimary=s.isPrimary),o.lastPos=o.currentPos,o.lastTime=o.currentTime,o.currentPos=s.currentPos,o.currentTime=s.currentTime):(s.captured=!1,s.insideElementPressed=!1,s.insideElement=!0,B(h,s));t.stopHandler&&"mouse"===r[0].type&&(clearTimeout(t.stopTimeOut),t.stopTimeOut=setTimeout((function(){!function(e,t,i){e.stopHandler&&e.stopHandler({eventSource:e,pointerType:i,position:m(t,e.element),buttons:e.getActivePointersListByType(i).buttons,isTouchEvent:"touch"===i,originalEvent:t,preventDefaultAction:!1,userData:e.userData})}(t,i,r[0].type)}),t.stopDelay)),0===h.contacts?t.moveHandler&&!1===t.moveHandler({eventSource:t,pointerType:r[0].type,position:v(r[0].currentPos,t.element),buttons:h.buttons,isTouchEvent:"touch"===r[0].type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i):1===h.contacts?(t.moveHandler&&(o=h.asArray()[0],!1===t.moveHandler({eventSource:t,pointerType:o.type,position:v(o.currentPos,t.element),buttons:h.buttons,isTouchEvent:"touch"===o.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i)),t.dragHandler&&(c=(o=h.asArray()[0]).currentPos.minus(o.lastPos),!1===t.dragHandler({eventSource:t,pointerType:o.type,position:v(o.currentPos,t.element),buttons:h.buttons,delta:c,speed:o.speed,direction:o.direction,shift:i.shiftKey,isTouchEvent:"touch"===o.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i))):2===h.contacts&&(t.moveHandler&&(a=h.asArray(),!1===t.moveHandler({eventSource:t,pointerType:a[0].type,position:v(y(a[0].currentPos,a[1].currentPos),t.element),buttons:h.buttons,isTouchEvent:"touch"===a[0].type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i)),t.pinchHandler&&"touch"===r[0].type&&(c=u.pinchGPoints[0].currentPos.distanceTo(u.pinchGPoints[1].currentPos))!=u.currentPinchDist&&(u.lastPinchDist=u.currentPinchDist,u.currentPinchDist=c,u.lastPinchCenter=u.currentPinchCenter,u.currentPinchCenter=y(u.pinchGPoints[0].currentPos,u.pinchGPoints[1].currentPos),!1===t.pinchHandler({eventSource:t,pointerType:"touch",gesturePoints:u.pinchGPoints,lastCenter:v(u.lastPinchCenter,t.element),center:v(u.currentPinchCenter,t.element),lastDistance:u.lastPinchDist,distance:u.currentPinchDist,shift:i.shiftKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i)))}e.MouseTracker=function(t){a.push(this);var i=arguments;e.isPlainObject(t)||(t={element:i[0],clickTimeThreshold:i[1],clickDistThreshold:i[2]}),this.hash=Math.random(),this.element=e.getElement(t.element),this.clickTimeThreshold=t.clickTimeThreshold||e.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=t.clickDistThreshold||e.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=t.dblClickTimeThreshold||e.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=t.dblClickDistThreshold||e.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=t.userData||null,this.stopDelay=t.stopDelay||50,this.enterHandler=t.enterHandler||null,this.exitHandler=t.exitHandler||null,this.pressHandler=t.pressHandler||null,this.nonPrimaryPressHandler=t.nonPrimaryPressHandler||null,this.releaseHandler=t.releaseHandler||null,this.nonPrimaryReleaseHandler=t.nonPrimaryReleaseHandler||null,this.moveHandler=t.moveHandler||null,this.scrollHandler=t.scrollHandler||null,this.clickHandler=t.clickHandler||null,this.dblClickHandler=t.dblClickHandler||null,this.dragHandler=t.dragHandler||null,this.dragEndHandler=t.dragEndHandler||null,this.pinchHandler=t.pinchHandler||null,this.stopHandler=t.stopHandler||null,this.keyDownHandler=t.keyDownHandler||null,this.keyUpHandler=t.keyUpHandler||null,this.keyHandler=t.keyHandler||null,this.focusHandler=t.focusHandler||null,this.blurHandler=t.blurHandler||null;var r=this;l[this.hash]={click:function(t){!function(t,i){t.clickHandler&&e.cancelEvent(i)}(r,t)},dblclick:function(t){!function(t,i){t.dblClickHandler&&e.cancelEvent(i)}(r,t)},keydown:function(t){!function(t,i){t.keyDownHandler&&(i=e.getEvent(i),t.keyDownHandler({eventSource:t,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData})||e.cancelEvent(i))}(r,t)},keyup:function(t){!function(t,i){t.keyUpHandler&&(i=e.getEvent(i),t.keyUpHandler({eventSource:t,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData})||e.cancelEvent(i))}(r,t)},keypress:function(t){!function(t,i){t.keyHandler&&(i=e.getEvent(i),t.keyHandler({eventSource:t,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData})||e.cancelEvent(i))}(r,t)},focus:function(t){!function(t,i){t.focusHandler&&(i=e.getEvent(i),!1===t.focusHandler({eventSource:t,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i))}(r,t)},blur:function(t){!function(t,i){t.blurHandler&&(i=e.getEvent(i),!1===t.blurHandler({eventSource:t,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i))}(r,t)},wheel:function(e){!function(e,t){E(e,t,t)}(r,e)},mousewheel:function(e){w(r,e)},DOMMouseScroll:function(e){w(r,e)},MozMousePixelScroll:function(e){w(r,e)},mouseenter:function(t){!function(t,i){T(t,i=e.getEvent(i))}(r,t)},mouseleave:function(t){!function(t,i){S(t,i=e.getEvent(i))}(r,t)},mouseover:function(t){!function(t,i){(i=e.getEvent(i)).currentTarget===i.relatedTarget||b(i.currentTarget,i.relatedTarget)||T(t,i)}(r,t)},mouseout:function(t){!function(t,i){(i=e.getEvent(i)).currentTarget===i.relatedTarget||b(i.currentTarget,i.relatedTarget)||S(t,i)}(r,t)},mousedown:function(t){!function(t,i){z(t,i=e.getEvent(i),[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:g(i),currentTime:e.now()}],x(i.button))&&(e.stopEvent(i),d(t,"mouse")),(t.clickHandler||t.dblClickHandler||t.pressHandler||t.dragHandler||t.dragEndHandler)&&e.cancelEvent(i)}(r,t)},mouseup:function(e){!function(e,t){R(e,t)}(r,e)},mouseupcaptured:function(t){!function(t,i){R(t,i),e.stopEvent(i)}(r,t)},mousemove:function(e){!function(e,t){C(e,t)}(r,e)},mousemovecaptured:function(t){!function(t,i){C(t,i),e.stopEvent(i)}(r,t)},touchstart:function(t){!function(t,i){var r,n,s,o,l=i.changedTouches.length,c=[],u=t.getActivePointersListByType("touch");for(r=e.now(),u.getLength()>i.touches.length-l&&(e.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),A(t,i,u)),n=0;n<l;n++)c.push({id:i.changedTouches[n].identifier,type:"touch",currentPos:g(i.changedTouches[n]),currentTime:r});for($(t,i,c),n=0;n<a.length;n++)if(a[n]!==t&&a[n].isTracking()&&b(a[n].element,t.element)){for(o=[],s=0;s<l;s++)o.push({id:i.changedTouches[s].identifier,type:"touch",currentPos:g(i.changedTouches[s]),currentTime:r});$(a[n],i,o)}z(t,i,c,0)&&(e.stopEvent(i),d(t,"touch",l)),e.cancelEvent(i)}(r,t)},touchend:function(e){!function(e,t){k(e,t)}(r,e)},touchendcaptured:function(t){!function(t,i){k(t,i),e.stopEvent(i)}(r,t)},touchmove:function(e){!function(e,t){L(e,t)}(r,e)},touchmovecaptured:function(t){!function(t,i){L(t,i),e.stopEvent(i)}(r,t)},touchcancel:function(e){!function(e,t){var i=e.getActivePointersListByType("touch");A(e,t,i)}(r,e)},gesturestart:function(e){!function(e,t){t.stopPropagation(),t.preventDefault()}(0,e)},gesturechange:function(e){!function(e,t){t.stopPropagation(),t.preventDefault()}(0,e)},pointerover:function(e){I(r,e)},MSPointerOver:function(e){I(r,e)},pointerout:function(e){P(r,e)},MSPointerOut:function(e){P(r,e)},pointerdown:function(e){_(r,e)},MSPointerDown:function(e){_(r,e)},pointerup:function(e){D(r,e)},MSPointerUp:function(e){D(r,e)},pointermove:function(e){M(r,e)},MSPointerMove:function(e){M(r,e)},pointercancel:function(e){N(r,e)},MSPointerCancel:function(e){N(r,e)},pointerupcaptured:function(t){!function(t,i){t.getActivePointersListByType(p(i)).getById(i.pointerId)&&O(t,i),e.stopEvent(i)}(r,t)},pointermovecaptured:function(t){!function(t,i){t.getActivePointersListByType(p(i)).getById(i.pointerId)&&F(t,i),e.stopEvent(i)}(r,t)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},t.startDisabled||this.setTracking(!0)},e.MouseTracker.prototype={destroy:function(){var e;for(u(this),this.element=null,e=0;e<a.length;e++)if(a[e]===this){a.splice(e,1);break}l[this.hash]=null,delete l[this.hash]},isTracking:function(){return l[this.hash].tracking},setTracking:function(t){return t?function(t){var i,r,n=l[t.hash];if(!n.tracking){for(r=0;r<e.MouseTracker.subscribeEvents.length;r++)i=e.MouseTracker.subscribeEvents[r],e.addEvent(t.element,i,n[i],!1);c(t),n.tracking=!0}}(this):u(this),this},getActivePointersListsExceptType:function(e){for(var t=l[this.hash],i=[],r=0;r<t.activePointersLists.length;++r)t.activePointersLists[r].type!==e&&i.push(t.activePointersLists[r]);return i},getActivePointersListByType:function(t){var i,r,n=l[this.hash],s=n.activePointersLists.length;for(i=0;i<s;i++)if(n.activePointersLists[i].type===t)return n.activePointersLists[i];return r=new e.MouseTracker.GesturePointList(t),n.activePointersLists.push(r),r},getActivePointerCount:function(){var e,t=l[this.hash],i=t.activePointersLists.length,r=0;for(e=0;e<i;e++)r+=t.activePointersLists[e].getLength();return r},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},e.MouseTracker.resetAllMouseTrackers=function(){for(var e=0;e<a.length;e++)a[e].isTracking()&&(a[e].setTracking(!1),a[e].setTracking(!0))},e.MouseTracker.gesturePointVelocityTracker=(t=[],i=0,r=0,n=function(e,t){return e.hash.toString()+t.type+t.id.toString()},s=function(){var i,n,s,o,a,l,c=t.length,u=e.now();for(o=u-r,r=u,i=0;i<c;i++)(s=(n=t[i]).gPoint).direction=Math.atan2(s.currentPos.y-n.lastPos.y,s.currentPos.x-n.lastPos.x),a=n.lastPos.distanceTo(s.currentPos),n.lastPos=s.currentPos,l=1e3*a/(o+1),s.speed=.75*l+.25*s.speed},{addPoint:function(o,a){var l=n(o,a);t.push({guid:l,gPoint:a,lastPos:a.currentPos}),1===t.length&&(r=e.now(),i=window.setInterval(s,50))},removePoint:function(e,r){var s,o=n(e,r),a=t.length;for(s=0;s<a;s++)if(t[s].guid===o){t.splice(s,1),0==--a&&window.clearInterval(i);break}}}),e.MouseTracker.captureElement=document,e.MouseTracker.wheelEventName=e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",e.MouseTracker.supportsMouseCapture=(o=document.createElement("div"),e.isFunction(o.setCapture)&&e.isFunction(o.releaseCapture)),e.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",e.MouseTracker.wheelEventName],"DOMMouseScroll"==e.MouseTracker.wheelEventName&&e.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||e.Browser.vendor!==e.BROWSERS.IE)?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),e.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?e.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:e.MouseTracker.maxTouchPoints=0,e.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),e.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?e.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:e.MouseTracker.maxTouchPoints=0,e.MouseTracker.haveMouseEnter=!1):(e.MouseTracker.havePointerEvents=!1,e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?(e.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),e.MouseTracker.haveMouseEnter=!0):(e.MouseTracker.subscribeEvents.push("mouseover","mouseout"),e.MouseTracker.haveMouseEnter=!1),e.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&e.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&e.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),e.MouseTracker.mousePointerId="legacy-mouse",e.MouseTracker.maxTouchPoints=10),e.MouseTracker.GesturePointList=function(e){this._gPoints=[],this.type=e,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},e.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(e){return this._gPoints.push(e)},removeById:function(e){var t,i=this._gPoints.length;for(t=0;t<i;t++)if(this._gPoints[t].id===e){this._gPoints.splice(t,1);break}return this._gPoints.length},getByIndex:function(e){return e<this._gPoints.length?this._gPoints[e]:null},getById:function(e){var t,i=this._gPoints.length;for(t=0;t<i;t++)if(this._gPoints[t].id===e)return this._gPoints[t];return null},getPrimary:function(e){var t,i=this._gPoints.length;for(t=0;t<i;t++)if(this._gPoints[t].isPrimary)return this._gPoints[t];return null},addContact:function(){++this.contacts,this.contacts>1&&("mouse"===this.type||"pen"===this.type)&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};var V=function(){try{return window.self!==window.top}catch(e){return!0}}();function q(e){try{return e.addEventListener&&e.removeEventListener}catch(e){return!1}}}(OpenSeadragon),function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},e.Control=function(t,i,r){var n=t.parentNode;"number"==typeof i&&(e.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),i={anchor:i}),i.attachToViewer=void 0===i.attachToViewer||i.attachToViewer,this.autoFade=void 0===i.autoFade||i.autoFade,this.element=t,this.anchor=i.anchor,this.container=r,this.anchor==e.ControlAnchor.ABSOLUTE?(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof i.top?i.top+"px":i.top,this.wrapper.style.left="number"==typeof i.left?i.left+"px":i.left,this.wrapper.style.height="number"==typeof i.height?i.height+"px":i.height,this.wrapper.style.width="number"==typeof i.width?i.width+"px":i.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),i.attachToViewer?this.anchor==e.ControlAnchor.TOP_RIGHT||this.anchor==e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):n.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(t){this.wrapper.style.display=t?this.anchor==e.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(t){this.element[e.SIGNAL]&&e.Browser.vendor==e.BROWSERS.IE?e.setElementOpacity(this.element,t,!0):e.setElementOpacity(this.wrapper,t,!0)}}}(OpenSeadragon),function(e){function t(e,t){var i,r=e.controls;for(i=r.length-1;i>=0;i--)if(r[i].element==t)return i;return-1}e.ControlDock=function(t){var i,r,n=["topleft","topright","bottomright","bottomleft"];for(e.extend(!0,this,{id:"controldock-"+e.now()+"-"+Math.floor(1e6*Math.random()),container:e.makeNeutralElement("div"),controls:[]},t),this.container.onsubmit=function(){return!1},this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),r=0;r<n.length;r++)i=n[r],this.controls[i]=e.makeNeutralElement("div"),this.controls[i].style.position="absolute",i.match("left")&&(this.controls[i].style.left="0px"),i.match("right")&&(this.controls[i].style.right="0px"),i.match("top")&&(this.controls[i].style.top="0px"),i.match("bottom")&&(this.controls[i].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(i,r){var n=null;if(!(t(this,i=e.getElement(i))>=0)){switch(r.anchor){case e.ControlAnchor.TOP_RIGHT:n=this.controls.topright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingTop="0px";break;case e.ControlAnchor.BOTTOM_RIGHT:n=this.controls.bottomright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.BOTTOM_LEFT:n=this.controls.bottomleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.TOP_LEFT:n=this.controls.topleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingTop="0px";break;case e.ControlAnchor.ABSOLUTE:default:case e.ControlAnchor.NONE:n=this.container,i.style.margin="0px",i.style.padding="0px"}this.controls.push(new e.Control(i,r,n)),i.style.display="inline-block"}},removeControl:function(i){var r=t(this,i=e.getElement(i));return r>=0&&(this.controls[r].destroy(),this.controls.splice(r,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var e;for(e=this.controls.length-1;e>=0;e--)if(this.controls[e].isVisible())return!0;return!1},setControlsEnabled:function(e){var t;for(t=this.controls.length-1;t>=0;t--)this.controls[t].setVisible(e);return this}}}(OpenSeadragon),function(e){e.Placement=e.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(e){var t={},i=1;function r(t){return t=e.getElement(t),new e.Point(0===t.clientWidth?1:t.clientWidth,0===t.clientHeight?1:t.clientHeight)}function n(t,i){if(i instanceof e.Overlay)return i;var r=null;if(i.element)r=e.getElement(i.element);else{var n=i.id?i.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random());(r=e.getElement(i.id))||((r=document.createElement("a")).href="#/overlay/"+n),r.id=n,e.addClass(r,i.className?i.className:"openseadragon-overlay")}var s=i.location,o=i.width,a=i.height;if(!s){var l=i.x,c=i.y;if(void 0!==i.px){var u=t.viewport.imageToViewportRectangle(new e.Rect(i.px,i.py,o||0,a||0));l=u.x,c=u.y,o=void 0!==o?u.width:void 0,a=void 0!==a?u.height:void 0}s=new e.Point(l,c)}var h=i.placement;return h&&"string"===e.type(h)&&(h=e.Placement[i.placement.toUpperCase()]),new e.Overlay({element:r,location:s,placement:h,onDraw:i.onDraw,checkResize:i.checkResize,width:o,height:a,rotationMode:i.rotationMode})}function s(e,t){var i;for(i=e.length-1;i>=0;i--)if(e[i].element===t)return i;return-1}function o(t,i){return e.requestAnimationFrame((function(){i(t)}))}function a(t){e.requestAnimationFrame((function(){!function(t){var i,r;if(t.controlsShouldFade){for(i=1-(e.now()-t.controlsFadeBeginTime)/t.controlsFadeLength,i=Math.min(1,i),i=Math.max(0,i),r=t.controls.length-1;r>=0;r--)t.controls[r].autoFade&&t.controls[r].setOpacity(i);i>0&&a(t)}}(t)}))}function l(t){t.autoHideControls&&(t.controlsShouldFade=!0,t.controlsFadeBeginTime=e.now()+t.controlsFadeDelay,window.setTimeout((function(){a(t)}),t.controlsFadeDelay))}function c(e){var t;for(e.controlsShouldFade=!1,t=e.controls.length-1;t>=0;t--)e.controls[t].setOpacity(1)}function u(){c(this)}function h(){l(this)}function d(t){var i={originalEvent:t.originalEvent,preventDefaultAction:t.preventDefaultAction,preventVerticalPan:t.preventVerticalPan,preventHorizontalPan:t.preventHorizontalPan};if(this.raiseEvent("canvas-key",i),i.preventDefaultAction||t.ctrl||t.alt||t.meta)return!0;switch(t.keyCode){case 38:return i.preventVerticalPan||(t.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return i.preventVerticalPan||(t.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return i.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return i.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}}function f(t){var i={originalEvent:t.originalEvent,preventDefaultAction:t.preventDefaultAction,preventVerticalPan:t.preventVerticalPan,preventHorizontalPan:t.preventHorizontalPan};if(this.raiseEvent("canvas-key",i),i.preventDefaultAction||t.ctrl||t.alt||t.meta)return!0;switch(t.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return i.preventVerticalPan||(t.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return i.preventVerticalPan||(t.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return i.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return i.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.flipped?this.viewport.setRotation(e.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(e.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 82:return this.viewport.flipped?this.viewport.setRotation(e.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(e.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}}function p(e){var t;document.activeElement==this.canvas||this.canvas.focus(),this.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x);var i={tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.raiseEvent("canvas-click",i),!i.preventDefaultAction&&this.viewport&&e.quick&&(t=this.gestureSettingsByDeviceType(e.pointerType)).clickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints())}function g(e){var t,i={tracker:e.eventSource,position:e.position,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.raiseEvent("canvas-double-click",i),!i.preventDefaultAction&&this.viewport&&(t=this.gestureSettingsByDeviceType(e.pointerType)).dblClickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints())}function m(e){var t,i={tracker:e.eventSource,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};if(this.raiseEvent("canvas-drag",i),!i.preventDefaultAction&&this.viewport){if(t=this.gestureSettingsByDeviceType(e.pointerType),this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewport.flipped&&(e.delta.x=-e.delta.x),this.constrainDuringPan){var r=this.viewport.deltaPointsFromPixels(e.delta.negate());this.viewport.centerSpringX.target.value+=r.x,this.viewport.centerSpringY.target.value+=r.y;var n=this.viewport.getBounds(),s=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=r.x,this.viewport.centerSpringY.target.value-=r.y,n.x!=s.x&&(e.delta.x=0),n.y!=s.y&&(e.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta.negate()),t.flickEnabled&&!this.constrainDuringPan)}}function v(t){if(!t.preventDefaultAction&&this.viewport){var i=this.gestureSettingsByDeviceType(t.pointerType);if(i.flickEnabled&&t.speed>=i.flickMinSpeed){var r=0;this.panHorizontal&&(r=i.flickMomentum*t.speed*Math.cos(t.direction));var n=0;this.panVertical&&(n=i.flickMomentum*t.speed*Math.sin(t.direction));var s=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),o=this.viewport.pointFromPixel(new e.Point(s.x-r,s.y-n));this.viewport.panTo(o,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:t.eventSource,position:t.position,speed:t.speed,direction:t.direction,shift:t.shift,originalEvent:t.originalEvent})}function y(e){this.raiseEvent("canvas-enter",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function w(t){window.location!=window.parent.location&&e.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:t.eventSource,pointerType:t.pointerType,position:t.position,buttons:t.buttons,pointers:t.pointers,insideElementPressed:t.insideElementPressed,buttonDownAny:t.buttonDownAny,originalEvent:t.originalEvent})}function E(e){this.raiseEvent("canvas-press",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function b(e){this.raiseEvent("canvas-release",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function T(e){this.raiseEvent("canvas-nonprimary-press",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function S(e){this.raiseEvent("canvas-nonprimary-release",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function x(e){var t,i,r;if(!e.preventDefaultAction&&this.viewport&&((t=this.gestureSettingsByDeviceType(e.pointerType)).pinchToZoom&&(i=this.viewport.pointFromPixel(e.center,!0),r=this.viewport.pointFromPixel(e.lastCenter,!0).minus(i),this.panHorizontal||(r.x=0),this.panVertical||(r.y=0),this.viewport.zoomBy(e.distance/e.lastDistance,i,!0),t.zoomToRefPoint&&this.viewport.panBy(r,!0),this.viewport.applyConstraints()),t.pinchRotate)){var n=Math.atan2(e.gesturePoints[0].currentPos.y-e.gesturePoints[1].currentPos.y,e.gesturePoints[0].currentPos.x-e.gesturePoints[1].currentPos.x),s=Math.atan2(e.gesturePoints[0].lastPos.y-e.gesturePoints[1].lastPos.y,e.gesturePoints[0].lastPos.x-e.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(n-s)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:e.eventSource,gesturePoints:e.gesturePoints,lastCenter:e.lastCenter,center:e.center,lastDistance:e.lastDistance,distance:e.distance,shift:e.shift,originalEvent:e.originalEvent}),!1}function R(t){var i,r,n;if((n=e.now())-this._lastScrollTime>this.minScrollDeltaTime){if(this._lastScrollTime=n,this.viewport.flipped&&(t.position.x=this.viewport.getContainerSize().x-t.position.x),!t.preventDefaultAction&&this.viewport&&(i=this.gestureSettingsByDeviceType(t.pointerType)).scrollToZoom&&(r=Math.pow(this.zoomPerScroll,t.scroll),this.viewport.zoomBy(r,i.zoomToRefPoint?this.viewport.pointFromPixel(t.position,!0):null),this.viewport.applyConstraints()),this.raiseEvent("canvas-scroll",{tracker:t.eventSource,position:t.position,scroll:t.scroll,shift:t.shift,originalEvent:t.originalEvent}),i&&i.scrollToZoom)return!1}else if((i=this.gestureSettingsByDeviceType(t.pointerType))&&i.scrollToZoom)return!1}function C(e){t[this.hash].mouseInside=!0,c(this),this.raiseEvent("container-enter",{tracker:e.eventSource,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function A(e){e.pointers<1&&(t[this.hash].mouseInside=!1,t[this.hash].animating||l(this)),this.raiseEvent("container-exit",{tracker:e.eventSource,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function k(e){!function(e){if(!e._opening){if(e.autoResize){var i=r(e.container),n=t[e.hash].prevContainerSize;if(!i.equals(n)){var s=e.viewport;if(e.preserveImageSizeOnResize){var o=n.x/i.x,a=s.getZoom()*o,u=s.getCenter();s.resize(i,!1),s.zoomTo(a,null,!0),s.panTo(u,!0)}else{var h=s.getBounds();s.resize(i,!0),s.fitBoundsWithConstraints(h,!0)}t[e.hash].prevContainerSize=i,t[e.hash].forceRedraw=!0}}var d=e.viewport.update(),f=e.world.update()||d;d&&e.raiseEvent("viewport-change"),e.referenceStrip&&(f=e.referenceStrip.update(e.viewport)||f),!t[e.hash].animating&&f&&(e.raiseEvent("animation-start"),c(e)),(f||t[e.hash].forceRedraw||e.world.needsDraw())&&(function(e){e.imageLoader.clear(),e.drawer.clear(),e.world.draw(),e.raiseEvent("update-viewport",{})}(e),e._drawOverlays(),e.navigator&&e.navigator.update(e.viewport),t[e.hash].forceRedraw=!1,f&&e.raiseEvent("animation")),t[e.hash].animating&&!f&&(e.raiseEvent("animation-finish"),t[e.hash].mouseInside||l(e)),t[e.hash].animating=f}}(e),e.isOpen()?e._updateRequestId=o(e,k):e._updateRequestId=!1}function L(e,t){return e?e+t:t}function I(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=this.zoomPerSecond,t[this.hash].zooming=!0,D(this)}function P(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=1/this.zoomPerSecond,t[this.hash].zooming=!0,D(this)}function _(){t[this.hash].zooming=!1}function D(t){e.requestAnimationFrame(e.delegate(t,O))}function O(){var i,r,n;t[this.hash].zooming&&this.viewport&&(r=(i=e.now())-t[this.hash].lastZoomTime,n=Math.pow(t[this.hash].zoomFactor,r/1e3),this.viewport.zoomBy(n),this.viewport.applyConstraints(),t[this.hash].lastZoomTime=i,D(this))}function M(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function F(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function N(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function B(){this.viewport&&this.viewport.goHome()}function U(){this.isFullPage()&&!e.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function $(){if(this.viewport){var t=this.viewport.getRotation();t=this.viewport.flipped?e.positiveModulo(t+this.rotationIncrement,360):e.positiveModulo(t-this.rotationIncrement,360),this.viewport.setRotation(t)}}function H(){if(this.viewport){var t=this.viewport.getRotation();t=this.viewport.flipped?e.positiveModulo(t-this.rotationIncrement,360):e.positiveModulo(t+this.rotationIncrement,360),this.viewport.setRotation(t)}}function z(){this.viewport.toggleFlip()}function j(){var e=this._sequenceIndex-1;this.navPrevNextWrap&&e<0&&(e+=this.tileSources.length),this.goToPage(e)}function G(){var e=this._sequenceIndex+1;this.navPrevNextWrap&&e>=this.tileSources.length&&(e=0),this.goToPage(e)}e.Viewer=function(n){var s,a,c=arguments,u=this;if(e.isPlainObject(n)||(n={id:c[0],xmlPath:c.length>1?c[1]:void 0,prefixUrl:c.length>2?c[2]:void 0,controls:c.length>3?c[3]:void 0,overlays:c.length>4?c[4]:void 0}),n.config&&(e.extend(!0,n,n.config),delete n.config),e.extend(!0,this,{id:n.id,hash:n.hash||i++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},e.DEFAULT_SETTINGS,n),void 0===this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(void 0!==t[this.hash]&&e.console.warn("Hash "+this.hash+" has already been used."),t[this.hash]={fsBoundsDelta:new e.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=e.now(),e.EventSource.call(this),this.addHandler("open-failed",(function(t){var i=e.getString("Errors.OpenFailed",t.eventSource,t.message);u._showMessage(i)})),e.ControlDock.call(this,n),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=e.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",(a=this.canvas.style).width="100%",a.height="100%",a.overflow="hidden",a.position="absolute",a.top="0px",a.left="0px",e.setElementTouchActionNone(this.canvas),""!==n.tabIndex&&(this.canvas.tabIndex=void 0===n.tabIndex?0:n.tabIndex),this.container.className="openseadragon-container",function(e){e.width="100%",e.height="100%",e.position="relative",e.overflow="hidden",e.left="0px",e.top="0px",e.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new e.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:e.delegate(this,d),keyHandler:e.delegate(this,f),clickHandler:e.delegate(this,p),dblClickHandler:e.delegate(this,g),dragHandler:e.delegate(this,m),dragEndHandler:e.delegate(this,v),enterHandler:e.delegate(this,y),exitHandler:e.delegate(this,w),pressHandler:e.delegate(this,E),releaseHandler:e.delegate(this,b),nonPrimaryPressHandler:e.delegate(this,T),nonPrimaryReleaseHandler:e.delegate(this,S),scrollHandler:e.delegate(this,R),pinchHandler:e.delegate(this,x)}),this.outerTracker=new e.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:e.delegate(this,C),exitHandler:e.delegate(this,A)}),this.toolbar&&(this.toolbar=new e.ControlDock({element:this.toolbar})),this.bindStandardControls(),t[this.hash].prevContainerSize=r(this.container),this.world=new e.World({viewer:this}),this.world.addHandler("add-item",(function(e){u.source=u.world.getItemAt(0).source,t[u.hash].forceRedraw=!0,u._updateRequestId||(u._updateRequestId=o(u,k))})),this.world.addHandler("remove-item",(function(e){u.world.getItemCount()?u.source=u.world.getItemAt(0).source:u.source=null,t[u.hash].forceRedraw=!0})),this.world.addHandler("metrics-change",(function(e){u.viewport&&u.viewport._setContentBounds(u.world.getHomeBounds(),u.world.getContentFactor())})),this.world.addHandler("item-index-change",(function(e){u.source=u.world.getItemAt(0).source})),this.viewport=new e.Viewport({containerSize:t[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new e.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:n.timeout}),this.tileCache=new e.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new e.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=e.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(s=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(s,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(s=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(s,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new e.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),s=0;s<this.customControls.length;s++)this.addControl(this.customControls[s].id,{anchor:this.customControls[s].anchor});e.requestAnimationFrame((function(){l(u)})),void 0===this.imageSmoothingEnabled||this.imageSmoothingEnabled||this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled)},e.extend(e.Viewer.prototype,e.EventSource.prototype,e.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(t){return e.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(t)},openTileSource:function(t){return e.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(t)},open:function(t,i){var r=this;if(this.close(),t){if(this.sequenceMode&&e.isArray(t))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===i||isNaN(i)||(this.initialPage=i),this.tileSources=t,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),void this._updateSequenceButtons(this._sequenceIndex);if(e.isArray(t)||(t=[t]),t.length){this._opening=!0;for(var s,o=t.length,a=0,l=0,c=function(){if(a+l===o)if(a){!r._firstOpen&&r.preserveViewport||(r.viewport.goHome(!0),r.viewport.update()),r._firstOpen=!1;var e=t[0];if(e.tileSource&&(e=e.tileSource),r.overlays&&!r.preserveOverlays)for(var i=0;i<r.overlays.length;i++)r.currentOverlays[i]=n(r,r.overlays[i]);r._drawOverlays(),r._opening=!1,r.raiseEvent("open",{source:e})}else r._opening=!1,r.raiseEvent("open-failed",s)},u=function(t){e.isPlainObject(t)&&t.tileSource||(t={tileSource:t}),void 0!==t.index&&(e.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete t.index),void 0===t.collectionImmediately&&(t.collectionImmediately=!0);var i=t.success;t.success=function(e){if(a++,t.tileSource.overlays)for(var n=0;n<t.tileSource.overlays.length;n++)r.addOverlay(t.tileSource.overlays[n]);i&&i(e),c()};var n=t.error;t.error=function(e){l++,s||(s=e),n&&n(e),c()},r.addTiledImage(t)},h=0;h<t.length;h++)u(t[h]);return this}}},close:function(){return t[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),t[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(t[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(e.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),t[this.hash]=null,delete t[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(e){return this.innerTracker.setTracking(e),this.outerTracker.setTracking(e),this.raiseEvent("mouse-enabled",{enabled:e}),this},areControlsEnabled:function(){var e,t=this.controls.length;for(e=0;e<this.controls.length;e++)t=t&&this.controls[e].isVisible();return t},setControlsEnabled:function(e){return e?c(this):l(this),this.raiseEvent("controls-enabled",{enabled:e}),this},setDebugMode:function(e){for(var t=0;t<this.world.getItemCount();t++)this.world.getItemAt(t).debugMode=e;this.debugMode=e,this.forceRedraw()},isFullPage:function(){return t[this.hash].fullPage},setFullPage:function(i){var r,n,s=document.body,o=s.style,a=document.documentElement.style,l=this;if(i==this.isFullPage())return this;var c={fullPage:i,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",c),c.preventDefaultAction)return this;if(i){for(this.elementSize=e.getElementSize(this.element),this.pageScroll=e.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=o.margin,this.docMargin=a.margin,o.margin="0",a.margin="0",this.bodyPadding=o.padding,this.docPadding=a.padding,o.padding="0",a.padding="0",this.bodyWidth=o.width,this.docWidth=a.width,o.width="100%",a.width="100%",this.bodyHeight=o.height,this.docHeight=a.height,o.height="100%",a.height="100%",this.previousBody=[],t[this.hash].prevElementParent=this.element.parentNode,t[this.hash].prevNextSibling=this.element.nextSibling,t[this.hash].prevElementWidth=this.element.style.width,t[this.hash].prevElementHeight=this.element.style.height,r=s.childNodes.length,n=0;n<r;n++)this.previousBody.push(s.childNodes[0]),s.removeChild(s.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,s.appendChild(this.toolbar.element),e.addClass(this.toolbar.element,"fullpage")),e.addClass(this.element,"fullpage"),s.appendChild(this.element),this.element.style.height=e.getWindowSize().y+"px",this.element.style.width=e.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=e.getElementSize(this.element).y-e.getElementSize(this.toolbar.element).y+"px"),t[this.hash].fullPage=!0,e.delegate(this,C)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,o.margin=this.bodyMargin,a.margin=this.docMargin,o.padding=this.bodyPadding,a.padding=this.docPadding,o.width=this.bodyWidth,a.width=this.docWidth,o.height=this.bodyHeight,a.height=this.docHeight,s.removeChild(this.element),r=this.previousBody.length,n=0;n<r;n++)s.appendChild(this.previousBody.shift());e.removeClass(this.element,"fullpage"),t[this.hash].prevElementParent.insertBefore(this.element,t[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(s.removeChild(this.toolbar.element),e.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=t[this.hash].prevElementWidth,this.element.style.height=t[this.hash].prevElementHeight;var u=0,h=function(){e.setPageScroll(l.pageScroll);var t=e.getPageScroll();++u<10&&(t.x!==l.pageScroll.x||t.y!==l.pageScroll.y)&&e.requestAnimationFrame(h)};e.requestAnimationFrame(h),t[this.hash].fullPage=!1,e.delegate(this,A)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:i}),this},setFullScreen:function(t){var i=this;if(!e.supportsFullScreen)return this.setFullPage(t);if(e.isFullScreen()===t)return this;var r={fullScreen:t,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",r),r.preventDefaultAction)return this;if(t){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var n=function(){var t=e.isFullScreen();t||(e.removeEvent(document,e.fullScreenEventName,n),e.removeEvent(document,e.fullScreenErrorEventName,n),i.setFullPage(!1),i.isFullPage()&&(i.element.style.width=i.fullPageStyleWidth,i.element.style.height=i.fullPageStyleHeight)),i.navigator&&i.viewport&&setTimeout((function(){i.navigator.update(i.viewport)})),i.raiseEvent("full-screen",{fullScreen:t})};e.addEvent(document,e.fullScreenEventName,n),e.addEvent(document,e.fullScreenErrorEventName,n),e.requestFullScreen(document.body)}else e.exitFullScreen();return this},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(e){return this.container.style.visibility=e?"":"hidden",this.raiseEvent("visible",{visible:e}),this},addTiledImage:function(t){e.console.assert(t,"[Viewer.addTiledImage] options is required"),e.console.assert(t.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),e.console.assert(!t.replace||t.index>-1&&t.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var i=this;t.replace&&(t.replaceItem=i.world.getItemAt(t.index)),this._hideMessage(),void 0===t.placeholderFillStyle&&(t.placeholderFillStyle=this.placeholderFillStyle),void 0===t.opacity&&(t.opacity=this.opacity),void 0===t.preload&&(t.preload=this.preload),void 0===t.compositeOperation&&(t.compositeOperation=this.compositeOperation),void 0===t.crossOriginPolicy&&(t.crossOriginPolicy=void 0!==t.tileSource.crossOriginPolicy?t.tileSource.crossOriginPolicy:this.crossOriginPolicy),void 0===t.ajaxWithCredentials&&(t.ajaxWithCredentials=this.ajaxWithCredentials),void 0===t.loadTilesWithAjax&&(t.loadTilesWithAjax=this.loadTilesWithAjax),void 0===t.ajaxHeaders||null===t.ajaxHeaders?t.ajaxHeaders=this.ajaxHeaders:e.isPlainObject(t.ajaxHeaders)&&e.isPlainObject(this.ajaxHeaders)&&(t.ajaxHeaders=e.extend({},this.ajaxHeaders,t.ajaxHeaders));var r={options:t};function n(e){for(var n=0;n<i._loadQueue.length;n++)if(i._loadQueue[n]===r){i._loadQueue.splice(n,1);break}0===i._loadQueue.length&&s(r),i.raiseEvent("add-item-failed",e),t.error&&t.error(e)}function s(e){i.collectionMode&&(i.world.arrange({immediately:e.options.collectionImmediately,rows:i.collectionRows,columns:i.collectionColumns,layout:i.collectionLayout,tileSize:i.collectionTileSize,tileMargin:i.collectionTileMargin}),i.world.setAutoRefigureSizes(!0))}function o(){for(var t,r,n;i._loadQueue.length&&(t=i._loadQueue[0]).tileSource;){if(i._loadQueue.splice(0,1),t.options.replace){var o=i.world.getIndexOfItem(t.options.replaceItem);-1!=o&&(t.options.index=o),i.world.removeItem(t.options.replaceItem)}r=new e.TiledImage({viewer:i,source:t.tileSource,viewport:i.viewport,drawer:i.drawer,tileCache:i.tileCache,imageLoader:i.imageLoader,x:t.options.x,y:t.options.y,width:t.options.width,height:t.options.height,fitBounds:t.options.fitBounds,fitBoundsPlacement:t.options.fitBoundsPlacement,clip:t.options.clip,placeholderFillStyle:t.options.placeholderFillStyle,opacity:t.options.opacity,preload:t.options.preload,degrees:t.options.degrees,compositeOperation:t.options.compositeOperation,springStiffness:i.springStiffness,animationTime:i.animationTime,minZoomImageRatio:i.minZoomImageRatio,wrapHorizontal:i.wrapHorizontal,wrapVertical:i.wrapVertical,immediateRender:i.immediateRender,blendTime:i.blendTime,alwaysBlend:i.alwaysBlend,minPixelRatio:i.minPixelRatio,smoothTileEdgesMinZoom:i.smoothTileEdgesMinZoom,iOSDevice:i.iOSDevice,crossOriginPolicy:t.options.crossOriginPolicy,ajaxWithCredentials:t.options.ajaxWithCredentials,loadTilesWithAjax:t.options.loadTilesWithAjax,ajaxHeaders:t.options.ajaxHeaders,debugMode:i.debugMode}),i.collectionMode&&i.world.setAutoRefigureSizes(!1),i.world.addItem(r,{index:t.options.index}),0===i._loadQueue.length&&s(t),1!==i.world.getItemCount()||i.preserveViewport||i.viewport.goHome(!0),i.navigator&&(n=e.extend({},t.options,{replace:!1,originalTiledImage:r,tileSource:t.tileSource}),i.navigator.addTiledImage(n)),t.options.success&&t.options.success({item:r})}}e.isArray(t.tileSource)?setTimeout((function(){n({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:t.tileSource,options:t})})):(this._loadQueue.push(r),function(t,i,r,n,s){var o=t;if("string"==e.type(i))if(i.match(/^\s*<.*>\s*$/))i=e.parseXml(i);else if(i.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var a=e.parseJSON(i);i=a}catch(e){}function l(e,t){e.ready?n(e):(e.addHandler("ready",(function(){n(e)})),e.addHandler("open-failed",(function(e){s({message:e.message,source:t})})))}setTimeout((function(){if("string"==e.type(i))(i=new e.TileSource({url:i,crossOriginPolicy:void 0!==r.crossOriginPolicy?r.crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,ajaxHeaders:t.ajaxHeaders,useCanvas:t.useCanvas,success:function(e){n(e.tileSource)}})).addHandler("open-failed",(function(e){s(e)}));else if(e.isPlainObject(i)||i.nodeType)if(void 0!==i.crossOriginPolicy||void 0===r.crossOriginPolicy&&void 0===t.crossOriginPolicy||(i.crossOriginPolicy=void 0!==r.crossOriginPolicy?r.crossOriginPolicy:t.crossOriginPolicy),void 0===i.ajaxWithCredentials&&(i.ajaxWithCredentials=t.ajaxWithCredentials),void 0===i.useCanvas&&(i.useCanvas=t.useCanvas),e.isFunction(i.getTileUrl)){var a=new e.TileSource(i);a.getTileUrl=i.getTileUrl,n(a)}else{var c=e.TileSource.determineType(o,i);if(!c)return void s({message:"Unable to load TileSource",source:i});var u=c.prototype.configure.apply(o,[i]);l(new c(u),i)}else l(i,i)}))}(this,t.tileSource,t,(function(e){r.tileSource=e,o()}),(function(e){e.options=t,n(e),o()})))},addSimpleImage:function(t){e.console.assert(t,"[Viewer.addSimpleImage] options is required"),e.console.assert(t.url,"[Viewer.addSimpleImage] options.url is required");var i=e.extend({},t,{tileSource:{type:"image",url:t.url}});delete i.url,this.addTiledImage(i)},addLayer:function(t){var i=this;e.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var r=e.extend({},t,{success:function(e){i.raiseEvent("add-layer",{options:t,drawer:e.item})},error:function(e){i.raiseEvent("add-layer-failed",e)}});return this.addTiledImage(r),this},getLayerAtLevel:function(t){return e.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(t)},getLevelOfLayer:function(t){return e.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(t)},getLayersCount:function(){return e.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(t,i){return e.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(t,i)},removeLayer:function(t){return e.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(t)},forceRedraw:function(){return t[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var t=e.delegate(this,u),i=e.delegate(this,h),r=e.delegate(this,G),n=e.delegate(this,j),s=this.navImages,o=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(o=!1),this.previousButton=new e.Button({element:this.previousButton?e.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.PreviousPage"),srcRest:L(this.prefixUrl,s.previous.REST),srcGroup:L(this.prefixUrl,s.previous.GROUP),srcHover:L(this.prefixUrl,s.previous.HOVER),srcDown:L(this.prefixUrl,s.previous.DOWN),onRelease:n,onFocus:t,onBlur:i}),this.nextButton=new e.Button({element:this.nextButton?e.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.NextPage"),srcRest:L(this.prefixUrl,s.next.REST),srcGroup:L(this.prefixUrl,s.next.GROUP),srcHover:L(this.prefixUrl,s.next.HOVER),srcDown:L(this.prefixUrl,s.next.DOWN),onRelease:r,onFocus:t,onBlur:i}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),o&&(this.paging=new e.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:e.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var t=e.delegate(this,I),i=e.delegate(this,_),r=e.delegate(this,M),n=e.delegate(this,P),s=e.delegate(this,F),o=e.delegate(this,B),a=e.delegate(this,U),l=e.delegate(this,$),c=e.delegate(this,H),d=e.delegate(this,z),f=e.delegate(this,u),p=e.delegate(this,h),g=this.navImages,m=[],v=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(v=!1),this.showZoomControl&&(m.push(this.zoomInButton=new e.Button({element:this.zoomInButton?e.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomIn"),srcRest:L(this.prefixUrl,g.zoomIn.REST),srcGroup:L(this.prefixUrl,g.zoomIn.GROUP),srcHover:L(this.prefixUrl,g.zoomIn.HOVER),srcDown:L(this.prefixUrl,g.zoomIn.DOWN),onPress:t,onRelease:i,onClick:r,onEnter:t,onExit:i,onFocus:f,onBlur:p})),m.push(this.zoomOutButton=new e.Button({element:this.zoomOutButton?e.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomOut"),srcRest:L(this.prefixUrl,g.zoomOut.REST),srcGroup:L(this.prefixUrl,g.zoomOut.GROUP),srcHover:L(this.prefixUrl,g.zoomOut.HOVER),srcDown:L(this.prefixUrl,g.zoomOut.DOWN),onPress:n,onRelease:i,onClick:s,onEnter:n,onExit:i,onFocus:f,onBlur:p}))),this.showHomeControl&&m.push(this.homeButton=new e.Button({element:this.homeButton?e.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Home"),srcRest:L(this.prefixUrl,g.home.REST),srcGroup:L(this.prefixUrl,g.home.GROUP),srcHover:L(this.prefixUrl,g.home.HOVER),srcDown:L(this.prefixUrl,g.home.DOWN),onRelease:o,onFocus:f,onBlur:p})),this.showFullPageControl&&m.push(this.fullPageButton=new e.Button({element:this.fullPageButton?e.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.FullPage"),srcRest:L(this.prefixUrl,g.fullpage.REST),srcGroup:L(this.prefixUrl,g.fullpage.GROUP),srcHover:L(this.prefixUrl,g.fullpage.HOVER),srcDown:L(this.prefixUrl,g.fullpage.DOWN),onRelease:a,onFocus:f,onBlur:p})),this.showRotationControl&&(m.push(this.rotateLeftButton=new e.Button({element:this.rotateLeftButton?e.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateLeft"),srcRest:L(this.prefixUrl,g.rotateleft.REST),srcGroup:L(this.prefixUrl,g.rotateleft.GROUP),srcHover:L(this.prefixUrl,g.rotateleft.HOVER),srcDown:L(this.prefixUrl,g.rotateleft.DOWN),onRelease:l,onFocus:f,onBlur:p})),m.push(this.rotateRightButton=new e.Button({element:this.rotateRightButton?e.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateRight"),srcRest:L(this.prefixUrl,g.rotateright.REST),srcGroup:L(this.prefixUrl,g.rotateright.GROUP),srcHover:L(this.prefixUrl,g.rotateright.HOVER),srcDown:L(this.prefixUrl,g.rotateright.DOWN),onRelease:c,onFocus:f,onBlur:p}))),this.showFlipControl&&m.push(this.flipButton=new e.Button({element:this.flipButton?e.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Flip"),srcRest:L(this.prefixUrl,g.flip.REST),srcGroup:L(this.prefixUrl,g.flip.GROUP),srcHover:L(this.prefixUrl,g.flip.HOVER),srcDown:L(this.prefixUrl,g.flip.DOWN),onRelease:d,onFocus:f,onBlur:p})),v&&(this.buttons=new e.ButtonGroup({buttons:m,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",e.delegate(this,N)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(e){return this.tileSources&&e>=0&&e<this.tileSources.length&&(this._sequenceIndex=e,this._updateSequenceButtons(e),this.open(this.tileSources[e]),this.referenceStrip&&this.referenceStrip.setFocus(e),this.raiseEvent("page",{page:e})),this},addOverlay:function(t,i,r,o){var a;if(a=e.isPlainObject(t)?t:{element:t,location:i,placement:r,onDraw:o},t=e.getElement(a.element),s(this.currentOverlays,t)>=0)return this;var l=n(this,a);return this.currentOverlays.push(l),l.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:t,location:a.location,placement:a.placement}),this},updateOverlay:function(i,r,n){var o;return i=e.getElement(i),(o=s(this.currentOverlays,i))>=0&&(this.currentOverlays[o].update(r,n),t[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:i,location:r,placement:n})),this},removeOverlay:function(i){var r;return i=e.getElement(i),(r=s(this.currentOverlays,i))>=0&&(this.currentOverlays[r].destroy(),this.currentOverlays.splice(r,1),t[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:i})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return t[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(t){var i;return t=e.getElement(t),(i=s(this.currentOverlays,t))>=0?this.currentOverlays[i]:null},_updateSequenceButtons:function(e){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==e?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(e>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(t){this._hideMessage();var i=e.makeNeutralElement("div");i.appendChild(document.createTextNode(t)),this.messageDiv=e.makeCenteredNode(i),e.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var e=this.messageDiv;e&&(e.parentNode.removeChild(e),delete this.messageDiv)},gestureSettingsByDeviceType:function(e){switch(e){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var e,t=this.currentOverlays.length;for(e=0;e<t;e++)this.currentOverlays[e].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new e.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else e.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}})}(OpenSeadragon),function(e){function t(e){var t={tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};if(this.viewer.raiseEvent("navigator-click",t),!t.preventDefaultAction&&e.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x);var i=this.viewport.pointFromPixel(e.position);this.panVertical?this.panHorizontal||(i.x=this.viewer.viewport.getCenter(!0).x):i.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(i),this.viewer.viewport.applyConstraints()}}function i(e){var t={tracker:e.eventSource,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",t),!t.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewer.viewport.flipped&&(e.delta.x=-e.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function r(e){e.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function n(e){return this.viewer.raiseEvent("navigator-scroll",{tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent}),!1}function s(e,t){o(e,"rotate("+t+"deg)")}function o(e,t){e.style.webkitTransform=t,e.style.mozTransform=t,e.style.msTransform=t,e.style.oTransform=t,e.style.transform=t}e.Navigator=function(o){var a,l,c,u,h=o.viewer,d=this;function f(e){s(d.displayRegionContainer,e),s(d.displayRegion,-e),d.viewport.setRotation(e)}o.id?(this.element=document.getElementById(o.id),o.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(o.id="navigator-"+e.now(),this.element=e.makeNeutralElement("div"),o.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:o.autoFade},o.position&&("BOTTOM_RIGHT"==o.position?o.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"==o.position?o.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"==o.position?o.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:"TOP_LEFT"==o.position?o.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:"ABSOLUTE"==o.position&&(o.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,o.controlOptions.top=o.top,o.controlOptions.left=o.left,o.controlOptions.height=o.height,o.controlOptions.width=o.width))),this.element.id=o.id,this.element.className+=" navigator",(o=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},o,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:o.autoResize,minZoomImageRatio:1,background:o.background,opacity:o.opacity,borderColor:o.borderColor,displayRegionColor:o.displayRegionColor})).minPixelRatio=this.minPixelRatio=h.minPixelRatio,e.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),o.controlOptions.anchor!=e.ControlAnchor.NONE&&(c=this.element.style,u=this.borderWidth,c.margin="0px",c.border=u+"px solid "+o.borderColor,c.padding="0px",c.background=o.background,c.opacity=o.opacity,c.overflow="hidden"),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(e,t){e.position="relative",e.top="0px",e.left="0px",e.fontSize="0px",e.overflow="hidden",e.border=t+"px solid "+o.displayRegionColor,e.margin="0px",e.padding="0px",e.background="transparent",e.float="left",e.cssFloat="left",e.styleFloat="left",e.zIndex=999999999,e.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=e.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",h.addControl(this.element,o.controlOptions),this._resizeWithViewer=o.controlOptions.anchor!=e.ControlAnchor.ABSOLUTE&&o.controlOptions.anchor!=e.ControlAnchor.NONE,o.width&&o.height?(this.setWidth(o.width),this.setHeight(o.height)):this._resizeWithViewer&&(a=e.getElementSize(h.element),this.element.style.height=Math.round(a.y*o.sizeRatio)+"px",this.element.style.width=Math.round(a.x*o.sizeRatio)+"px",this.oldViewerSize=a,l=e.getElementSize(this.element),this.elementArea=l.x*l.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[o]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),o.navigatorRotate&&(f(o.viewer.viewport?o.viewer.viewport.getRotation():o.viewer.degrees||0),o.viewer.addHandler("rotate",(function(e){f(e.degrees)}))),this.innerTracker.destroy(),this.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,i),clickHandler:e.delegate(this,t),releaseHandler:e.delegate(this,r),scrollHandler:e.delegate(this,n)}),this.addHandler("reset-size",(function(){d.viewport&&d.viewport.goHome(!0)})),h.world.addHandler("item-index-change",(function(e){window.setTimeout((function(){var t=d.world.getItemAt(e.previousIndex);d.world.setItemIndex(t,e.newIndex)}),1)})),h.world.addHandler("remove-item",(function(e){var t=e.item,i=d._getMatchingItem(t);i&&d.world.removeItem(i)})),this.update(h.viewport)},e.extend(e.Navigator.prototype,e.EventSource.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var t=new e.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);t.equals(this.oldContainerSize)||(this.viewport.resize(t,!0),this.viewport.goHome(!0),this.oldContainerSize=t,this.drawer.clear(),this.world.draw())}},setWidth:function(e){this.width=e,this.element.style.width="number"==typeof e?e+"px":e,this._resizeWithViewer=!1},setHeight:function(e){this.height=e,this.element.style.height="number"==typeof e?e+"px":e,this._resizeWithViewer=!1},setFlip:function(e){return this.viewport.setFlip(e),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(e){o(this.displayRegion,e),o(this.canvas,e),o(this.element,e)},update:function(t){var i,r,n,s,o,a;if(i=e.getElementSize(this.viewer.element),this._resizeWithViewer&&i.x&&i.y&&!i.equals(this.oldViewerSize)&&(this.oldViewerSize=i,this.maintainSizeRatio||!this.elementArea?(r=i.x*this.sizeRatio,n=i.y*this.sizeRatio):(r=Math.sqrt(this.elementArea*(i.x/i.y)),n=this.elementArea/r),this.element.style.width=Math.round(r)+"px",this.element.style.height=Math.round(n)+"px",this.elementArea||(this.elementArea=r*n),this.updateSize()),t&&this.viewport){s=t.getBoundsNoRotate(!0),o=this.viewport.pixelFromPointNoRotate(s.getTopLeft(),!1),a=this.viewport.pixelFromPointNoRotate(s.getBottomRight(),!1).minus(this.totalBorderWidths);var l=this.displayRegion.style;l.display=this.world.getItemCount()?"block":"none",l.top=Math.round(o.y)+"px",l.left=Math.round(o.x)+"px";var c=Math.abs(o.x-a.x),u=Math.abs(o.y-a.y);l.width=Math.round(Math.max(c,0))+"px",l.height=Math.round(Math.max(u,0))+"px"}},addTiledImage:function(t){var i=this,r=t.originalTiledImage;delete t.original;var n=e.extend({},t,{success:function(e){var t=e.item;function n(){i._matchBounds(t,r)}t._originalForNavigator=r,i._matchBounds(t,r,!0),r.addHandler("bounds-change",n),r.addHandler("clip-change",n),r.addHandler("opacity-change",(function(){i._matchOpacity(t,r)})),r.addHandler("composite-operation-change",(function(){i._matchCompositeOperation(t,r)}))}});return e.Viewer.prototype.addTiledImage.apply(this,[n])},_getMatchingItem:function(e){for(var t,i=this.world.getItemCount(),r=0;r<i;r++)if((t=this.world.getItemAt(r))._originalForNavigator===e)return t;return null},_matchBounds:function(e,t,i){var r=t.getBoundsNoRotate();e.setPosition(r.getTopLeft(),i),e.setWidth(r.width,i),e.setRotation(t.getRotation(),i),e.setClip(t.getClip())},_matchOpacity:function(e,t){e.setOpacity(t.opacity)},_matchCompositeOperation:function(e,t){e.setCompositeOperation(t.compositeOperation)}})}(OpenSeadragon),function(e){var t={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};e.extend(e,{getString:function(i){var r,n=i.split("."),s=null,o=arguments,a=t;for(r=0;r<n.length-1;r++)a=a[n[r]]||{};return"string"!=typeof(s=a[n[r]])&&(e.console.log("Untranslated source string:",i),s=""),s.replace(/\{\d+\}/g,(function(e){var t=parseInt(e.match(/\d+/),10)+1;return t<o.length?o[t]:""}))},setString:function(e,i){var r,n=e.split("."),s=t;for(r=0;r<n.length-1;r++)s[n[r]]||(s[n[r]]={}),s=s[n[r]];s[n[r]]=i}})}(OpenSeadragon),function(e){e.Point=function(e,t){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0},e.Point.prototype={clone:function(){return new e.Point(this.x,this.y)},plus:function(t){return new e.Point(this.x+t.x,this.y+t.y)},minus:function(t){return new e.Point(this.x-t.x,this.y-t.y)},times:function(t){return new e.Point(this.x*t,this.y*t)},divide:function(t){return new e.Point(this.x/t,this.y/t)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},squaredDistanceTo:function(e){return Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)},apply:function(t){return new e.Point(t(this.x),t(this.y))},equals:function(t){return t instanceof e.Point&&this.x===t.x&&this.y===t.y},rotate:function(t,i){var r,n;if(i=i||new e.Point(0,0),t%90==0)switch(e.positiveModulo(t,360)){case 0:r=1,n=0;break;case 90:r=0,n=1;break;case 180:r=-1,n=0;break;case 270:r=0,n=-1}else{var s=t*Math.PI/180;r=Math.cos(s),n=Math.sin(s)}var o=r*(this.x-i.x)-n*(this.y-i.y)+i.x,a=n*(this.x-i.x)+r*(this.y-i.y)+i.y;return new e.Point(o,a)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),function(e){e.TileSource=function(t,i,r,n,s,o){var a,l,c=this,u=arguments;if(a=e.isPlainObject(t)?t:{width:u[0],height:u[1],tileSize:u[2],tileOverlap:u[3],minLevel:u[4],maxLevel:u[5]},e.EventSource.call(this),e.extend(!0,this,a),!this.success)for(l=0;l<arguments.length;l++)if(e.isFunction(arguments[l])){this.success=arguments[l];break}this.success&&this.addHandler("ready",(function(e){c.success(e)})),"string"==e.type(arguments[0])&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new e.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=a.width&&a.height?a.width/a.height:1,this.dimensions=new e.Point(a.width,a.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=a.tileOverlap?a.tileOverlap:0,this.minLevel=a.minLevel?a.minLevel:0,this.maxLevel=void 0!==a.maxLevel&&null!==a.maxLevel?a.maxLevel:a.width&&a.height?Math.ceil(Math.log(Math.max(a.width,a.height))/Math.log(2)):0,this.success&&e.isFunction(this.success)&&this.success(this))},e.TileSource.prototype={getTileSize:function(t){return e.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(e){return this._tileWidth?this._tileWidth:this.getTileSize(e)},getTileHeight:function(e){return this._tileHeight?this._tileHeight:this.getTileSize(e)},getLevelScale:function(e){var t,i={};for(t=0;t<=this.maxLevel;t++)i[t]=1/Math.pow(2,this.maxLevel-t);return this.getLevelScale=function(e){return i[e]},this.getLevelScale(e)},getNumTiles:function(t){var i=this.getLevelScale(t),r=Math.ceil(i*this.dimensions.x/this.getTileWidth(t)),n=Math.ceil(i*this.dimensions.y/this.getTileHeight(t));return new e.Point(r,n)},getPixelRatio:function(t){var i=this.dimensions.times(this.getLevelScale(t)),r=1/i.x,n=1/i.y;return new e.Point(r,n)},getClosestLevel:function(){var e,t;for(e=this.minLevel+1;e<=this.maxLevel&&!((t=this.getNumTiles(e)).x>1||t.y>1);e++);return e-1},getTileAtPoint:function(t,i){var r=i.x>=0&&i.x<=1&&i.y>=0&&i.y<=1/this.aspectRatio;e.console.assert(r,"[TileSource.getTileAtPoint] must be called with a valid point.");var n=this.dimensions.x*this.getLevelScale(t),s=i.x*n,o=i.y*n,a=Math.floor(s/this.getTileWidth(t)),l=Math.floor(o/this.getTileHeight(t));return i.x>=1&&(a=this.getNumTiles(t).x-1),i.y>=1/this.aspectRatio-1e-15&&(l=this.getNumTiles(t).y-1),new e.Point(a,l)},getTileBounds:function(t,i,r,n){var s=this.dimensions.times(this.getLevelScale(t)),o=this.getTileWidth(t),a=this.getTileHeight(t),l=0===i?0:o*i-this.tileOverlap,c=0===r?0:a*r-this.tileOverlap,u=o+(0===i?1:2)*this.tileOverlap,h=a+(0===r?1:2)*this.tileOverlap,d=1/s.x;return u=Math.min(u,s.x-l),h=Math.min(h,s.y-c),n?new e.Rect(0,0,u,h):new e.Rect(l*d,c*d,u*d,h*d)},getImageInfo:function(t){var i,r,n,s,o,a,l,c=this;t&&(l=(a=(o=t.split("/"))[o.length-1]).lastIndexOf("."))>-1&&(o[o.length-1]=a.slice(0,l)),r=function(i){"string"==typeof i&&(i=e.parseXml(i));var r=e.TileSource.determineType(c,i,t);r?(void 0===(s=r.prototype.configure.apply(c,[i,t])).ajaxWithCredentials&&(s.ajaxWithCredentials=c.ajaxWithCredentials),n=new r(s),c.ready=!0,c.raiseEvent("ready",{tileSource:n})):c.raiseEvent("open-failed",{message:"Unable to load TileSource",source:t})},t.match(/\.js$/)?(i=t.split("/").pop().replace(".js",""),e.jsonp({url:t,async:!1,callbackName:i,callback:r})):e.makeAjaxRequest({url:t,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(t){var i=function(t){var i,r,n=t.responseText,s=t.status;if(!t)throw new Error(e.getString("Errors.Security"));if(200!==t.status&&0!==t.status)throw i=404==(s=t.status)?"Not Found":t.statusText,new Error(e.getString("Errors.Status",s,i));if(n.match(/\s*<.*/))try{r=t.responseXML&&t.responseXML.documentElement?t.responseXML:e.parseXml(n)}catch(e){r=t.responseText}else if(n.match(/\s*[\{\[].*/))try{r=e.parseJSON(n)}catch(e){r=n}else r=n;return r}(t);r(i)},error:function(e,i){var r;try{r="HTTP "+e.status+" attempting to load TileSource"}catch(e){r=(void 0!==i&&i.toString?i.toString():"Unknown error")+" attempting to load TileSource"}c.raiseEvent("open-failed",{message:r,source:t})}})},supports:function(e,t){return!1},configure:function(e,t){throw new Error("Method not implemented.")},getTileUrl:function(e,t,i){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(e,t,i){return{}},tileExists:function(e,t,i){var r=this.getNumTiles(e);return e>=this.minLevel&&e<=this.maxLevel&&t>=0&&i>=0&&t<r.x&&i<r.y}},e.extend(!0,e.TileSource.prototype,e.EventSource.prototype),e.TileSource.determineType=function(t,i,r){var n;for(n in OpenSeadragon)if(n.match(/.+TileSource$/)&&e.isFunction(OpenSeadragon[n])&&e.isFunction(OpenSeadragon[n].prototype.supports)&&OpenSeadragon[n].prototype.supports.call(t,i,r))return OpenSeadragon[n];e.console.error("No TileSource was able to open %s %s",r,i)}}(OpenSeadragon),function(e){function t(t,i){var r,n,s=i.Image,o=s.Url,a=s.Format,l=s.Size,c=s.DisplayRect||[],u=parseInt(l.Width,10),h=parseInt(l.Height,10),d=parseInt(s.TileSize,10),f=parseInt(s.Overlap,10),p=[];for(n=0;n<c.length;n++)r=c[n].Rect,p.push(new e.DisplayRect(parseInt(r.X,10),parseInt(r.Y,10),parseInt(r.Width,10),parseInt(r.Height,10),parseInt(r.MinLevel,10),parseInt(r.MaxLevel,10)));return e.extend(!0,{width:u,height:h,tileSize:d,tileOverlap:f,minLevel:null,maxLevel:null,tilesUrl:o,fileFormat:a,displayRects:p},i)}e.DziTileSource=function(t,i,r,n,s,o,a,l,c){var u,h,d,f;if(f=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=f.tilesUrl,this.fileFormat=f.fileFormat,this.displayRects=f.displayRects,this.displayRects)for(u=this.displayRects.length-1;u>=0;u--)for(d=(h=this.displayRects[u]).minLevel;d<=h.maxLevel;d++)this._levelRects[d]||(this._levelRects[d]=[]),this._levelRects[d].push(h);e.TileSource.apply(this,[f])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){var i;return e.Image?i=e.Image.xmlns:e.documentElement&&("Image"!=e.documentElement.localName&&"Image"!=e.documentElement.tagName||(i=e.documentElement.namespaceURI)),-1!==(i=(i||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==i.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(i,r){var n;return n=e.isPlainObject(i)?t(0,i):function(i,r){if(!r||!r.documentElement)throw new Error(e.getString("Errors.Xml"));var n,s,o,a,l,c=r.documentElement,u=c.localName||c.tagName,h=r.documentElement.namespaceURI,d=null,f=[];if("Image"==u)try{if(void 0===(a=c.getElementsByTagName("Size")[0])&&(a=c.getElementsByTagNameNS(h,"Size")[0]),d={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:c.getAttribute("Url"),Format:c.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(c.getAttribute("Overlap"),10),TileSize:parseInt(c.getAttribute("TileSize"),10),Size:{Height:parseInt(a.getAttribute("Height"),10),Width:parseInt(a.getAttribute("Width"),10)}}},!e.imageFormatSupported(d.Image.Format))throw new Error(e.getString("Errors.ImageFormat",d.Image.Format.toUpperCase()));for(void 0===(n=c.getElementsByTagName("DisplayRect"))&&(n=c.getElementsByTagNameNS(h,"DisplayRect")[0]),l=0;l<n.length;l++)void 0===(o=(s=n[l]).getElementsByTagName("Rect")[0])&&(o=s.getElementsByTagNameNS(h,"Rect")[0]),f.push({Rect:{X:parseInt(o.getAttribute("X"),10),Y:parseInt(o.getAttribute("Y"),10),Width:parseInt(o.getAttribute("Width"),10),Height:parseInt(o.getAttribute("Height"),10),MinLevel:parseInt(s.getAttribute("MinLevel"),10),MaxLevel:parseInt(s.getAttribute("MaxLevel"),10)}});return f.length&&(d.Image.DisplayRect=f),t(0,d)}catch(t){throw t instanceof Error?t:new Error(e.getString("Errors.Dzi"))}else{if("Collection"==u)throw new Error(e.getString("Errors.Dzc"));if("Error"==u){var p=c.getElementsByTagName("Message")[0].firstChild.nodeValue;throw new Error(p)}}throw new Error(e.getString("Errors.Dzi"))}(0,i),r&&!n.tilesUrl&&(n.tilesUrl=r.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),-1!=r.search(/\.(dzi|xml|js)\?/)?n.queryParams=r.match(/\?.*/):n.queryParams=""),n},getTileUrl:function(e,t,i){return[this.tilesUrl,e,"/",t,"_",i,".",this.fileFormat,this.queryParams].join("")},tileExists:function(e,t,i){var r,n,s,o,a,l,c,u=this._levelRects[e];if(this.minLevel&&e<this.minLevel||this.maxLevel&&e>this.maxLevel)return!1;if(!u||!u.length)return!0;for(c=u.length-1;c>=0;c--)if(!(e<(r=u[c]).minLevel||e>r.maxLevel)&&(n=this.getLevelScale(e),s=r.x*n,o=r.y*n,a=s+r.width*n,l=o+r.height*n,s=Math.floor(s/this._tileWidth),o=Math.floor(o/this._tileWidth),a=Math.ceil(a/this._tileWidth),l=Math.ceil(l/this._tileWidth),s<=t&&t<a&&o<=i&&i<l))return!0;return!1}})}(OpenSeadragon),function(e){function t(e){var t=Array.isArray(e.profile)?e.profile[0]:e.profile,i=-1!==["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"].indexOf(t),r=!1;return 2===e.version&&e.profile.length>1&&e.profile[1].supports&&(r=-1!==e.profile[1].supports.indexOf("sizeByW")),3===e.version&&e.extraFeatures&&(r=-1!==e.extraFeatures.indexOf("sizeByWh")),!i||r}function i(e){for(var t=[],i=0;i<e.sizes.length;i++)t.push({url:e["@id"]+"/full/"+e.sizes[i].width+","+(3===e.version?e.sizes[i].height:"")+"/0/default."+e.tileFormat,width:e.sizes[i].width,height:e.sizes[i].height});return t.sort((function(e,t){return e.width-t.width}))}function r(t,i,n){var s,o;if(3==t.nodeType&&n)(o=t.nodeValue.trim()).match(/^\d*$/)&&(o=Number(o)),i[n]?(e.isArray(i[n])||(i[n]=[i[n]]),i[n].push(o)):i[n]=o;else if(1==t.nodeType)for(s=0;s<t.childNodes.length;s++)r(t.childNodes[s],i,t.nodeName)}e.IIIFTileSource=function(r){if(e.extend(!0,this,r),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(r.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=r.version,this.tile_width&&this.tile_height)r.tileWidth=this.tile_width,r.tileHeight=this.tile_height;else if(this.tile_width)r.tileSize=this.tile_width;else if(this.tile_height)r.tileSize=this.tile_height;else if(this.tiles)if(1==this.tiles.length)r.tileWidth=this.tiles[0].width,r.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var n=0;n<this.tiles.length;n++)for(var s=0;s<this.tiles[n].scaleFactors.length;s++){var o=this.tiles[n].scaleFactors[s];this.scale_factors.push(o),r.tileSizePerScaleFactor[o]={width:this.tiles[n].width,height:this.tiles[n].height||this.tiles[n].width}}}else if(t(r)){for(var a=Math.min(this.height,this.width),l=[256,512,1024],c=[],u=0;u<l.length;u++)l[u]<=a&&c.push(l[u]);c.length>0?r.tileSize=Math.max.apply(null,c):r.tileSize=a}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,r.levels=i(this),e.extend(!0,r,{width:r.levels[r.levels.length-1].width,height:r.levels[r.levels.length-1].height,tileSize:Math.max(r.height,r.width),tileOverlap:0,minLevel:0,maxLevel:r.levels.length-1}),this.levels=r.levels):e.console.error("Nothing in the info.json to construct image pyramids from");if(!r.maxLevel&&!this.emulateLegacyImagePyramid)if(this.scale_factors){var h=Math.max.apply(null,this.scale_factors);r.maxLevel=Math.round(Math.log(h)*Math.LOG2E)}else r.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));e.TileSource.apply(this,[r])},e.extend(e.IIIFTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return!!(e.protocol&&"http://iiif.io/api/image"==e.protocol||e["@context"]&&("http://library.stanford.edu/iiif/image-api/1.1/context.json"==e["@context"]||"http://iiif.io/api/image/1/context.json"==e["@context"])||e.profile&&0===e.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")||e.identifier&&e.width&&e.height||e.documentElement&&"info"==e.documentElement.tagName&&"http://library.stanford.edu/iiif/image-api/ns/"==e.documentElement.namespaceURI)},configure:function(t,i){if(e.isPlainObject(t)){if(t["@context"]){var n=t["@context"];if(Array.isArray(n))for(var s=0;s<n.length;s++)if("string"==typeof n[s]&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(n[s])||"http://library.stanford.edu/iiif/image-api/1.1/context.json"===n[s])){n=n[s];break}switch(n){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":t.version=1;break;case"http://iiif.io/api/image/2/context.json":t.version=2;break;case"http://iiif.io/api/image/3/context.json":t.version=3;break;default:e.console.error("Data has a @context property which contains no known IIIF context URI.")}}else t["@context"]="http://iiif.io/api/image/1.0/context.json",t["@id"]=i.replace("/info.json",""),t.version=1;if(!t["@id"]&&t.id&&(t["@id"]=t.id),t.preferredFormats)for(var o=0;o<t.preferredFormats.length;o++)if(OpenSeadragon.imageFormatSupported(t.preferredFormats[o])){t.tileFormat=t.preferredFormats[o];break}return t}var a=function(t){if(!t||!t.documentElement)throw new Error(e.getString("Errors.Xml"));var i=t.documentElement,n=null;if("info"==i.tagName)try{return r(i,n={}),n}catch(t){throw t instanceof Error?t:new Error(e.getString("Errors.IIIF"))}throw new Error(e.getString("Errors.IIIF"))}(t);return a["@context"]="http://iiif.io/api/image/1.0/context.json",a["@id"]=i.replace("/info.xml",""),a.version=1,a},getTileWidth:function(t){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileWidth.call(this,t);var i=Math.pow(2,this.maxLevel-t);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[i]?this.tileSizePerScaleFactor[i].width:this._tileWidth},getTileHeight:function(t){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileHeight.call(this,t);var i=Math.pow(2,this.maxLevel-t);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[i]?this.tileSizePerScaleFactor[i].height:this._tileHeight},getLevelScale:function(t){if(this.emulateLegacyImagePyramid){var i=NaN;return this.levels.length>0&&t>=this.minLevel&&t<=this.maxLevel&&(i=this.levels[t].width/this.levels[this.maxLevel].width),i}return e.TileSource.prototype.getLevelScale.call(this,t)},getNumTiles:function(t){return this.emulateLegacyImagePyramid?this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0):e.TileSource.prototype.getNumTiles.call(this,t)},getTileAtPoint:function(t,i){return this.emulateLegacyImagePyramid?new e.Point(0,0):e.TileSource.prototype.getTileAtPoint.call(this,t,i)},getTileUrl:function(e,t,i){if(this.emulateLegacyImagePyramid){var r=null;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(r=this.levels[e].url),r}var n,s,o,a,l,c,u,h,d,f,p,g,m,v=Math.pow(.5,this.maxLevel-e),y=Math.ceil(this.width*v),w=Math.ceil(this.height*v);return n=this.getTileWidth(e),s=this.getTileHeight(e),o=Math.ceil(n/v),a=Math.ceil(s/v),m=1===this.version?"native."+this.tileFormat:"default."+this.tileFormat,y<n&&w<s?(f=2===this.version&&y===this.width||3===this.version&&y===this.width&&w===this.height?"max":3===this.version?y+","+w:y+",",l="full"):(c=t*o,u=i*a,h=Math.min(o,this.width-c),d=Math.min(a,this.height-u),l=0===t&&0===i&&h===this.width&&d===this.height?"full":[c,u,h,d].join(","),p=Math.ceil(h*v),g=Math.ceil(d*v),f=2===this.version&&p===this.width||3===this.version&&p===this.width&&g===this.height?"max":3===this.version?p+","+g:p+","),[this["@id"],l,f,"0",m].join("/")},__testonly__:{canBeTiled:t,constructLevels:i}})}(OpenSeadragon),function(e){e.OsmTileSource=function(t,i,r,n,s){var o;(o=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]}).width&&o.height||(o.width=65572864,o.height=65572864),o.tileSize||(o.tileSize=256,o.tileOverlap=0),o.tilesUrl||(o.tilesUrl="http://tile.openstreetmap.org/"),o.minLevel=8,e.TileSource.apply(this,[o])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"openstreetmaps"==e.type},configure:function(e,t){return e},getTileUrl:function(e,t,i){return this.tilesUrl+(e-8)+"/"+t+"/"+i+".png"}})}(OpenSeadragon),function(e){e.TmsTileSource=function(t,i,r,n,s){var o;o=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var a,l=256*Math.ceil(o.width/256),c=256*Math.ceil(o.height/256);a=l>c?l/256:c/256,o.maxLevel=Math.ceil(Math.log(a)/Math.log(2))-1,o.tileSize=256,o.width=l,o.height=c,e.TileSource.apply(this,[o])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"tiledmapservice"==e.type},configure:function(e,t){return e},getTileUrl:function(e,t,i){var r=this.getNumTiles(e).y-1;return this.tilesUrl+e+"/"+t+"/"+(r-i)+".png"}})}(OpenSeadragon),function(e){e.ZoomifyTileSource=function(e){e.tileSize=256;var t={x:e.width,y:e.height};for(e.imageSizes=[{x:e.width,y:e.height}],e.gridSize=[this._getGridSize(e.width,e.height,e.tileSize)];parseInt(t.x,10)>e.tileSize||parseInt(t.y,10)>e.tileSize;)t.x=Math.floor(t.x/2),t.y=Math.floor(t.y/2),e.imageSizes.push({x:t.x,y:t.y}),e.gridSize.push(this._getGridSize(t.x,t.y,e.tileSize));e.imageSizes.reverse(),e.gridSize.reverse(),e.minLevel=0,e.maxLevel=e.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[e])},e.extend(e.ZoomifyTileSource.prototype,e.TileSource.prototype,{_getGridSize:function(e,t,i){return{x:Math.ceil(e/i),y:Math.ceil(t/i)}},_calculateAbsoluteTileNumber:function(e,t,i){for(var r=0,n={},s=0;s<e;s++)r+=(n=this.gridSize[s]).x*n.y;return r+((n=this.gridSize[e]).x*i+t)},supports:function(e,t){return e.type&&"zoomifytileservice"==e.type},configure:function(e,t){return e},getTileUrl:function(e,t,i){var r,n=this._calculateAbsoluteTileNumber(e,t,i);return r=Math.floor(n/256),this.tilesUrl+"TileGroup"+r+"/"+e+"-"+t+"-"+i+".jpg"}})}(OpenSeadragon),function(e){function t(e,t){return t.levels}e.LegacyTileSource=function(t){var i,r,n;e.isArray(t)&&(i={type:"legacy-image-pyramid",levels:t}),i.levels=function(t){var i,r,n=[];for(r=0;r<t.length;r++)(i=t[r]).height&&i.width&&i.url?n.push({url:i.url,width:Number(i.width),height:Number(i.height)}):e.console.error("Unsupported image format: %s",i.url?i.url:"<no URL>");return n.sort((function(e,t){return e.height-t.height}))}(i.levels),i.levels.length>0?(r=i.levels[i.levels.length-1].width,n=i.levels[i.levels.length-1].height):(r=0,n=0,e.console.error("No supported image formats found")),e.extend(!0,i,{width:r,height:n,tileSize:Math.max(n,r),tileOverlap:0,minLevel:0,maxLevel:i.levels.length>0?i.levels.length-1:0}),e.TileSource.apply(this,[i]),this.levels=i.levels},e.extend(e.LegacyTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"legacy-image-pyramid"==e.type||e.documentElement&&"legacy-image-pyramid"==e.documentElement.getAttribute("type")},configure:function(i,r){return e.isPlainObject(i)?t(0,i):function(i,r){if(!r||!r.documentElement)throw new Error(e.getString("Errors.Xml"));var n,s,o=r.documentElement,a=o.tagName,l=null,c=[];if("image"==a)try{for(l={type:o.getAttribute("type"),levels:[]},c=o.getElementsByTagName("level"),s=0;s<c.length;s++)n=c[s],l.levels.push({url:n.getAttribute("url"),width:parseInt(n.getAttribute("width"),10),height:parseInt(n.getAttribute("height"),10)});return t(0,l)}catch(e){throw e instanceof Error?e:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==a)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"==a)throw new Error("Error: "+r)}throw new Error("Unknown element "+a)}(0,i)},getLevelScale:function(e){var t=NaN;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){return this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(e,t,i){var r=null;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(r=this.levels[e].url),r}})}(OpenSeadragon),function(e){e.ImageTileSource=function(t){t=e.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},t),e.TileSource.apply(this,[t])},e.extend(e.ImageTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"image"===e.type},configure:function(e,t){return e},getImageInfo:function(t){var i=this._image=new Image,r=this;this.crossOriginPolicy&&(i.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(i.useCredentials=this.ajaxWithCredentials),e.addEvent(i,"load",(function(){r.width=Object.prototype.hasOwnProperty.call(i,"naturalWidth")?i.naturalWidth:i.width,r.height=Object.prototype.hasOwnProperty.call(i,"naturalHeight")?i.naturalHeight:i.height,r.aspectRatio=r.width/r.height,r.dimensions=new e.Point(r.width,r.height),r._tileWidth=r.width,r._tileHeight=r.height,r.tileOverlap=0,r.minLevel=0,r.levels=r._buildLevels(),r.maxLevel=r.levels.length-1,r.ready=!0,r.raiseEvent("ready",{tileSource:r})})),e.addEvent(i,"error",(function(){r.raiseEvent("open-failed",{message:"Error loading image at "+t,source:t})})),i.src=t},getLevelScale:function(e){var t=NaN;return e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){return this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(e,t,i){var r=null;return e>=this.minLevel&&e<=this.maxLevel&&(r=this.levels[e].url),r},getContext2D:function(e,t,i){var r=null;return e>=this.minLevel&&e<=this.maxLevel&&(r=this.levels[e].context2D),r},_buildLevels:function(){var t=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!e.supportsCanvas||!this.useCanvas)return delete this._image,t;var i=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,r=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,n=document.createElement("canvas"),s=n.getContext("2d");if(n.width=i,n.height=r,s.drawImage(this._image,0,0,i,r),t[0].context2D=s,delete this._image,e.isCanvasTainted(n))return t;for(;i>=2&&r>=2;){i=Math.floor(i/2),r=Math.floor(r/2);var o=document.createElement("canvas"),a=o.getContext("2d");o.width=i,o.height=r,a.drawImage(n,0,0,i,r),t.splice(0,0,{context2D:a,width:i,height:r}),n=o,s=a}return t}})}(OpenSeadragon),function(e){e.TileSourceCollection=function(t,i,r,n){e.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(e){function t(i){e.requestAnimationFrame((function(){!function(i){var r;i.shouldFade&&(r=1-(e.now()-i.fadeBeginTime)/i.fadeLength,r=Math.min(1,r),r=Math.max(0,r),i.imgGroup&&e.setElementOpacity(i.imgGroup,r,!0),r>0&&t(i))}(i)}))}function i(t,i){t.element.disabled||(i>=e.ButtonState.GROUP&&t.currentState==e.ButtonState.REST&&(function(t){t.shouldFade=!1,t.imgGroup&&e.setElementOpacity(t.imgGroup,1,!0)}(t),t.currentState=e.ButtonState.GROUP),i>=e.ButtonState.HOVER&&t.currentState==e.ButtonState.GROUP&&(t.imgHover&&(t.imgHover.style.visibility=""),t.currentState=e.ButtonState.HOVER),i>=e.ButtonState.DOWN&&t.currentState==e.ButtonState.HOVER&&(t.imgDown&&(t.imgDown.style.visibility=""),t.currentState=e.ButtonState.DOWN))}function r(i,r){i.element.disabled||(r<=e.ButtonState.HOVER&&i.currentState==e.ButtonState.DOWN&&(i.imgDown&&(i.imgDown.style.visibility="hidden"),i.currentState=e.ButtonState.HOVER),r<=e.ButtonState.GROUP&&i.currentState==e.ButtonState.HOVER&&(i.imgHover&&(i.imgHover.style.visibility="hidden"),i.currentState=e.ButtonState.GROUP),r<=e.ButtonState.REST&&i.currentState==e.ButtonState.GROUP&&(function(i){i.shouldFade=!0,i.fadeBeginTime=e.now()+i.fadeDelay,window.setTimeout((function(){t(i)}),i.fadeDelay)}(i),i.currentState=e.ButtonState.REST))}e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(t){var n=this;e.EventSource.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},t),this.element=t.element||e.makeNeutralElement("div"),t.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",e.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",e.Browser.vendor==e.BROWSERS.FIREFOX&&e.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(t){t.insideElementPressed?(i(n,e.ButtonState.DOWN),n.raiseEvent("enter",{originalEvent:t.originalEvent})):t.buttonDownAny||i(n,e.ButtonState.HOVER)},focusHandler:function(e){this.enterHandler(e),n.raiseEvent("focus",{originalEvent:e.originalEvent})},exitHandler:function(t){r(n,e.ButtonState.GROUP),t.insideElementPressed&&n.raiseEvent("exit",{originalEvent:t.originalEvent})},blurHandler:function(e){this.exitHandler(e),n.raiseEvent("blur",{originalEvent:e.originalEvent})},pressHandler:function(t){i(n,e.ButtonState.DOWN),n.raiseEvent("press",{originalEvent:t.originalEvent})},releaseHandler:function(t){t.insideElementPressed&&t.insideElementReleased?(r(n,e.ButtonState.HOVER),n.raiseEvent("release",{originalEvent:t.originalEvent})):t.insideElementPressed?r(n,e.ButtonState.GROUP):i(n,e.ButtonState.HOVER)},clickHandler:function(e){e.quick&&n.raiseEvent("click",{originalEvent:e.originalEvent})},keyHandler:function(e){return 13!==e.keyCode||(n.raiseEvent("click",{originalEvent:e.originalEvent}),n.raiseEvent("release",{originalEvent:e.originalEvent}),!1)}}),r(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventSource.prototype,{notifyGroupEnter:function(){i(this,e.ButtonState.GROUP)},notifyGroupExit:function(){r(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),function(e){e.ButtonGroup=function(t){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},t);var i,r=this.buttons.concat([]),n=this;if(this.element=t.element||e.makeNeutralElement("div"),!t.group)for(this.element.style.display="inline-block",i=0;i<r.length;i++)this.element.appendChild(r[i].element);e.setElementTouchActionNone(this.element),this.tracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(e){var t;for(t=0;t<n.buttons.length;t++)n.buttons[t].notifyGroupEnter()},exitHandler:function(e){var t;if(!e.insideElementPressed)for(t=0;t<n.buttons.length;t++)n.buttons[t].notifyGroupExit()}})},e.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(e){e.Rect=function(t,i,r,n,s){var o,a;this.x="number"==typeof t?t:0,this.y="number"==typeof i?i:0,this.width="number"==typeof r?r:0,this.height="number"==typeof n?n:0,this.degrees="number"==typeof s?s:0,this.degrees=e.positiveModulo(this.degrees,360),this.degrees>=270?(o=this.getTopRight(),this.x=o.x,this.y=o.y,a=this.height,this.height=this.width,this.width=a,this.degrees-=270):this.degrees>=180?(o=this.getBottomRight(),this.x=o.x,this.y=o.y,this.degrees-=180):this.degrees>=90&&(o=this.getBottomLeft(),this.x=o.x,this.y=o.y,a=this.height,this.height=this.width,this.width=a,this.degrees-=90)},e.Rect.fromSummits=function(t,i,r){var n=t.distanceTo(i),s=t.distanceTo(r),o=i.minus(t),a=Math.atan(o.y/o.x);return o.x<0?a+=Math.PI:o.y<0&&(a+=2*Math.PI),new e.Rect(t.x,t.y,n,s,a/Math.PI*180)},e.Rect.prototype={clone:function(){return new e.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new e.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new e.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new e.Point(this.width,this.height)},equals:function(t){return t instanceof e.Rect&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height&&this.degrees===t.degrees},times:function(t){return new e.Rect(this.x*t,this.y*t,this.width*t,this.height*t,this.degrees)},translate:function(t){return new e.Rect(this.x+t.x,this.y+t.y,this.width,this.height,this.degrees)},union:function(t){var i=this.getBoundingBox(),r=t.getBoundingBox(),n=Math.min(i.x,r.x),s=Math.min(i.y,r.y),o=Math.max(i.x+i.width,r.x+r.width),a=Math.max(i.y+i.height,r.y+r.height);return new e.Rect(n,s,o-n,a-s)},intersection:function(t){var i=1e-10,r=[],n=this.getTopLeft();t.containsPoint(n,i)&&r.push(n);var s=this.getTopRight();t.containsPoint(s,i)&&r.push(s);var o=this.getBottomLeft();t.containsPoint(o,i)&&r.push(o);var a=this.getBottomRight();t.containsPoint(a,i)&&r.push(a);var l=t.getTopLeft();this.containsPoint(l,i)&&r.push(l);var c=t.getTopRight();this.containsPoint(c,i)&&r.push(c);var u=t.getBottomLeft();this.containsPoint(u,i)&&r.push(u);var h=t.getBottomRight();this.containsPoint(h,i)&&r.push(h);for(var d=this._getSegments(),f=t._getSegments(),p=0;p<d.length;p++)for(var g=d[p],m=0;m<f.length;m++){var v=f[m],y=w(g[0],g[1],v[0],v[1]);y&&r.push(y)}function w(t,r,n,s){var o=r.minus(t),a=s.minus(n),l=-a.x*o.y+o.x*a.y;if(0===l)return null;var c=(o.x*(t.y-n.y)-o.y*(t.x-n.x))/l,u=(a.x*(t.y-n.y)-a.y*(t.x-n.x))/l;return-1e-10<=c&&c<=1-i&&-1e-10<=u&&u<=1-i?new e.Point(t.x+u*o.x,t.y+u*o.y):null}if(0===r.length)return null;for(var E=r[0].x,b=r[0].x,T=r[0].y,S=r[0].y,x=1;x<r.length;x++){var R=r[x];R.x<E&&(E=R.x),R.x>b&&(b=R.x),R.y<T&&(T=R.y),R.y>S&&(S=R.y)}return new e.Rect(E,T,b-E,S-T)},_getSegments:function(){var e=this.getTopLeft(),t=this.getTopRight(),i=this.getBottomLeft(),r=this.getBottomRight();return[[e,t],[t,r],[r,i],[i,e]]},rotate:function(t,i){if(0===(t=e.positiveModulo(t,360)))return this.clone();i=i||this.getCenter();var r=this.getTopLeft().rotate(t,i),n=this.getTopRight().rotate(t,i).minus(r);n=n.apply((function(e){return Math.abs(e)<1e-15?0:e}));var s=Math.atan(n.y/n.x);return n.x<0?s+=Math.PI:n.y<0&&(s+=2*Math.PI),new e.Rect(r.x,r.y,this.width,this.height,s/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var t=this.getTopLeft(),i=this.getTopRight(),r=this.getBottomLeft(),n=this.getBottomRight(),s=Math.min(t.x,i.x,r.x,n.x),o=Math.max(t.x,i.x,r.x,n.x),a=Math.min(t.y,i.y,r.y,n.y),l=Math.max(t.y,i.y,r.y,n.y);return new e.Rect(s,a,o-s,l-a)},getIntegerBoundingBox:function(){var t=this.getBoundingBox(),i=Math.floor(t.x),r=Math.floor(t.y),n=Math.ceil(t.width+t.x-i),s=Math.ceil(t.height+t.y-r);return new e.Rect(i,r,n,s)},containsPoint:function(e,t){t=t||0;var i=this.getTopLeft(),r=this.getTopRight(),n=this.getBottomLeft(),s=r.minus(i),o=n.minus(i);return(e.x-i.x)*s.x+(e.y-i.y)*s.y>=-t&&(e.x-r.x)*s.x+(e.y-r.y)*s.y<=t&&(e.x-i.x)*o.x+(e.y-i.y)*o.y>=-t&&(e.x-n.x)*o.x+(e.y-n.y)*o.y<=t},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),function(e){var t={};function i(t){var i=Number(this.element.style.marginLeft.replace("px","")),r=Number(this.element.style.marginTop.replace("px","")),s=Number(this.element.style.width.replace("px","")),o=Number(this.element.style.height.replace("px","")),a=e.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?-t.delta.x>0?i>-(s-a.x)&&(this.element.style.marginLeft=i+2*t.delta.x+"px",n(this,a.x,i+2*t.delta.x)):-t.delta.x<0&&i<0&&(this.element.style.marginLeft=i+2*t.delta.x+"px",n(this,a.x,i+2*t.delta.x)):-t.delta.y>0?r>-(o-a.y)&&(this.element.style.marginTop=r+2*t.delta.y+"px",n(this,a.y,r+2*t.delta.y)):-t.delta.y<0&&r<0&&(this.element.style.marginTop=r+2*t.delta.y+"px",n(this,a.y,r+2*t.delta.y))),!1}function r(t){var i=Number(this.element.style.marginLeft.replace("px","")),r=Number(this.element.style.marginTop.replace("px","")),s=Number(this.element.style.width.replace("px","")),o=Number(this.element.style.height.replace("px","")),a=e.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?t.scroll>0?i>-(s-a.x)&&(this.element.style.marginLeft=i-60*t.scroll+"px",n(this,a.x,i-60*t.scroll)):t.scroll<0&&i<0&&(this.element.style.marginLeft=i-60*t.scroll+"px",n(this,a.x,i-60*t.scroll)):t.scroll<0?r>a.y-o&&(this.element.style.marginTop=r+60*t.scroll+"px",n(this,a.y,r+60*t.scroll)):t.scroll>0&&r<0&&(this.element.style.marginTop=r+60*t.scroll+"px",n(this,a.y,r+60*t.scroll))),!1}function n(t,i,r){var n,s,o,a,l,c,u;for(n="horizontal"==t.scroll?t.panelWidth:t.panelHeight,s=Math.ceil(i/n)+5,c=s=(s=(o=Math.ceil((Math.abs(r)+i)/n)+1)-s)<0?0:s;c<o&&c<t.panels.length;c++)if(!(u=t.panels[c]).activePanel){var h,d=t.viewer.tileSources[c];h=d.referenceStripThumbnailUrl?{type:"image",url:d.referenceStripThumbnailUrl}:d,(a=new e.Viewer({id:u.id,tileSources:[h],element:u,navigatorSizeRatio:t.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:t.viewer.loadTilesWithAjax,ajaxHeaders:t.viewer.ajaxHeaders,useCanvas:t.useCanvas})).displayRegion=e.makeNeutralElement("div"),a.displayRegion.id=u.id+"-displayregion",a.displayRegion.className="displayregion",(l=a.displayRegion.style).position="relative",l.top="0px",l.left="0px",l.fontSize="0px",l.overflow="hidden",l.float="left",l.cssFloat="left",l.styleFloat="left",l.zIndex=999999999,l.cursor="default",l.width=t.panelWidth-4+"px",l.height=t.panelHeight-4+"px",a.displayRegion.innerTracker=new e.MouseTracker({element:a.displayRegion,startDisabled:!0}),u.getElementsByTagName("div")[0].appendChild(a.displayRegion),t.miniViewers[u.id]=a,u.activePanel=!0}}function s(e){var t=e.eventSource.element;return"horizontal"==this.scroll?t.style.marginBottom="0px":t.style.marginLeft="0px",!1}function o(t){var i=t.eventSource.element;return"horizontal"==this.scroll?i.style.marginBottom="-"+e.getElementSize(i).y/2+"px":i.style.marginLeft="-"+e.getElementSize(i).x/2+"px",!1}function a(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 38:case 39:return r.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:case 37:return r.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;default:return!0}}function l(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 61:case 48:case 119:case 87:case 100:return r.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:case 115:case 83:case 97:return r.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;default:return!0}}e.ReferenceStrip=function(c){var u,h,d,f=c.viewer,p=e.getElementSize(f.element);for(c.id||(c.id="referencestrip-"+e.now(),this.element=e.makeNeutralElement("div"),this.element.id=c.id,this.element.className="referencestrip"),c=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.referenceStripSizeRatio,position:e.DEFAULT_SETTINGS.referenceStripPosition,scroll:e.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold},c,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),e.extend(this,c),t[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,(h=this.element.style).marginTop="0px",h.marginRight="0px",h.marginBottom="0px",h.marginLeft="0px",h.left="0px",h.bottom="0px",h.border="0px",h.background="#000",h.position="relative",e.setElementTouchActionNone(this.element),e.setElementOpacity(this.element,.8),this.viewer=f,this.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,i),scrollHandler:e.delegate(this,r),enterHandler:e.delegate(this,s),exitHandler:e.delegate(this,o),keyDownHandler:e.delegate(this,a),keyHandler:e.delegate(this,l)}),c.width&&c.height?(this.element.style.width=c.width+"px",this.element.style.height=c.height+"px",f.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):"horizontal"==c.scroll?(this.element.style.width=p.x*c.sizeRatio*f.tileSources.length+12*f.tileSources.length+"px",this.element.style.height=p.y*c.sizeRatio+"px",f.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=p.y*c.sizeRatio*f.tileSources.length+12*f.tileSources.length+"px",this.element.style.width=p.x*c.sizeRatio+"px",f.addControl(this.element,{anchor:e.ControlAnchor.TOP_LEFT})),this.panelWidth=p.x*this.sizeRatio+8,this.panelHeight=p.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},d=0;d<f.tileSources.length;d++)(u=e.makeNeutralElement("div")).id=this.element.id+"-"+d,u.style.width=this.panelWidth+"px",u.style.height=this.panelHeight+"px",u.style.display="inline",u.style.float="left",u.style.cssFloat="left",u.style.styleFloat="left",u.style.padding="2px",e.setElementTouchActionNone(u),u.innerTracker=new e.MouseTracker({element:u,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(t){t.eventSource.dragging=e.now()},releaseHandler:function(t){var i=t.eventSource,r=i.element.id,n=Number(r.split("-")[2]),s=e.now();t.insideElementPressed&&t.insideElementReleased&&i.dragging&&s-i.dragging<i.clickTimeThreshold&&(i.dragging=null,f.goToPage(n))}}),this.element.appendChild(u),u.activePanel=!1,this.panels.push(u);n(this,"vertical"==this.scroll?p.y:p.x,0),this.setFocus(0)},e.extend(e.ReferenceStrip.prototype,e.EventSource.prototype,e.Viewer.prototype,{setFocus:function(t){var i,r=this.element.querySelector("#"+this.element.id+"-"+t),o=e.getElementSize(this.viewer.canvas),a=Number(this.element.style.width.replace("px","")),l=Number(this.element.style.height.replace("px","")),c=-Number(this.element.style.marginLeft.replace("px","")),u=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==r&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=r,this.currentSelected.style.background="#999","horizontal"==this.scroll?(i=Number(t)*(this.panelWidth+3))>c+o.x-this.panelWidth?(i=Math.min(i,a-o.x),this.element.style.marginLeft=-i+"px",n(this,o.x,-i)):i<c&&(i=Math.max(0,i-o.x/2),this.element.style.marginLeft=-i+"px",n(this,o.x,-i)):(i=Number(t)*(this.panelHeight+3))>u+o.y-this.panelHeight?(i=Math.min(i,l-o.y),this.element.style.marginTop=-i+"px",n(this,o.y,-i)):i<u&&(i=Math.max(0,i-o.y/2),this.element.style.marginTop=-i+"px",n(this,o.y,-i)),this.currentPage=t,s.call(this,{eventSource:this.innerTracker}))},update:function(){return!!t[this.id].animating&&(e.console.log("image reference strip update"),!0)},destroy:function(){if(this.miniViewers)for(var e in this.miniViewers)this.miniViewers[e].destroy();this.element&&this.element.parentNode.removeChild(this.element)}})}(OpenSeadragon),function(e){e.DisplayRect=function(t,i,r,n,s,o){e.Rect.apply(this,[t,i,r,n]),this.minLevel=s,this.maxLevel=o},e.extend(e.DisplayRect.prototype,e.Rect.prototype)}(OpenSeadragon),function(e){e.Spring=function(t){var i=arguments;"object"!=typeof t&&(t={initial:i.length&&"number"==typeof i[0]?i[0]:void 0,springStiffness:i.length>1?i[1].springStiffness:5,animationTime:i.length>1?i[1].animationTime:1.5}),e.console.assert("number"==typeof t.springStiffness&&0!==t.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),e.console.assert("number"==typeof t.animationTime&&t.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),t.exponential&&(this._exponential=!0,delete t.exponential),e.extend(!0,this,t),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:e.now()},e.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},e.Spring.prototype={resetTo:function(t){e.console.assert(!this._exponential||0!==t,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=t,this.start.time=this.target.time=this.current.time=e.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(t){e.console.assert(!this._exponential||0!==t,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=t,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(t){this.start.value+=t,this.target.value+=t,this._exponential&&(e.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(t){this._exponential=t,this._exponential&&(e.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){var t,i;this.current.time=e.now(),this._exponential?(t=this.start._logValue,i=this.target._logValue):(t=this.start.value,i=this.target.value);var r,n,s=this.current.time>=this.target.time?i:t+(i-t)*(r=this.springStiffness,n=(this.current.time-this.start.time)/(this.target.time-this.start.time),(1-Math.exp(r*-n))/(1-Math.exp(-r))),o=this.current.value;return this._exponential?this.current.value=Math.exp(s):this.current.value=s,o!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),function(e){function t(t){e.extend(!0,this,{timeout:e.DEFAULT_SETTINGS.timeout,jobId:null},t),this.image=null}t.prototype={errorMsg:null,start:function(){var t=this,i=this.abort;this.image=new Image,this.image.onload=function(){t.finish(!0)},this.image.onabort=this.image.onerror=function(){t.errorMsg="Image load aborted",t.finish(!1)},this.jobId=window.setTimeout((function(){t.errorMsg="Image load exceeded timeout ("+t.timeout+" ms)",t.finish(!1)}),this.timeout),this.loadWithAjax?(this.request=e.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(e){var i;try{i=new window.Blob([e.response])}catch(t){var r=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if("TypeError"===t.name&&r){var n=new r;n.append(e.response),i=n.getBlob()}}0===i.size&&(t.errorMsg="Empty image response.",t.finish(!1));var s=(window.URL||window.webkitURL).createObjectURL(i);t.image.src=s},error:function(e){t.errorMsg="Image load aborted - XHR error",t.finish(!1)}}),this.abort=function(){t.request.abort(),"function"==typeof i&&i()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(e){this.image.onload=this.image.onerror=this.image.onabort=null,e||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},e.ImageLoader=function(t){e.extend(!0,this,{jobLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,timeout:e.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},t)},e.ImageLoader.prototype={addJob:function(e){var i=this,r=new t({src:e.src,loadWithAjax:e.loadWithAjax,ajaxHeaders:e.loadWithAjax?e.ajaxHeaders:null,crossOriginPolicy:e.crossOriginPolicy,ajaxWithCredentials:e.ajaxWithCredentials,callback:function(t){!function(e,t,i){e.jobsInProgress--,(!e.jobLimit||e.jobsInProgress<e.jobLimit)&&e.jobQueue.length>0&&(e.jobQueue.shift().start(),e.jobsInProgress++),i(t.image,t.errorMsg,t.request)}(i,t,e.callback)},abort:e.abort,timeout:this.timeout});!this.jobLimit||this.jobsInProgress<this.jobLimit?(r.start(),this.jobsInProgress++):this.jobQueue.push(r)},clear:function(){for(var e=0;e<this.jobQueue.length;e++){var t=this.jobQueue[e];"function"==typeof t.abort&&t.abort()}this.jobQueue=[]}}}(OpenSeadragon),function(e){e.Tile=function(e,t,i,r,n,s,o,a,l,c){this.level=e,this.x=t,this.y=i,this.bounds=r,this.sourceBounds=c,this.exists=n,this.url=s,this.context2D=o,this.loadWithAjax=a,this.ajaxHeaders=l,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(t){this.cacheImageRecord?this.loaded?(this.element||(this.element=e.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=t&&t.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",e.setElementOpacity(this.element,this.opacity)):e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):e.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(t,i,r,n){var s,o,a,l=this.position.times(e.pixelDensityRatio),c=this.size.times(e.pixelDensityRatio);this.context2D||this.cacheImageRecord?(s=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&s?(t.save(),t.globalAlpha=this.opacity,"number"==typeof r&&1!==r&&(l=l.times(r),c=c.times(r)),n instanceof e.Point&&(l=l.plus(n)),1===t.globalAlpha&&this._hasTransparencyChannel()&&t.clearRect(l.x,l.y,c.x,c.y),i({context:t,tile:this,rendered:s}),this.sourceBounds?(o=Math.min(this.sourceBounds.width,s.canvas.width),a=Math.min(this.sourceBounds.height,s.canvas.height)):(o=s.canvas.width,a=s.canvas.height),t.drawImage(s.canvas,0,0,o,a,l.x,l.y,c.x,c.y),t.restore()):e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())):e.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var t;if(this.cacheImageRecord)t=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return e.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;t=this.context2D}return t.canvas.width/(this.size.x*e.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(t,i,r){var n=Math.max(1,Math.ceil((r.x-i.x)/2)),s=Math.max(1,Math.ceil((r.y-i.y)/2));return new e.Point(n,s).minus(this.position.times(e.pixelDensityRatio).times(t||1).apply((function(e){return e%1})))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(e){e.OverlayPlacement=e.Placement,e.OverlayRotationMode=e.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),e.Overlay=function(t,i,r){var n;n=e.isPlainObject(t)?t:{element:t,location:i,placement:r},this.element=n.element,this.style=n.element.style,this._init(n)},e.Overlay.prototype={_init:function(t){this.location=t.location,this.placement=void 0===t.placement?e.Placement.TOP_LEFT:t.placement,this.onDraw=t.onDraw,this.checkResize=void 0===t.checkResize||t.checkResize,this.width=void 0===t.width?null:t.width,this.height=void 0===t.height?null:t.height,this.rotationMode=t.rotationMode||e.OverlayRotationMode.EXACT,this.location instanceof e.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=e.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new e.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(t,i){var r=e.Placement.properties[this.placement];r&&(r.isHorizontallyCentered?t.x-=i.x/2:r.isRight&&(t.x-=i.x),r.isVerticallyCentered?t.y-=i.y/2:r.isBottom&&(t.y-=i.y))},destroy:function(){var t=this.element,i=this.style;t.parentNode&&(t.parentNode.removeChild(t),t.prevElementParent&&(i.display="none",document.body.appendChild(t))),this.onDraw=null,i.top="",i.left="",i.position="",null!==this.width&&(i.width=""),null!==this.height&&(i.height="");var r=e.getCssPropertyWithVendorPrefix("transformOrigin"),n=e.getCssPropertyWithVendorPrefix("transform");r&&n&&(i[r]="",i[n]="")},drawHTML:function(t,i){var r=this.element;r.parentNode!==t&&(r.prevElementParent=r.parentNode,r.prevNextSibling=r.nextSibling,t.appendChild(r),this.style.position="absolute",this.size=e.getElementSize(r));var n=this._getOverlayPositionAndSize(i),s=n.position,o=this.size=n.size,a=n.rotate;if(this.onDraw)this.onDraw(s,o,this.element);else{var l=this.style;l.left=s.x+"px",l.top=s.y+"px",null!==this.width&&(l.width=o.x+"px"),null!==this.height&&(l.height=o.y+"px");var c=e.getCssPropertyWithVendorPrefix("transformOrigin"),u=e.getCssPropertyWithVendorPrefix("transform");c&&u&&(a?(l[c]=this._getTransformOrigin(),l[u]="rotate("+a+"deg)"):(l[c]="",l[u]="")),"none"!==l.display&&(l.display="block")}},_getOverlayPositionAndSize:function(t){var i=t.pixelFromPoint(this.location,!0),r=this._getSizeInPixels(t);this.adjust(i,r);var n=0;if(t.degrees&&this.rotationMode!==e.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height){var s=new e.Rect(i.x,i.y,r.x,r.y),o=this._getBoundingBox(s,t.degrees);i=o.getTopLeft(),r=o.getSize()}else n=t.degrees;return{position:i,size:r,rotate:n}},_getSizeInPixels:function(t){var i=this.size.x,r=this.size.y;if(null!==this.width||null!==this.height){var n=t.deltaPixelsFromPointsNoRotate(new e.Point(this.width||0,this.height||0),!0);null!==this.width&&(i=n.x),null!==this.height&&(r=n.y)}if(this.checkResize&&(null===this.width||null===this.height)){var s=this.size=e.getElementSize(this.element);null===this.width&&(i=s.x),null===this.height&&(r=s.y)}return new e.Point(i,r)},_getBoundingBox:function(e,t){var i=this._getPlacementPoint(e);return e.rotate(t,i).getBoundingBox()},_getPlacementPoint:function(t){var i=new e.Point(t.x,t.y),r=e.Placement.properties[this.placement];return r&&(r.isHorizontallyCentered?i.x+=t.width/2:r.isRight&&(i.x+=t.width),r.isVerticallyCentered?i.y+=t.height/2:r.isBottom&&(i.y+=t.height)),i},_getTransformOrigin:function(){var t="",i=e.Placement.properties[this.placement];return i?(i.isLeft?t="left":i.isRight&&(t="right"),i.isTop?t+=" top":i.isBottom&&(t+=" bottom"),t):t},update:function(t,i){var r=e.isPlainObject(t)?t:{location:t,placement:i};this._init({location:r.location||this.location,placement:void 0!==r.placement?r.placement:this.placement,onDraw:r.onDraw||this.onDraw,checkResize:r.checkResize||this.checkResize,width:void 0!==r.width?r.width:this.width,height:void 0!==r.height?r.height:this.height,rotationMode:r.rotationMode||this.rotationMode})},getBounds:function(t){e.console.assert(t,"A viewport must now be passed to Overlay.getBounds.");var i=this.width,r=this.height;if(null===i||null===r){var n=t.deltaPointsFromPixelsNoRotate(this.size,!0);null===i&&(i=n.x),null===r&&(r=n.y)}var s=this.location.clone();return this.adjust(s,new e.Point(i,r)),this._adjustBoundsForRotation(t,new e.Rect(s.x,s.y,i,r))},_adjustBoundsForRotation:function(t,i){if(!t||0===t.degrees||this.rotationMode===e.OverlayRotationMode.EXACT)return i;if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX){if(null===this.width||null===this.height)return i;var r=this._getOverlayPositionAndSize(t);return t.viewerElementToViewportRectangle(new e.Rect(r.position.x,r.position.y,r.size.x,r.size.y))}return i.rotate(-t.degrees,this._getPlacementPoint(i))}}}(OpenSeadragon),function(e){e.Drawer=function(t){e.console.assert(t.viewer,"[Drawer] options.viewer is required");var i=arguments;if(e.isPlainObject(t)||(t={source:i[0],viewport:i[1],element:i[2]}),e.console.assert(t.viewport,"[Drawer] options.viewport is required"),e.console.assert(t.element,"[Drawer] options.element is required"),t.source&&e.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=t.viewer,this.viewport=t.viewport,this.debugGridColor="string"==typeof t.debugGridColor?[t.debugGridColor]:t.debugGridColor||e.DEFAULT_SETTINGS.debugGridColor,t.opacity&&e.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=e.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=e.getElement(t.element),this.canvas=e.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var r=this._calculateCanvasSize();this.canvas.width=r.x,this.canvas.height=r.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",e.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},e.Drawer.prototype={addOverlay:function(t,i,r,n){return e.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(t,i,r,n),this},updateOverlay:function(t,i,r){return e.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(t,i,r),this},removeOverlay:function(t){return e.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(t),this},clearOverlays:function(){return e.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(t){var i=this.viewport.pixelFromPointNoRotate(t,!0);return new e.Point(i.x*e.pixelDensityRatio,i.y*e.pixelDensityRatio)},clipWithPolygons:function(e,t){if(this.useCanvas){var i=this._getContext(t);i.beginPath(),e.forEach((function(e){e.forEach((function(e,t){i[0===t?"moveTo":"lineTo"](e.x,e.y)}))})),i.clip()}},setOpacity:function(t){e.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var i=this.viewer.world,r=0;r<i.getItemCount();r++)i.getItemAt(r).setOpacity(t);return this},getOpacity:function(){e.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var t=this.viewer.world,i=0,r=0;r<t.getItemCount();r++){var n=t.getItemAt(r).getOpacity();n>i&&(i=n)}return i},needsUpdate:function(){return e.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return e.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return e.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return e.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var e=this._calculateCanvasSize();if((this.canvas.width!=e.x||this.canvas.height!=e.y)&&(this.canvas.width=e.x,this.canvas.height=e.y,this._updateImageSmoothingEnabled(this.context),null!==this.sketchCanvas)){var t=this._calculateSketchCanvasSize();this.sketchCanvas.width=t.x,this.sketchCanvas.height=t.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(e,t){if(this.useCanvas){var i=this._getContext(e);if(t)i.clearRect(t.x,t.y,t.width,t.height);else{var r=i.canvas;i.clearRect(0,0,r.width,r.height)}}},viewportToDrawerRectangle:function(t){var i=this.viewport.pixelFromPointNoRotate(t.getTopLeft(),!0),r=this.viewport.deltaPixelsFromPointsNoRotate(t.getSize(),!0);return new e.Rect(i.x*e.pixelDensityRatio,i.y*e.pixelDensityRatio,r.x*e.pixelDensityRatio,r.y*e.pixelDensityRatio)},drawTile:function(t,i,r,n,s){if(e.console.assert(t,"[Drawer.drawTile] tile is required"),e.console.assert(i,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var o=this._getContext(r);n=n||1,t.drawCanvas(o,i,n,s)}else t.drawHTML(this.canvas)},_getContext:function(e){var t=this.context;if(e){if(null===this.sketchCanvas){this.sketchCanvas=document.createElement("canvas");var i=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=i.x,this.sketchCanvas.height=i.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()){var r=this;this.viewer.addHandler("rotate",(function e(){if(0!==r.viewport.getRotation()){r.viewer.removeHandler("rotate",e);var t=r._calculateSketchCanvasSize();r.sketchCanvas.width=t.x,r.sketchCanvas.height=t.y}}))}this._updateImageSmoothingEnabled(this.sketchContext)}t=this.sketchContext}return t},saveContext:function(e){this.useCanvas&&this._getContext(e).save()},restoreContext:function(e){this.useCanvas&&this._getContext(e).restore()},setClip:function(e,t){if(this.useCanvas){var i=this._getContext(t);i.beginPath(),i.rect(e.x,e.y,e.width,e.height),i.clip()}},drawRectangle:function(e,t,i){if(this.useCanvas){var r=this._getContext(i);r.save(),r.fillStyle=t,r.fillRect(e.x,e.y,e.width,e.height),r.restore()}},blendSketch:function(t,i,r,n){var s=t;if(e.isPlainObject(s)||(s={opacity:t,scale:i,translate:r,compositeOperation:n}),this.useCanvas&&this.sketchCanvas){t=s.opacity,n=s.compositeOperation;var o=s.bounds;if(this.context.save(),this.context.globalAlpha=t,n&&(this.context.globalCompositeOperation=n),o)o.x<0&&(o.width+=o.x,o.x=0),o.x+o.width>this.canvas.width&&(o.width=this.canvas.width-o.x),o.y<0&&(o.height+=o.y,o.y=0),o.y+o.height>this.canvas.height&&(o.height=this.canvas.height-o.y),this.context.drawImage(this.sketchCanvas,o.x,o.y,o.width,o.height,o.x,o.y,o.width,o.height);else{i=s.scale||1;var a=(r=s.translate)instanceof e.Point?r:new e.Point(0,0),l=0,c=0;if(r){var u=this.sketchCanvas.width-this.canvas.width,h=this.sketchCanvas.height-this.canvas.height;l=Math.round(u/2),c=Math.round(h/2)}this.context.drawImage(this.sketchCanvas,a.x-l*i,a.y-c*i,(this.canvas.width+2*l)*i,(this.canvas.height+2*c)*i,-l,-c,this.canvas.width+2*l,this.canvas.height+2*c)}this.context.restore()}},drawDebugInfo:function(t,i,r,n){if(this.useCanvas){var s=this.viewer.world.getIndexOfItem(n)%this.debugGridColor.length,o=this.context;o.save(),o.lineWidth=2*e.pixelDensityRatio,o.font="small-caps bold "+13*e.pixelDensityRatio+"px arial",o.strokeStyle=this.debugGridColor[s],o.fillStyle=this.debugGridColor[s],0!==this.viewport.degrees&&this._offsetForRotation({degrees:this.viewport.degrees}),n.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:n.getRotation(!0),point:n.viewport.pixelFromPointNoRotate(n._getRotationPoint(!0),!0)}),0===n.viewport.degrees&&n.getRotation(!0)%360==0&&n._drawer.viewer.viewport.getFlip()&&n._drawer._flip(),o.strokeRect(t.position.x*e.pixelDensityRatio,t.position.y*e.pixelDensityRatio,t.size.x*e.pixelDensityRatio,t.size.y*e.pixelDensityRatio);var a=(t.position.x+t.size.x/2)*e.pixelDensityRatio,l=(t.position.y+t.size.y/2)*e.pixelDensityRatio;o.translate(a,l),o.rotate(Math.PI/180*-this.viewport.degrees),o.translate(-a,-l),0===t.x&&0===t.y&&(o.fillText("Zoom: "+this.viewport.getZoom(),t.position.x*e.pixelDensityRatio,(t.position.y-30)*e.pixelDensityRatio),o.fillText("Pan: "+this.viewport.getBounds().toString(),t.position.x*e.pixelDensityRatio,(t.position.y-20)*e.pixelDensityRatio)),o.fillText("Level: "+t.level,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+20)*e.pixelDensityRatio),o.fillText("Column: "+t.x,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+30)*e.pixelDensityRatio),o.fillText("Row: "+t.y,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+40)*e.pixelDensityRatio),o.fillText("Order: "+r+" of "+i,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+50)*e.pixelDensityRatio),o.fillText("Size: "+t.size.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+60)*e.pixelDensityRatio),o.fillText("Position: "+t.position.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+70)*e.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),n.getRotation(!0)%360!=0&&this._restoreRotationChanges(),0===n.viewport.degrees&&n.getRotation(!0)%360==0&&n._drawer.viewer.viewport.getFlip()&&n._drawer._flip(),o.restore()}},debugRect:function(t){if(this.useCanvas){var i=this.context;i.save(),i.lineWidth=2*e.pixelDensityRatio,i.strokeStyle=this.debugGridColor[0],i.fillStyle=this.debugGridColor[0],i.strokeRect(t.x*e.pixelDensityRatio,t.y*e.pixelDensityRatio,t.width*e.pixelDensityRatio,t.height*e.pixelDensityRatio),i.restore()}},setImageSmoothingEnabled:function(e){this.useCanvas&&(this._imageSmoothingEnabled=e,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(e){e.msImageSmoothingEnabled=this._imageSmoothingEnabled,e.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(t){var i=this._getContext(t).canvas;return new e.Point(i.width,i.height)},getCanvasCenter:function(){return new e.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(t){var i=t.point?t.point.times(e.pixelDensityRatio):this.getCanvasCenter(),r=this._getContext(t.useSketch);r.save(),r.translate(i.x,i.y),this.viewer.viewport.flipped?(r.rotate(Math.PI/180*-t.degrees),r.scale(-1,1)):r.rotate(Math.PI/180*t.degrees),r.translate(-i.x,-i.y)},_flip:function(t){var i=(t=t||{}).point?t.point.times(e.pixelDensityRatio):this.getCanvasCenter(),r=this._getContext(t.useSketch);r.translate(i.x,0),r.scale(-1,1),r.translate(-i.x,0)},_restoreRotationChanges:function(e){this._getContext(e).restore()},_calculateCanvasSize:function(){var t=e.pixelDensityRatio,i=this.viewport.getContainerSize();return{x:Math.round(i.x*t),y:Math.round(i.y*t)}},_calculateSketchCanvasSize:function(){var e=this._calculateCanvasSize();if(0===this.viewport.getRotation())return e;var t=Math.ceil(Math.sqrt(e.x*e.x+e.y*e.y));return{x:t,y:t}}}}(OpenSeadragon),function(e){e.Viewport=function(t){var i=arguments;i.length&&i[0]instanceof e.Point&&(t={containerSize:i[0],contentSize:i[1],config:i[2]}),t.config&&(e.extend(!0,t,t.config),delete t.config),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t.margins||{}),delete t.margins,e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:e.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:e.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:e.DEFAULT_SETTINGS.maxZoomLevel,degrees:e.DEFAULT_SETTINGS.degrees,flipped:e.DEFAULT_SETTINGS.flipped,homeFillsViewer:e.DEFAULT_SETTINGS.homeFillsViewer},t),this._updateContainerInnerSize(),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new e.Rect(0,0,1,1),1),this.goHome(!0),this.update()},e.Viewport.prototype={resetContentSize:function(t){return e.console.assert(t,"[Viewport.resetContentSize] contentSize is required"),e.console.assert(t instanceof e.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),e.console.assert(t.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),e.console.assert(t.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new e.Rect(0,0,1,t.y/t.x),t.x),this},setHomeBounds:function(t,i){e.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(t,i)},_setContentBounds:function(t,i){e.console.assert(t,"[Viewport._setContentBounds] bounds is required"),e.console.assert(t instanceof e.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),e.console.assert(t.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),e.console.assert(t.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=t.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(i),this._contentBounds=t.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(i),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:i,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var e=this._contentAspectRatio/this.getAspectRatio();return(this.homeFillsViewer?e>=1?e:1:e>=1?1:e)/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var t=this._contentBounds.getCenter(),i=1/this.getHomeZoom(),r=i/this.getAspectRatio();return new e.Rect(t.x-i/2,t.y-r/2,i,r)},goHome:function(e){return this.viewer&&this.viewer.raiseEvent("home",{immediately:e}),this.fitBounds(this.getHomeBounds(),e)},getMinZoom:function(){var e=this.getHomeZoom();return this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*e},getMaxZoom:function(){var e=this.maxZoomLevel;return e||(e=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,e/=this._contentBounds.width),Math.max(e,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return e.extend({},this._margins)},setMargins:function(t){e.console.assert("object"===e.type(t),"[Viewport.setMargins] margins must be an object"),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(-this.getRotation())},getBoundsNoRotate:function(t){var i=this.getCenter(t),r=1/this.getZoom(t),n=r/this.getAspectRatio();return new e.Rect(i.x-r/2,i.y-n/2,r,n)},getBoundsWithMargins:function(e){return this.getBoundsNoRotateWithMargins(e).rotate(-this.getRotation(),this.getCenter(e))},getBoundsNoRotateWithMargins:function(e){var t=this.getBoundsNoRotate(e),i=this._containerInnerSize.x*this.getZoom(e);return t.x-=this._margins.left/i,t.y-=this._margins.top/i,t.width+=(this._margins.left+this._margins.right)/i,t.height+=(this._margins.top+this._margins.bottom)/i,t},getCenter:function(t){var i,r,n,s,o,a,l=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),c=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return t?l:this.zoomPoint?(i=this.pixelFromPoint(this.zoomPoint,!0),s=(n=1/(r=this.getZoom()))/this.getAspectRatio(),o=new e.Rect(l.x-n/2,l.y-s/2,n,s),a=this._pixelFromPoint(this.zoomPoint,o).minus(i).divide(this._containerInnerSize.x*r),c.plus(a)):c},getZoom:function(e){return e?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(e){return Math.max(Math.min(e,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(t){var i=new e.Rect(t.x,t.y,t.width,t.height);if(this.wrapHorizontal);else{var r=this.visibilityRatio*i.width,n=i.x+i.width,s=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,o=this._contentBoundsNoRotate.x-n+r,a=s-i.x-r;r>this._contentBoundsNoRotate.width?i.x+=(o+a)/2:a<0?i.x+=a:o>0&&(i.x+=o)}if(this.wrapVertical);else{var l=this.visibilityRatio*i.height,c=i.y+i.height,u=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,h=this._contentBoundsNoRotate.y-c+l,d=u-i.y-l;l>this._contentBoundsNoRotate.height?i.y+=(h+d)/2:d<0?i.y+=d:h>0&&(i.y+=h)}return i},_raiseConstraintsEvent:function(e){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:e})},applyConstraints:function(e){var t=this.getZoom(),i=this._applyZoomConstraints(t);t!==i&&this.zoomTo(i,this.zoomPoint,e);var r=this.getBoundsNoRotate(),n=this._applyBoundaryConstraints(r);return this._raiseConstraintsEvent(e),(r.x!==n.x||r.y!==n.y||e)&&this.fitBounds(n.rotate(-this.getRotation()),e),this},ensureVisible:function(e){return this.applyConstraints(e)},_fitBounds:function(t,i){var r=(i=i||{}).immediately||!1,n=i.constraints||!1,s=this.getAspectRatio(),o=t.getCenter(),a=new e.Rect(t.x,t.y,t.width,t.height,t.degrees+this.getRotation()).getBoundingBox();a.getAspectRatio()>=s?a.height=a.width/s:a.width=a.height*s,a.x=o.x-a.width/2,a.y=o.y-a.height/2;var l=1/a.width;if(n){var c=a.getAspectRatio(),u=this._applyZoomConstraints(l);l!==u&&(l=u,a.width=1/l,a.x=o.x-a.width/2,a.height=a.width/c,a.y=o.y-a.height/2),o=(a=this._applyBoundaryConstraints(a)).getCenter(),this._raiseConstraintsEvent(r)}if(r)return this.panTo(o,!0),this.zoomTo(l,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var h=this.getBounds(),d=this.getZoom();if(0===d||Math.abs(l/d-1)<1e-8)return this.zoomTo(l,!0),this.panTo(o,r);var f=(a=a.rotate(-this.getRotation())).getTopLeft().times(l).minus(h.getTopLeft().times(d)).divide(l-d);return this.zoomTo(l,f,r)},fitBounds:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!1})},fitBoundsWithConstraints:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!0})},fitVertically:function(t){var i=new e.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(i,t)},fitHorizontally:function(t){var i=new e.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(i,t)},getConstrainedBounds:function(e){var t;return t=this.getBounds(e),this._applyBoundaryConstraints(t)},panBy:function(t,i){var r=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(r.plus(t),i)},panTo:function(e,t){return t?(this.centerSpringX.resetTo(e.x),this.centerSpringY.resetTo(e.y)):(this.centerSpringX.springTo(e.x),this.centerSpringY.springTo(e.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:e,immediately:t}),this},zoomBy:function(e,t,i){return this.zoomTo(this.zoomSpring.target.value*e,t,i)},zoomTo:function(t,i,r){var n=this;return this.zoomPoint=i instanceof e.Point&&!isNaN(i.x)&&!isNaN(i.y)?i:null,r?this._adjustCenterSpringsForZoomPoint((function(){n.zoomSpring.resetTo(t)})):this.zoomSpring.springTo(t),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:t,refPoint:i,immediately:r}),this},setRotation:function(t){return this.viewer&&this.viewer.drawer.canRotate()?(this.degrees=e.positiveModulo(t,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:t}),this):this},getRotation:function(){return this.degrees},resize:function(e,t){var i,r=this.getBoundsNoRotate(),n=r;return this.containerSize.x=e.x,this.containerSize.y=e.y,this._updateContainerInnerSize(),t&&(i=e.x/this.containerSize.x,n.width=r.width*i,n.height=n.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:e,maintain:t}),this.fitBounds(n,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new e.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var e=this;this._adjustCenterSpringsForZoomPoint((function(){e.zoomSpring.update()})),this.centerSpringX.update(),this.centerSpringY.update();var t=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,t},_adjustCenterSpringsForZoomPoint:function(e){if(this.zoomPoint){var t=this.pixelFromPoint(this.zoomPoint,!0);e();var i=this.pixelFromPoint(this.zoomPoint,!0).minus(t),r=this.deltaPointsFromPixels(i,!0);this.centerSpringX.shiftBy(r.x),this.centerSpringY.shiftBy(r.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else e()},deltaPixelsFromPointsNoRotate:function(e,t){return e.times(this._containerInnerSize.x*this.getZoom(t))},deltaPixelsFromPoints:function(e,t){return this.deltaPixelsFromPointsNoRotate(e.rotate(this.getRotation()),t)},deltaPointsFromPixelsNoRotate:function(e,t){return e.divide(this._containerInnerSize.x*this.getZoom(t))},deltaPointsFromPixels:function(e,t){return this.deltaPointsFromPixelsNoRotate(e,t).rotate(-this.getRotation())},pixelFromPointNoRotate:function(e,t){return this._pixelFromPointNoRotate(e,this.getBoundsNoRotate(t))},pixelFromPoint:function(e,t){return this._pixelFromPoint(e,this.getBoundsNoRotate(t))},_pixelFromPointNoRotate:function(t,i){return t.minus(i.getTopLeft()).times(this._containerInnerSize.x/i.width).plus(new e.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(e,t){return this._pixelFromPointNoRotate(e.rotate(this.getRotation(),this.getCenter(!0)),t)},pointFromPixelNoRotate:function(t,i){var r=this.getBoundsNoRotate(i);return t.minus(new e.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/r.width).plus(r.getTopLeft())},pointFromPixel:function(e,t){return this.pointFromPixelNoRotate(e,t).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(t,i){var r=this._contentBoundsNoRotate.width;return new e.Point(t*this._contentSizeNoRotate.x/r,i*this._contentSizeNoRotate.x/r)},viewportToImageCoordinates:function(t,i){if(t instanceof e.Point)return this.viewportToImageCoordinates(t.x,t.y);if(this.viewer){var r=this.viewer.world.getItemCount();if(r>1)e.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===r)return this.viewer.world.getItemAt(0).viewportToImageCoordinates(t,i,!0)}return this._viewportToImageDelta(t-this._contentBoundsNoRotate.x,i-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(t,i){var r=this._contentBoundsNoRotate.width;return new e.Point(t/this._contentSizeNoRotate.x*r,i/this._contentSizeNoRotate.x*r)},imageToViewportCoordinates:function(t,i){if(t instanceof e.Point)return this.imageToViewportCoordinates(t.x,t.y);if(this.viewer){var r=this.viewer.world.getItemCount();if(r>1)e.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===r)return this.viewer.world.getItemAt(0).imageToViewportCoordinates(t,i,!0)}var n=this._imageToViewportDelta(t,i);return n.x+=this._contentBoundsNoRotate.x,n.y+=this._contentBoundsNoRotate.y,n},imageToViewportRectangle:function(t,i,r,n){var s=t;if(s instanceof e.Rect||(s=new e.Rect(t,i,r,n)),this.viewer){var o=this.viewer.world.getItemCount();if(o>1)e.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===o)return this.viewer.world.getItemAt(0).imageToViewportRectangle(t,i,r,n,!0)}var a=this.imageToViewportCoordinates(s.x,s.y),l=this._imageToViewportDelta(s.width,s.height);return new e.Rect(a.x,a.y,l.x,l.y,s.degrees)},viewportToImageRectangle:function(t,i,r,n){var s=t;if(s instanceof e.Rect||(s=new e.Rect(t,i,r,n)),this.viewer){var o=this.viewer.world.getItemCount();if(o>1)e.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===o)return this.viewer.world.getItemAt(0).viewportToImageRectangle(t,i,r,n,!0)}var a=this.viewportToImageCoordinates(s.x,s.y),l=this._viewportToImageDelta(s.width,s.height);return new e.Rect(a.x,a.y,l.x,l.y,s.degrees)},viewerElementToImageCoordinates:function(e){var t=this.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.pixelFromPoint(t,!0)},windowToImageCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var i=t.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(i)},imageToWindowCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(t).plus(e.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(e){return this.pointFromPixel(e,!0)},viewportToViewerElementCoordinates:function(e){return this.pixelFromPoint(e,!0)},viewerElementToViewportRectangle:function(t){return e.Rect.fromSummits(this.pointFromPixel(t.getTopLeft(),!0),this.pointFromPixel(t.getTopRight(),!0),this.pointFromPixel(t.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(t){return e.Rect.fromSummits(this.pixelFromPoint(t.getTopLeft(),!0),this.pixelFromPoint(t.getTopRight(),!0),this.pixelFromPoint(t.getBottomLeft(),!0))},windowToViewportCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var i=t.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(i)},viewportToWindowCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(t).plus(e.getElementPosition(this.viewer.element))},viewportToImageZoom:function(t){if(this.viewer){var i=this.viewer.world.getItemCount();if(i>1)e.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===i)return this.viewer.world.getItemAt(0).viewportToImageZoom(t)}var r=this._contentSizeNoRotate.x;return t*(this._containerInnerSize.x/r*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(t){if(this.viewer){var i=this.viewer.world.getItemCount();if(i>1)e.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===i)return this.viewer.world.getItemAt(0).imageToViewportZoom(t)}return t*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(e){return this.flipped===e||(this.flipped=e,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:e})),this}}}(OpenSeadragon),function(e){function t(e,t,r,n,s,o,l,c,u){var h=l.getBoundingBox().getTopLeft(),d=l.getBoundingBox().getBottomRight();e.viewer&&e.viewer.raiseEvent("update-level",{tiledImage:e,havedrawn:t,level:n,opacity:s,visibility:o,drawArea:l,topleft:h,bottomright:d,currenttime:c,best:u}),a(e.coverage,n),a(e.loadingCoverage,n);for(var f=e._getCornerTiles(n,h,d),p=f.topLeft,g=f.bottomRight,m=e.source.getNumTiles(n),v=e.viewport.pixelFromPoint(e.viewport.getCenter()),y=p.x;y<=g.x;y++)for(var w=p.y;w<=g.y;w++){if(!e.wrapHorizontal&&!e.wrapVertical){var E=e.source.getTileBounds(n,y,w);if(null===l.intersection(E))continue}u=i(e,r,t,y,w,n,s,o,v,m,c,u)}return u}function i(t,i,n,a,l,c,u,h,d,f,p,g){var m=function(t,i,r,n,s,o,a,l,c,u){var h,d,f,p,g,m,v,y,w;return o[r]||(o[r]={}),o[r][t]||(o[r][t]={}),o[r][t][i]||(h=(l.x+t%l.x)%l.x,d=(l.y+i%l.y)%l.y,f=s.getTileBounds(r,h,d),p=s.getTileBounds(r,h,d,!0),g=s.tileExists(r,h,d),m=s.getTileUrl(r,h,d),n.loadTilesWithAjax?(v=s.getTileAjaxHeaders(r,h,d),e.isPlainObject(n.ajaxHeaders)&&(v=e.extend({},n.ajaxHeaders,v))):v=null,y=s.getContext2D?s.getContext2D(r,h,d):void 0,f.x+=(t-h)/l.x,f.y+=u/c*((i-d)/l.y),w=new e.Tile(r,t,i,f,g,m,y,n.loadTilesWithAjax,v,p),h===l.x-1&&(w.isRightMost=!0),d===l.y-1&&(w.isBottomMost=!0),o[r][t][i]=w),(w=o[r][t][i]).lastTouchTime=a,w}(a,l,c,t,t.source,t.tilesMatrix,p,f,t._worldWidthCurrent,t._worldHeightCurrent),v=n;t.viewer&&t.viewer.raiseEvent("update-tile",{tiledImage:t,tile:m}),o(t.coverage,c,a,l,!1);var y=m.loaded||m.loading||s(t.loadingCoverage,c,a,l);if(o(t.loadingCoverage,c,a,l,y),!m.exists)return g;if(i&&!v&&(s(t.coverage,c,a,l)?o(t.coverage,c,a,l,!0):v=!0),!v)return g;if(function(t,i,r,n,s,o){var a=t.bounds.getTopLeft();a.x*=o._scaleSpring.current.value,a.y*=o._scaleSpring.current.value,a.x+=o._xSpring.current.value,a.y+=o._ySpring.current.value;var l=t.bounds.getSize();l.x*=o._scaleSpring.current.value,l.y*=o._scaleSpring.current.value;var c=r.pixelFromPointNoRotate(a,!0),u=r.pixelFromPointNoRotate(a,!1),h=r.deltaPixelsFromPointsNoRotate(l,!0),d=r.deltaPixelsFromPointsNoRotate(l,!1),f=u.plus(d.divide(2)),p=n.squaredDistanceTo(f);i||(h=h.plus(new e.Point(1,1))),t.isRightMost&&o.wrapHorizontal&&(h.x+=.75),t.isBottomMost&&o.wrapVertical&&(h.y+=.75),t.position=c,t.size=h,t.squaredDistance=p,t.visibility=s}(m,t.source.tileOverlap,t.viewport,d,h,t),!m.loaded)if(m.context2D)r(t,m);else{var w=t._tileCache.getImageRecord(m.cacheKey);w&&r(t,m,w.getImage())}if(m.loaded){var E=function(e,t,i,r,n,s,a){var l,c,u=1e3*e.blendTime;if(t.blendStart||(t.blendStart=a),l=a-t.blendStart,c=u?Math.min(1,l/u):1,e.alwaysBlend&&(c*=s),t.opacity=c,e.lastDrawn.push(t),1===c)o(e.coverage,n,i,r,!0),e._hasOpaqueTile=!0;else if(l<u)return!0;return!1}(t,m,a,l,c,u,p);E&&(t._needsDraw=!0)}else m.loading?t._tilesLoading++:y||(g=function(e,t){return e?t.visibility>e.visibility||t.visibility==e.visibility&&t.squaredDistance<e.squaredDistance?t:e:t}(g,m));return g}function r(e,t,i,r,n){var s=0;function o(){return s++,a}function a(){0==--s&&(t.loading=!1,t.loaded=!0,t.context2D||e._tileCache.cacheTile({image:i,tile:t,cutoff:r,tiledImage:e}),e._needsDraw=!0)}e.viewer.raiseEvent("tile-loaded",{tile:t,tiledImage:e,tileRequest:n,image:i,getCompletionCallback:o}),o()()}function n(e,t,i,r){var n,s,o,a;if(!e[t])return!1;if(void 0===i||void 0===r){for(o in n=e[t])if(Object.prototype.hasOwnProperty.call(n,o))for(a in s=n[o])if(Object.prototype.hasOwnProperty.call(s,a)&&!s[a])return!1;return!0}return void 0===e[t][i]||void 0===e[t][i][r]||!0===e[t][i][r]}function s(e,t,i,r){return void 0===i||void 0===r?n(e,t+1):n(e,t+1,2*i,2*r)&&n(e,t+1,2*i,2*r+1)&&n(e,t+1,2*i+1,2*r)&&n(e,t+1,2*i+1,2*r+1)}function o(t,i,r,n,s){t[i]?(t[i][r]||(t[i][r]={}),t[i][r][n]=s):e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",i)}function a(e,t){e[t]={}}e.TiledImage=function(t){var i=this;e.console.assert(t.tileCache,"[TiledImage] options.tileCache is required"),e.console.assert(t.drawer,"[TiledImage] options.drawer is required"),e.console.assert(t.viewer,"[TiledImage] options.viewer is required"),e.console.assert(t.imageLoader,"[TiledImage] options.imageLoader is required"),e.console.assert(t.source,"[TiledImage] options.source is required"),e.console.assert(!t.clip||t.clip instanceof e.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),e.EventSource.call(this),this._tileCache=t.tileCache,delete t.tileCache,this._drawer=t.drawer,delete t.drawer,this._imageLoader=t.imageLoader,delete t.imageLoader,t.clip instanceof e.Rect&&(this._clip=t.clip.clone()),delete t.clip;var r=t.x||0;delete t.x;var n=t.y||0;delete t.y,this.normHeight=t.source.dimensions.y/t.source.dimensions.x,this.contentAspectX=t.source.dimensions.x/t.source.dimensions.y;var s=1;t.width?(s=t.width,delete t.width,t.height&&(e.console.error("specifying both width and height to a tiledImage is not supported"),delete t.height)):t.height&&(s=t.height/this.normHeight,delete t.height);var o=t.fitBounds;delete t.fitBounds;var a=t.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete t.fitBoundsPlacement;var l=t.degrees||0;delete t.degrees,e.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:e.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:e.DEFAULT_SETTINGS.iOSDevice,debugMode:e.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:e.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:e.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:e.DEFAULT_SETTINGS.placeholderFillStyle,opacity:e.DEFAULT_SETTINGS.opacity,preload:e.DEFAULT_SETTINGS.preload,compositeOperation:e.DEFAULT_SETTINGS.compositeOperation},t),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new e.Spring({initial:r,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new e.Spring({initial:n,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new e.Spring({initial:s,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new e.Spring({initial:l,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),o&&this.fitBounds(o,a,!0),this._drawingHandler=function(t){i.viewer.raiseEvent("tile-drawing",e.extend({tiledImage:i},t))}},e.extend(e.TiledImage.prototype,e.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(e){e!==this._fullyLoaded&&(this._fullyLoaded=e,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=e.now(),this._needsDraw=!0},update:function(){var e=this._xSpring.update(),t=this._ySpring.update(),i=this._scaleSpring.update(),r=this._degreesSpring.update();return!!(e||t||i||r)&&(this._updateForScale(),this._needsDraw=!0,!0)},draw:function(){0!==this.opacity||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(this.getRotation(e),this._getRotationPoint(e))},getBoundsNoRotate:function(t){return t?new e.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new e.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return e.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(t){var i=this.getBoundsNoRotate(t);if(this._clip){var r=(t?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x,n=this._clip.times(r);i=new e.Rect(i.x+n.x,i.y+n.y,n.width,n.height)}return i.rotate(this.getRotation(t),this._getRotationPoint(t))},getContentSize:function(){return new e.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(t,i,r){var n=r?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(t*(this.source.dimensions.x/n),i*(this.source.dimensions.y*this.contentAspectX/n))},viewportToImageCoordinates:function(t,i,r){var n;return t instanceof e.Point?(r=i,n=t):n=new e.Point(t,i),n=n.rotate(-this.getRotation(r),this._getRotationPoint(r)),r?this._viewportToImageDelta(n.x-this._xSpring.current.value,n.y-this._ySpring.current.value):this._viewportToImageDelta(n.x-this._xSpring.target.value,n.y-this._ySpring.target.value)},_imageToViewportDelta:function(t,i,r){var n=r?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(t/this.source.dimensions.x*n,i/this.source.dimensions.y/this.contentAspectX*n)},imageToViewportCoordinates:function(t,i,r){t instanceof e.Point&&(r=i,i=t.y,t=t.x);var n=this._imageToViewportDelta(t,i);return r?(n.x+=this._xSpring.current.value,n.y+=this._ySpring.current.value):(n.x+=this._xSpring.target.value,n.y+=this._ySpring.target.value),n.rotate(this.getRotation(r),this._getRotationPoint(r))},imageToViewportRectangle:function(t,i,r,n,s){var o=t;o instanceof e.Rect?s=i:o=new e.Rect(t,i,r,n);var a=this.imageToViewportCoordinates(o.getTopLeft(),s),l=this._imageToViewportDelta(o.width,o.height,s);return new e.Rect(a.x,a.y,l.x,l.y,o.degrees+this.getRotation(s))},viewportToImageRectangle:function(t,i,r,n,s){var o=t;t instanceof e.Rect?s=i:o=new e.Rect(t,i,r,n);var a=this.viewportToImageCoordinates(o.getTopLeft(),s),l=this._viewportToImageDelta(o.width,o.height,s);return new e.Rect(a.x,a.y,l.x,l.y,o.degrees-this.getRotation(s))},viewerElementToImageCoordinates:function(e){var t=this.viewport.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.viewport.pixelFromPoint(t,!0)},windowToImageCoordinates:function(e){var t=e.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(t)},imageToWindowCoordinates:function(e){return this.imageToViewerElementCoordinates(e).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(t){var i=this._scaleSpring.current.value;return t=t.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new e.Rect((t.x-this._xSpring.current.value)/i,(t.y-this._ySpring.current.value)/i,t.width/i,t.height/i,t.degrees)},viewportToImageZoom:function(e){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*e},imageToViewportZoom:function(e){return e/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(e,t){var i=this._xSpring.target.value===e.x&&this._ySpring.target.value===e.y;if(t){if(i&&this._xSpring.current.value===e.x&&this._ySpring.current.value===e.y)return;this._xSpring.resetTo(e.x),this._ySpring.resetTo(e.y),this._needsDraw=!0}else{if(i)return;this._xSpring.springTo(e.x),this._ySpring.springTo(e.y),this._needsDraw=!0}i||this._raiseBoundsChange()},setWidth:function(e,t){this._setScale(e,t)},setHeight:function(e,t){this._setScale(e/this.normHeight,t)},setCroppingPolygons:function(t){try{if(!e.isArray(t))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=t.map((function(t){return t.map((function(t){try{if(function(t){return t instanceof e.Point||"number"==typeof t.x&&"number"==typeof t.y}(t))return{x:t.x,y:t.y};throw new Error}catch(e){throw new Error("A Provided cropping polygon point is not supported")}}))}))}catch(t){e.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),e.console.error(t),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(t,i,r){i=i||e.Placement.CENTER;var n=e.Placement.properties[i],s=this.contentAspectX,o=0,a=0,l=1,c=1;if(this._clip&&(s=this._clip.getAspectRatio(),l=this._clip.width/this.source.dimensions.x,c=this._clip.height/this.source.dimensions.y,t.getAspectRatio()>s?(o=this._clip.x/this._clip.height*t.height,a=this._clip.y/this._clip.height*t.height):(o=this._clip.x/this._clip.width*t.width,a=this._clip.y/this._clip.width*t.width)),t.getAspectRatio()>s){var u=t.height/c,h=0;n.isHorizontallyCentered?h=(t.width-t.height*s)/2:n.isRight&&(h=t.width-t.height*s),this.setPosition(new e.Point(t.x-o+h,t.y-a),r),this.setHeight(u,r)}else{var d=t.width/l,f=0;n.isVerticallyCentered?f=(t.height-t.width/s)/2:n.isBottom&&(f=t.height-t.width/s),this.setPosition(new e.Point(t.x-o,t.y-a+f),r),this.setWidth(d,r)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(t){e.console.assert(!t||t instanceof e.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),t instanceof e.Rect?this._clip=t.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(e){e!==this.opacity&&(this.opacity=e,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(e){this._preload=!!e,this._needsDraw=!0},getRotation:function(e){return e?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(e,t){this._degreesSpring.target.value===e&&this._degreesSpring.isAtTargetValue()||(t?this._degreesSpring.resetTo(e):this._degreesSpring.springTo(e),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(e){return this.getBoundsNoRotate(e).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(e){e!==this.compositeOperation&&(this.compositeOperation=e,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(e,t){var i=this._scaleSpring.target.value===e;if(t){if(i&&this._scaleSpring.current.value===e)return;this._scaleSpring.resetTo(e),this._updateForScale(),this._needsDraw=!0}else{if(i)return;this._scaleSpring.springTo(e),this._updateForScale(),this._needsDraw=!0}i||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var e=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),t=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,i=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(t/this.minPixelRatio)/Math.log(2))));return i=Math.max(i,this.source.minLevel||0),{lowestLevel:e=Math.min(e,i),highestLevel:i}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;)this.lastDrawn.pop().beingDrawn=!1;var i,s,o,a=this.viewport,l=this._viewportToTiledImageRectangle(a.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var c=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(l=l.intersection(c)))return}for(var u=this._getLevelsInterval(),h=u.lowestLevel,d=u.highestLevel,f=null,p=!1,g=e.now(),m=d;m>=h;m--){var v=!1,y=a.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(m),!0).x*this._scaleSpring.current.value;if(m===h||!p&&y>=this.minPixelRatio)v=!0,p=!0;else if(!p)continue;var w=a.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(m),!1).x*this._scaleSpring.current.value,E=a.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,b=this.immediateRender?1:E;if(f=t(this,p,v,m,Math.min(1,(y-.5)/.5),b/Math.abs(b-w),l,g,f),n(this.coverage,m))break}!function(t,i){if(0!==t.opacity&&(0!==i.length||t.placeholderFillStyle)){var r,n,s,o=i[0];o&&(r=t.opacity<1||t.compositeOperation&&"source-over"!==t.compositeOperation||!t._isBottomItem()&&o._hasTransparencyChannel());var a,l=t.viewport.getZoom(!0),c=t.viewportToImageZoom(l);i.length>1&&c>t.smoothTileEdgesMinZoom&&!t.iOSDevice&&t.getRotation(!0)%360==0&&e.supportsCanvas&&(r=!0,n=o.getScaleForEdgeSmoothing(),s=o.getTranslationForEdgeSmoothing(n,t._drawer.getCanvasSize(!1),t._drawer.getCanvasSize(!0))),r&&(n||(a=t.viewport.viewportToViewerElementRectangle(t.getClippedBounds(!0)).getIntegerBoundingBox(),t._drawer.viewer.viewport.getFlip()&&(0===t.viewport.degrees&&t.getRotation(!0)%360==0||(a.x=t._drawer.viewer.container.clientWidth-(a.x+a.width))),a=a.times(e.pixelDensityRatio)),t._drawer._clear(!0,a)),n||(0!==t.viewport.degrees&&t._drawer._offsetForRotation({degrees:t.viewport.degrees,useSketch:r}),t.getRotation(!0)%360!=0&&t._drawer._offsetForRotation({degrees:t.getRotation(!0),point:t.viewport.pixelFromPointNoRotate(t._getRotationPoint(!0),!0),useSketch:r}),0===t.viewport.degrees&&t.getRotation(!0)%360==0&&t._drawer.viewer.viewport.getFlip()&&t._drawer._flip());var u=!1;if(t._clip){t._drawer.saveContext(r);var h=t.imageToViewportRectangle(t._clip,!0);h=h.rotate(-t.getRotation(!0),t._getRotationPoint(!0));var d=t._drawer.viewportToDrawerRectangle(h);n&&(d=d.times(n)),s&&(d=d.translate(s)),t._drawer.setClip(d,r),u=!0}if(t._croppingPolygons){t._drawer.saveContext(r);try{var f=t._croppingPolygons.map((function(e){return e.map((function(e){var i=t.imageToViewportCoordinates(e.x,e.y,!0).rotate(-t.getRotation(!0),t._getRotationPoint(!0)),r=t._drawer.viewportCoordToDrawerCoord(i);return n&&(r=r.times(n)),r}))}));t._drawer.clipWithPolygons(f,r)}catch(t){e.console.error(t)}u=!0}if(t.placeholderFillStyle&&!1===t._hasOpaqueTile){var p=t._drawer.viewportToDrawerRectangle(t.getBounds(!0));n&&(p=p.times(n)),s&&(p=p.translate(s));var g;g="function"==typeof t.placeholderFillStyle?t.placeholderFillStyle(t,t._drawer.context):t.placeholderFillStyle,t._drawer.drawRectangle(p,g,r)}for(var m=i.length-1;m>=0;m--)o=i[m],t._drawer.drawTile(o,t._drawingHandler,r,n,s),o.beingDrawn=!0,t.viewer&&t.viewer.raiseEvent("tile-drawn",{tiledImage:t,tile:o});u&&t._drawer.restoreContext(r),n||(t.getRotation(!0)%360!=0&&t._drawer._restoreRotationChanges(r),0!==t.viewport.degrees&&t._drawer._restoreRotationChanges(r)),r&&(n&&(0!==t.viewport.degrees&&t._drawer._offsetForRotation({degrees:t.viewport.degrees,useSketch:!1}),t.getRotation(!0)%360!=0&&t._drawer._offsetForRotation({degrees:t.getRotation(!0),point:t.viewport.pixelFromPointNoRotate(t._getRotationPoint(!0),!0),useSketch:!1})),t._drawer.blendSketch({opacity:t.opacity,scale:n,translate:s,compositeOperation:t.compositeOperation,bounds:a}),n&&(t.getRotation(!0)%360!=0&&t._drawer._restoreRotationChanges(!1),0!==t.viewport.degrees&&t._drawer._restoreRotationChanges(!1))),n||0===t.viewport.degrees&&t.getRotation(!0)%360==0&&t._drawer.viewer.viewport.getFlip()&&t._drawer._flip(),function(t,i){if(t.debugMode)for(var r=i.length-1;r>=0;r--){var n=i[r];try{t._drawer.drawDebugInfo(n,i.length,r,t)}catch(t){e.console.error(t)}}}(t,i)}}(this,this.lastDrawn),f&&!f.context2D?(i=this,o=g,(s=f).loading=!0,i._imageLoader.addJob({src:s.url,loadWithAjax:s.loadWithAjax,ajaxHeaders:s.ajaxHeaders,crossOriginPolicy:i.crossOriginPolicy,ajaxWithCredentials:i.ajaxWithCredentials,callback:function(t,n,a){!function(t,i,n,s,o,a){if(!s)return e.console.log("Tile %s failed to load: %s - error: %s",i,i.url,o),t.viewer.raiseEvent("tile-load-failed",{tile:i,tiledImage:t,time:n,message:o,tileRequest:a}),i.loading=!1,void(i.exists=!1);if(n<t.lastResetTime)return e.console.log("Ignoring tile %s loaded before reset: %s",i,i.url),void(i.loading=!1);var l=function(){var e=t.source.getClosestLevel();r(t,i,s,e,a)};t._midDraw?window.setTimeout(l,1):l()}(i,s,o,t,n,a)},abort:function(){s.loading=!1}}),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(t,i,r){var n,s,o,a;this.wrapHorizontal?(n=e.positiveModulo(i.x,1),s=e.positiveModulo(r.x,1)):(n=Math.max(0,i.x),s=Math.min(1,r.x));var l=1/this.source.aspectRatio;this.wrapVertical?(o=e.positiveModulo(i.y,l),a=e.positiveModulo(r.y,l)):(o=Math.max(0,i.y),a=Math.min(l,r.y));var c=this.source.getTileAtPoint(t,new e.Point(n,o)),u=this.source.getTileAtPoint(t,new e.Point(s,a)),h=this.source.getNumTiles(t);return this.wrapHorizontal&&(c.x+=h.x*Math.floor(i.x),u.x+=h.x*Math.floor(r.x)),this.wrapVertical&&(c.y+=h.y*Math.floor(i.y/l),u.y+=h.y*Math.floor(r.y/l)),{topLeft:c,bottomRight:u}}})}(OpenSeadragon),function(e){var t=function(t){e.console.assert(t,"[TileCache.cacheTile] options is required"),e.console.assert(t.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(t.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=t.tile,this.tiledImage=t.tiledImage},i=function(t){e.console.assert(t,"[ImageRecord] options is required"),e.console.assert(t.image,"[ImageRecord] options.image is required"),this._image=t.image,this._tiles=[]};i.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var e=document.createElement("canvas");e.width=this._image.width,e.height=this._image.height,this._renderedContext=e.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(t){e.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=t},addTile:function(t){e.console.assert(t,"[ImageRecord.addTile] tile is required"),this._tiles.push(t)},removeTile:function(t){for(var i=0;i<this._tiles.length;i++)if(this._tiles[i]===t)return void this._tiles.splice(i,1);e.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",t)},getTileCount:function(){return this._tiles.length}},e.TileCache=function(t){t=t||{},this._maxImageCacheCount=t.maxImageCacheCount||e.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},e.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(r){e.console.assert(r,"[TileCache.cacheTile] options is required"),e.console.assert(r.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(r.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),e.console.assert(r.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var n=r.cutoff||0,s=this._tilesLoaded.length,o=this._imagesLoaded[r.tile.cacheKey];if(o||(e.console.assert(r.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),o=this._imagesLoaded[r.tile.cacheKey]=new i({image:r.image}),this._imagesLoadedCount++),o.addTile(r.tile),r.tile.cacheImageRecord=o,this._imagesLoadedCount>this._maxImageCacheCount){for(var a,l,c,u,h,d,f=null,p=-1,g=null,m=this._tilesLoaded.length-1;m>=0;m--)(a=(d=this._tilesLoaded[m]).tile).level<=n||a.beingDrawn||(f?(u=a.lastTouchTime,l=f.lastTouchTime,h=a.level,c=f.level,(u<l||u==l&&h>c)&&(f=a,p=m,g=d)):(f=a,p=m,g=d));f&&p>=0&&(this._unloadTile(g),s=p)}this._tilesLoaded[s]=new t({tile:r.tile,tiledImage:r.tiledImage})},clearTilesFor:function(t){var i;e.console.assert(t,"[TileCache.clearTilesFor] tiledImage is required");for(var r=0;r<this._tilesLoaded.length;++r)(i=this._tilesLoaded[r]).tiledImage===t&&(this._unloadTile(i),this._tilesLoaded.splice(r,1),r--)},getImageRecord:function(t){return e.console.assert(t,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[t]},_unloadTile:function(t){e.console.assert(t,"[TileCache._unloadTile] tileRecord is required");var i=t.tile,r=t.tiledImage;i.unload(),i.cacheImageRecord=null;var n=this._imagesLoaded[i.cacheKey];n.removeTile(i),n.getTileCount()||(n.destroy(),delete this._imagesLoaded[i.cacheKey],this._imagesLoadedCount--),r.viewer.raiseEvent("tile-unloaded",{tile:i,tiledImage:r})}}}(OpenSeadragon),function(e){e.World=function(t){var i=this;e.console.assert(t.viewer,"[World] options.viewer is required"),e.EventSource.call(this),this.viewer=t.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(e){i._autoRefigureSizes?i._figureSizes():i._needsSizesFigured=!0},this._figureSizes()},e.extend(e.World.prototype,e.EventSource.prototype,{addItem:function(t,i){if(e.console.assert(t,"[World.addItem] item is required"),e.console.assert(t instanceof e.TiledImage,"[World.addItem] only TiledImages supported at this time"),void 0!==(i=i||{}).index){var r=Math.max(0,Math.min(this._items.length,i.index));this._items.splice(r,0,t)}else this._items.push(t);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,t.addHandler("bounds-change",this._delegatedFigureSizes),t.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:t})},getItemAt:function(t){return e.console.assert(void 0!==t,"[World.getItemAt] index is required"),this._items[t]},getIndexOfItem:function(t){return e.console.assert(t,"[World.getIndexOfItem] item is required"),e.indexOf(this._items,t)},getItemCount:function(){return this._items.length},setItemIndex:function(t,i){e.console.assert(t,"[World.setItemIndex] item is required"),e.console.assert(void 0!==i,"[World.setItemIndex] index is required");var r=this.getIndexOfItem(t);if(i>=this._items.length)throw new Error("Index bigger than number of layers.");i!==r&&-1!==r&&(this._items.splice(r,1),this._items.splice(i,0,t),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:t,previousIndex:r,newIndex:i}))},removeItem:function(t){e.console.assert(t,"[World.removeItem] item is required");var i=e.indexOf(this._items,t);-1!==i&&(t.removeHandler("bounds-change",this._delegatedFigureSizes),t.removeHandler("clip-change",this._delegatedFigureSizes),t.destroy(),this._items.splice(i,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(t))},removeAll:function(){var e,t;for(this.viewer._cancelPendingImages(),t=0;t<this._items.length;t++)(e=this._items[t]).removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy();var i=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,t=0;t<i.length;t++)e=i[t],this._raiseRemoveItem(e)},resetItems:function(){for(var e=0;e<this._items.length;e++)this._items[e].reset()},update:function(){for(var e=!1,t=0;t<this._items.length;t++)e=this._items[t].update()||e;return e},draw:function(){for(var e=0;e<this._items.length;e++)this._items[e].draw();this._needsDraw=!1},needsDraw:function(){for(var e=0;e<this._items.length;e++)if(this._items[e].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(e){this._autoRefigureSizes=e,e&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(t){var i,r=(t=t||{}).immediately||!1,n=t.layout||e.DEFAULT_SETTINGS.collectionLayout,s=t.rows||e.DEFAULT_SETTINGS.collectionRows,o=t.columns||e.DEFAULT_SETTINGS.collectionColumns,a=t.tileSize||e.DEFAULT_SETTINGS.collectionTileSize,l=a+(t.tileMargin||e.DEFAULT_SETTINGS.collectionTileMargin);i=!t.rows&&o?o:Math.ceil(this._items.length/s);var c,u,h,d,f,p=0,g=0;this.setAutoRefigureSizes(!1);for(var m=0;m<this._items.length;m++)m&&m%i==0&&("horizontal"===n?(g+=l,p=0):(p+=l,g=0)),d=(h=(u=(c=this._items[m]).getBounds()).width>u.height?a:a*(u.width/u.height))*(u.height/u.width),f=new e.Point(p+(a-h)/2,g+(a-d)/2),c.setPosition(f,r),c.setWidth(h,r),"horizontal"===n?p+=l:g+=l;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var t=this._homeBounds?this._homeBounds.clone():null,i=this._contentSize?this._contentSize.clone():null,r=this._contentFactor||0;if(this._items.length){var n=this._items[0],s=n.getBounds();this._contentFactor=n.getContentSize().x/s.width;for(var o=n.getClippedBounds().getBoundingBox(),a=o.x,l=o.y,c=o.x+o.width,u=o.y+o.height,h=1;h<this._items.length;h++)s=(n=this._items[h]).getBounds(),this._contentFactor=Math.max(this._contentFactor,n.getContentSize().x/s.width),o=n.getClippedBounds().getBoundingBox(),a=Math.min(a,o.x),l=Math.min(l,o.y),c=Math.max(c,o.x+o.width),u=Math.max(u,o.y+o.height);this._homeBounds=new e.Rect(a,l,c-a,u-l),this._contentSize=new e.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new e.Rect(0,0,1,1),this._contentSize=new e.Point(1,1),this._contentFactor=1;this._contentFactor===r&&this._homeBounds.equals(t)&&this._contentSize.equals(i)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(e){this.raiseEvent("remove-item",{item:e})}})}(OpenSeadragon)},9430:function(e,t){var i,r;void 0===(r="function"==typeof(i=function(){return function(e){function t(e){return" "===e||"\t"===e||"\n"===e||"\f"===e||"\r"===e}function i(t){var i,r=t.exec(e.substring(g));if(r)return i=r[0],g+=i.length,i}for(var r,n,s,o,a,l=e.length,c=/^[ \t\n\r\u000c]+/,u=/^[, \t\n\r\u000c]+/,h=/^[^ \t\n\r\u000c]+/,d=/[,]+$/,f=/^\d+$/,p=/^-?(?:[0-9]+|[0-9]*\.[0-9]+)(?:[eE][+-]?[0-9]+)?$/,g=0,m=[];;){if(i(u),g>=l)return m;r=i(h),n=[],","===r.slice(-1)?(r=r.replace(d,""),y()):v()}function v(){for(i(c),s="",o="in descriptor";;){if(a=e.charAt(g),"in descriptor"===o)if(t(a))s&&(n.push(s),s="",o="after descriptor");else{if(","===a)return g+=1,s&&n.push(s),void y();if("("===a)s+=a,o="in parens";else{if(""===a)return s&&n.push(s),void y();s+=a}}else if("in parens"===o)if(")"===a)s+=a,o="in descriptor";else{if(""===a)return n.push(s),void y();s+=a}else if("after descriptor"===o)if(t(a));else{if(""===a)return void y();o="in descriptor",g-=1}g+=1}}function y(){var t,i,s,o,a,l,c,u,h,d=!1,g={};for(o=0;o<n.length;o++)l=(a=n[o])[a.length-1],c=a.substring(0,a.length-1),u=parseInt(c,10),h=parseFloat(c),f.test(c)&&"w"===l?((t||i)&&(d=!0),0===u?d=!0:t=u):p.test(c)&&"x"===l?((t||i||s)&&(d=!0),h<0?d=!0:i=h):f.test(c)&&"h"===l?((s||i)&&(d=!0),0===u?d=!0:s=u):d=!0;d?console&&console.log&&console.log("Invalid srcset descriptor found in '"+e+"' at '"+a+"'."):(g.url=r,t&&(g.w=t),i&&(g.d=i),s&&(g.h=s),m.push(g))}}})?i.apply(t,[]):i)||(e.exports=r)},4241:e=>{var t=String,i=function(){return{isColorSupported:!1,reset:t,bold:t,dim:t,italic:t,underline:t,inverse:t,hidden:t,strikethrough:t,black:t,red:t,green:t,yellow:t,blue:t,magenta:t,cyan:t,white:t,gray:t,bgBlack:t,bgRed:t,bgGreen:t,bgYellow:t,bgBlue:t,bgMagenta:t,bgCyan:t,bgWhite:t}};e.exports=i(),e.exports.createColors=i},1353:(e,t,i)=>{"use strict";let r=i(1019);class n extends r{constructor(e){super(e),this.type="atrule"}append(...e){return this.proxyOf.nodes||(this.nodes=[]),super.append(...e)}prepend(...e){return this.proxyOf.nodes||(this.nodes=[]),super.prepend(...e)}}e.exports=n,n.default=n,r.registerAtRule(n)},9932:(e,t,i)=>{"use strict";let r=i(5631);class n extends r{constructor(e){super(e),this.type="comment"}}e.exports=n,n.default=n},1019:(e,t,i)=>{"use strict";let r,n,s,o,{isClean:a,my:l}=i(5513),c=i(4258),u=i(9932),h=i(5631);function d(e){return e.map((e=>(e.nodes&&(e.nodes=d(e.nodes)),delete e.source,e)))}function f(e){if(e[a]=!1,e.proxyOf.nodes)for(let t of e.proxyOf.nodes)f(t)}class p extends h{append(...e){for(let t of e){let e=this.normalize(t,this.last);for(let t of e)this.proxyOf.nodes.push(t)}return this.markDirty(),this}cleanRaws(e){if(super.cleanRaws(e),this.nodes)for(let t of this.nodes)t.cleanRaws(e)}each(e){if(!this.proxyOf.nodes)return;let t,i,r=this.getIterator();for(;this.indexes[r]<this.proxyOf.nodes.length&&(t=this.indexes[r],i=e(this.proxyOf.nodes[t],t),!1!==i);)this.indexes[r]+=1;return delete this.indexes[r],i}every(e){return this.nodes.every(e)}getIterator(){this.lastEach||(this.lastEach=0),this.indexes||(this.indexes={}),this.lastEach+=1;let e=this.lastEach;return this.indexes[e]=0,e}getProxyProcessor(){return{get:(e,t)=>"proxyOf"===t?e:e[t]?"each"===t||"string"==typeof t&&t.startsWith("walk")?(...i)=>e[t](...i.map((e=>"function"==typeof e?(t,i)=>e(t.toProxy(),i):e))):"every"===t||"some"===t?i=>e[t](((e,...t)=>i(e.toProxy(),...t))):"root"===t?()=>e.root().toProxy():"nodes"===t?e.nodes.map((e=>e.toProxy())):"first"===t||"last"===t?e[t].toProxy():e[t]:e[t],set:(e,t,i)=>(e[t]===i||(e[t]=i,"name"!==t&&"params"!==t&&"selector"!==t||e.markDirty()),!0)}}index(e){return"number"==typeof e?e:(e.proxyOf&&(e=e.proxyOf),this.proxyOf.nodes.indexOf(e))}insertAfter(e,t){let i,r=this.index(e),n=this.normalize(t,this.proxyOf.nodes[r]).reverse();r=this.index(e);for(let e of n)this.proxyOf.nodes.splice(r+1,0,e);for(let e in this.indexes)i=this.indexes[e],r<i&&(this.indexes[e]=i+n.length);return this.markDirty(),this}insertBefore(e,t){let i,r=this.index(e),n=0===r&&"prepend",s=this.normalize(t,this.proxyOf.nodes[r],n).reverse();r=this.index(e);for(let e of s)this.proxyOf.nodes.splice(r,0,e);for(let e in this.indexes)i=this.indexes[e],r<=i&&(this.indexes[e]=i+s.length);return this.markDirty(),this}normalize(e,t){if("string"==typeof e)e=d(r(e).nodes);else if(Array.isArray(e)){e=e.slice(0);for(let t of e)t.parent&&t.parent.removeChild(t,"ignore")}else if("root"===e.type&&"document"!==this.type){e=e.nodes.slice(0);for(let t of e)t.parent&&t.parent.removeChild(t,"ignore")}else if(e.type)e=[e];else if(e.prop){if(void 0===e.value)throw new Error("Value field is missed in node creation");"string"!=typeof e.value&&(e.value=String(e.value)),e=[new c(e)]}else if(e.selector)e=[new n(e)];else if(e.name)e=[new s(e)];else{if(!e.text)throw new Error("Unknown node type in node creation");e=[new u(e)]}return e.map((e=>(e[l]||p.rebuild(e),(e=e.proxyOf).parent&&e.parent.removeChild(e),e[a]&&f(e),void 0===e.raws.before&&t&&void 0!==t.raws.before&&(e.raws.before=t.raws.before.replace(/\S/g,"")),e.parent=this.proxyOf,e)))}prepend(...e){e=e.reverse();for(let t of e){let e=this.normalize(t,this.first,"prepend").reverse();for(let t of e)this.proxyOf.nodes.unshift(t);for(let t in this.indexes)this.indexes[t]=this.indexes[t]+e.length}return this.markDirty(),this}push(e){return e.parent=this,this.proxyOf.nodes.push(e),this}removeAll(){for(let e of this.proxyOf.nodes)e.parent=void 0;return this.proxyOf.nodes=[],this.markDirty(),this}removeChild(e){let t;e=this.index(e),this.proxyOf.nodes[e].parent=void 0,this.proxyOf.nodes.splice(e,1);for(let i in this.indexes)t=this.indexes[i],t>=e&&(this.indexes[i]=t-1);return this.markDirty(),this}replaceValues(e,t,i){return i||(i=t,t={}),this.walkDecls((r=>{t.props&&!t.props.includes(r.prop)||t.fast&&!r.value.includes(t.fast)||(r.value=r.value.replace(e,i))})),this.markDirty(),this}some(e){return this.nodes.some(e)}walk(e){return this.each(((t,i)=>{let r;try{r=e(t,i)}catch(e){throw t.addToError(e)}return!1!==r&&t.walk&&(r=t.walk(e)),r}))}walkAtRules(e,t){return t?e instanceof RegExp?this.walk(((i,r)=>{if("atrule"===i.type&&e.test(i.name))return t(i,r)})):this.walk(((i,r)=>{if("atrule"===i.type&&i.name===e)return t(i,r)})):(t=e,this.walk(((e,i)=>{if("atrule"===e.type)return t(e,i)})))}walkComments(e){return this.walk(((t,i)=>{if("comment"===t.type)return e(t,i)}))}walkDecls(e,t){return t?e instanceof RegExp?this.walk(((i,r)=>{if("decl"===i.type&&e.test(i.prop))return t(i,r)})):this.walk(((i,r)=>{if("decl"===i.type&&i.prop===e)return t(i,r)})):(t=e,this.walk(((e,i)=>{if("decl"===e.type)return t(e,i)})))}walkRules(e,t){return t?e instanceof RegExp?this.walk(((i,r)=>{if("rule"===i.type&&e.test(i.selector))return t(i,r)})):this.walk(((i,r)=>{if("rule"===i.type&&i.selector===e)return t(i,r)})):(t=e,this.walk(((e,i)=>{if("rule"===e.type)return t(e,i)})))}get first(){if(this.proxyOf.nodes)return this.proxyOf.nodes[0]}get last(){if(this.proxyOf.nodes)return this.proxyOf.nodes[this.proxyOf.nodes.length-1]}}p.registerParse=e=>{r=e},p.registerRule=e=>{n=e},p.registerAtRule=e=>{s=e},p.registerRoot=e=>{o=e},e.exports=p,p.default=p,p.rebuild=e=>{"atrule"===e.type?Object.setPrototypeOf(e,s.prototype):"rule"===e.type?Object.setPrototypeOf(e,n.prototype):"decl"===e.type?Object.setPrototypeOf(e,c.prototype):"comment"===e.type?Object.setPrototypeOf(e,u.prototype):"root"===e.type&&Object.setPrototypeOf(e,o.prototype),e[l]=!0,e.nodes&&e.nodes.forEach((e=>{p.rebuild(e)}))}},2671:(e,t,i)=>{"use strict";let r=i(4241),n=i(2868);class s extends Error{constructor(e,t,i,r,n,o){super(e),this.name="CssSyntaxError",this.reason=e,n&&(this.file=n),r&&(this.source=r),o&&(this.plugin=o),void 0!==t&&void 0!==i&&("number"==typeof t?(this.line=t,this.column=i):(this.line=t.line,this.column=t.column,this.endLine=i.line,this.endColumn=i.column)),this.setMessage(),Error.captureStackTrace&&Error.captureStackTrace(this,s)}setMessage(){this.message=this.plugin?this.plugin+": ":"",this.message+=this.file?this.file:"<css input>",void 0!==this.line&&(this.message+=":"+this.line+":"+this.column),this.message+=": "+this.reason}showSourceCode(e){if(!this.source)return"";let t=this.source;null==e&&(e=r.isColorSupported),n&&e&&(t=n(t));let i,s,o=t.split(/\r?\n/),a=Math.max(this.line-3,0),l=Math.min(this.line+2,o.length),c=String(l).length;if(e){let{bold:e,gray:t,red:n}=r.createColors(!0);i=t=>e(n(t)),s=e=>t(e)}else i=s=e=>e;return o.slice(a,l).map(((e,t)=>{let r=a+1+t,n=" "+(" "+r).slice(-c)+" | ";if(r===this.line){let t=s(n.replace(/\d/g," "))+e.slice(0,this.column-1).replace(/[^\t]/g," ");return i(">")+s(n)+e+"\n "+t+i("^")}return" "+s(n)+e})).join("\n")}toString(){let e=this.showSourceCode();return e&&(e="\n\n"+e+"\n"),this.name+": "+this.message+e}}e.exports=s,s.default=s},4258:(e,t,i)=>{"use strict";let r=i(5631);class n extends r{constructor(e){e&&void 0!==e.value&&"string"!=typeof e.value&&(e={...e,value:String(e.value)}),super(e),this.type="decl"}get variable(){return this.prop.startsWith("--")||"$"===this.prop[0]}}e.exports=n,n.default=n},6461:(e,t,i)=>{"use strict";let r,n,s=i(1019);class o extends s{constructor(e){super({type:"document",...e}),this.nodes||(this.nodes=[])}toResult(e={}){return new r(new n,this,e).stringify()}}o.registerLazyResult=e=>{r=e},o.registerProcessor=e=>{n=e},e.exports=o,o.default=o},250:(e,t,i)=>{"use strict";let r=i(4258),n=i(7981),s=i(9932),o=i(1353),a=i(5995),l=i(1025),c=i(1675);function u(e,t){if(Array.isArray(e))return e.map((e=>u(e)));let{inputs:i,...h}=e;if(i){t=[];for(let e of i){let i={...e,__proto__:a.prototype};i.map&&(i.map={...i.map,__proto__:n.prototype}),t.push(i)}}if(h.nodes&&(h.nodes=e.nodes.map((e=>u(e,t)))),h.source){let{inputId:e,...i}=h.source;h.source=i,null!=e&&(h.source.input=t[e])}if("root"===h.type)return new l(h);if("decl"===h.type)return new r(h);if("rule"===h.type)return new c(h);if("comment"===h.type)return new s(h);if("atrule"===h.type)return new o(h);throw new Error("Unknown node type: "+e.type)}e.exports=u,u.default=u},5995:(e,t,i)=>{"use strict";let{SourceMapConsumer:r,SourceMapGenerator:n}=i(209),{fileURLToPath:s,pathToFileURL:o}=i(7414),{isAbsolute:a,resolve:l}=i(9830),{nanoid:c}=i(2961),u=i(2868),h=i(2671),d=i(7981),f=Symbol("fromOffsetCache"),p=Boolean(r&&n),g=Boolean(l&&a);class m{constructor(e,t={}){if(null==e||"object"==typeof e&&!e.toString)throw new Error(`PostCSS received ${e} instead of CSS string`);if(this.css=e.toString(),"\ufeff"===this.css[0]||"￾"===this.css[0]?(this.hasBOM=!0,this.css=this.css.slice(1)):this.hasBOM=!1,t.from&&(!g||/^\w+:\/\//.test(t.from)||a(t.from)?this.file=t.from:this.file=l(t.from)),g&&p){let e=new d(this.css,t);if(e.text){this.map=e;let t=e.consumer().file;!this.file&&t&&(this.file=this.mapResolve(t))}}this.file||(this.id="<input css "+c(6)+">"),this.map&&(this.map.file=this.from)}error(e,t,i,r={}){let n,s,a;if(t&&"object"==typeof t){let e=t,r=i;if("number"==typeof e.offset){let r=this.fromOffset(e.offset);t=r.line,i=r.col}else t=e.line,i=e.column;if("number"==typeof r.offset){let e=this.fromOffset(r.offset);s=e.line,a=e.col}else s=r.line,a=r.column}else if(!i){let e=this.fromOffset(t);t=e.line,i=e.col}let l=this.origin(t,i,s,a);return n=l?new h(e,void 0===l.endLine?l.line:{column:l.column,line:l.line},void 0===l.endLine?l.column:{column:l.endColumn,line:l.endLine},l.source,l.file,r.plugin):new h(e,void 0===s?t:{column:i,line:t},void 0===s?i:{column:a,line:s},this.css,this.file,r.plugin),n.input={column:i,endColumn:a,endLine:s,line:t,source:this.css},this.file&&(o&&(n.input.url=o(this.file).toString()),n.input.file=this.file),n}fromOffset(e){let t,i;if(this[f])i=this[f];else{let e=this.css.split("\n");i=new Array(e.length);let t=0;for(let r=0,n=e.length;r<n;r++)i[r]=t,t+=e[r].length+1;this[f]=i}t=i[i.length-1];let r=0;if(e>=t)r=i.length-1;else{let t,n=i.length-2;for(;r<n;)if(t=r+(n-r>>1),e<i[t])n=t-1;else{if(!(e>=i[t+1])){r=t;break}r=t+1}}return{col:e-i[r]+1,line:r+1}}mapResolve(e){return/^\w+:\/\//.test(e)?e:l(this.map.consumer().sourceRoot||this.map.root||".",e)}origin(e,t,i,r){if(!this.map)return!1;let n,l,c=this.map.consumer(),u=c.originalPositionFor({column:t,line:e});if(!u.source)return!1;"number"==typeof i&&(n=c.originalPositionFor({column:r,line:i})),l=a(u.source)?o(u.source):new URL(u.source,this.map.consumer().sourceRoot||o(this.map.mapFile));let h={column:u.column,endColumn:n&&n.column,endLine:n&&n.line,line:u.line,url:l.toString()};if("file:"===l.protocol){if(!s)throw new Error("file: protocol is not available in this PostCSS build");h.file=s(l)}let d=c.sourceContentFor(u.source);return d&&(h.source=d),h}toJSON(){let e={};for(let t of["hasBOM","css","file","id"])null!=this[t]&&(e[t]=this[t]);return this.map&&(e.map={...this.map},e.map.consumerCache&&(e.map.consumerCache=void 0)),e}get from(){return this.file||this.id}}e.exports=m,m.default=m,u&&u.registerInput&&u.registerInput(m)},1939:(e,t,i)=>{"use strict";let{isClean:r,my:n}=i(5513),s=i(8505),o=i(7088),a=i(1019),l=i(6461),c=(i(2448),i(3632)),u=i(6939),h=i(1025);const d={atrule:"AtRule",comment:"Comment",decl:"Declaration",document:"Document",root:"Root",rule:"Rule"},f={AtRule:!0,AtRuleExit:!0,Comment:!0,CommentExit:!0,Declaration:!0,DeclarationExit:!0,Document:!0,DocumentExit:!0,Once:!0,OnceExit:!0,postcssPlugin:!0,prepare:!0,Root:!0,RootExit:!0,Rule:!0,RuleExit:!0},p={Once:!0,postcssPlugin:!0,prepare:!0},g=0;function m(e){return"object"==typeof e&&"function"==typeof e.then}function v(e){let t=!1,i=d[e.type];return"decl"===e.type?t=e.prop.toLowerCase():"atrule"===e.type&&(t=e.name.toLowerCase()),t&&e.append?[i,i+"-"+t,g,i+"Exit",i+"Exit-"+t]:t?[i,i+"-"+t,i+"Exit",i+"Exit-"+t]:e.append?[i,g,i+"Exit"]:[i,i+"Exit"]}function y(e){let t;return t="document"===e.type?["Document",g,"DocumentExit"]:"root"===e.type?["Root",g,"RootExit"]:v(e),{eventIndex:0,events:t,iterator:0,node:e,visitorIndex:0,visitors:[]}}function w(e){return e[r]=!1,e.nodes&&e.nodes.forEach((e=>w(e))),e}let E={};class b{constructor(e,t,i){let r;if(this.stringified=!1,this.processed=!1,"object"!=typeof t||null===t||"root"!==t.type&&"document"!==t.type)if(t instanceof b||t instanceof c)r=w(t.root),t.map&&(void 0===i.map&&(i.map={}),i.map.inline||(i.map.inline=!1),i.map.prev=t.map);else{let e=u;i.syntax&&(e=i.syntax.parse),i.parser&&(e=i.parser),e.parse&&(e=e.parse);try{r=e(t,i)}catch(e){this.processed=!0,this.error=e}r&&!r[n]&&a.rebuild(r)}else r=w(t);this.result=new c(e,r,i),this.helpers={...E,postcss:E,result:this.result},this.plugins=this.processor.plugins.map((e=>"object"==typeof e&&e.prepare?{...e,...e.prepare(this.result)}:e))}async(){return this.error?Promise.reject(this.error):this.processed?Promise.resolve(this.result):(this.processing||(this.processing=this.runAsync()),this.processing)}catch(e){return this.async().catch(e)}finally(e){return this.async().then(e,e)}getAsyncError(){throw new Error("Use process(css).then(cb) to work with async plugins")}handleError(e,t){let i=this.result.lastPlugin;try{t&&t.addToError(e),this.error=e,"CssSyntaxError"!==e.name||e.plugin?i.postcssVersion:(e.plugin=i.postcssPlugin,e.setMessage())}catch(e){console&&console.error&&console.error(e)}return e}prepareVisitors(){this.listeners={};let e=(e,t,i)=>{this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push([e,i])};for(let t of this.plugins)if("object"==typeof t)for(let i in t){if(!f[i]&&/^[A-Z]/.test(i))throw new Error(`Unknown event ${i} in ${t.postcssPlugin}. Try to update PostCSS (${this.processor.version} now).`);if(!p[i])if("object"==typeof t[i])for(let r in t[i])e(t,"*"===r?i:i+"-"+r.toLowerCase(),t[i][r]);else"function"==typeof t[i]&&e(t,i,t[i])}this.hasListener=Object.keys(this.listeners).length>0}async runAsync(){this.plugin=0;for(let e=0;e<this.plugins.length;e++){let t=this.plugins[e],i=this.runOnRoot(t);if(m(i))try{await i}catch(e){throw this.handleError(e)}}if(this.prepareVisitors(),this.hasListener){let e=this.result.root;for(;!e[r];){e[r]=!0;let t=[y(e)];for(;t.length>0;){let e=this.visitTick(t);if(m(e))try{await e}catch(e){let i=t[t.length-1].node;throw this.handleError(e,i)}}}if(this.listeners.OnceExit)for(let[t,i]of this.listeners.OnceExit){this.result.lastPlugin=t;try{if("document"===e.type){let t=e.nodes.map((e=>i(e,this.helpers)));await Promise.all(t)}else await i(e,this.helpers)}catch(e){throw this.handleError(e)}}}return this.processed=!0,this.stringify()}runOnRoot(e){this.result.lastPlugin=e;try{if("object"==typeof e&&e.Once){if("document"===this.result.root.type){let t=this.result.root.nodes.map((t=>e.Once(t,this.helpers)));return m(t[0])?Promise.all(t):t}return e.Once(this.result.root,this.helpers)}if("function"==typeof e)return e(this.result.root,this.result)}catch(e){throw this.handleError(e)}}stringify(){if(this.error)throw this.error;if(this.stringified)return this.result;this.stringified=!0,this.sync();let e=this.result.opts,t=o;e.syntax&&(t=e.syntax.stringify),e.stringifier&&(t=e.stringifier),t.stringify&&(t=t.stringify);let i=new s(t,this.result.root,this.result.opts).generate();return this.result.css=i[0],this.result.map=i[1],this.result}sync(){if(this.error)throw this.error;if(this.processed)return this.result;if(this.processed=!0,this.processing)throw this.getAsyncError();for(let e of this.plugins)if(m(this.runOnRoot(e)))throw this.getAsyncError();if(this.prepareVisitors(),this.hasListener){let e=this.result.root;for(;!e[r];)e[r]=!0,this.walkSync(e);if(this.listeners.OnceExit)if("document"===e.type)for(let t of e.nodes)this.visitSync(this.listeners.OnceExit,t);else this.visitSync(this.listeners.OnceExit,e)}return this.result}then(e,t){return this.async().then(e,t)}toString(){return this.css}visitSync(e,t){for(let[i,r]of e){let e;this.result.lastPlugin=i;try{e=r(t,this.helpers)}catch(e){throw this.handleError(e,t.proxyOf)}if("root"!==t.type&&"document"!==t.type&&!t.parent)return!0;if(m(e))throw this.getAsyncError()}}visitTick(e){let t=e[e.length-1],{node:i,visitors:n}=t;if("root"!==i.type&&"document"!==i.type&&!i.parent)return void e.pop();if(n.length>0&&t.visitorIndex<n.length){let[e,r]=n[t.visitorIndex];t.visitorIndex+=1,t.visitorIndex===n.length&&(t.visitors=[],t.visitorIndex=0),this.result.lastPlugin=e;try{return r(i.toProxy(),this.helpers)}catch(e){throw this.handleError(e,i)}}if(0!==t.iterator){let n,s=t.iterator;for(;n=i.nodes[i.indexes[s]];)if(i.indexes[s]+=1,!n[r])return n[r]=!0,void e.push(y(n));t.iterator=0,delete i.indexes[s]}let s=t.events;for(;t.eventIndex<s.length;){let e=s[t.eventIndex];if(t.eventIndex+=1,e===g)return void(i.nodes&&i.nodes.length&&(i[r]=!0,t.iterator=i.getIterator()));if(this.listeners[e])return void(t.visitors=this.listeners[e])}e.pop()}walkSync(e){e[r]=!0;let t=v(e);for(let i of t)if(i===g)e.nodes&&e.each((e=>{e[r]||this.walkSync(e)}));else{let t=this.listeners[i];if(t&&this.visitSync(t,e.toProxy()))return}}warnings(){return this.sync().warnings()}get content(){return this.stringify().content}get css(){return this.stringify().css}get map(){return this.stringify().map}get messages(){return this.sync().messages}get opts(){return this.result.opts}get processor(){return this.result.processor}get root(){return this.sync().root}get[Symbol.toStringTag](){return"LazyResult"}}b.registerPostcss=e=>{E=e},e.exports=b,b.default=b,h.registerLazyResult(b),l.registerLazyResult(b)},4715:e=>{"use strict";let t={comma:e=>t.split(e,[","],!0),space:e=>t.split(e,[" ","\n","\t"]),split(e,t,i){let r=[],n="",s=!1,o=0,a=!1,l="",c=!1;for(let i of e)c?c=!1:"\\"===i?c=!0:a?i===l&&(a=!1):'"'===i||"'"===i?(a=!0,l=i):"("===i?o+=1:")"===i?o>0&&(o-=1):0===o&&t.includes(i)&&(s=!0),s?(""!==n&&r.push(n.trim()),n="",s=!1):n+=i;return(i||""!==n)&&r.push(n.trim()),r}};e.exports=t,t.default=t},8505:(e,t,i)=>{"use strict";let{SourceMapConsumer:r,SourceMapGenerator:n}=i(209),{dirname:s,relative:o,resolve:a,sep:l}=i(9830),{pathToFileURL:c}=i(7414),u=i(5995),h=Boolean(r&&n),d=Boolean(s&&a&&o&&l);e.exports=class{constructor(e,t,i,r){this.stringify=e,this.mapOpts=i.map||{},this.root=t,this.opts=i,this.css=r,this.usesFileUrls=!this.mapOpts.from&&this.mapOpts.absolute,this.memoizedFileURLs=new Map,this.memoizedPaths=new Map,this.memoizedURLs=new Map}addAnnotation(){let e;e=this.isInline()?"data:application/json;base64,"+this.toBase64(this.map.toString()):"string"==typeof this.mapOpts.annotation?this.mapOpts.annotation:"function"==typeof this.mapOpts.annotation?this.mapOpts.annotation(this.opts.to,this.root):this.outputFile()+".map";let t="\n";this.css.includes("\r\n")&&(t="\r\n"),this.css+=t+"/*# sourceMappingURL="+e+" */"}applyPrevMaps(){for(let e of this.previous()){let t,i=this.toUrl(this.path(e.file)),n=e.root||s(e.file);!1===this.mapOpts.sourcesContent?(t=new r(e.text),t.sourcesContent&&(t.sourcesContent=t.sourcesContent.map((()=>null)))):t=e.consumer(),this.map.applySourceMap(t,i,this.toUrl(this.path(n)))}}clearAnnotation(){if(!1!==this.mapOpts.annotation)if(this.root){let e;for(let t=this.root.nodes.length-1;t>=0;t--)e=this.root.nodes[t],"comment"===e.type&&0===e.text.indexOf("# sourceMappingURL=")&&this.root.removeChild(t)}else this.css&&(this.css=this.css.replace(/(\n)?\/\*#[\S\s]*?\*\/$/gm,""))}generate(){if(this.clearAnnotation(),d&&h&&this.isMap())return this.generateMap();{let e="";return this.stringify(this.root,(t=>{e+=t})),[e]}}generateMap(){if(this.root)this.generateString();else if(1===this.previous().length){let e=this.previous()[0].consumer();e.file=this.outputFile(),this.map=n.fromSourceMap(e)}else this.map=new n({file:this.outputFile()}),this.map.addMapping({generated:{column:0,line:1},original:{column:0,line:1},source:this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>"});return this.isSourcesContent()&&this.setSourcesContent(),this.root&&this.previous().length>0&&this.applyPrevMaps(),this.isAnnotation()&&this.addAnnotation(),this.isInline()?[this.css]:[this.css,this.map]}generateString(){this.css="",this.map=new n({file:this.outputFile()});let e,t,i=1,r=1,s="<no source>",o={generated:{column:0,line:0},original:{column:0,line:0},source:""};this.stringify(this.root,((n,a,l)=>{if(this.css+=n,a&&"end"!==l&&(o.generated.line=i,o.generated.column=r-1,a.source&&a.source.start?(o.source=this.sourcePath(a),o.original.line=a.source.start.line,o.original.column=a.source.start.column-1,this.map.addMapping(o)):(o.source=s,o.original.line=1,o.original.column=0,this.map.addMapping(o))),e=n.match(/\n/g),e?(i+=e.length,t=n.lastIndexOf("\n"),r=n.length-t):r+=n.length,a&&"start"!==l){let e=a.parent||{raws:{}};("decl"===a.type||"atrule"===a.type&&!a.nodes)&&a===e.last&&!e.raws.semicolon||(a.source&&a.source.end?(o.source=this.sourcePath(a),o.original.line=a.source.end.line,o.original.column=a.source.end.column-1,o.generated.line=i,o.generated.column=r-2,this.map.addMapping(o)):(o.source=s,o.original.line=1,o.original.column=0,o.generated.line=i,o.generated.column=r-1,this.map.addMapping(o)))}}))}isAnnotation(){return!!this.isInline()||(void 0!==this.mapOpts.annotation?this.mapOpts.annotation:!this.previous().length||this.previous().some((e=>e.annotation)))}isInline(){if(void 0!==this.mapOpts.inline)return this.mapOpts.inline;let e=this.mapOpts.annotation;return(void 0===e||!0===e)&&(!this.previous().length||this.previous().some((e=>e.inline)))}isMap(){return void 0!==this.opts.map?!!this.opts.map:this.previous().length>0}isSourcesContent(){return void 0!==this.mapOpts.sourcesContent?this.mapOpts.sourcesContent:!this.previous().length||this.previous().some((e=>e.withContent()))}outputFile(){return this.opts.to?this.path(this.opts.to):this.opts.from?this.path(this.opts.from):"to.css"}path(e){if(this.mapOpts.absolute)return e;if(60===e.charCodeAt(0))return e;if(/^\w+:\/\//.test(e))return e;let t=this.memoizedPaths.get(e);if(t)return t;let i=this.opts.to?s(this.opts.to):".";"string"==typeof this.mapOpts.annotation&&(i=s(a(i,this.mapOpts.annotation)));let r=o(i,e);return this.memoizedPaths.set(e,r),r}previous(){if(!this.previousMaps)if(this.previousMaps=[],this.root)this.root.walk((e=>{if(e.source&&e.source.input.map){let t=e.source.input.map;this.previousMaps.includes(t)||this.previousMaps.push(t)}}));else{let e=new u(this.css,this.opts);e.map&&this.previousMaps.push(e.map)}return this.previousMaps}setSourcesContent(){let e={};if(this.root)this.root.walk((t=>{if(t.source){let i=t.source.input.from;if(i&&!e[i]){e[i]=!0;let r=this.usesFileUrls?this.toFileUrl(i):this.toUrl(this.path(i));this.map.setSourceContent(r,t.source.input.css)}}}));else if(this.css){let e=this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>";this.map.setSourceContent(e,this.css)}}sourcePath(e){return this.mapOpts.from?this.toUrl(this.mapOpts.from):this.usesFileUrls?this.toFileUrl(e.source.input.from):this.toUrl(this.path(e.source.input.from))}toBase64(e){return Buffer?Buffer.from(e).toString("base64"):window.btoa(unescape(encodeURIComponent(e)))}toFileUrl(e){let t=this.memoizedFileURLs.get(e);if(t)return t;if(c){let t=c(e).toString();return this.memoizedFileURLs.set(e,t),t}throw new Error("`map.absolute` option is not available in this PostCSS build")}toUrl(e){let t=this.memoizedURLs.get(e);if(t)return t;"\\"===l&&(e=e.replace(/\\/g,"/"));let i=encodeURI(e).replace(/[#?]/g,encodeURIComponent);return this.memoizedURLs.set(e,i),i}}},7647:(e,t,i)=>{"use strict";let r=i(8505),n=i(7088),s=(i(2448),i(6939));const o=i(3632);class a{constructor(e,t,i){let s;t=t.toString(),this.stringified=!1,this._processor=e,this._css=t,this._opts=i,this._map=void 0;let a=n;this.result=new o(this._processor,s,this._opts),this.result.css=t;let l=this;Object.defineProperty(this.result,"root",{get:()=>l.root});let c=new r(a,s,this._opts,t);if(c.isMap()){let[e,t]=c.generate();e&&(this.result.css=e),t&&(this.result.map=t)}}async(){return this.error?Promise.reject(this.error):Promise.resolve(this.result)}catch(e){return this.async().catch(e)}finally(e){return this.async().then(e,e)}sync(){if(this.error)throw this.error;return this.result}then(e,t){return this.async().then(e,t)}toString(){return this._css}warnings(){return[]}get content(){return this.result.css}get css(){return this.result.css}get map(){return this.result.map}get messages(){return[]}get opts(){return this.result.opts}get processor(){return this.result.processor}get root(){if(this._root)return this._root;let e,t=s;try{e=t(this._css,this._opts)}catch(e){this.error=e}if(this.error)throw this.error;return this._root=e,e}get[Symbol.toStringTag](){return"NoWorkResult"}}e.exports=a,a.default=a},5631:(e,t,i)=>{"use strict";let{isClean:r,my:n}=i(5513),s=i(2671),o=i(1062),a=i(7088);function l(e,t){let i=new e.constructor;for(let r in e){if(!Object.prototype.hasOwnProperty.call(e,r))continue;if("proxyCache"===r)continue;let n=e[r],s=typeof n;"parent"===r&&"object"===s?t&&(i[r]=t):"source"===r?i[r]=n:Array.isArray(n)?i[r]=n.map((e=>l(e,i))):("object"===s&&null!==n&&(n=l(n)),i[r]=n)}return i}class c{constructor(e={}){this.raws={},this[r]=!1,this[n]=!0;for(let t in e)if("nodes"===t){this.nodes=[];for(let i of e[t])"function"==typeof i.clone?this.append(i.clone()):this.append(i)}else this[t]=e[t]}addToError(e){if(e.postcssNode=this,e.stack&&this.source&&/\n\s{4}at /.test(e.stack)){let t=this.source;e.stack=e.stack.replace(/\n\s{4}at /,`$&${t.input.from}:${t.start.line}:${t.start.column}$&`)}return e}after(e){return this.parent.insertAfter(this,e),this}assign(e={}){for(let t in e)this[t]=e[t];return this}before(e){return this.parent.insertBefore(this,e),this}cleanRaws(e){delete this.raws.before,delete this.raws.after,e||delete this.raws.between}clone(e={}){let t=l(this);for(let i in e)t[i]=e[i];return t}cloneAfter(e={}){let t=this.clone(e);return this.parent.insertAfter(this,t),t}cloneBefore(e={}){let t=this.clone(e);return this.parent.insertBefore(this,t),t}error(e,t={}){if(this.source){let{end:i,start:r}=this.rangeBy(t);return this.source.input.error(e,{column:r.column,line:r.line},{column:i.column,line:i.line},t)}return new s(e)}getProxyProcessor(){return{get:(e,t)=>"proxyOf"===t?e:"root"===t?()=>e.root().toProxy():e[t],set:(e,t,i)=>(e[t]===i||(e[t]=i,"prop"!==t&&"value"!==t&&"name"!==t&&"params"!==t&&"important"!==t&&"text"!==t||e.markDirty()),!0)}}markDirty(){if(this[r]){this[r]=!1;let e=this;for(;e=e.parent;)e[r]=!1}}next(){if(!this.parent)return;let e=this.parent.index(this);return this.parent.nodes[e+1]}positionBy(e,t){let i=this.source.start;if(e.index)i=this.positionInside(e.index,t);else if(e.word){let r=(t=this.toString()).indexOf(e.word);-1!==r&&(i=this.positionInside(r,t))}return i}positionInside(e,t){let i=t||this.toString(),r=this.source.start.column,n=this.source.start.line;for(let t=0;t<e;t++)"\n"===i[t]?(r=1,n+=1):r+=1;return{column:r,line:n}}prev(){if(!this.parent)return;let e=this.parent.index(this);return this.parent.nodes[e-1]}rangeBy(e){let t={column:this.source.start.column,line:this.source.start.line},i=this.source.end?{column:this.source.end.column+1,line:this.source.end.line}:{column:t.column+1,line:t.line};if(e.word){let r=this.toString(),n=r.indexOf(e.word);-1!==n&&(t=this.positionInside(n,r),i=this.positionInside(n+e.word.length,r))}else e.start?t={column:e.start.column,line:e.start.line}:e.index&&(t=this.positionInside(e.index)),e.end?i={column:e.end.column,line:e.end.line}:e.endIndex?i=this.positionInside(e.endIndex):e.index&&(i=this.positionInside(e.index+1));return(i.line<t.line||i.line===t.line&&i.column<=t.column)&&(i={column:t.column+1,line:t.line}),{end:i,start:t}}raw(e,t){return(new o).raw(this,e,t)}remove(){return this.parent&&this.parent.removeChild(this),this.parent=void 0,this}replaceWith(...e){if(this.parent){let t=this,i=!1;for(let r of e)r===this?i=!0:i?(this.parent.insertAfter(t,r),t=r):this.parent.insertBefore(t,r);i||this.remove()}return this}root(){let e=this;for(;e.parent&&"document"!==e.parent.type;)e=e.parent;return e}toJSON(e,t){let i={},r=null==t;t=t||new Map;let n=0;for(let e in this){if(!Object.prototype.hasOwnProperty.call(this,e))continue;if("parent"===e||"proxyCache"===e)continue;let r=this[e];if(Array.isArray(r))i[e]=r.map((e=>"object"==typeof e&&e.toJSON?e.toJSON(null,t):e));else if("object"==typeof r&&r.toJSON)i[e]=r.toJSON(null,t);else if("source"===e){let s=t.get(r.input);null==s&&(s=n,t.set(r.input,n),n++),i[e]={end:r.end,inputId:s,start:r.start}}else i[e]=r}return r&&(i.inputs=[...t.keys()].map((e=>e.toJSON()))),i}toProxy(){return this.proxyCache||(this.proxyCache=new Proxy(this,this.getProxyProcessor())),this.proxyCache}toString(e=a){e.stringify&&(e=e.stringify);let t="";return e(this,(e=>{t+=e})),t}warn(e,t,i){let r={node:this};for(let e in i)r[e]=i[e];return e.warn(t,r)}get proxyOf(){return this}}e.exports=c,c.default=c},6939:(e,t,i)=>{"use strict";let r=i(1019),n=i(8867),s=i(5995);function o(e,t){let i=new s(e,t),r=new n(i);try{r.parse()}catch(e){throw e}return r.root}e.exports=o,o.default=o,r.registerParse(o)},8867:(e,t,i)=>{"use strict";let r=i(4258),n=i(3852),s=i(9932),o=i(1353),a=i(1025),l=i(1675);const c={empty:!0,space:!0};e.exports=class{constructor(e){this.input=e,this.root=new a,this.current=this.root,this.spaces="",this.semicolon=!1,this.customProperty=!1,this.createTokenizer(),this.root.source={input:e,start:{column:1,line:1,offset:0}}}atrule(e){let t,i,r,n=new o;n.name=e[1].slice(1),""===n.name&&this.unnamedAtrule(n,e),this.init(n,e[2]);let s=!1,a=!1,l=[],c=[];for(;!this.tokenizer.endOfFile();){if(t=(e=this.tokenizer.nextToken())[0],"("===t||"["===t?c.push("("===t?")":"]"):"{"===t&&c.length>0?c.push("}"):t===c[c.length-1]&&c.pop(),0===c.length){if(";"===t){n.source.end=this.getPosition(e[2]),n.source.end.offset++,this.semicolon=!0;break}if("{"===t){a=!0;break}if("}"===t){if(l.length>0){for(r=l.length-1,i=l[r];i&&"space"===i[0];)i=l[--r];i&&(n.source.end=this.getPosition(i[3]||i[2]),n.source.end.offset++)}this.end(e);break}l.push(e)}else l.push(e);if(this.tokenizer.endOfFile()){s=!0;break}}n.raws.between=this.spacesAndCommentsFromEnd(l),l.length?(n.raws.afterName=this.spacesAndCommentsFromStart(l),this.raw(n,"params",l),s&&(e=l[l.length-1],n.source.end=this.getPosition(e[3]||e[2]),n.source.end.offset++,this.spaces=n.raws.between,n.raws.between="")):(n.raws.afterName="",n.params=""),a&&(n.nodes=[],this.current=n)}checkMissedSemicolon(e){let t=this.colon(e);if(!1===t)return;let i,r=0;for(let n=t-1;n>=0&&(i=e[n],"space"===i[0]||(r+=1,2!==r));n--);throw this.input.error("Missed semicolon","word"===i[0]?i[3]+1:i[2])}colon(e){let t,i,r,n=0;for(let[s,o]of e.entries()){if(t=o,i=t[0],"("===i&&(n+=1),")"===i&&(n-=1),0===n&&":"===i){if(r){if("word"===r[0]&&"progid"===r[1])continue;return s}this.doubleColon(t)}r=t}return!1}comment(e){let t=new s;this.init(t,e[2]),t.source.end=this.getPosition(e[3]||e[2]),t.source.end.offset++;let i=e[1].slice(2,-2);if(/^\s*$/.test(i))t.text="",t.raws.left=i,t.raws.right="";else{let e=i.match(/^(\s*)([^]*\S)(\s*)$/);t.text=e[2],t.raws.left=e[1],t.raws.right=e[3]}}createTokenizer(){this.tokenizer=n(this.input)}decl(e,t){let i=new r;this.init(i,e[0][2]);let n,s=e[e.length-1];for(";"===s[0]&&(this.semicolon=!0,e.pop()),i.source.end=this.getPosition(s[3]||s[2]||function(e){for(let t=e.length-1;t>=0;t--){let i=e[t],r=i[3]||i[2];if(r)return r}}(e)),i.source.end.offset++;"word"!==e[0][0];)1===e.length&&this.unknownWord(e),i.raws.before+=e.shift()[1];for(i.source.start=this.getPosition(e[0][2]),i.prop="";e.length;){let t=e[0][0];if(":"===t||"space"===t||"comment"===t)break;i.prop+=e.shift()[1]}for(i.raws.between="";e.length;){if(n=e.shift(),":"===n[0]){i.raws.between+=n[1];break}"word"===n[0]&&/\w/.test(n[1])&&this.unknownWord([n]),i.raws.between+=n[1]}"_"!==i.prop[0]&&"*"!==i.prop[0]||(i.raws.before+=i.prop[0],i.prop=i.prop.slice(1));let o,a=[];for(;e.length&&(o=e[0][0],"space"===o||"comment"===o);)a.push(e.shift());this.precheckMissedSemicolon(e);for(let t=e.length-1;t>=0;t--){if(n=e[t],"!important"===n[1].toLowerCase()){i.important=!0;let r=this.stringFrom(e,t);r=this.spacesFromEnd(e)+r," !important"!==r&&(i.raws.important=r);break}if("important"===n[1].toLowerCase()){let r=e.slice(0),n="";for(let e=t;e>0;e--){let t=r[e][0];if(0===n.trim().indexOf("!")&&"space"!==t)break;n=r.pop()[1]+n}0===n.trim().indexOf("!")&&(i.important=!0,i.raws.important=n,e=r)}if("space"!==n[0]&&"comment"!==n[0])break}e.some((e=>"space"!==e[0]&&"comment"!==e[0]))&&(i.raws.between+=a.map((e=>e[1])).join(""),a=[]),this.raw(i,"value",a.concat(e),t),i.value.includes(":")&&!t&&this.checkMissedSemicolon(e)}doubleColon(e){throw this.input.error("Double colon",{offset:e[2]},{offset:e[2]+e[1].length})}emptyRule(e){let t=new l;this.init(t,e[2]),t.selector="",t.raws.between="",this.current=t}end(e){this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.semicolon=!1,this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.spaces="",this.current.parent?(this.current.source.end=this.getPosition(e[2]),this.current.source.end.offset++,this.current=this.current.parent):this.unexpectedClose(e)}endFile(){this.current.parent&&this.unclosedBlock(),this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.root.source.end=this.getPosition(this.tokenizer.position())}freeSemicolon(e){if(this.spaces+=e[1],this.current.nodes){let e=this.current.nodes[this.current.nodes.length-1];e&&"rule"===e.type&&!e.raws.ownSemicolon&&(e.raws.ownSemicolon=this.spaces,this.spaces="")}}getPosition(e){let t=this.input.fromOffset(e);return{column:t.col,line:t.line,offset:e}}init(e,t){this.current.push(e),e.source={input:this.input,start:this.getPosition(t)},e.raws.before=this.spaces,this.spaces="","comment"!==e.type&&(this.semicolon=!1)}other(e){let t=!1,i=null,r=!1,n=null,s=[],o=e[1].startsWith("--"),a=[],l=e;for(;l;){if(i=l[0],a.push(l),"("===i||"["===i)n||(n=l),s.push("("===i?")":"]");else if(o&&r&&"{"===i)n||(n=l),s.push("}");else if(0===s.length){if(";"===i){if(r)return void this.decl(a,o);break}if("{"===i)return void this.rule(a);if("}"===i){this.tokenizer.back(a.pop()),t=!0;break}":"===i&&(r=!0)}else i===s[s.length-1]&&(s.pop(),0===s.length&&(n=null));l=this.tokenizer.nextToken()}if(this.tokenizer.endOfFile()&&(t=!0),s.length>0&&this.unclosedBracket(n),t&&r){if(!o)for(;a.length&&(l=a[a.length-1][0],"space"===l||"comment"===l);)this.tokenizer.back(a.pop());this.decl(a,o)}else this.unknownWord(a)}parse(){let e;for(;!this.tokenizer.endOfFile();)switch(e=this.tokenizer.nextToken(),e[0]){case"space":this.spaces+=e[1];break;case";":this.freeSemicolon(e);break;case"}":this.end(e);break;case"comment":this.comment(e);break;case"at-word":this.atrule(e);break;case"{":this.emptyRule(e);break;default:this.other(e)}this.endFile()}precheckMissedSemicolon(){}raw(e,t,i,r){let n,s,o,a,l=i.length,u="",h=!0;for(let e=0;e<l;e+=1)n=i[e],s=n[0],"space"!==s||e!==l-1||r?"comment"===s?(a=i[e-1]?i[e-1][0]:"empty",o=i[e+1]?i[e+1][0]:"empty",c[a]||c[o]||","===u.slice(-1)?h=!1:u+=n[1]):u+=n[1]:h=!1;if(!h){let r=i.reduce(((e,t)=>e+t[1]),"");e.raws[t]={raw:r,value:u}}e[t]=u}rule(e){e.pop();let t=new l;this.init(t,e[0][2]),t.raws.between=this.spacesAndCommentsFromEnd(e),this.raw(t,"selector",e),this.current=t}spacesAndCommentsFromEnd(e){let t,i="";for(;e.length&&(t=e[e.length-1][0],"space"===t||"comment"===t);)i=e.pop()[1]+i;return i}spacesAndCommentsFromStart(e){let t,i="";for(;e.length&&(t=e[0][0],"space"===t||"comment"===t);)i+=e.shift()[1];return i}spacesFromEnd(e){let t,i="";for(;e.length&&(t=e[e.length-1][0],"space"===t);)i=e.pop()[1]+i;return i}stringFrom(e,t){let i="";for(let r=t;r<e.length;r++)i+=e[r][1];return e.splice(t,e.length-t),i}unclosedBlock(){let e=this.current.source.start;throw this.input.error("Unclosed block",e.line,e.column)}unclosedBracket(e){throw this.input.error("Unclosed bracket",{offset:e[2]},{offset:e[2]+1})}unexpectedClose(e){throw this.input.error("Unexpected }",{offset:e[2]},{offset:e[2]+1})}unknownWord(e){throw this.input.error("Unknown word",{offset:e[0][2]},{offset:e[0][2]+e[0][1].length})}unnamedAtrule(e,t){throw this.input.error("At-rule without name",{offset:t[2]},{offset:t[2]+t[1].length})}}},20:(e,t,i)=>{"use strict";let r=i(2671),n=i(4258),s=i(1939),o=i(1019),a=i(1723),l=i(7088),c=i(250),u=i(6461),h=i(1728),d=i(9932),f=i(1353),p=i(3632),g=i(5995),m=i(6939),v=i(4715),y=i(1675),w=i(1025),E=i(5631);function b(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),new a(e)}b.plugin=function(e,t){let i,r=!1;function n(...i){console&&console.warn&&!r&&(r=!0,console.warn(e+": postcss.plugin was deprecated. Migration guide:\nhttps://evilmartians.com/chronicles/postcss-8-plugin-migration"),process.env.LANG&&process.env.LANG.startsWith("cn")&&console.warn(e+": 里面 postcss.plugin 被弃用. 迁移指南:\nhttps://www.w3ctech.com/topic/2226"));let n=t(...i);return n.postcssPlugin=e,n.postcssVersion=(new a).version,n}return Object.defineProperty(n,"postcss",{get:()=>(i||(i=n()),i)}),n.process=function(e,t,i){return b([n(i)]).process(e,t)},n},b.stringify=l,b.parse=m,b.fromJSON=c,b.list=v,b.comment=e=>new d(e),b.atRule=e=>new f(e),b.decl=e=>new n(e),b.rule=e=>new y(e),b.root=e=>new w(e),b.document=e=>new u(e),b.CssSyntaxError=r,b.Declaration=n,b.Container=o,b.Processor=a,b.Document=u,b.Comment=d,b.Warning=h,b.AtRule=f,b.Result=p,b.Input=g,b.Rule=y,b.Root=w,b.Node=E,s.registerPostcss(b),e.exports=b,b.default=b},7981:(e,t,i)=>{"use strict";let{SourceMapConsumer:r,SourceMapGenerator:n}=i(209),{existsSync:s,readFileSync:o}=i(4777),{dirname:a,join:l}=i(9830);class c{constructor(e,t){if(!1===t.map)return;this.loadAnnotation(e),this.inline=this.startWith(this.annotation,"data:");let i=t.map?t.map.prev:void 0,r=this.loadMap(t.from,i);!this.mapFile&&t.from&&(this.mapFile=t.from),this.mapFile&&(this.root=a(this.mapFile)),r&&(this.text=r)}consumer(){return this.consumerCache||(this.consumerCache=new r(this.text)),this.consumerCache}decodeInline(e){if(/^data:application\/json;charset=utf-?8,/.test(e)||/^data:application\/json,/.test(e))return decodeURIComponent(e.substr(RegExp.lastMatch.length));if(/^data:application\/json;charset=utf-?8;base64,/.test(e)||/^data:application\/json;base64,/.test(e))return t=e.substr(RegExp.lastMatch.length),Buffer?Buffer.from(t,"base64").toString():window.atob(t);var t;let i=e.match(/data:application\/json;([^,]+),/)[1];throw new Error("Unsupported source map encoding "+i)}getAnnotationURL(e){return e.replace(/^\/\*\s*# sourceMappingURL=/,"").trim()}isMap(e){return"object"==typeof e&&("string"==typeof e.mappings||"string"==typeof e._mappings||Array.isArray(e.sections))}loadAnnotation(e){let t=e.match(/\/\*\s*# sourceMappingURL=/gm);if(!t)return;let i=e.lastIndexOf(t.pop()),r=e.indexOf("*/",i);i>-1&&r>-1&&(this.annotation=this.getAnnotationURL(e.substring(i,r)))}loadFile(e){if(this.root=a(e),s(e))return this.mapFile=e,o(e,"utf-8").toString().trim()}loadMap(e,t){if(!1===t)return!1;if(t){if("string"==typeof t)return t;if("function"!=typeof t){if(t instanceof r)return n.fromSourceMap(t).toString();if(t instanceof n)return t.toString();if(this.isMap(t))return JSON.stringify(t);throw new Error("Unsupported previous source map format: "+t.toString())}{let i=t(e);if(i){let e=this.loadFile(i);if(!e)throw new Error("Unable to load previous source map: "+i.toString());return e}}}else{if(this.inline)return this.decodeInline(this.annotation);if(this.annotation){let t=this.annotation;return e&&(t=l(a(e),t)),this.loadFile(t)}}}startWith(e,t){return!!e&&e.substr(0,t.length)===t}withContent(){return!!(this.consumer().sourcesContent&&this.consumer().sourcesContent.length>0)}}e.exports=c,c.default=c},1723:(e,t,i)=>{"use strict";let r=i(7647),n=i(1939),s=i(6461),o=i(1025);class a{constructor(e=[]){this.version="8.4.31",this.plugins=this.normalize(e)}normalize(e){let t=[];for(let i of e)if(!0===i.postcss?i=i():i.postcss&&(i=i.postcss),"object"==typeof i&&Array.isArray(i.plugins))t=t.concat(i.plugins);else if("object"==typeof i&&i.postcssPlugin)t.push(i);else if("function"==typeof i)t.push(i);else if("object"!=typeof i||!i.parse&&!i.stringify)throw new Error(i+" is not a PostCSS plugin");return t}process(e,t={}){return 0===this.plugins.length&&void 0===t.parser&&void 0===t.stringifier&&void 0===t.syntax?new r(this,e,t):new n(this,e,t)}use(e){return this.plugins=this.plugins.concat(this.normalize([e])),this}}e.exports=a,a.default=a,o.registerProcessor(a),s.registerProcessor(a)},3632:(e,t,i)=>{"use strict";let r=i(1728);class n{constructor(e,t,i){this.processor=e,this.messages=[],this.root=t,this.opts=i,this.css=void 0,this.map=void 0}toString(){return this.css}warn(e,t={}){t.plugin||this.lastPlugin&&this.lastPlugin.postcssPlugin&&(t.plugin=this.lastPlugin.postcssPlugin);let i=new r(e,t);return this.messages.push(i),i}warnings(){return this.messages.filter((e=>"warning"===e.type))}get content(){return this.css}}e.exports=n,n.default=n},1025:(e,t,i)=>{"use strict";let r,n,s=i(1019);class o extends s{constructor(e){super(e),this.type="root",this.nodes||(this.nodes=[])}normalize(e,t,i){let r=super.normalize(e);if(t)if("prepend"===i)this.nodes.length>1?t.raws.before=this.nodes[1].raws.before:delete t.raws.before;else if(this.first!==t)for(let e of r)e.raws.before=t.raws.before;return r}removeChild(e,t){let i=this.index(e);return!t&&0===i&&this.nodes.length>1&&(this.nodes[1].raws.before=this.nodes[i].raws.before),super.removeChild(e)}toResult(e={}){return new r(new n,this,e).stringify()}}o.registerLazyResult=e=>{r=e},o.registerProcessor=e=>{n=e},e.exports=o,o.default=o,s.registerRoot(o)},1675:(e,t,i)=>{"use strict";let r=i(1019),n=i(4715);class s extends r{constructor(e){super(e),this.type="rule",this.nodes||(this.nodes=[])}get selectors(){return n.comma(this.selector)}set selectors(e){let t=this.selector?this.selector.match(/,\s*/):null,i=t?t[0]:","+this.raw("between","beforeOpen");this.selector=e.join(i)}}e.exports=s,s.default=s,r.registerRule(s)},1062:e=>{"use strict";const t={after:"\n",beforeClose:"\n",beforeComment:"\n",beforeDecl:"\n",beforeOpen:" ",beforeRule:"\n",colon:": ",commentLeft:" ",commentRight:" ",emptyBody:"",indent:"    ",semicolon:!1};class i{constructor(e){this.builder=e}atrule(e,t){let i="@"+e.name,r=e.params?this.rawValue(e,"params"):"";if(void 0!==e.raws.afterName?i+=e.raws.afterName:r&&(i+=" "),e.nodes)this.block(e,i+r);else{let n=(e.raws.between||"")+(t?";":"");this.builder(i+r+n,e)}}beforeAfter(e,t){let i;i="decl"===e.type?this.raw(e,null,"beforeDecl"):"comment"===e.type?this.raw(e,null,"beforeComment"):"before"===t?this.raw(e,null,"beforeRule"):this.raw(e,null,"beforeClose");let r=e.parent,n=0;for(;r&&"root"!==r.type;)n+=1,r=r.parent;if(i.includes("\n")){let t=this.raw(e,null,"indent");if(t.length)for(let e=0;e<n;e++)i+=t}return i}block(e,t){let i,r=this.raw(e,"between","beforeOpen");this.builder(t+r+"{",e,"start"),e.nodes&&e.nodes.length?(this.body(e),i=this.raw(e,"after")):i=this.raw(e,"after","emptyBody"),i&&this.builder(i),this.builder("}",e,"end")}body(e){let t=e.nodes.length-1;for(;t>0&&"comment"===e.nodes[t].type;)t-=1;let i=this.raw(e,"semicolon");for(let r=0;r<e.nodes.length;r++){let n=e.nodes[r],s=this.raw(n,"before");s&&this.builder(s),this.stringify(n,t!==r||i)}}comment(e){let t=this.raw(e,"left","commentLeft"),i=this.raw(e,"right","commentRight");this.builder("/*"+t+e.text+i+"*/",e)}decl(e,t){let i=this.raw(e,"between","colon"),r=e.prop+i+this.rawValue(e,"value");e.important&&(r+=e.raws.important||" !important"),t&&(r+=";"),this.builder(r,e)}document(e){this.body(e)}raw(e,i,r){let n;if(r||(r=i),i&&(n=e.raws[i],void 0!==n))return n;let s=e.parent;if("before"===r){if(!s||"root"===s.type&&s.first===e)return"";if(s&&"document"===s.type)return""}if(!s)return t[r];let o=e.root();if(o.rawCache||(o.rawCache={}),void 0!==o.rawCache[r])return o.rawCache[r];if("before"===r||"after"===r)return this.beforeAfter(e,r);{let t="raw"+((a=r)[0].toUpperCase()+a.slice(1));this[t]?n=this[t](o,e):o.walk((e=>{if(n=e.raws[i],void 0!==n)return!1}))}var a;return void 0===n&&(n=t[r]),o.rawCache[r]=n,n}rawBeforeClose(e){let t;return e.walk((e=>{if(e.nodes&&e.nodes.length>0&&void 0!==e.raws.after)return t=e.raws.after,t.includes("\n")&&(t=t.replace(/[^\n]+$/,"")),!1})),t&&(t=t.replace(/\S/g,"")),t}rawBeforeComment(e,t){let i;return e.walkComments((e=>{if(void 0!==e.raws.before)return i=e.raws.before,i.includes("\n")&&(i=i.replace(/[^\n]+$/,"")),!1})),void 0===i?i=this.raw(t,null,"beforeDecl"):i&&(i=i.replace(/\S/g,"")),i}rawBeforeDecl(e,t){let i;return e.walkDecls((e=>{if(void 0!==e.raws.before)return i=e.raws.before,i.includes("\n")&&(i=i.replace(/[^\n]+$/,"")),!1})),void 0===i?i=this.raw(t,null,"beforeRule"):i&&(i=i.replace(/\S/g,"")),i}rawBeforeOpen(e){let t;return e.walk((e=>{if("decl"!==e.type&&(t=e.raws.between,void 0!==t))return!1})),t}rawBeforeRule(e){let t;return e.walk((i=>{if(i.nodes&&(i.parent!==e||e.first!==i)&&void 0!==i.raws.before)return t=i.raws.before,t.includes("\n")&&(t=t.replace(/[^\n]+$/,"")),!1})),t&&(t=t.replace(/\S/g,"")),t}rawColon(e){let t;return e.walkDecls((e=>{if(void 0!==e.raws.between)return t=e.raws.between.replace(/[^\s:]/g,""),!1})),t}rawEmptyBody(e){let t;return e.walk((e=>{if(e.nodes&&0===e.nodes.length&&(t=e.raws.after,void 0!==t))return!1})),t}rawIndent(e){if(e.raws.indent)return e.raws.indent;let t;return e.walk((i=>{let r=i.parent;if(r&&r!==e&&r.parent&&r.parent===e&&void 0!==i.raws.before){let e=i.raws.before.split("\n");return t=e[e.length-1],t=t.replace(/\S/g,""),!1}})),t}rawSemicolon(e){let t;return e.walk((e=>{if(e.nodes&&e.nodes.length&&"decl"===e.last.type&&(t=e.raws.semicolon,void 0!==t))return!1})),t}rawValue(e,t){let i=e[t],r=e.raws[t];return r&&r.value===i?r.raw:i}root(e){this.body(e),e.raws.after&&this.builder(e.raws.after)}rule(e){this.block(e,this.rawValue(e,"selector")),e.raws.ownSemicolon&&this.builder(e.raws.ownSemicolon,e,"end")}stringify(e,t){if(!this[e.type])throw new Error("Unknown AST node type "+e.type+". Maybe you need to change PostCSS stringifier.");this[e.type](e,t)}}e.exports=i,i.default=i},7088:(e,t,i)=>{"use strict";let r=i(1062);function n(e,t){new r(t).stringify(e)}e.exports=n,n.default=n},5513:e=>{"use strict";e.exports.isClean=Symbol("isClean"),e.exports.my=Symbol("my")},3852:e=>{"use strict";const t="'".charCodeAt(0),i='"'.charCodeAt(0),r="\\".charCodeAt(0),n="/".charCodeAt(0),s="\n".charCodeAt(0),o=" ".charCodeAt(0),a="\f".charCodeAt(0),l="\t".charCodeAt(0),c="\r".charCodeAt(0),u="[".charCodeAt(0),h="]".charCodeAt(0),d="(".charCodeAt(0),f=")".charCodeAt(0),p="{".charCodeAt(0),g="}".charCodeAt(0),m=";".charCodeAt(0),v="*".charCodeAt(0),y=":".charCodeAt(0),w="@".charCodeAt(0),E=/[\t\n\f\r "#'()/;[\\\]{}]/g,b=/[\t\n\f\r !"#'():;@[\\\]{}]|\/(?=\*)/g,T=/.[\r\n"'(/\\]/,S=/[\da-f]/i;e.exports=function(e,x={}){let R,C,A,k,L,I,P,_,D,O,M=e.css.valueOf(),F=x.ignoreErrors,N=M.length,B=0,U=[],$=[];function H(t){throw e.error("Unclosed "+t,B)}return{back:function(e){$.push(e)},endOfFile:function(){return 0===$.length&&B>=N},nextToken:function(e){if($.length)return $.pop();if(B>=N)return;let x=!!e&&e.ignoreUnclosed;switch(R=M.charCodeAt(B),R){case s:case o:case l:case c:case a:C=B;do{C+=1,R=M.charCodeAt(C)}while(R===o||R===s||R===l||R===c||R===a);O=["space",M.slice(B,C)],B=C-1;break;case u:case h:case p:case g:case y:case m:case f:{let e=String.fromCharCode(R);O=[e,e,B];break}case d:if(_=U.length?U.pop()[1]:"",D=M.charCodeAt(B+1),"url"===_&&D!==t&&D!==i&&D!==o&&D!==s&&D!==l&&D!==a&&D!==c){C=B;do{if(I=!1,C=M.indexOf(")",C+1),-1===C){if(F||x){C=B;break}H("bracket")}for(P=C;M.charCodeAt(P-1)===r;)P-=1,I=!I}while(I);O=["brackets",M.slice(B,C+1),B,C],B=C}else C=M.indexOf(")",B+1),k=M.slice(B,C+1),-1===C||T.test(k)?O=["(","(",B]:(O=["brackets",k,B,C],B=C);break;case t:case i:A=R===t?"'":'"',C=B;do{if(I=!1,C=M.indexOf(A,C+1),-1===C){if(F||x){C=B+1;break}H("string")}for(P=C;M.charCodeAt(P-1)===r;)P-=1,I=!I}while(I);O=["string",M.slice(B,C+1),B,C],B=C;break;case w:E.lastIndex=B+1,E.test(M),C=0===E.lastIndex?M.length-1:E.lastIndex-2,O=["at-word",M.slice(B,C+1),B,C],B=C;break;case r:for(C=B,L=!0;M.charCodeAt(C+1)===r;)C+=1,L=!L;if(R=M.charCodeAt(C+1),L&&R!==n&&R!==o&&R!==s&&R!==l&&R!==c&&R!==a&&(C+=1,S.test(M.charAt(C)))){for(;S.test(M.charAt(C+1));)C+=1;M.charCodeAt(C+1)===o&&(C+=1)}O=["word",M.slice(B,C+1),B,C],B=C;break;default:R===n&&M.charCodeAt(B+1)===v?(C=M.indexOf("*/",B+2)+1,0===C&&(F||x?C=M.length:H("comment")),O=["comment",M.slice(B,C+1),B,C],B=C):(b.lastIndex=B+1,b.test(M),C=0===b.lastIndex?M.length-1:b.lastIndex-2,O=["word",M.slice(B,C+1),B,C],U.push(O),B=C)}return B++,O},position:function(){return B}}}},2448:e=>{"use strict";let t={};e.exports=function(e){t[e]||(t[e]=!0,"undefined"!=typeof console&&console.warn&&console.warn(e))}},1728:e=>{"use strict";class t{constructor(e,t={}){if(this.type="warning",this.text=e,t.node&&t.node.source){let e=t.node.rangeBy(t);this.line=e.start.line,this.column=e.start.column,this.endLine=e.end.line,this.endColumn=e.end.column}for(let e in t)this[e]=t[e]}toString(){return this.node?this.node.error(this.text,{index:this.index,plugin:this.plugin,word:this.word}).message:this.plugin?this.plugin+": "+this.text:this.text}}e.exports=t,t.default=t},1036:(e,t,i)=>{const r=i(3719),n=i(2997),{isPlainObject:s}=i(977),o=i(9996),a=i(9430),{parse:l}=i(20),c=["img","audio","video","picture","svg","object","map","iframe","embed"],u=["script","style"];function h(e,t){e&&Object.keys(e).forEach((function(i){t(e[i],i)}))}function d(e,t){return{}.hasOwnProperty.call(e,t)}function f(e,t){const i=[];return h(e,(function(e){t(e)&&i.push(e)})),i}e.exports=g;const p=/^[^\0\t\n\f\r /<=>]+$/;function g(e,t,i){if(null==e)return"";"number"==typeof e&&(e=e.toString());let v="",y="";function w(e,t){const i=this;this.tag=e,this.attribs=t||{},this.tagPosition=v.length,this.text="",this.mediaChildren=[],this.updateParentNodeText=function(){I.length&&(I[I.length-1].text+=i.text)},this.updateParentNodeMediaChildren=function(){I.length&&c.includes(this.tag)&&I[I.length-1].mediaChildren.push(this.tag)}}(t=Object.assign({},g.defaults,t)).parser=Object.assign({},m,t.parser);const E=function(e){return!1===t.allowedTags||(t.allowedTags||[]).indexOf(e)>-1};u.forEach((function(e){E(e)&&!t.allowVulnerableTags&&console.warn(`\n\n⚠️ Your \`allowedTags\` option includes, \`${e}\`, which is inherently\nvulnerable to XSS attacks. Please remove it from \`allowedTags\`.\nOr, to disable this warning, add the \`allowVulnerableTags\` option\nand ensure you are accounting for this risk.\n\n`)}));const b=t.nonTextTags||["script","style","textarea","option"];let T,S;t.allowedAttributes&&(T={},S={},h(t.allowedAttributes,(function(e,t){T[t]=[];const i=[];e.forEach((function(e){"string"==typeof e&&e.indexOf("*")>=0?i.push(n(e).replace(/\\\*/g,".*")):T[t].push(e)})),i.length&&(S[t]=new RegExp("^("+i.join("|")+")$"))})));const x={},R={},C={};h(t.allowedClasses,(function(e,t){if(T&&(d(T,t)||(T[t]=[]),T[t].push("class")),x[t]=e,Array.isArray(e)){const i=[];x[t]=[],C[t]=[],e.forEach((function(e){"string"==typeof e&&e.indexOf("*")>=0?i.push(n(e).replace(/\\\*/g,".*")):e instanceof RegExp?C[t].push(e):x[t].push(e)})),i.length&&(R[t]=new RegExp("^("+i.join("|")+")$"))}}));const A={};let k,L,I,P,_,D,O;h(t.transformTags,(function(e,t){let i;"function"==typeof e?i=e:"string"==typeof e&&(i=g.simpleTransform(e)),"*"===t?k=i:A[t]=i}));let M=!1;N();const F=new r.Parser({onopentag:function(e,i){if(t.enforceHtmlBoundary&&"html"===e&&N(),D)return void O++;const r=new w(e,i);I.push(r);let n=!1;const c=!!r.text;let u;if(d(A,e)&&(u=A[e](e,i),r.attribs=i=u.attribs,void 0!==u.text&&(r.innerText=u.text),e!==u.tagName&&(r.name=e=u.tagName,_[L]=u.tagName)),k&&(u=k(e,i),r.attribs=i=u.attribs,e!==u.tagName&&(r.name=e=u.tagName,_[L]=u.tagName)),(!E(e)||"recursiveEscape"===t.disallowedTagsMode&&!function(e){for(const t in e)if(d(e,t))return!1;return!0}(P)||null!=t.nestingLimit&&L>=t.nestingLimit)&&(n=!0,P[L]=!0,"discard"===t.disallowedTagsMode&&-1!==b.indexOf(e)&&(D=!0,O=1),P[L]=!0),L++,n){if("discard"===t.disallowedTagsMode)return;y=v,v=""}v+="<"+e,"script"===e&&(t.allowedScriptHostnames||t.allowedScriptDomains)&&(r.innerText=""),(!T||d(T,e)||T["*"])&&h(i,(function(i,n){if(!p.test(n))return void delete r.attribs[n];if(""===i&&(t.nonBooleanAttributes.includes(n)||t.nonBooleanAttributes.includes("*")))return void delete r.attribs[n];let c=!1;if(!T||d(T,e)&&-1!==T[e].indexOf(n)||T["*"]&&-1!==T["*"].indexOf(n)||d(S,e)&&S[e].test(n)||S["*"]&&S["*"].test(n))c=!0;else if(T&&T[e])for(const t of T[e])if(s(t)&&t.name&&t.name===n){c=!0;let e="";if(!0===t.multiple){const r=i.split(" ");for(const i of r)-1!==t.values.indexOf(i)&&(""===e?e=i:e+=" "+i)}else t.values.indexOf(i)>=0&&(e=i);i=e}if(c){if(-1!==t.allowedSchemesAppliedToAttributes.indexOf(n)&&U(e,i))return void delete r.attribs[n];if("script"===e&&"src"===n){let e=!0;try{const r=$(i);if(t.allowedScriptHostnames||t.allowedScriptDomains){const i=(t.allowedScriptHostnames||[]).find((function(e){return e===r.url.hostname})),n=(t.allowedScriptDomains||[]).find((function(e){return r.url.hostname===e||r.url.hostname.endsWith(`.${e}`)}));e=i||n}}catch(t){e=!1}if(!e)return void delete r.attribs[n]}if("iframe"===e&&"src"===n){let e=!0;try{const r=$(i);if(r.isRelativeUrl)e=d(t,"allowIframeRelativeUrls")?t.allowIframeRelativeUrls:!t.allowedIframeHostnames&&!t.allowedIframeDomains;else if(t.allowedIframeHostnames||t.allowedIframeDomains){const i=(t.allowedIframeHostnames||[]).find((function(e){return e===r.url.hostname})),n=(t.allowedIframeDomains||[]).find((function(e){return r.url.hostname===e||r.url.hostname.endsWith(`.${e}`)}));e=i||n}}catch(t){e=!1}if(!e)return void delete r.attribs[n]}if("srcset"===n)try{let e=a(i);if(e.forEach((function(e){U("srcset",e.url)&&(e.evil=!0)})),e=f(e,(function(e){return!e.evil})),!e.length)return void delete r.attribs[n];i=f(e,(function(e){return!e.evil})).map((function(e){if(!e.url)throw new Error("URL missing");return e.url+(e.w?` ${e.w}w`:"")+(e.h?` ${e.h}h`:"")+(e.d?` ${e.d}x`:"")})).join(", "),r.attribs[n]=i}catch(e){return void delete r.attribs[n]}if("class"===n){const t=x[e],s=x["*"],a=R[e],l=C[e],c=[a,R["*"]].concat(l).filter((function(e){return e}));if(!(u=i,h=t&&s?o(t,s):t||s,g=c,i=h?(u=u.split(/\s+/)).filter((function(e){return-1!==h.indexOf(e)||g.some((function(t){return t.test(e)}))})).join(" "):u).length)return void delete r.attribs[n]}if("style"===n)if(t.parseStyleAttributes)try{if(i=function(e){return e.nodes[0].nodes.reduce((function(e,t){return e.push(`${t.prop}:${t.value}${t.important?" !important":""}`),e}),[]).join(";")}(function(e,t){if(!t)return e;const i=e.nodes[0];let r;return r=t[i.selector]&&t["*"]?o(t[i.selector],t["*"]):t[i.selector]||t["*"],r&&(e.nodes[0].nodes=i.nodes.reduce(function(e){return function(t,i){return d(e,i.prop)&&e[i.prop].some((function(e){return e.test(i.value)}))&&t.push(i),t}}(r),[])),e}(l(e+" {"+i+"}"),t.allowedStyles)),0===i.length)return void delete r.attribs[n]}catch(t){return"undefined"!=typeof window&&console.warn('Failed to parse "'+e+" {"+i+"}\", If you're running this in a browser, we recommend to disable style parsing: options.parseStyleAttributes: false, since this only works in a node environment due to a postcss dependency, More info: https://github.com/apostrophecms/sanitize-html/issues/547"),void delete r.attribs[n]}else if(t.allowedStyles)throw new Error("allowedStyles option cannot be used together with parseStyleAttributes: false.");v+=" "+n,i&&i.length&&(v+='="'+B(i,!0)+'"')}else delete r.attribs[n];var u,h,g})),-1!==t.selfClosing.indexOf(e)?v+=" />":(v+=">",!r.innerText||c||t.textFilter||(v+=B(r.innerText),M=!0)),n&&(v=y+B(v),y="")},ontext:function(e){if(D)return;const i=I[I.length-1];let r;if(i&&(r=i.tag,e=void 0!==i.innerText?i.innerText:e),"discard"!==t.disallowedTagsMode||"script"!==r&&"style"!==r){const i=B(e,!1);t.textFilter&&!M?v+=t.textFilter(i,r):M||(v+=i)}else v+=e;I.length&&(I[I.length-1].text+=e)},onclosetag:function(e,i){if(D){if(O--,O)return;D=!1}const r=I.pop();if(!r)return;if(r.tag!==e)return void I.push(r);D=!!t.enforceHtmlBoundary&&"html"===e,L--;const n=P[L];if(n){if(delete P[L],"discard"===t.disallowedTagsMode)return void r.updateParentNodeText();y=v,v=""}_[L]&&(e=_[L],delete _[L]),t.exclusiveFilter&&t.exclusiveFilter(r)?v=v.substr(0,r.tagPosition):(r.updateParentNodeMediaChildren(),r.updateParentNodeText(),-1!==t.selfClosing.indexOf(e)||i&&!E(e)&&["escape","recursiveEscape"].indexOf(t.disallowedTagsMode)>=0?n&&(v=y,y=""):(v+="</"+e+">",n&&(v=y+B(v),y=""),M=!1))}},t.parser);return F.write(e),F.end(),v;function N(){v="",L=0,I=[],P={},_={},D=!1,O=0}function B(e,i){return"string"!=typeof e&&(e+=""),t.parser.decodeEntities&&(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),i&&(e=e.replace(/"/g,"&quot;"))),e=e.replace(/&(?![a-zA-Z0-9#]{1,20};)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),i&&(e=e.replace(/"/g,"&quot;")),e}function U(e,i){for(i=i.replace(/[\x00-\x20]+/g,"");;){const e=i.indexOf("\x3c!--");if(-1===e)break;const t=i.indexOf("--\x3e",e+4);if(-1===t)break;i=i.substring(0,e)+i.substring(t+3)}const r=i.match(/^([a-zA-Z][a-zA-Z0-9.\-+]*):/);if(!r)return!!i.match(/^[/\\]{2}/)&&!t.allowProtocolRelative;const n=r[1].toLowerCase();return d(t.allowedSchemesByTag,e)?-1===t.allowedSchemesByTag[e].indexOf(n):!t.allowedSchemes||-1===t.allowedSchemes.indexOf(n)}function $(e){if((e=e.replace(/^(\w+:)?\s*[\\/]\s*[\\/]/,"$1//")).startsWith("relative:"))throw new Error("relative: exploit attempt");let t="relative://relative-site";for(let e=0;e<100;e++)t+=`/${e}`;const i=new URL(e,t);return{isRelativeUrl:i&&"relative-site"===i.hostname&&"relative:"===i.protocol,url:i}}}const m={decodeEntities:!0};g.defaults={allowedTags:["address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","hgroup","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","main","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rb","rp","rt","rtc","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr"],nonBooleanAttributes:["abbr","accept","accept-charset","accesskey","action","allow","alt","as","autocapitalize","autocomplete","blocking","charset","cite","class","color","cols","colspan","content","contenteditable","coords","crossorigin","data","datetime","decoding","dir","dirname","download","draggable","enctype","enterkeyhint","fetchpriority","for","form","formaction","formenctype","formmethod","formtarget","headers","height","hidden","high","href","hreflang","http-equiv","id","imagesizes","imagesrcset","inputmode","integrity","is","itemid","itemprop","itemref","itemtype","kind","label","lang","list","loading","low","max","maxlength","media","method","min","minlength","name","nonce","optimum","pattern","ping","placeholder","popover","popovertarget","popovertargetaction","poster","preload","referrerpolicy","rel","rows","rowspan","sandbox","scope","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","tabindex","target","title","translate","type","usemap","value","width","wrap","onauxclick","onafterprint","onbeforematch","onbeforeprint","onbeforeunload","onbeforetoggle","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncontextlost","oncontextmenu","oncontextrestored","oncopy","oncuechange","oncut","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onformdata","onhashchange","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onlanguagechange","onload","onloadeddata","onloadedmetadata","onloadstart","onmessage","onmessageerror","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onoffline","ononline","onpagehide","onpageshow","onpaste","onpause","onplay","onplaying","onpopstate","onprogress","onratechange","onreset","onresize","onrejectionhandled","onscroll","onscrollend","onsecuritypolicyviolation","onseeked","onseeking","onselect","onslotchange","onstalled","onstorage","onsubmit","onsuspend","ontimeupdate","ontoggle","onunhandledrejection","onunload","onvolumechange","onwaiting","onwheel"],disallowedTagsMode:"discard",allowedAttributes:{a:["href","name","target"],img:["src","srcset","alt","title","width","height","loading"]},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto","tel"],allowedSchemesByTag:{},allowedSchemesAppliedToAttributes:["href","src","cite"],allowProtocolRelative:!0,enforceHtmlBoundary:!1,parseStyleAttributes:!0},g.simpleTransform=function(e,t,i){return i=void 0===i||i,t=t||{},function(r,n){let s;if(i)for(s in t)n[s]=t[s];else n=t;return{tagName:e,attribs:n}}}},2997:e=>{"use strict";e.exports=e=>{if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}},977:(e,t)=>{"use strict";function i(e){return"[object Object]"===Object.prototype.toString.call(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.isPlainObject=function(e){var t,r;return!1!==i(e)&&(void 0===(t=e.constructor)||!1!==i(r=t.prototype)&&!1!==r.hasOwnProperty("isPrototypeOf"))}},1757:function(e,t){!function(e){"use strict";function t(e){return null==e}function i(e){throw new Error("Argument "+e+" is empty.")}function r(e){return"function"==typeof e&&"getType"in e}function n(e){throw new Error("Argument "+e+' is invalid, it should be an action-creator instance from "typesafe-actions"')}function s(e,t){if(null==e)throw new Error("Argument contains array with empty element at index "+t);if(null==e.getType)throw new Error("Argument contains array with invalid element at index "+t+', it should be an action-creator instance from "typesafe-actions"')}function o(e){return"string"==typeof e||"symbol"==typeof e}function a(e){return!o(e)}function l(e){throw new Error("Argument "+e+" is invalid, it should be an action type of type: string | symbol")}function c(e,t){if(null==e)throw new Error("Argument contains array with empty element at index "+t);if("string"!=typeof e&&"symbol"!=typeof e)throw new Error("Argument contains array with invalid element at index "+t+", it should be of type: string | symbol")}function u(e,r,s,o){return t(e)&&i(1),a(e)&&n(1),{type:e,payload:r,meta:s,error:o}}function h(e,r){return t(e)&&i(1),a(e)&&l(1),Object.assign((function(){var t=null!=r?r.apply(void 0,arguments):void 0;return Object.assign({type:e},t)}),{getType:function(){return e},toString:function(){return e}})}function d(e,r,n){return t(e)&&i(1),a(e)&&l(1),function(){return h(e,(function(){var e=arguments.length<=0?void 0:arguments[0],t=arguments.length<=1?void 0:arguments[1];return null==r&&null==n||(e=null!=r?r.apply(void 0,arguments):void 0,t=null!=n?n.apply(void 0,arguments):void 0),Object.assign({},void 0!==e&&{payload:e},{},void 0!==t&&{meta:t})}))}}function f(e){return t(e)&&i(1),r(e)||n(1),e.getType()}function p(e,r){t(e)&&i(1),a(e)&&l(1);var n=null!=r?r(e):function(){return{type:e}};return Object.assign(n,{getType:function(){return e},toString:function(){return e}})}var g={createAction:function(e,t){var i=null==t?function(){return u(e)}:t(u.bind(null,e));return Object.assign(i,{getType:function(){return e},toString:function(){return e}})},createCustomAction:p,createStandardAction:function(e){return t(e)&&i(1),a(e)&&l(1),Object.assign((function(){return p(e,(function(e){return function(t,i){return{type:e,payload:t,meta:i}}}))}),{map:function(t){return p(e,(function(e){return function(i,r){return Object.assign(t(i,r),{type:e})}}))}})}};e.action=u,e.createAction=d,e.createAsyncAction=function(e,t,i,r){return function(){var n=[e,t,i,r].map((function(e,t){return Array.isArray(e)?d(e[0],e[1],e[2])():"string"==typeof e||"symbol"==typeof e?d(e)():void(t<3&&function(e){throw new Error("Argument "+e+' is invalid, it should be an action type of "string | symbol" or a tuple of "[string | symbol, Function, Function?]"')}(t))}));return{request:n[0],success:n[1],failure:n[2],cancel:n[3]}}},e.createCustomAction=h,e.createReducer=function e(t,i){void 0===i&&(i={});var n=Object.assign({},i),s=function(i,s){var a=Array.isArray(i)?i:[i],l={};return a.map((function(e,t){return r(e)?f(e):o(e)?e:function(e){throw new Error("Argument "+e+' is invalid, it should be an action-creator instance from "typesafe-actions" or action type of type: string | symbol')}(t+1)})).forEach((function(e){return l[e]=s})),e(t,Object.assign({},n,{},l))};return Object.assign((function(e,i){if(void 0===e&&(e=t),n.hasOwnProperty(i.type)){var r=n[i.type];if("function"!=typeof r)throw Error('Reducer under "'+i.type+'" key is not a valid reducer');return r(e,i)}return e}),{handlers:Object.assign({},n),handleAction:s,handleType:s})},e.deprecated=g,e.getType=f,e.isActionOf=function(e,r){t(e)&&i(1);var n=Array.isArray(e)?e:[e];n.forEach(s);var o=function(e){return n.some((function(t){return e.type===t.getType()}))};return void 0===r?o:o(r)},e.isOfType=function(e,r){t(e)&&i(1);var n=Array.isArray(e)?e:[e];n.forEach(c);var s=function(e){return n.includes(e.type)};return void 0===r?s:s(r)}}(t)},2868:()=>{},4777:()=>{},9830:()=>{},209:()=>{},7414:()=>{},2961:e=>{e.exports={nanoid:(e=21)=>{let t="",i=e;for(;i--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[64*Math.random()|0];return t},customAlphabet:(e,t=21)=>(i=t)=>{let r="",n=i;for(;n--;)r+=e[Math.random()*e.length|0];return r}}}},__webpack_module_cache__={},leafPrototypes,getProto;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(i.exports,i,i.exports,__webpack_require__),i.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var i=Object.create(null);__webpack_require__.r(i);var r={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var n=2&t&&e;"object"==typeof n&&!~leafPrototypes.indexOf(n);n=getProto(n))Object.getOwnPropertyNames(n).forEach((t=>r[t]=()=>e[t]));return r.default=()=>e,__webpack_require__.d(i,r),i},__webpack_require__.d=(e,t)=>{for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var getCurrentScript=function(){var e=document.currentScript;if(!e){for(var t=document.getElementsByTagName("script"),i=[],r=0;r<t.length;r++)i.push(t[r]);e=(i=i.filter((function(e){return!e.async&&!e.text&&!e.textContent}))).slice(-1)[0]}return e},isLocalScript=function(e){return/\/_dash-component-suites\//.test(e.src)},url;if(Object.defineProperty(__webpack_require__,"p",{get:(url=getCurrentScript().src.split("/").slice(0,-1).join("/")+"/",function(){return url})}),"undefined"!=typeof jsonpScriptSrc){var __jsonpScriptSrc__=jsonpScriptSrc;jsonpScriptSrc=function(e){var t=getCurrentScript(),i=isLocalScript(t),r=__jsonpScriptSrc__(e);if(!i)return r;var n=r.split("/"),s=n.slice(-1)[0].split(".");return s.splice(1,0,"v0_0_1m1696030208"),n.splice(-1,1,s.join(".")),n.join("/")}}__webpack_require__.nc=void 0;var __webpack_exports__={};(()=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Cloveriiif:()=>zy});const e=window.React;var t=__webpack_require__.t(e,2),i=__webpack_require__.n(e);const r=window.PropTypes;var n=__webpack_require__.n(r),s=Object.defineProperty,o=(e,t,i)=>(((e,t,i)=>{t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i})(e,"symbol"!=typeof t?t+"":t,i),i);const a=[];Object.freeze(a);const l={id:"https://iiif-parser/annotation-page",type:"AnnotationPage",behavior:a,motivation:null,label:null,thumbnail:a,summary:null,requiredStatement:null,metadata:a,rights:null,provider:a,items:a,seeAlso:a,homepage:a,logo:a,rendering:a,service:a},c={id:"https://iiif-parser/empty-canvas",type:"Canvas",label:null,behavior:a,motivation:null,thumbnail:a,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:a,rights:null,navDate:null,provider:a,items:a,annotations:a,seeAlso:a,homepage:a,logo:a,partOf:a,rendering:a,service:a,duration:0,height:0,width:0},u={id:"https://iiif-parser/empty-collection",type:"Collection",label:null,viewingDirection:"left-to-right",behavior:a,motivation:null,thumbnail:a,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:a,rights:null,navDate:null,provider:a,items:a,annotations:a,seeAlso:a,homepage:a,logo:a,partOf:a,rendering:a,service:a,services:a},h={id:"https://iiif-parser/empty-manifest",type:"Manifest",annotations:a,behavior:a,homepage:a,items:a,label:null,logo:a,metadata:a,motivation:null,navDate:null,provider:a,partOf:a,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,rendering:a,requiredStatement:null,rights:null,seeAlso:a,service:a,services:a,start:null,structures:a,summary:null,thumbnail:a,viewingDirection:"left-to-right"},d={id:"https://iiif-parser/empty-canvas",type:"Range",label:null,behavior:a,motivation:null,thumbnail:a,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:a,rights:null,navDate:null,provider:a,items:a,annotations:a,seeAlso:a,homepage:a,logo:a,partOf:a,rendering:a,service:a,start:null,supplementary:null,viewingDirection:"left-to-right"},f={id:"https://iiif-parser/empty-agent",type:"Agent",label:{},logo:a,seeAlso:a,homepage:a};function p(e){return Array.isArray(e)?e:[e]}const g=["Collection","Manifest","Canvas","AnnotationPage","AnnotationCollection","Annotation","ContentResource","Range","Service","Selector","Agent"];class m{constructor(e,t={}){o(this,"traversals"),o(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationCollection:[],annotationPage:[],annotation:[],contentResource:[],choice:[],range:[],service:[],agent:[],...e},this.options={allowUndefinedReturn:!1,...t}}static all(e){return new m({collection:[e],manifest:[e],canvas:[e],annotationCollection:[e],annotationPage:[e],annotation:[e],contentResource:[e],choice:[e],range:[e],service:[e]})}traverseDescriptive(e){return e.thumbnail&&(e.thumbnail=e.thumbnail.map((e=>this.traverseType(e,this.traversals.contentResource)))),e.provider&&(e.provider=e.provider.map((e=>this.traverseAgent(e)))),e}traverseLinking(e){return e.seeAlso&&(e.seeAlso=e.seeAlso.map((e=>this.traverseType(e,this.traversals.contentResource)))),e.service&&(e.service=p(e.service).map((e=>this.traverseType(e,this.traversals.service)))),e.services&&(e.services=e.services.map((e=>this.traverseType(e,this.traversals.service)))),e.logo&&(e.logo=e.logo.map((e=>this.traverseType(e,this.traversals.contentResource)))),e.homepage&&(e.homepage=e.homepage.map((e=>this.traverseType(e,this.traversals.contentResource)))),e.partOf&&(e.partOf=e.partOf.map((e=>"string"!=typeof e&&e.type?"Canvas"===e.type?this.traverseType(e,this.traversals.canvas):"AnnotationCollection"===e.type?this.traverseType(e,this.traversals.annotationCollection):"Collection"===e.type?this.traverseType(e,this.traversals.collection):this.traverseType(e,this.traversals.contentResource):this.traverseType(e,this.traversals.contentResource)))),e.start&&(e.start=e.start?this.traverseType(e.start,this.traversals.canvas):null),e.rendering&&(e.rendering=e.rendering.map((e=>this.traverseType(e,this.traversals.contentResource)))),e.supplementary&&(e.supplementary=e.supplementary.map((e=>this.traverseType(e,this.traversals.contentResource)))),e}traverseCollectionItems(e){return e.items&&e.items.map((e=>"Collection"===e.type?this.traverseCollection(e):this.traverseManifest(e))),e}traverseCollection(e){return this.traverseType(this.traverseDescriptive(this.traverseInlineAnnotationPages(this.traverseLinking(this.traversePosterCanvas(this.traverseCollectionItems(e))))),this.traversals.collection)}traverseManifestItems(e){return e.items&&(e.items=e.items.map((e=>this.traverseCanvas(e)))),e}traverseManifestStructures(e){return e.structures&&(e.structures=e.structures.map((e=>this.traverseRange(e)))),e}traverseManifest(e){return this.traverseType(this.traverseInlineAnnotationPages(this.traverseManifestStructures(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(e)))))),this.traversals.manifest)}traverseCanvasItems(e){return e.items=(e.items||[]).map((e=>this.traverseAnnotationPage(e))),e}traverseInlineAnnotationPages(e){return"string"!=typeof e&&e?(e.annotations&&(e.annotations=e.annotations.map((e=>this.traverseAnnotationPage(e)))),e):e}traverseCanvas(e){return this.traverseType(this.traverseInlineAnnotationPages(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(e))))),this.traversals.canvas)}traverseAnnotationPageItems(e){return e.items&&(e.items=e.items.map((e=>this.traverseAnnotation(e)))),e}traverseAnnotationPage(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationPageItems(e))),this.traversals.annotationPage)}traverseAnnotationBody(e){return Array.isArray(e.body)?e.body=e.body.map((e=>this.traverseContentResource(e))):e.body&&(e.body=this.traverseContentResource(e.body)),e}traversePosterCanvas(e){return e.posterCanvas&&(e.posterCanvas=this.traverseCanvas(e.posterCanvas)),e.placeholderCanvas&&(e.placeholderCanvas=this.traverseCanvas(e.placeholderCanvas)),e.accompanyingCanvas&&(e.accompanyingCanvas=this.traverseCanvas(e.accompanyingCanvas)),e}traverseAnnotation(e){return this.traverseType(this.traverseLinking(this.traverseAnnotationBody(e)),this.traversals.annotation)}traverseContentResourceLinking(e){return"string"!=typeof e&&e?(e&&e.service&&(e.service=p(e.service||[]).map((e=>this.traverseType(e,this.traversals.service)))),e):e}traverseContentResource(e){return"Choice"===e.type&&(e.items=e.items.map((e=>this.traverseContentResource(e)))),this.traverseType(this.traverseInlineAnnotationPages(this.traverseContentResourceLinking(e)),this.traversals.contentResource)}traverseRangeRanges(e){return e.items&&(e.items=e.items.map((e=>"string"==typeof e?this.traverseCanvas({id:e,type:"Canvas"}):"Manifest"===e.type?this.traverseManifest(e):this.traverseRange(e)))),e}traverseRange(e){return this.traverseType(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseRangeRanges(e)))),this.traversals.range)}traverseAgent(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),this.traversals.agent)}traverseType(e,t){return t.reduce(((e,t)=>{const i=t(e);return void 0!==i||this.options.allowUndefinedReturn?i:e}),e)}traverseService(e){return this.traverseType(e,this.traversals.service)}traverseUnknown(e){const t=function(e){if(null==e)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(e))throw new Error("Array is not a valid entity");if("object"!=typeof e)throw new Error(typeof e+" is not a valid entity");if("string"==typeof e.type){const t=g.indexOf(e.type);if(-1!==t)return g[t]}if(e.profile)return"Service";throw new Error("Resource type is not known")}(e);switch(t){case"Collection":return this.traverseCollection(e);case"Manifest":return this.traverseManifest(e);case"Canvas":return this.traverseCanvas(e);case"AnnotationPage":return this.traverseAnnotationPage(e);case"Annotation":return this.traverseAnnotation(e);case"ContentResource":return this.traverseContentResource(e);case"Range":return this.traverseRange(e);case"Service":return this.traverseService(e);case"Agent":return this.traverseAgent(e);default:throw new Error(`Unknown or unsupported resource type of ${t}`)}}}const v=["sc:Collection","sc:Manifest","sc:Canvas","sc:AnnotationList","oa:Annotation","sc:Range","sc:Layer","sc:Sequence","oa:Choice","Service","ContentResource"];class y{constructor(e,t={}){o(this,"traversals"),o(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationList:[],sequence:[],annotation:[],contentResource:[],choice:[],range:[],service:[],layer:[],...e},this.options={convertPropsToArray:!0,mergeMemberProperties:!0,allowUndefinedReturn:!1,...t}}static all(e){return new y({collection:[e],manifest:[e],canvas:[e],annotationList:[e],sequence:[e],annotation:[e],contentResource:[e],choice:[e],range:[e],service:[e],layer:[e]})}traverseCollection(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(e))),this.traversals.collection)}traverseCollectionItems(e){if(this.options.mergeMemberProperties){const t=[...(e.manifests||[]).map((e=>"string"==typeof e?{"@id":e,"@type":"sc:Manifest"}:e)),...(e.collections||[]).map((e=>"string"==typeof e?{"@id":e,"@type":"sc:Collection"}:e)),...e.members||[]];delete e.collections,delete e.manifests,e.members=t}return e.manifests&&(e.manifests=e.manifests.map((e=>this.traverseManifest("string"==typeof e?{"@id":e,"@type":"sc:Manifest"}:e)))),e.collections&&(e.collections=e.collections.map((e=>this.traverseCollection("string"==typeof e?{"@id":e,"@type":"sc:Collection"}:e)))),e.members&&(e.members=e.members.map((e=>"string"==typeof e?e:this.traverseUnknown(e)))),e}traverseManifest(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(e))),this.traversals.manifest)}traverseManifestItems(e){return e.sequences&&(e.sequences=e.sequences.map((e=>this.traverseSequence(e)))),e.structures&&(e.structures=e.structures.map((e=>this.traverseRange(e)))),e}traverseSequence(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(e))),this.traversals.sequence)}traverseSequenceItems(e){return e.canvases&&(e.canvases=e.canvases.map((e=>this.traverseCanvas(e)))),e}traverseCanvas(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(e))),this.traversals.canvas)}traverseCanvasItems(e){return e.images&&(e.images=e.images.map((e=>this.traverseAnnotation(e)))),e.otherContent&&(e.otherContent=e.otherContent.map((e=>this.traverseAnnotationList(e)))),e}traverseRange(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(e))),this.traversals.range)}traverseRangeItems(e){if(this.options.mergeMemberProperties){const t=[...(e.ranges||[]).map((e=>"string"==typeof e?{"@id":e,"@type":"sc:Range"}:e)),...(e.canvases||[]).map((e=>"string"==typeof e?{"@id":e,"@type":"sc:Canvas"}:e)),...e.members||[]];delete e.ranges,delete e.canvases,e.members=t.length?t.map((e=>this.traverseUnknown(e))):void 0}return e}traverseAnnotationList(e){const t="string"==typeof e?{"@id":e,"@type":"sc:AnnotationList"}:e;return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems(t)),this.traversals.annotationList)}traverseAnnotationListItems(e){return e.resources&&(e.resources=e.resources.map((e=>this.traverseAnnotation(e)))),e}traverseAnnotation(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(e))),this.traversals.annotation)}traverseAnnotationItems(e){return e.resource&&(Array.isArray(e.resource)?e.resource=e.resource.map((e=>this.traverseContentResource(e))):e.resource=this.traverseContentResource(e.resource)),e.on,e}traverseLayer(e){return this.traverseType(this.traverseLinking(this.traverseLayerItems(e)),this.traversals.layer)}traverseLayerItems(e){return e.otherContent&&(e.otherContent=e.otherContent.map((e=>this.traverseAnnotationList(e)))),e}traverseChoice(e){return this.traverseType(this.traverseChoiceItems(e),this.traversals.choice)}traverseChoiceItems(e){return e.default&&"rdf:nil"!==e.default&&(e.default=this.traverseContentResource(e.default)),e.item&&"rdf:nil"!==e.item&&(e.item=e.item.map((e=>this.traverseContentResource(e)))),e}traverseService(e){return this.traverseType(this.traverseLinking(e),this.traversals.service)}traverseContentResource(e){return"oa:Choice"===e["@type"]?this.traverseChoice(e):this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),this.traversals.contentResource)}traverseUnknown(e){if(!e["@type"]||"string"==typeof e)return e;switch(function(e){if(null==e)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(e))throw new Error("Array is not a valid entity");if("object"!=typeof e)throw new Error(typeof e+" is not a valid entity");if("string"==typeof e["@type"]){const t=v.indexOf(e["@type"]);if(-1!==t)return v[t]}if(e.profile)return"Service";if(e.format)return"ContentResource";if(e["@type"])return"ContentResource";throw new Error("Resource type is not known")}(e)){case"sc:Collection":return this.traverseCollection(e);case"sc:Manifest":return this.traverseManifest(e);case"sc:Canvas":return this.traverseCanvas(e);case"sc:Sequence":return this.traverseSequence(e);case"sc:Range":return this.traverseRange(e);case"oa:Annotation":return this.traverseAnnotation(e);case"sc:AnnotationList":return this.traverseAnnotationList(e);case"sc:Layer":return this.traverseLayer(e);case"Service":return this.traverseService(e);case"oa:Choice":return this.traverseChoice(e);case"ContentResource":return this.traverseContentResource(e)}return e.profile?this.traverseService(e):e}traverseImageResource(e){const t=Array.isArray(e),i=Array.isArray(e)?e:[e],r=[];for(const e of i)"string"==typeof e?r.push(this.traverseContentResource({"@id":e,"@type":"dctypes:Image"})):r.push(this.traverseContentResource(e));return t||this.options.convertPropsToArray?r:r[0]}traverseDescriptive(e){return e.thumbnail&&(e.thumbnail=this.traverseImageResource(e.thumbnail)),e.logo&&(e.logo=this.traverseImageResource(e.logo)),e}traverseOneOrMoreServices(e){const t=Array.isArray(e),i=Array.isArray(e)?e:[e],r=[];for(const e of i)r.push(this.traverseService(e));return t||this.options.convertPropsToArray?r:r[0]}traverseLinking(e){return e.related&&(e.related=this.traverseOneOrManyType(e.related,this.traversals.contentResource)),e.rendering&&(e.rendering=this.traverseOneOrManyType(e.rendering,this.traversals.contentResource)),e.service&&(e.service=this.traverseOneOrMoreServices(e.service)),e.seeAlso&&(e.seeAlso=this.traverseOneOrManyType(e.seeAlso,this.traversals.contentResource)),e.within&&("string"==typeof e.within||(e.within=this.traverseOneOrManyType(e.within,this.traversals.contentResource))),e.startCanvas&&("string"==typeof e.startCanvas?e.startCanvas=this.traverseType({"@id":e.startCanvas,"@type":"sc:Canvas"},this.traversals.canvas):e.startCanvas&&this.traverseType(e.startCanvas,this.traversals.canvas)),e.contentLayer&&("string"==typeof e.contentLayer?e.contentLayer=this.traverseLayer({"@id":e.contentLayer,"@type":"sc:Layer"}):e.contentLayer=this.traverseLayer(e.contentLayer)),e}traverseOneOrManyType(e,t){if(!Array.isArray(e)){if(!this.options.convertPropsToArray)return this.traverseType(e,t);e=[e]}return e.map((e=>this.traverseType(e,t)))}traverseType(e,t){return t.reduce(((e,t)=>{const i=t(e);return void 0!==i||this.options.allowUndefinedReturn?i:e}),e)}}const w="http://library.stanford.edu/iiif/image-api/compliance.html#level1",E="http://library.stanford.edu/iiif/image-api/compliance.html#level2",b="http://library.stanford.edu/iiif/image-api/conformance.html#level1",T="http://library.stanford.edu/iiif/image-api/conformance.html#level2",S="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",x="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",R="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",C="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",A="http://iiif.io/api/image/1/level1.json",k="http://iiif.io/api/image/1/profiles/level1.json",L="http://iiif.io/api/image/1/level2.json",I="http://iiif.io/api/image/1/profiles/level2.json",P="http://iiif.io/api/image/2/level1.json",_="http://iiif.io/api/image/2/profiles/level1.json",D="http://iiif.io/api/image/2/level2.json",O="http://iiif.io/api/image/2/profiles/level2.json",M="level1",F="level2",N="http://iiif.io/api/image/2/level1",B="http://iiif.io/api/image/2/level2",U=[N,B,w,E,b,T,S,x,R,C,A,k,L,I,P,_,D,O,M,F],$=["http://iiif.io/api/image/2/level0",N,B,"http://library.stanford.edu/iiif/image-api/compliance.html#level0",w,E,"http://library.stanford.edu/iiif/image-api/conformance.html#level0",b,T,"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",S,x,"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",R,C,"http://iiif.io/api/image/1/level0.json","http://iiif.io/api/image/1/profiles/level0.json",A,k,L,I,"http://iiif.io/api/image/2/level0.json","http://iiif.io/api/image/2/profiles/level0.json",P,_,D,O,"level0",M,F],H={attributionLabel:"Attribution",lang:"none",providerId:"http://example.org/provider",providerName:"Unknown"};function z(e,t="none"){if(!e)return{};const i=Array.isArray(e)?e:[e],r={};for(const e of i){if("string"==typeof e){r[t]=r[t]?r[t]:[],r[t].push(e||"");continue}if(!e["@language"]){r[t]=r[t]?r[t]:[],r[t].push(e["@value"]||"");continue}const i=e["@language"];r[i]=r[i]?r[i]:[],r[i].push(e["@value"]||"")}return r}function j(e){return Array.isArray(e)?j(e.find((e=>"string"==typeof e))):-1!==$.indexOf(e)?"level2":-1!==U.indexOf(e)?"level1":"string"==typeof e?e:void 0}function G(e){for(const t of["sc","oa","dcterms","dctypes","iiif"])if(e.startsWith(`${t}:`))return e.slice(t.length+1);return e}const V=["Collection","Manifest","Annotation","AnnotationPage","Range","Service"];function q(e){const t=e["@id"]||e.id;let i=e["@type"]||e.type;const r=e.profile||void 0,n=e["@context"]||void 0;if(r){const e=function(e){switch(e){case"http://iiif.io/api/image/2/level0.json":case"http://iiif.io/api/image/2/level1.json":case"http://iiif.io/api/image/2/level2.json":return"ImageService2";case"http://iiif.io/api/auth/1/kiosk":case"http://iiif.io/api/auth/1/login":case"http://iiif.io/api/auth/1/clickthrough":case"http://iiif.io/api/auth/1/external":case"http://iiif.io/api/auth/0/kiosk":case"http://iiif.io/api/auth/0/login":case"http://iiif.io/api/auth/0/clickthrough":case"http://iiif.io/api/auth/0/external":return"AuthCookieService1";case"http://iiif.io/api/auth/1/token":case"http://iiif.io/api/auth/0/token":return"AuthTokenService1";case"http://iiif.io/api/auth/1/logout":case"http://iiif.io/api/auth/0/logout":return"AuthLogoutService1";case"http://iiif.io/api/search/1/search":case"http://iiif.io/api/search/0/search":return"SearchService1";case"http://iiif.io/api/search/1/autocomplete":case"http://iiif.io/api/search/0/autocomplete":return"AutoCompleteService1"}}(r);if(e)return e}if(n){const e=function(e){const t=Array.isArray(e)?e:[e];for(const e of t)switch(e){case"http://iiif.io/api/image/2/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2":return"ImageService2";case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":return"ImageService1";case"http://iiif.io/api/annex/openannotation/context.json":return"ImageApiSelector"}}(n);if(e)return e}if(i){if(Array.isArray(i)){if(-1!==i.indexOf("oa:CssStylesheet"))return"CssStylesheet";if(-1!==i.indexOf("cnt:ContentAsText"))return"TextualBody";i=i[0]}for(const e of["sc","oa","dcterms","dctypes","iiif"])if(i.startsWith(`${e}:`)){i=i.slice(e.length+1);break}switch(i){case"Layer":return"AnnotationCollection";case"AnnotationList":return"AnnotationPage";case"cnt:ContentAsText":return"TextualBody"}}if(i&&-1!==V.indexOf(i))return i;if(e.format){if(e.format.startsWith("image/"))return"Image";if(e.format.startsWith("text/"))return"Text";if("application/pdf"===e.format)return"Text";if(e.format.startsWith("application/"))return"Dataset"}return t&&(t.endsWith(".jpg")||t.endsWith(".png")||t.endsWith(".jpeg"))?"Image":i||"unknown"}const W=/http(s)?:\/\/(creativecommons.org|rightsstatements.org)[^"'\\<\n]+/gm;function K(e){const t=e.match(W);return t?t[0]:e}const Y=["http://iiif.io/api/presentation/2/context.json","http://iiif.io/api/image/2/context.json","http://iiif.io/api/image/1/context.json","http://library.stanford.edu/iiif/image-api/1.1/context.json","http://iiif.io/api/search/1/context.json","http://iiif.io/api/search/0/context.json","http://iiif.io/api/auth/1/context.json","http://iiif.io/api/auth/0/context.json","http://iiif.io/api/annex/openannotation/context.json"];function X(e){if(e){const t=Array.isArray(e)?e:[e],i=[];for(const e of t)"http://iiif.io/api/presentation/2/context.json"===e&&i.push("http://iiif.io/api/presentation/3/context.json"),-1===Y.indexOf(e)&&i.push(e);if(t.length)return 1===i.length?i[0]:i}}function Z(e){for(const t in e)void 0!==e[t]&&null!==e[t]||delete e[t];return e}let Q=0;function J(e,t){const i=encodeURI(e.id||e["@id"]||"").trim();return i&&t?`${i}/${t}`:i||(Q++,`http://example.org/${e["@type"]}${t?`/${t}`:""}/${Q}`)}function ee(e){const t=[...e.behavior||[]];let i;return e.viewingHint&&t.push(e.viewingHint),Array.isArray(e.motivation)?i=e.motivation.map(G):e.motivation&&(i=G(e.motivation)),{"@context":e["@context"]?X(e["@context"]):void 0,id:(e["@id"]||J(e)).trim(),type:q(e),behavior:t.length?t:void 0,height:e.height?e.height:void 0,width:e.width?e.width:void 0,motivation:i,viewingDirection:e.viewingDirection,profile:e.profile,format:e.format?e.format:void 0,duration:void 0,timeMode:void 0}}function te(e){const[t,i]=function(e,t="Rights/License",i="none"){let r=null;const n=[],s=Array.isArray(e)?e:[e];for(const e of s){const s=e?K(e):void 0;!s||-1===s.indexOf("creativecommons.org")&&-1===s.indexOf("rightsstatements.org")?s&&n.push({label:{[i]:[t]},value:{[i]:[s]}}):r=s.startsWith("https://")?`http://${s.slice(8)}`:s}return[r,n]}(e.license),r=[...e.metadata?(n=e.metadata,n?n.map((e=>({label:z(e.label),value:z(e.value)}))):[]):[],...i];var n;return{rights:t,metadata:r.length?r:void 0,label:e.label?z(e.label):void 0,requiredStatement:e.attribution?{label:z(H.attributionLabel),value:z(e.attribution)}:void 0,navDate:e.navDate,summary:e.description?z(e.description):void 0,thumbnail:e.thumbnail}}function ie(e){if(!e.within)return;const t=Array.isArray(e.within)?e.within:[e.within],i=[];for(const r of t)"string"==typeof r?r&&"sc:Manifest"===e["@type"]&&i.push({id:r,type:"Collection"}):r["@id"]&&i.push({id:r["@id"],type:q(r)});return i.length?i:void 0}function re(e){const t=e.related?Array.isArray(e.related)?e.related:[e.related]:[],i=e.contentLayer;return{provider:e.logo||t.length?[{id:H.providerId,type:"Agent",homepage:t.length?[t[0]]:void 0,logo:e.logo?Array.isArray(e.logo)?e.logo:[e.logo]:void 0,label:z(H.providerName)}]:void 0,partOf:ie(e),rendering:e.rendering,seeAlso:e.seeAlso,start:e.startCanvas,service:e.service?p(e.service):void 0,supplementary:i?[i]:void 0}}function ne(e){const t=e;return Z({...ee(t),...te(t),...re(t),...(i=t,{chars:i.chars,format:i.format?i.format:void 0,language:i.language})});var i}const se=new y({collection:[function(e){return Z({...ee(e),...te(e),...re(e),items:e.members})}],manifest:[function(e){const t=[],i=[];for(const r of e.sequences||[])r.canvases.length&&t.push(...r.canvases),r.behavior&&i.push(...r.behavior);const r=ee(e);return i.length&&(r.behavior?r.behavior.push(...i):r.behavior=i),Z({...r,...te(e),...re(e),items:t,structures:e.structures})}],canvas:[function(e){return Z({...ee(e),...te(e),...re(e),annotations:e.otherContent&&e.otherContent.length?e.otherContent:void 0,items:e.images&&e.images.length?[{id:J(e,"annotation-page"),type:"AnnotationPage",items:e.images}]:void 0})}],annotationList:[function(e){return Z({...ee(e),...te(e),...re(e),items:e.resources&&e.resources.length?e.resources:void 0})}],sequence:[function(e){return e.canvases&&0!==e.canvases.length?{canvases:e.canvases,behavior:e.viewingHint?[e.viewingHint]:[]}:{canvases:[],behavior:[]}}],annotation:[function(e){return Z({...ee(e),...te(e),...re(e),target:function e(t){if(Array.isArray(t)){if(t.length>1)return{type:"List",items:t.map(e)};t=t[0]}if("string"==typeof t)return encodeURI(t).trim();if("@type"in t){let e;if("string"==typeof t.full)e=t.full;else if("dctypes:Image"===t.full["@type"])e={id:t.full["@id"],type:"Image"};else{if("sc:Canvas"!==t.full["@type"])throw new Error(`Unsupported source type on annotation: ${t.full["@type"]}`);e={id:t.full["@id"],type:"Canvas"}}return{type:"SpecificResource",source:e,selector:oe(t.selector)}}return encodeURI(t["@id"]).trim()}(e.on),body:Array.isArray(e.resource)?e.resource.map(ne):ne(e.resource)})}],contentResource:[ne],choice:[function(e){const t=[];return e.default&&"rdf:nil"!==e.default&&t.push(e.default),e.item&&"rdf:nil"!==e.item&&t.push(...e.item),{...ee(e),...te(e),items:t}}],range:[function(e){return Z({...ee(e),...te(e),...re(e),items:e.members})}],service:[function(e){const{"@id":t,"@type":i,"@context":r,profile:n,...s}=e,o={};return t&&(o["@id"]=t),o["@type"]=q(e),"unknown"===o["@type"]&&(r&&r.length&&(o["@context"]=r),o["@type"]="Service"),n&&(o.profile=j(n)),Z({...o,...s})}],layer:[function(e){return Z({...ee(e),...te(e),...re(e)})}]});function oe(e){if((Array.isArray(e["@type"])&&e["@type"].includes("oa:SvgSelector")||"oa:SvgSelector"==e["@type"])&&("chars"in e||"value"in e))return{type:"SvgSelector",value:"chars"in e?e.chars:e.value};if("oa:FragmentSelector"===e["@type"])return{type:"FragmentSelector",value:e.value};if("oa:Choice"===e["@type"])return[oe(e.default),...(Array.isArray(e.item)?e.item:[e.item]).map(oe)];if("iiif:ImageApiSelector"==e["@type"])return{type:"ImageApiSelector",region:"region"in e?e.region:void 0,rotation:"rotation"in e?e.rotation:void 0};throw new Error(`Unsupported selector type: ${e["@type"]}`)}function ae(e,t){if("string"==typeof e)return{id:e,type:t};if(!e.id)throw new Error(`Invalid resource does not have an ID (${t})`);return e}function le(e){return(t,i)=>{const r=e[t]?e[t]:{};return e=>{const n=ae(e,i||t);return n&&n.id&&t?(r[n.id]=r[n.id]?function(e,t){if("string"==typeof e)return e;if(t.id!==e.id||t.type!==e.type)throw new Error("Can only merge entities with identical identifiers and type!");return ce({...e},t)}(r[n.id],n):Object.assign({},n),{id:n.id,type:"ContentResource"===t?t:n.type}):n}}}function ce(e,t){if(!t)return e;if(Array.isArray(e)){if(!Array.isArray(t))throw new Error("Cannot merge array with non-array");const i=[...e];for(const r of t)if(null!=r)if(Array.isArray(r))i.push(r);else if("object"==typeof r&&r.id&&r.type){const e=i.findIndex((e=>e.id===r.id&&e.type===r.type));e>=0&&(i[e]=ce(i[e],r))}else-1===e.indexOf(r)&&i.push(r);return i}if("object"==typeof e){if(Array.isArray(t)||"object"!=typeof t)throw new Error("Cannot merge object with non-object");const i={...e};for(const[e,r]of Object.entries(t)){const t=i[e];i[e]=t!==a&&t?ce(t,r):r}return i}return e||t}function ue(e){const t=JSON.stringify(e);let i=5381,r=t.length;for(;r;)i=33*i^t.charCodeAt(--r);const n=(i>>>0).toString(16);return n.length%2?"0"+n:n}function he(e){return t=>"string"==typeof t?{id:t,type:e}:t.id?t.type?t:{type:e,...t}:{id:`vault://${ue(t)}`,type:e,...t}}function de(e){return t=>({...e,...t})}function fe(e){return Array.isArray(e)?e:[e]}function pe(e){return e.body&&(e.body=fe(e.body)),e.seeAlso&&(e.seeAlso=fe(e.seeAlso)),e.body&&(e.body=fe(e.body)),e.audience&&(e.audience=fe(e.audience)),e.accessibility&&(e.accessibility=fe(e.accessibility)),e.motivation&&(e.motivation=fe(e.motivation)),e}const ge="__$UNSET$__",me="__$UNWRAP$__";function ve(e){if(!e)return;const t=Object.keys(e);if(0!==t.length){if(1===t.length){const i=t[0];if(!i)return"";const r=(e[i]||[]).join("");return"@none"===i||"none"===i||"en"===i?r:{"@language":i,"@value":r}}return t.map((t=>({"@language":t,"@value":(e[t]||[]).join("")})))}}function ye(e){return Array.isArray(e)?e.map((e=>ye(e))):"string"==typeof e?e:e.type&&"Canvas"===e.type?e.id:e}function we(e,t=!1){if(e)return e.length>1&&!t?e:e[0]||void 0}function Ee(e){if(e){if("string"==typeof e)return{"@id":e};if("@id"in e){const t={...e};return delete t["@type"],t}return{"@context":"http://iiif.io/api/image/2/context.json","@id":e.id,profile:`http://iiif.io/api/image/2/profiles/${e.profile}.json`}}}function be(e,t){return[["@id",e.id],["@type",t],["format",e.format],["height",e.height],["width",e.width],["viewingDirection","left-to-right"!==e.viewingDirection?e.viewingDirection:void 0]]}function*Te(e){const t=e.provider?yield e.provider[0]:void 0;return[["label",ve(e.label)],["metadata",e.metadata&&e.metadata.length?e.metadata.map((e=>({label:ve(e.label)||"",value:ve(e.value)||""}))):void 0],["description",ve(e.summary)],["thumbnail",we(yield e.thumbnail)],["navDate",e.navDate],["logo",t?we(t.logo):void 0],["homepage",t?t.homepage:void 0],["attribution",e.requiredStatement?ve(e.requiredStatement.value):void 0]]}function*Se(e){return[["seeAlso",we(yield e.seeAlso)],["service",we((e.service||[]).map(Ee))],["rendering",we(yield e.rendering)],["startCanvas",e.start?e.start.id:void 0]]}const xe={Manifest:function*(e){return[...be(e,"sc:Manifest"),...yield*Te(e),...yield*Se(e),["sequences",[{"@id":`${e.id}/sequence0`,"@type":"sc:Sequence",canvases:yield e.items}]],["structures",yield e.structures]]},Canvas:function*(e){const t=(yield e.items)[0];return[...be(e,"sc:Canvas"),...yield*Te(e),...yield*Se(e),["images",t?[t.resources]:void 0],["annotations",e.annotations&&e.annotations.length?we(yield e.annotations):void 0]]},AnnotationPage:function*(e){return[...be(e,"sc:AnnotationList"),...yield*Te(e),["resources",e.items&&e.items.length?we(yield e.items):void 0]]},Annotation:function*(e){return[["@id",e.id],["@type","oa:Annotation"],["motivation","sc:painting"],["on",ye(e.target)],["resource",we(yield e.body,!0)]]},ContentResource:function*(e){return"Image"===e.type?[...be(e,"dctypes:Image"),...yield*Te(e),...yield*Se(e)]:[...be(e,void 0),...yield*Te(e)]},AnnotationCollection:function*(e){return[["@id",e.id],["@type","sc:Layer"],["label",ve(e.label)]]},Collection:function*(e){return[...be(e,"sc:Collection"),...yield*Te(e),...yield*Se(e),["members",yield*e.items]]},Range:function*(e){const t=[],i=[];if(e.items)for(const r of e.items){const n=yield r;t.push({"@id":r.id,"@type":r.type,label:n?n.label:void 0,within:e.id}),"Canvas"===r.type&&i.push(r.id)}return[...be(e,"sc:Range"),...yield*Te(e),...yield*Se(e),["canvases",i.length===t.length?i:void 0],["members",i.length!==t.length?t:void 0]]}};function Re(e){var t;return[["id",(null==(t=e.id)?void 0:t.startsWith("vault://"))?void 0:e.id],["type",e.type],["format",e.format],["profile",e.profile],["height",e.height],["width",e.width],["duration",e.duration||void 0],["viewingDirection","left-to-right"!==e.viewingDirection?e.viewingDirection:void 0],["behavior",e.behavior&&e.behavior.length?e.behavior:void 0],["timeMode",e.timeMode],["motivation",Array.isArray(e.motivation)?e.motivation[0]:e.motivation]]}function Ce(e){if(e&&0!==e.length)return e}function Ae(e){if(e&&e.type&&"ImageService2"===e.type){const{id:t,type:i,profile:r,...n}=e,s="string"==typeof r?r:Array.isArray(r)?r.find((e=>"string"==typeof e)):"";return{"@id":t,"@type":i,profile:s?s.startsWith("http")?s:`http://iiif.io/api/image/2/${s}.json`:"http://iiif.io/api/image/2/level0.json",...n}}return e}function ke(e){if(e&&0!==e.length)return e.map(Ae)}function*Le(e){return[["label",e.label],["metadata",Ce(e.metadata)],["summary",e.summary],["requiredStatement",e.requiredStatement],["rights",e.rights],["navDate",e.navDate],["language",e.language],["thumbnail",Ce(yield e.thumbnail)],["placeholderCanvas",yield e.placeholderCanvas],["accompanyingCanvas",yield e.accompanyingCanvas],["provider",Ce(yield e.provider)]]}function*Ie(e){return[["seeAlso",Ce(yield e.seeAlso)],["service",ke(e.service)],["services",ke(e.services)],["rendering",Ce(yield e.rendering)],["supplementary",Ce(yield e.supplementary)],["homepage",Ce(yield e.homepage)],["logo",Ce(yield e.logo)],["partOf",Ce(yield e.partOf)],["start",e.start]]}const Pe={Manifest:function*(e,t,{isTopLevel:i}){return i?[["@context","http://iiif.io/api/presentation/3/context.json"],...Re(e),...yield*Le(e),...yield*Ie(e),["items",yield e.items],["structures",Ce(yield e.structures)],["annotations",Ce(yield e.annotations)]]:[...Re(e),...yield*Le(e)]},Canvas:function*(e){return[...Re(e),...yield*Le(e),...yield*Ie(e),["items",yield e.items],["annotations",Ce(yield e.annotations)]]},Agent:function*(e){return[["id",e.id],["type","Agent"],["label",e.label],...yield*Ie(e)]},AnnotationPage:function*(e){return[...Object.entries(e).map((([e,t])=>[e,Array.isArray(t)?Ce(t):t])).filter((([e,t])=>"items"!==e)),...yield*Ie(e),["items",yield e.items]]},Service:function*(e){return[[me,Ae(e)]]},Annotation:function*(e){const t=Object.entries(e).map((([e,t])=>"motivation"===e?[e,Array.isArray(t)?t[0]:t]:[e,Array.isArray(t)?Ce(t):t])).filter((([e])=>"body"!==e)),i=yield e.body;return[...t,["body",1===i.length?i[0]:i]]},ContentResource:function*(e){return[...Re(e),...yield*Le(e),...yield*Ie(e),["annotations",Ce(yield e.annotations)],["items",Ce(yield e.items)]]},AnnotationCollection:function*(e){return[["id",e.id],["type","AnnotationCollection"],["label",e.label]]},Collection:function*(e,t,{isTopLevel:i}){return i?[["@context","http://iiif.io/api/presentation/3/context.json"],...Re(e),...yield*Le(e),...yield*Ie(e),["items",Ce(yield e.items)]]:[...Re(e),...yield*Le(e)]},Range:function*(e){const t=[];for(const i of e.items)"Range"===i.type?t.push(yield i):t.push(i);return[...Re(e),...yield*Le(e),...yield*Ie(e),["items",t],["annotations",Ce(yield e.annotations)]]}};var _e=__webpack_require__(1757);function De(e){return De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},De(e)}function Oe(e){var t=function(e,t){if("object"!==De(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!==De(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===De(t)?t:String(t)}function Me(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function Fe(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Me(Object(i),!0).forEach((function(t){var r,n,s;r=e,n=t,s=i[t],(n=Oe(n))in r?Object.defineProperty(r,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[n]=s})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Me(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Ne(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var Be="function"==typeof Symbol&&Symbol.observable||"@@observable",Ue=function(){return Math.random().toString(36).substring(7).split("").join(".")},$e={INIT:"@@redux/INIT"+Ue(),REPLACE:"@@redux/REPLACE"+Ue(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+Ue()}};function He(e,t,i){var r;if("function"==typeof t&&"function"==typeof i||"function"==typeof i&&"function"==typeof arguments[3])throw new Error(Ne(0));if("function"==typeof t&&void 0===i&&(i=t,t=void 0),void 0!==i){if("function"!=typeof i)throw new Error(Ne(1));return i(He)(e,t)}if("function"!=typeof e)throw new Error(Ne(2));var n=e,s=t,o=[],a=o,l=!1;function c(){a===o&&(a=o.slice())}function u(){if(l)throw new Error(Ne(3));return s}function h(e){if("function"!=typeof e)throw new Error(Ne(4));if(l)throw new Error(Ne(5));var t=!0;return c(),a.push(e),function(){if(t){if(l)throw new Error(Ne(6));t=!1,c();var i=a.indexOf(e);a.splice(i,1),o=null}}}function d(e){if(!function(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(e))throw new Error(Ne(7));if(void 0===e.type)throw new Error(Ne(8));if(l)throw new Error(Ne(9));try{l=!0,s=n(s,e)}finally{l=!1}for(var t=o=a,i=0;i<t.length;i++)(0,t[i])();return e}return d({type:$e.INIT}),(r={dispatch:d,subscribe:h,getState:u,replaceReducer:function(e){if("function"!=typeof e)throw new Error(Ne(10));n=e,d({type:$e.REPLACE})}})[Be]=function(){var e,t=h;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new Error(Ne(11));function i(){e.next&&e.next(u())}return i(),{unsubscribe:t(i)}}})[Be]=function(){return this},e},r}function ze(e){for(var t=Object.keys(e),i={},r=0;r<t.length;r++){var n=t[r];"function"==typeof e[n]&&(i[n]=e[n])}var s,o=Object.keys(i);try{!function(e){Object.keys(e).forEach((function(t){var i=e[t];if(void 0===i(void 0,{type:$e.INIT}))throw new Error(Ne(12));if(void 0===i(void 0,{type:$e.PROBE_UNKNOWN_ACTION()}))throw new Error(Ne(13))}))}(i)}catch(e){s=e}return function(e,t){if(void 0===e&&(e={}),s)throw s;for(var r=!1,n={},a=0;a<o.length;a++){var l=o[a],c=i[l],u=e[l],h=c(u,t);if(void 0===h)throw t&&t.type,new Error(Ne(14));n[l]=h,r=r||h!==u}return(r=r||o.length!==Object.keys(e).length)?n:e}}function je(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function Ge(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(e){return function(){var i=e.apply(void 0,arguments),r=function(){throw new Error(Ne(15))},n={getState:i.getState,dispatch:function(){return r.apply(void 0,arguments)}},s=t.map((function(e){return e(n)}));return r=je.apply(void 0,s)(i.dispatch),Fe(Fe({},i),{},{dispatch:r})}}}const Ve="@iiif/IMPORT_ENTITIES",qe="@iiif/MODIFY_ENTITY_FIELD",We="@iiif/REORDER_ENTITY_FIELD",Ke="@iiif/ADD_REFERENCE",Ye="@iiif/REMOVE_REFERENCE",Xe=(0,_e.createAction)(Ve)(),Ze=(0,_e.createAction)(qe)(),Qe=(0,_e.createAction)(We)(),Je=(0,_e.createAction)(Ke)(),et=(0,_e.createAction)(Ye)(),tt={importEntities:Xe,modifyEntityField:Ze,reorderEntityField:Qe,addReference:Je,removeReference:et},it="@iiif/ADD_MAPPING",rt="@iiif/ADD_MAPPINGS",nt=(0,_e.createAction)(it)(),st=(0,_e.createAction)(rt)(),ot="@iiif/SET_META_VALUE",at="@iiif/SET_META_VALUE_DYNAMIC",lt="@iiif/UNSET_META_VALUE",ct={setMetaValue:(0,_e.createAction)(ot)(),setMetaValueDynamic:(0,_e.createAction)(at)(),unsetMetaValue:(0,_e.createAction)(lt)()},ut="RESOURCE_ERROR",ht="RESOURCE_LOADING",dt="RESOURCE_READY",ft="@iiif/REQUEST_RESOURCE",pt="@iiif/REQUEST_ERROR",gt="@iiif/REQUEST_MISMATCH",mt="@iiif/REQUEST_COMPLETE",vt="@iiif/REQUEST_OFFLINE_RESOURCE",yt=(0,_e.createAction)(ft)(),wt=(0,_e.createAction)(pt)(),Et=(0,_e.createAction)(gt)(),bt=(0,_e.createAction)(mt)();(0,_e.createAction)(vt)();const Tt="@iiif/BATCH",St="@iiif/BATCH_IMPORT",xt=(0,_e.createAction)(Tt)();(0,_e.createAction)(St)();const Rt=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function Ct(e,t){if(!Array.isArray(e)||!Array.isArray(t))return e===t;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!((i=e[n])===(r=t[n])||Rt(i)&&Rt(r)))return!1;var i,r;return!0}function At(e,t){const i=e.iiif.requests[t],r=e.iiif.mapping[t];if(r&&e.iiif.entities[r][i.resourceUri])return e.iiif.entities[r][i.resourceUri]}function kt(e,t,{waitTimeout:i=30}={}){return async(r,n)=>{const s=e.getState(),o=s.iiif.requests[r];if(o)switch(o.loadingState){case ut:break;case ht:{let t,n=!1;try{const s=await Promise.race([new Promise(((i,s)=>{n||(t=e.subscribe((()=>{const t=e.getState();if(t.iiif.requests[r].loadingState!==ut){if(t.iiif.requests[r].loadingState===dt){const e=At(t,r);e?i(e):s()}}else s()})))})),new Promise(((e,t)=>setTimeout((()=>{n=!0,t()}),60*i)))]);if(t&&t(),s)return s}catch(e){t&&t();break}break}case dt:{const e=At(s,r);if(e)return e;break}}e.dispatch(yt({id:r}));try{const i=await t(r,n);i.id||i["@id"]||(i["@type"]?(i["@id"]=r,i.id=r):i.id=r);const s=((e,t)=>{const{entities:i,resource:r,mapping:n}=function(e){const t=function(e){return e&&e["@context"]&&("http://iiif.io/api/presentation/2/context.json"===e["@context"]||-1!==e["@context"].indexOf("http://iiif.io/api/presentation/2/context.json")||"http://www.shared-canvas.org/ns/context.json"===e["@context"])||"http://iiif.io/api/image/2/context.json"===e["@context"]?se.traverseUnknown(e):e}(e),i={Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}},r={},n=le(i),s=function(e){return(t,i)=>r=>{const{id:n,type:s}=ae(r,i||t);if(void 0===n)throw new Error("Found invalid entity without an ID.");return e[n]="ContentResource"===t?t:s,r}}(r);return{entities:i,resource:new m({collection:[de(u),s("Collection"),n("Collection")],manifest:[de(h),s("Manifest"),n("Manifest")],canvas:[de(c),s("Canvas"),n("Canvas")],annotationPage:[he("AnnotationPage"),de(l),s("AnnotationPage"),n("AnnotationPage")],annotation:[he("Annotation"),pe,s("Annotation"),n("Annotation")],contentResource:[he("ContentResource"),s("ContentResource"),n("ContentResource")],range:[de(d),s("Range","Canvas"),n("Range","Canvas")],agent:[de(f),s("Agent"),n("Agent")]}).traverseUnknown(t),mapping:r}}(t);if(void 0===r.id)return[wt({id:e,message:"ID is not defined in resource."})];const s=[Xe({entities:i}),st({mapping:n})];return r.id!==e&&(s.push(nt({id:e,type:r.type})),s.push(Et({requestId:e,actualId:r.id}))),s.push(bt({id:e})),s})(r,i);return e.dispatch(xt({actions:s})),At(e.getState(),r)}catch(t){throw e.dispatch(wt({id:r,message:t.toString()})),t}}}function Lt(e,t,i,r){return!!(e[i]&&e[i][t]&&e[i][t][r]&&Array.isArray(e[i][t][r]))}function It(e,t){const i={},r=[];for(const[n,s]of Object.entries(e||{})){r.push(n);const e=(t||{})[n];e&&0!==e.length?i[n]=e:i[n]=s}for(const[e,n]of Object.entries(t||{}))-1===r.indexOf(e)&&(i[e]=n);return i}const Pt=ze({mapping:(e={},t)=>{switch(t.type){case it:return{...e,[t.payload.id]:t.payload.type};case rt:return{...e,...t.payload.mapping};default:return e}},entities:(e={Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}},t)=>{switch(t.type){case qe:{if(!e[t.payload.type]||!e[t.payload.type][t.payload.id])return e;const i=e[t.payload.type][t.payload.id];return"string"==typeof i?e:{...e,[t.payload.type]:{...e[t.payload.type],[t.payload.id]:{...i,[t.payload.key]:t.payload.value}}}}case We:{if(!Lt(e,t.payload.id,t.payload.type,t.payload.key))return e;const i=e[t.payload.type][t.payload.id];if("string"==typeof i)return e;const r=Array.from(i[t.payload.key]),[n]=r.splice(t.payload.startIndex,1);return r.splice(t.payload.endIndex,0,n),{...e,[t.payload.type]:{...e[t.payload.type],[t.payload.id]:{...i,[t.payload.key]:r}}}}case Ve:{const i=Object.keys(t.payload.entities),r={...e};for(const n of i){const i=t.payload.entities[n],s={...e[n]||{}};let o=!1;const a=Object.keys(i||{})||[];if(i&&a){for(const t of a)o=!0,s[t]=e[n][t]?It(e[n][t],i[t]):i[t];o&&(r[n]=s)}}return r}case Ke:{if(!Lt(e,t.payload.id,t.payload.type,t.payload.key))return e;const i=e[t.payload.type][t.payload.id],r=Array.from(i[t.payload.key]);return r.splice(t.payload.index||r.length+1,0,t.payload.reference),{...e,[t.payload.type]:{...e[t.payload.type],[t.payload.id]:{...i,[t.payload.key]:r}}}}case Ye:{if(!Lt(e,t.payload.id,t.payload.type,t.payload.key))return e;const i=e[t.payload.type][t.payload.id],r=Array.from(i[t.payload.key]),n=t.payload.index||r.findIndex((e=>e&&e.id===t.payload.reference.id));return-1===n||r[n]?.id!==t.payload.reference.id?e:(r.splice(n,1),{...e,[t.payload.type]:{...e[t.payload.type],[t.payload.id]:{...i,[t.payload.key]:r}}})}default:return e}},requests:(e={},t)=>{switch(t.type){case ft:case vt:return{...e,[t.payload.id]:{requestUri:t.payload.id,loadingState:ht,uriMismatch:!1,resourceUri:t.payload.id}};case gt:return{...e,[t.payload.requestId]:{...e[t.payload.requestId]||{},uriMismatch:!0,resourceUri:t.payload.actualId},[t.payload.actualId]:{requestUri:t.payload.requestId,loadingState:e[t.payload.requestId].loadingState,uriMismatch:!0,resourceUri:t.payload.actualId}};case pt:return{...e,[t.payload.id]:{...e[t.payload.id]||{},loadingState:ut,error:t.payload.message}};case mt:return{...e,[t.payload.id]:{...e[t.payload.id]||{},loadingState:dt,error:void 0}}}return e},meta:(e={},t)=>{const{id:i,updateValue:r,value:n,meta:s,key:o}=t&&t.payload||{};switch(t.type){case ot:return{...e,[i]:{...e[i]||{},[s]:{...e[i]&&e[i][s]||{},[o]:n}}};case at:return{...e,[i]:{...e[i]||{},[s]:{...e[i]&&e[i][s]||{},[o]:e[i]&&e[i][s]?r(e[i][s][o]):r(void 0)}}};case lt:return e[i]&&e[i][s]&&e[i][s][o]?{...e,[i]:{...e[i]||{},[s]:{...e[i]&&e[i][s]||{},[o]:void 0}}}:e;default:return e}}}),_t="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||je;class Dt{options;store;emitter;isBatching=!1;batchQueue=[];remoteFetcher;staticFetcher;constructor(e,t){this.options=Object.assign({reducers:{},middleware:[],defaultState:{},customFetcher:this.defaultFetcher,enableDevtools:!0},e||{}),this.store=t||function(e={}){const{enableDevtools:t=!0,iiifStoreName:i="iiif",defaultState:r={},extraMiddleware:n=[],customReducers:s={}}=e;var o;return He((o=ze({[i]:Pt,...s}),(e,t)=>t&&t.type===Tt?t.payload.actions.reduce(o,e):t&&t.type===St?t.payload.state:o(e,t)),r,t?_t(Ge(...n)):je(Ge(...n)))}({customReducers:this.options.reducers,extraMiddleware:[...this.options.middleware,this.middleware],defaultState:this.options.defaultState,enableDevtools:this.options.enableDevtools}),this.emitter=function(e){return{all:e=e||new Map,on:function(t,i){var r=e.get(t);r?r.push(i):e.set(t,[i])},off:function(t,i){var r=e.get(t);r&&(i?r.splice(r.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var r=e.get(t);r&&r.slice().map((function(e){e(i)})),(r=e.get("*"))&&r.slice().map((function(e){e(t,i)}))}}}(),this.remoteFetcher=kt(this.store,this.options.customFetcher),this.staticFetcher=kt(this.store,((e,t)=>t))}defaultFetcher=e=>fetch(e).then((e=>e.json()));batch(e){this.isBatching=!0;try{e(this),this.store.dispatch(xt({actions:this.batchQueue}))}catch(e){throw this.batchQueue=[],this.isBatching=!1,e}this.batchQueue=[],this.isBatching=!1}async asyncBatch(e){this.isBatching=!0;try{await e(this),this.store.dispatch(xt({actions:this.batchQueue}))}catch(e){throw this.batchQueue=[],this.isBatching=!1,e}this.batchQueue=[],this.isBatching=!1}modifyEntityField(e,t,i){this.dispatch(tt.modifyEntityField({id:e.id,type:e.type,key:t,value:i}))}dispatch(e){this.isBatching?this.batchQueue.push(e):this.store.dispatch(e)}middleware=e=>t=>i=>{if(i.type===Tt){for(const t of i.payload.actions)this.emitter.emit(t.type,{realAction:t,state:e.getState()});const r=t(i);for(const e of i.payload.actions)this.emitter.emit(`after:${i.type}`,{action:i,state:r});return r}this.emitter.emit(i.type,{action:i,state:e.getState()});const r=t(i);return this.emitter.emit(`after:${i.type}`,{action:i,state:r}),r};serialize(e,t){return function(e,t,i){if(!t.type||!t.id)throw new Error("Unknown entity");if(!i[t.type])throw new Error(`Serializer not found for ${t.type}`);return function r(n){const s=i[n.type];if(!s)return ge;const o=function(e,t){const i=e.requests[t],r=e.mapping[t];if(r&&(!i||!i.resourceUri||e.entities[r][i.resourceUri]))return e.entities[r][i?i.resourceUri:t]}(e,n.id)||(n.id&&n.type?n:null);if(!o)return ge;const a=s(o,e,{isTopLevel:t.id===n.id});let l=a.next();for(;!l.done;){const e=l.value;let t=ge;if(e)if(Array.isArray(e)){const i=[];for(const t of e)i.push(r(t));t=i}else t=r(e);l=a.next(t)}return l.value===ge?ge:function(e){const t={};for(const[i,r]of e){if(i===me&&r!==ge)return r;r!==ge&&null!=r&&(t[i]=r)}return t}(l.value)}(t)}(this.getState().iiif,e,t)}toPresentation2(e){return this.serialize(e,xe)}toPresentation3(e){return this.serialize(e,Pe)}hydrate(e,t){return this.get(e,t,{skipSelfReturn:!1})}get(e,t,i={}){"string"!=typeof t&&(i=t||{},t=void 0);const{skipSelfReturn:r=!0}=i||{};if(Array.isArray(e))return e.map((e=>this.get(e,i)));const n=this.getState();if("string"==typeof e){const i=t||n.iiif.mapping[e];if(!i)return r?null:{id:e,type:"unknown"};e={id:e,type:i}}const s=t||e.type,o=e.id,a=n.iiif.entities[s];if(!a){const t=n.iiif.requests[o];return t&&t.resourceUri!==o?this.get(t.resourceUri,i):r?null:e}return a[e.id]||(r?null:e)}select(e){return e(this.getState())}getStore(){return this.store}getState(){return this.store.getState()}loadManifest(e,t){const i="string"==typeof e?e:e.id;return this.load(i,t)}loadCollection(e,t){const i="string"==typeof e?e:e.id;return this.load(i,t)}load(e,t){const i="string"==typeof e?e:e.id;return t?this.staticFetcher(i,t):this.remoteFetcher(i)}areInputsEqual(e,t){return Ct(e,t)}subscribe(e,t,i){void 0!==i||void 0!==t&&!1!==t&&!0!==t||(i=t,t=e,e=e=>e);let r=i?null:e(this.store.getState());return i||t(r,this),this.store.subscribe((()=>{const i=this.store.getState(),n=e(i);r===n||Ct(r,n)||t(n,this),r=n}))}async ensureLoaded(e){const t="string"==typeof e?e:e.id;this.requestStatus(t)||await this.load(t)}requestStatus(e){return this.select((t=>t.iiif.requests[e]))}getResourceMeta(e,t){const i=this.getState().iiif.meta[e];if(i)return t?i[t]:i}setMetaValue([e,t,i],r){this.dispatch("function"==typeof r?ct.setMetaValueDynamic({id:e,meta:t,key:i,updateValue:r}):ct.setMetaValue({id:e,meta:t,key:i,value:r}))}}function Ot(){return Ot=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},Ot.apply(this,arguments)}function Mt(e,t,{checkForDefaultPrevented:i=!0}={}){return function(r){if(null==e||e(r),!1===i||!r.defaultPrevented)return null==t?void 0:t(r)}}function Ft(t,i=[]){let r=[];const n=()=>{const i=r.map((t=>(0,e.createContext)(t)));return function(r){const n=(null==r?void 0:r[t])||i;return(0,e.useMemo)((()=>({[`__scope${t}`]:{...r,[t]:n}})),[r,n])}};return n.scopeName=t,[function(i,n){const s=(0,e.createContext)(n),o=r.length;function a(i){const{scope:r,children:n,...a}=i,l=(null==r?void 0:r[t][o])||s,c=(0,e.useMemo)((()=>a),Object.values(a));return(0,e.createElement)(l.Provider,{value:c},n)}return r=[...r,n],a.displayName=i+"Provider",[a,function(r,a){const l=(null==a?void 0:a[t][o])||s,c=(0,e.useContext)(l);if(c)return c;if(void 0!==n)return n;throw new Error(`\`${r}\` must be used within \`${i}\``)}]},Nt(n,...i)]}function Nt(...t){const i=t[0];if(1===t.length)return i;const r=()=>{const r=t.map((e=>({useScope:e(),scopeName:e.scopeName})));return function(t){const n=r.reduce(((e,{useScope:i,scopeName:r})=>({...e,...i(t)[`__scope${r}`]})),{});return(0,e.useMemo)((()=>({[`__scope${i.scopeName}`]:n})),[n])}};return r.scopeName=i.scopeName,r}function Bt(t){const i=(0,e.useRef)(t);return(0,e.useEffect)((()=>{i.current=t})),(0,e.useMemo)((()=>(...e)=>{var t;return null===(t=i.current)||void 0===t?void 0:t.call(i,...e)}),[])}function Ut({prop:t,defaultProp:i,onChange:r=(()=>{})}){const[n,s]=function({defaultProp:t,onChange:i}){const r=(0,e.useState)(t),[n]=r,s=(0,e.useRef)(n),o=Bt(i);return(0,e.useEffect)((()=>{s.current!==n&&(o(n),s.current=n)}),[n,s,o]),r}({defaultProp:i,onChange:r}),o=void 0!==t,a=o?t:n,l=Bt(r);return[a,(0,e.useCallback)((e=>{if(o){const i="function"==typeof e?e(t):e;i!==t&&l(i)}else s(e)}),[o,t,s,l])]}const $t=Boolean(null===globalThis||void 0===globalThis?void 0:globalThis.document)?e.useLayoutEffect:()=>{};function Ht(...e){return t=>e.forEach((e=>function(e,t){"function"==typeof e?e(t):null!=e&&(e.current=t)}(e,t)))}function zt(...t){return(0,e.useCallback)(Ht(...t),t)}const jt=window.ReactDOM,Gt=(0,e.forwardRef)(((t,i)=>{const{children:r,...n}=t,s=e.Children.toArray(r),o=s.find(Wt);if(o){const t=o.props.children,r=s.map((i=>i===o?e.Children.count(t)>1?e.Children.only(null):(0,e.isValidElement)(t)?t.props.children:null:i));return(0,e.createElement)(Vt,Ot({},n,{ref:i}),(0,e.isValidElement)(t)?(0,e.cloneElement)(t,void 0,r):null)}return(0,e.createElement)(Vt,Ot({},n,{ref:i}),r)}));Gt.displayName="Slot";const Vt=(0,e.forwardRef)(((t,i)=>{const{children:r,...n}=t;return(0,e.isValidElement)(r)?(0,e.cloneElement)(r,{...Kt(n,r.props),ref:i?Ht(i,r.ref):r.ref}):e.Children.count(r)>1?e.Children.only(null):null}));Vt.displayName="SlotClone";const qt=({children:t})=>(0,e.createElement)(e.Fragment,null,t);function Wt(t){return(0,e.isValidElement)(t)&&t.type===qt}function Kt(e,t){const i={...t};for(const r in t){const n=e[r],s=t[r];/^on[A-Z]/.test(r)?n&&s?i[r]=(...e)=>{s(...e),n(...e)}:n&&(i[r]=n):"style"===r?i[r]={...n,...s}:"className"===r&&(i[r]=[n,s].filter(Boolean).join(" "))}return{...e,...i}}const Yt=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce(((t,i)=>{const r=(0,e.forwardRef)(((t,r)=>{const{asChild:n,...s}=t,o=n?Gt:i;return(0,e.useEffect)((()=>{window[Symbol.for("radix-ui")]=!0}),[]),(0,e.createElement)(o,Ot({},s,{ref:r}))}));return r.displayName=`Primitive.${i}`,{...t,[i]:r}}),{});function Xt(e,t){e&&(0,jt.flushSync)((()=>e.dispatchEvent(t)))}const Zt=t=>{const{present:i,children:r}=t,n=function(t){const[i,r]=(0,e.useState)(),n=(0,e.useRef)({}),s=(0,e.useRef)(t),o=(0,e.useRef)("none"),a=t?"mounted":"unmounted",[l,c]=function(t,i){return(0,e.useReducer)(((e,t)=>{const r=i[e][t];return null!=r?r:e}),t)}(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return(0,e.useEffect)((()=>{const e=Qt(n.current);o.current="mounted"===l?e:"none"}),[l]),$t((()=>{const e=n.current,i=s.current;if(i!==t){const r=o.current,n=Qt(e);t?c("MOUNT"):"none"===n||"none"===(null==e?void 0:e.display)?c("UNMOUNT"):c(i&&r!==n?"ANIMATION_OUT":"UNMOUNT"),s.current=t}}),[t,c]),$t((()=>{if(i){const e=e=>{const t=Qt(n.current).includes(e.animationName);e.target===i&&t&&(0,jt.flushSync)((()=>c("ANIMATION_END")))},t=e=>{e.target===i&&(o.current=Qt(n.current))};return i.addEventListener("animationstart",t),i.addEventListener("animationcancel",e),i.addEventListener("animationend",e),()=>{i.removeEventListener("animationstart",t),i.removeEventListener("animationcancel",e),i.removeEventListener("animationend",e)}}c("ANIMATION_END")}),[i,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:(0,e.useCallback)((e=>{e&&(n.current=getComputedStyle(e)),r(e)}),[])}}(i),s="function"==typeof r?r({present:n.isPresent}):e.Children.only(r),o=zt(n.ref,s.ref);return"function"==typeof r||n.isPresent?(0,e.cloneElement)(s,{ref:o}):null};function Qt(e){return(null==e?void 0:e.animationName)||"none"}Zt.displayName="Presence";const Jt=t["useId".toString()]||(()=>{});let ei=0;function ti(t){const[i,r]=e.useState(Jt());return $t((()=>{t||r((e=>null!=e?e:String(ei++)))}),[t]),t||(i?`radix-${i}`:"")}const ii="Collapsible",[ri,ni]=Ft(ii),[si,oi]=ri(ii),ai=(0,e.forwardRef)(((t,i)=>{const{__scopeCollapsible:r,open:n,defaultOpen:s,disabled:o,onOpenChange:a,...l}=t,[c=!1,u]=Ut({prop:n,defaultProp:s,onChange:a});return(0,e.createElement)(si,{scope:r,disabled:o,contentId:ti(),open:c,onOpenToggle:(0,e.useCallback)((()=>u((e=>!e))),[u])},(0,e.createElement)(Yt.div,Ot({"data-state":di(c),"data-disabled":o?"":void 0},l,{ref:i})))})),li=(0,e.forwardRef)(((t,i)=>{const{__scopeCollapsible:r,...n}=t,s=oi("CollapsibleTrigger",r);return(0,e.createElement)(Yt.button,Ot({type:"button","aria-controls":s.contentId,"aria-expanded":s.open||!1,"data-state":di(s.open),"data-disabled":s.disabled?"":void 0,disabled:s.disabled},n,{ref:i,onClick:Mt(t.onClick,s.onOpenToggle)}))})),ci="CollapsibleContent",ui=(0,e.forwardRef)(((t,i)=>{const{forceMount:r,...n}=t,s=oi(ci,t.__scopeCollapsible);return(0,e.createElement)(Zt,{present:r||s.open},(({present:t})=>(0,e.createElement)(hi,Ot({},n,{ref:i,present:t}))))})),hi=(0,e.forwardRef)(((t,i)=>{const{__scopeCollapsible:r,present:n,children:s,...o}=t,a=oi(ci,r),[l,c]=(0,e.useState)(n),u=(0,e.useRef)(null),h=zt(i,u),d=(0,e.useRef)(0),f=d.current,p=(0,e.useRef)(0),g=p.current,m=a.open||l,v=(0,e.useRef)(m),y=(0,e.useRef)();return(0,e.useEffect)((()=>{const e=requestAnimationFrame((()=>v.current=!1));return()=>cancelAnimationFrame(e)}),[]),$t((()=>{const e=u.current;if(e){y.current=y.current||{transitionDuration:e.style.transitionDuration,animationName:e.style.animationName},e.style.transitionDuration="0s",e.style.animationName="none";const t=e.getBoundingClientRect();d.current=t.height,p.current=t.width,v.current||(e.style.transitionDuration=y.current.transitionDuration,e.style.animationName=y.current.animationName),c(n)}}),[a.open,n]),(0,e.createElement)(Yt.div,Ot({"data-state":di(a.open),"data-disabled":a.disabled?"":void 0,id:a.contentId,hidden:!m},o,{ref:h,style:{"--radix-collapsible-content-height":f?`${f}px`:void 0,"--radix-collapsible-content-width":g?`${g}px`:void 0,...t.style}}),m&&s)}));function di(e){return e?"open":"closed"}const fi=ai,pi=li,gi=ui,mi=(0,e.createContext)(null),vi={didCatch:!1,error:null};class yi extends e.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=vi}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(null!==e){for(var t,i,r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];null===(t=(i=this.props).onReset)||void 0===t||t.call(i,{args:n,reason:"imperative-api"}),this.setState(vi)}}componentDidCatch(e,t){var i,r;null===(i=(r=this.props).onError)||void 0===i||i.call(r,e,t)}componentDidUpdate(e,t){const{didCatch:i}=this.state,{resetKeys:r}=this.props;var n,s;i&&null!==t.error&&function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.length!==t.length||e.some(((e,i)=>!Object.is(e,t[i])))}(e.resetKeys,r)&&(null===(n=(s=this.props).onReset)||void 0===n||n.call(s,{next:r,prev:e.resetKeys,reason:"keys"}),this.setState(vi))}render(){const{children:t,fallbackRender:i,FallbackComponent:r,fallback:n}=this.props,{didCatch:s,error:o}=this.state;let a=t;if(s){const t={error:o,resetErrorBoundary:this.resetErrorBoundary};if((0,e.isValidElement)(n))a=n;else if("function"==typeof i)a=i(t);else{if(!r)throw o;a=(0,e.createElement)(r,t)}}return(0,e.createElement)(mi.Provider,{value:{didCatch:s,error:o,resetErrorBoundary:this.resetErrorBoundary}},a)}}var wi,Ei="colors",bi="sizes",Ti="space",Si={gap:Ti,gridGap:Ti,columnGap:Ti,gridColumnGap:Ti,rowGap:Ti,gridRowGap:Ti,inset:Ti,insetBlock:Ti,insetBlockEnd:Ti,insetBlockStart:Ti,insetInline:Ti,insetInlineEnd:Ti,insetInlineStart:Ti,margin:Ti,marginTop:Ti,marginRight:Ti,marginBottom:Ti,marginLeft:Ti,marginBlock:Ti,marginBlockEnd:Ti,marginBlockStart:Ti,marginInline:Ti,marginInlineEnd:Ti,marginInlineStart:Ti,padding:Ti,paddingTop:Ti,paddingRight:Ti,paddingBottom:Ti,paddingLeft:Ti,paddingBlock:Ti,paddingBlockEnd:Ti,paddingBlockStart:Ti,paddingInline:Ti,paddingInlineEnd:Ti,paddingInlineStart:Ti,top:Ti,right:Ti,bottom:Ti,left:Ti,scrollMargin:Ti,scrollMarginTop:Ti,scrollMarginRight:Ti,scrollMarginBottom:Ti,scrollMarginLeft:Ti,scrollMarginX:Ti,scrollMarginY:Ti,scrollMarginBlock:Ti,scrollMarginBlockEnd:Ti,scrollMarginBlockStart:Ti,scrollMarginInline:Ti,scrollMarginInlineEnd:Ti,scrollMarginInlineStart:Ti,scrollPadding:Ti,scrollPaddingTop:Ti,scrollPaddingRight:Ti,scrollPaddingBottom:Ti,scrollPaddingLeft:Ti,scrollPaddingX:Ti,scrollPaddingY:Ti,scrollPaddingBlock:Ti,scrollPaddingBlockEnd:Ti,scrollPaddingBlockStart:Ti,scrollPaddingInline:Ti,scrollPaddingInlineEnd:Ti,scrollPaddingInlineStart:Ti,fontSize:"fontSizes",background:Ei,backgroundColor:Ei,backgroundImage:Ei,borderImage:Ei,border:Ei,borderBlock:Ei,borderBlockEnd:Ei,borderBlockStart:Ei,borderBottom:Ei,borderBottomColor:Ei,borderColor:Ei,borderInline:Ei,borderInlineEnd:Ei,borderInlineStart:Ei,borderLeft:Ei,borderLeftColor:Ei,borderRight:Ei,borderRightColor:Ei,borderTop:Ei,borderTopColor:Ei,caretColor:Ei,color:Ei,columnRuleColor:Ei,fill:Ei,outline:Ei,outlineColor:Ei,stroke:Ei,textDecorationColor:Ei,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:bi,minBlockSize:bi,maxBlockSize:bi,inlineSize:bi,minInlineSize:bi,maxInlineSize:bi,width:bi,minWidth:bi,maxWidth:bi,height:bi,minHeight:bi,maxHeight:bi,flexBasis:bi,gridTemplateColumns:bi,gridTemplateRows:bi,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},xi=(e,t)=>"function"==typeof t?{"()":Function.prototype.toString.call(t)}:t,Ri=()=>{const e=Object.create(null);return(t,i,...r)=>{const n=(e=>JSON.stringify(e,xi))(t);return n in e?e[n]:e[n]=i(t,...r)}},Ci=Symbol.for("sxs.internal"),Ai=(e,t)=>Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)),ki=e=>{for(const t in e)return!0;return!1},{hasOwnProperty:Li}=Object.prototype,Ii=e=>e.includes("-")?e:e.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase())),Pi=/\s+(?![^()]*\))/,_i=e=>t=>e(..."string"==typeof t?String(t).split(Pi):[t]),Di={appearance:e=>({WebkitAppearance:e,appearance:e}),backfaceVisibility:e=>({WebkitBackfaceVisibility:e,backfaceVisibility:e}),backdropFilter:e=>({WebkitBackdropFilter:e,backdropFilter:e}),backgroundClip:e=>({WebkitBackgroundClip:e,backgroundClip:e}),boxDecorationBreak:e=>({WebkitBoxDecorationBreak:e,boxDecorationBreak:e}),clipPath:e=>({WebkitClipPath:e,clipPath:e}),content:e=>({content:e.includes('"')||e.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(e)?e:`"${e}"`}),hyphens:e=>({WebkitHyphens:e,hyphens:e}),maskImage:e=>({WebkitMaskImage:e,maskImage:e}),maskSize:e=>({WebkitMaskSize:e,maskSize:e}),tabSize:e=>({MozTabSize:e,tabSize:e}),textSizeAdjust:e=>({WebkitTextSizeAdjust:e,textSizeAdjust:e}),userSelect:e=>({WebkitUserSelect:e,userSelect:e}),marginBlock:_i(((e,t)=>({marginBlockStart:e,marginBlockEnd:t||e}))),marginInline:_i(((e,t)=>({marginInlineStart:e,marginInlineEnd:t||e}))),maxSize:_i(((e,t)=>({maxBlockSize:e,maxInlineSize:t||e}))),minSize:_i(((e,t)=>({minBlockSize:e,minInlineSize:t||e}))),paddingBlock:_i(((e,t)=>({paddingBlockStart:e,paddingBlockEnd:t||e}))),paddingInline:_i(((e,t)=>({paddingInlineStart:e,paddingInlineEnd:t||e})))},Oi=/([\d.]+)([^]*)/,Mi=(e,t)=>e.length?e.reduce(((e,i)=>(e.push(...t.map((e=>e.includes("&")?e.replace(/&/g,/[ +>|~]/.test(i)&&/&.*&/.test(e)?`:is(${i})`:i):i+" "+e))),e)),[]):t,Fi=(e,t)=>e in Ni&&"string"==typeof t?t.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,((t,i,r,n)=>i+("stretch"===r?`-moz-available${n};${Ii(e)}:${i}-webkit-fill-available`:`-moz-fit-content${n};${Ii(e)}:${i}fit-content`)+n)):String(t),Ni={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},Bi=e=>e?e+"-":"",Ui=(e,t,i)=>e.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,((e,r,n,s,o)=>"$"==s==!!n?e:(r||"--"==s?"calc(":"")+"var(--"+("$"===s?Bi(t)+(o.includes("$")?"":Bi(i))+o.replace(/\$/g,"-"):o)+")"+(r||"--"==s?"*"+(r||"")+(n||"1")+")":""))),$i=/\s*,\s*(?![^()]*\))/,Hi=Object.prototype.toString,zi=(e,t,i,r,n)=>{let s,o,a;const l=(e,t,i)=>{let c,u;const h=e=>{for(c in e){const p=64===c.charCodeAt(0),g=p&&Array.isArray(e[c])?e[c]:[e[c]];for(u of g){const e=/[A-Z]/.test(f=c)?f:f.replace(/-[^]/g,(e=>e[1].toUpperCase())),g="object"==typeof u&&u&&u.toString===Hi&&(!r.utils[e]||!t.length);if(e in r.utils&&!g){const t=r.utils[e];if(t!==o){o=t,h(t(u)),o=null;continue}}else if(e in Di){const t=Di[e];if(t!==a){a=t,h(t(u)),a=null;continue}}if(p&&(d=c.slice(1)in r.media?"@media "+r.media[c.slice(1)]:c,c=d.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,((e,t,i,r,n,s)=>{const o=Oi.test(t),a=.0625*(o?-1:1),[l,c]=o?[r,t]:[t,r];return"("+("="===i[0]?"":">"===i[0]===o?"max-":"min-")+l+":"+("="!==i[0]&&1===i.length?c.replace(Oi,((e,t,r)=>Number(t)+a*(">"===i?1:-1)+r)):c)+(n?") and ("+(">"===n[0]?"min-":"max-")+l+":"+(1===n.length?s.replace(Oi,((e,t,i)=>Number(t)+a*(">"===n?-1:1)+i)):s):"")+")"}))),g){const e=p?i.concat(c):[...i],r=p?[...t]:Mi(t,c.split($i));void 0!==s&&n(ji(...s)),s=void 0,l(u,r,e)}else void 0===s&&(s=[[],t,i]),c=p||36!==c.charCodeAt(0)?c:`--${Bi(r.prefix)}${c.slice(1).replace(/\$/g,"-")}`,u=g?u:"number"==typeof u?u&&e in Gi?String(u)+"px":String(u):Ui(Fi(e,null==u?"":u),r.prefix,r.themeMap[e]),s[0].push(`${p?`${c} `:`${Ii(c)}:`}${u}`)}}var d,f};h(e),void 0!==s&&n(ji(...s)),s=void 0};l(e,t,i)},ji=(e,t,i)=>`${i.map((e=>`${e}{`)).join("")}${t.length?`${t.join(",")}{`:""}${e.join(";")}${t.length?"}":""}${Array(i.length?i.length+1:0).join("}")}`,Gi={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},Vi=e=>String.fromCharCode(e+(e>25?39:97)),qi=e=>(e=>{let t,i="";for(t=Math.abs(e);t>52;t=t/52|0)i=Vi(t%52)+i;return Vi(t%52)+i})(((e,t)=>{let i=t.length;for(;i;)e=33*e^t.charCodeAt(--i);return e})(5381,JSON.stringify(e))>>>0),Wi=["themed","global","styled","onevar","resonevar","allvar","inline"],Ki=e=>{if(e.href&&!e.href.startsWith(location.origin))return!1;try{return!!e.cssRules}catch(e){return!1}},Yi=e=>{let t;const i=()=>{const{cssRules:e}=t.sheet;return[].map.call(e,((i,r)=>{const{cssText:n}=i;let s="";if(n.startsWith("--sxs"))return"";if(e[r-1]&&(s=e[r-1].cssText).startsWith("--sxs")){if(!i.cssRules.length)return"";for(const e in t.rules)if(t.rules[e].group===i)return`--sxs{--sxs:${[...t.rules[e].cache].join(" ")}}${n}`;return i.cssRules.length?`${s}${n}`:""}return n})).join("")},r=()=>{if(t){const{rules:e,sheet:i}=t;if(!i.deleteRule){for(;3===Object(Object(i.cssRules)[0]).type;)i.cssRules.splice(0,1);i.cssRules=[]}for(const t in e)delete e[t]}const n=Object(e).styleSheets||[];for(const e of n)if(Ki(e)){for(let n=0,s=e.cssRules;s[n];++n){const o=Object(s[n]);if(1!==o.type)continue;const a=Object(s[n+1]);if(4!==a.type)continue;++n;const{cssText:l}=o;if(!l.startsWith("--sxs"))continue;const c=l.slice(14,-3).trim().split(/\s+/),u=Wi[c[0]];u&&(t||(t={sheet:e,reset:r,rules:{},toString:i}),t.rules[u]={group:a,index:n,cache:new Set(c)})}if(t)break}if(!t){const n=(e,t)=>({type:t,cssRules:[],insertRule(e,t){this.cssRules.splice(t,0,n(e,{import:3,undefined:1}[(e.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return"@media{}"===e?`@media{${[].map.call(this.cssRules,(e=>e.cssText)).join("")}}`:e}});t={sheet:e?(e.head||e).appendChild(document.createElement("style")).sheet:n("","text/css"),rules:{},reset:r,toString:i}}const{sheet:s,rules:o}=t;for(let e=Wi.length-1;e>=0;--e){const t=Wi[e];if(!o[t]){const i=Wi[e+1],r=o[i]?o[i].index:s.cssRules.length;s.insertRule("@media{}",r),s.insertRule(`--sxs{--sxs:${e}}`,r),o[t]={group:s.cssRules[r+1],index:r,cache:new Set([e])}}Xi(o[t])}};return r(),t},Xi=e=>{const t=e.group;let i=t.cssRules.length;e.apply=e=>{try{t.insertRule(e,i),++i}catch(e){}}},Zi=Symbol(),Qi=Ri(),Ji=(e,t)=>Qi(e,(()=>(...i)=>{let r={type:null,composers:new Set};for(const t of i)if(null!=t)if(t[Ci]){null==r.type&&(r.type=t[Ci].type);for(const e of t[Ci].composers)r.composers.add(e)}else t.constructor!==Object||t.$$typeof?null==r.type&&(r.type=t):r.composers.add(er(t,e));return null==r.type&&(r.type="span"),r.composers.size||r.composers.add(["PJLV",{},[],[],{},[]]),tr(e,r,t)})),er=({variants:e,compoundVariants:t,defaultVariants:i,...r},n)=>{const s=`${Bi(n.prefix)}c-${qi(r)}`,o=[],a=[],l=Object.create(null),c=[];for(const e in i)l[e]=String(i[e]);if("object"==typeof e&&e)for(const t in e){u=l,h=t,Li.call(u,h)||(l[t]="undefined");const i=e[t];for(const e in i){const r={[t]:String(e)};"undefined"===String(e)&&c.push(t);const n=i[e],s=[r,n,!ki(n)];o.push(s)}}var u,h;if("object"==typeof t&&t)for(const e of t){let{css:t,...i}=e;t="object"==typeof t&&t||{};for(const e in i)i[e]=String(i[e]);const r=[i,t,!ki(t)];a.push(r)}return[s,r,o,a,l,c]},tr=(e,t,i)=>{const[r,n,s,o]=ir(t.composers),a="function"==typeof t.type||t.type.$$typeof?(e=>{function t(){for(let i=0;i<t[Zi].length;i++){const[r,n]=t[Zi][i];e.rules[r].apply(n)}return t[Zi]=[],null}return t[Zi]=[],t.rules={},Wi.forEach((e=>t.rules[e]={apply:i=>t[Zi].push([e,i])})),t})(i):null,l=(a||i).rules,c=`.${r}${n.length>1?`:where(.${n.slice(1).join(".")})`:""}`,u=u=>{u="object"==typeof u&&u||nr;const{css:h,...d}=u,f={};for(const e in s)if(delete d[e],e in u){let t=u[e];"object"==typeof t&&t?f[e]={"@initial":s[e],...t}:(t=String(t),f[e]="undefined"!==t||o.has(e)?t:s[e])}else f[e]=s[e];const p=new Set([...n]);for(const[r,n,s,o]of t.composers){i.rules.styled.cache.has(r)||(i.rules.styled.cache.add(r),zi(n,[`.${r}`],[],e,(e=>{l.styled.apply(e)})));const t=rr(s,f,e.media),a=rr(o,f,e.media,!0);for(const n of t)if(void 0!==n)for(const[t,s,o]of n){const n=`${r}-${qi(s)}-${t}`;p.add(n);const a=(o?i.rules.resonevar:i.rules.onevar).cache,c=o?l.resonevar:l.onevar;a.has(n)||(a.add(n),zi(s,[`.${n}`],[],e,(e=>{c.apply(e)})))}for(const t of a)if(void 0!==t)for(const[n,s]of t){const t=`${r}-${qi(s)}-${n}`;p.add(t),i.rules.allvar.cache.has(t)||(i.rules.allvar.cache.add(t),zi(s,[`.${t}`],[],e,(e=>{l.allvar.apply(e)})))}}if("object"==typeof h&&h){const t=`${r}-i${qi(h)}-css`;p.add(t),i.rules.inline.cache.has(t)||(i.rules.inline.cache.add(t),zi(h,[`.${t}`],[],e,(e=>{l.inline.apply(e)})))}for(const e of String(u.className||"").trim().split(/\s+/))e&&p.add(e);const g=d.className=[...p].join(" ");return{type:t.type,className:g,selector:c,props:d,toString:()=>g,deferredInjector:a}};return Ai(u,{className:r,selector:c,[Ci]:t,toString:()=>(i.rules.styled.cache.has(r)||u(),r)})},ir=e=>{let t="";const i=[],r={},n=[];for(const[s,,,,o,a]of e){""===t&&(t=s),i.push(s),n.push(...a);for(const e in o){const t=o[e];(void 0===r[e]||"undefined"!==t||a.includes(t))&&(r[e]=t)}}return[t,i,r,new Set(n)]},rr=(e,t,i,r)=>{const n=[];e:for(let[s,o,a]of e){if(a)continue;let e,l=0,c=!1;for(e in s){const r=s[e];let n=t[e];if(n!==r){if("object"!=typeof n||!n)continue e;{let e,t,s=0;for(const o in n){if(r===String(n[o])){if("@initial"!==o){const e=o.slice(1);(t=t||[]).push(e in i?i[e]:o.replace(/^@media ?/,"")),c=!0}l+=s,e=!0}++s}if(t&&t.length&&(o={["@media "+t.join(", ")]:o}),!e)continue e}}}(n[l]=n[l]||[]).push([r?"cv":`${e}-${s[e]}`,o,c])}return n},nr={},sr=Ri(),or=(e,t)=>sr(e,(()=>(...i)=>{const r=()=>{for(let r of i){r="object"==typeof r&&r||{};let i=qi(r);if(!t.rules.global.cache.has(i)){if(t.rules.global.cache.add(i),"@import"in r){let e=[].indexOf.call(t.sheet.cssRules,t.rules.themed.group)-1;for(let i of[].concat(r["@import"]))i=i.includes('"')||i.includes("'")?i:`"${i}"`,t.sheet.insertRule(`@import ${i};`,e++);delete r["@import"]}zi(r,[],[],e,(e=>{t.rules.global.apply(e)}))}}return""};return Ai(r,{toString:r})})),ar=Ri(),lr=(e,t)=>ar(e,(()=>i=>{const r=`${Bi(e.prefix)}k-${qi(i)}`,n=()=>{if(!t.rules.global.cache.has(r)){t.rules.global.cache.add(r);const n=[];zi(i,[],[],e,(e=>n.push(e)));const s=`@keyframes ${r}{${n.join("")}}`;t.rules.global.apply(s)}return r};return Ai(n,{get name(){return n()},toString:n})})),cr=class{constructor(e,t,i,r){this.token=null==e?"":String(e),this.value=null==t?"":String(t),this.scale=null==i?"":String(i),this.prefix=null==r?"":String(r)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+Bi(this.prefix)+Bi(this.scale)+this.token}toString(){return this.computedValue}},ur=Ri(),hr=(e,t)=>ur(e,(()=>(i,r)=>{r="object"==typeof i&&i||Object(r);const n=`.${i=(i="string"==typeof i?i:"")||`${Bi(e.prefix)}t-${qi(r)}`}`,s={},o=[];for(const t in r){s[t]={};for(const i in r[t]){const n=`--${Bi(e.prefix)}${t}-${i}`,a=Ui(String(r[t][i]),e.prefix,t);s[t][i]=new cr(i,a,t,e.prefix),o.push(`${n}:${a}`)}}const a=()=>{if(o.length&&!t.rules.themed.cache.has(i)){t.rules.themed.cache.add(i);const n=`${r===e.theme?":root,":""}.${i}{${o.join(";")}}`;t.rules.themed.apply(n)}return i};return{...s,get className(){return a()},selector:n,toString:a}})),dr=Ri(),fr=Ri(),pr=t=>{const i=(e=>{let t=!1;const i=dr(e,(e=>{t=!0;const i="prefix"in(e="object"==typeof e&&e||{})?String(e.prefix):"",r="object"==typeof e.media&&e.media||{},n="object"==typeof e.root?e.root||null:globalThis.document||null,s="object"==typeof e.theme&&e.theme||{},o={prefix:i,media:r,theme:s,themeMap:"object"==typeof e.themeMap&&e.themeMap||{...Si},utils:"object"==typeof e.utils&&e.utils||{}},a=Yi(n),l={css:Ji(o,a),globalCss:or(o,a),keyframes:lr(o,a),createTheme:hr(o,a),reset(){a.reset(),l.theme.toString()},theme:{},sheet:a,config:o,prefix:i,getCssText:a.toString,toString:a.toString};return String(l.theme=l.createTheme(s)),l}));return t||i.reset(),i})(t);return i.styled=(({config:t,sheet:i})=>fr(t,(()=>{const r=Ji(t,i);return(...t)=>{const i=r(...t),n=i[Ci].type,s=e.forwardRef(((t,r)=>{const s=t&&t.as||n,{props:o,deferredInjector:a}=i(t);return delete o.as,o.ref=r,a?e.createElement(e.Fragment,null,e.createElement(s,o),e.createElement(a,null)):e.createElement(s,o)}));return s.className=i.className,s.displayName=`Styled.${n.displayName||n.name||n}`,s.selector=i.selector,s.toString=()=>i.selector,s[Ci]=i[Ci],s}})))(i),i};function gr(t){const i=t+"CollectionProvider",[r,n]=Ft(i),[s,o]=r(i,{collectionRef:{current:null},itemMap:new Map}),a=t+"CollectionSlot",l=t+"CollectionItemSlot",c="data-radix-collection-item";return[{Provider:t=>{const{scope:i,children:r}=t,n=e.useRef(null),o=e.useRef(new Map).current;return e.createElement(s,{scope:i,itemMap:o,collectionRef:n},r)},Slot:e.forwardRef(((t,i)=>{const{scope:r,children:n}=t,s=zt(i,o(a,r).collectionRef);return e.createElement(Gt,{ref:s},n)})),ItemSlot:e.forwardRef(((t,i)=>{const{scope:r,children:n,...s}=t,a=e.useRef(null),u=zt(i,a),h=o(l,r);return e.useEffect((()=>(h.itemMap.set(a,{ref:a,...s}),()=>{h.itemMap.delete(a)}))),e.createElement(Gt,{[c]:"",ref:u},n)}))},function(i){const r=o(t+"CollectionConsumer",i),n=e.useCallback((()=>{const e=r.collectionRef.current;if(!e)return[];const t=Array.from(e.querySelectorAll(`[${c}]`)),i=Array.from(r.itemMap.values()).sort(((e,i)=>t.indexOf(e.ref.current)-t.indexOf(i.ref.current)));return i}),[r.collectionRef,r.itemMap]);return n},n]}const mr=(0,e.createContext)(void 0);function vr(t){const i=(0,e.useContext)(mr);return t||i||"ltr"}const yr="rovingFocusGroup.onEntryFocus",wr={bubbles:!1,cancelable:!0},Er="RovingFocusGroup",[br,Tr,Sr]=gr(Er),[xr,Rr]=Ft(Er,[Sr]),[Cr,Ar]=xr(Er),kr=(0,e.forwardRef)(((t,i)=>(0,e.createElement)(br.Provider,{scope:t.__scopeRovingFocusGroup},(0,e.createElement)(br.Slot,{scope:t.__scopeRovingFocusGroup},(0,e.createElement)(Lr,Ot({},t,{ref:i})))))),Lr=(0,e.forwardRef)(((t,i)=>{const{__scopeRovingFocusGroup:r,orientation:n,loop:s=!1,dir:o,currentTabStopId:a,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:c,onEntryFocus:u,...h}=t,d=(0,e.useRef)(null),f=zt(i,d),p=vr(o),[g=null,m]=Ut({prop:a,defaultProp:l,onChange:c}),[v,y]=(0,e.useState)(!1),w=Bt(u),E=Tr(r),b=(0,e.useRef)(!1),[T,S]=(0,e.useState)(0);return(0,e.useEffect)((()=>{const e=d.current;if(e)return e.addEventListener(yr,w),()=>e.removeEventListener(yr,w)}),[w]),(0,e.createElement)(Cr,{scope:r,orientation:n,dir:p,loop:s,currentTabStopId:g,onItemFocus:(0,e.useCallback)((e=>m(e)),[m]),onItemShiftTab:(0,e.useCallback)((()=>y(!0)),[]),onFocusableItemAdd:(0,e.useCallback)((()=>S((e=>e+1))),[]),onFocusableItemRemove:(0,e.useCallback)((()=>S((e=>e-1))),[])},(0,e.createElement)(Yt.div,Ot({tabIndex:v||0===T?-1:0,"data-orientation":n},h,{ref:f,style:{outline:"none",...t.style},onMouseDown:Mt(t.onMouseDown,(()=>{b.current=!0})),onFocus:Mt(t.onFocus,(e=>{const t=!b.current;if(e.target===e.currentTarget&&t&&!v){const t=new CustomEvent(yr,wr);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){const e=E().filter((e=>e.focusable));_r([e.find((e=>e.active)),e.find((e=>e.id===g)),...e].filter(Boolean).map((e=>e.ref.current)))}}b.current=!1})),onBlur:Mt(t.onBlur,(()=>y(!1)))})))})),Ir=(0,e.forwardRef)(((t,i)=>{const{__scopeRovingFocusGroup:r,focusable:n=!0,active:s=!1,tabStopId:o,...a}=t,l=ti(),c=o||l,u=Ar("RovingFocusGroupItem",r),h=u.currentTabStopId===c,d=Tr(r),{onFocusableItemAdd:f,onFocusableItemRemove:p}=u;return(0,e.useEffect)((()=>{if(n)return f(),()=>p()}),[n,f,p]),(0,e.createElement)(br.ItemSlot,{scope:r,id:c,focusable:n,active:s},(0,e.createElement)(Yt.span,Ot({tabIndex:h?0:-1,"data-orientation":u.orientation},a,{ref:i,onMouseDown:Mt(t.onMouseDown,(e=>{n?u.onItemFocus(c):e.preventDefault()})),onFocus:Mt(t.onFocus,(()=>u.onItemFocus(c))),onKeyDown:Mt(t.onKeyDown,(e=>{if("Tab"===e.key&&e.shiftKey)return void u.onItemShiftTab();if(e.target!==e.currentTarget)return;const t=function(e,t,i){const r=function(e,t){return"rtl"!==t?e:"ArrowLeft"===e?"ArrowRight":"ArrowRight"===e?"ArrowLeft":e}(e.key,i);return"vertical"===t&&["ArrowLeft","ArrowRight"].includes(r)||"horizontal"===t&&["ArrowUp","ArrowDown"].includes(r)?void 0:Pr[r]}(e,u.orientation,u.dir);if(void 0!==t){e.preventDefault();let n=d().filter((e=>e.focusable)).map((e=>e.ref.current));if("last"===t)n.reverse();else if("prev"===t||"next"===t){"prev"===t&&n.reverse();const s=n.indexOf(e.currentTarget);n=u.loop?(r=s+1,(i=n).map(((e,t)=>i[(r+t)%i.length]))):n.slice(s+1)}setTimeout((()=>_r(n)))}var i,r}))})))})),Pr={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function _r(e){const t=document.activeElement;for(const i of e){if(i===t)return;if(i.focus(),document.activeElement!==t)return}}const Dr=kr,Or=Ir,Mr="Tabs",[Fr,Nr]=Ft(Mr,[Rr]),Br=Rr(),[Ur,$r]=Fr(Mr);function Hr(e,t){return`${e}-trigger-${t}`}function zr(e,t){return`${e}-content-${t}`}const jr=(0,e.forwardRef)(((t,i)=>{const{__scopeTabs:r,value:n,onValueChange:s,defaultValue:o,orientation:a="horizontal",dir:l,activationMode:c="automatic",...u}=t,h=vr(l),[d,f]=Ut({prop:n,onChange:s,defaultProp:o});return(0,e.createElement)(Ur,{scope:r,baseId:ti(),value:d,onValueChange:f,orientation:a,dir:h,activationMode:c},(0,e.createElement)(Yt.div,Ot({dir:h,"data-orientation":a},u,{ref:i})))})),Gr=(0,e.forwardRef)(((t,i)=>{const{__scopeTabs:r,loop:n=!0,...s}=t,o=$r("TabsList",r),a=Br(r);return(0,e.createElement)(Dr,Ot({asChild:!0},a,{orientation:o.orientation,dir:o.dir,loop:n}),(0,e.createElement)(Yt.div,Ot({role:"tablist","aria-orientation":o.orientation},s,{ref:i})))})),Vr=(0,e.forwardRef)(((t,i)=>{const{__scopeTabs:r,value:n,disabled:s=!1,...o}=t,a=$r("TabsTrigger",r),l=Br(r),c=Hr(a.baseId,n),u=zr(a.baseId,n),h=n===a.value;return(0,e.createElement)(Or,Ot({asChild:!0},l,{focusable:!s,active:h}),(0,e.createElement)(Yt.button,Ot({type:"button",role:"tab","aria-selected":h,"aria-controls":u,"data-state":h?"active":"inactive","data-disabled":s?"":void 0,disabled:s,id:c},o,{ref:i,onMouseDown:Mt(t.onMouseDown,(e=>{s||0!==e.button||!1!==e.ctrlKey?e.preventDefault():a.onValueChange(n)})),onKeyDown:Mt(t.onKeyDown,(e=>{[" ","Enter"].includes(e.key)&&a.onValueChange(n)})),onFocus:Mt(t.onFocus,(()=>{const e="manual"!==a.activationMode;h||s||!e||a.onValueChange(n)}))})))})),qr=(0,e.forwardRef)(((t,i)=>{const{__scopeTabs:r,value:n,forceMount:s,children:o,...a}=t,l=$r("TabsContent",r),c=Hr(l.baseId,n),u=zr(l.baseId,n),h=n===l.value,d=(0,e.useRef)(h);return(0,e.useEffect)((()=>{const e=requestAnimationFrame((()=>d.current=!1));return()=>cancelAnimationFrame(e)}),[]),(0,e.createElement)(Zt,{present:s||h},(({present:r})=>(0,e.createElement)(Yt.div,Ot({"data-state":h?"active":"inactive","data-orientation":l.orientation,role:"tabpanel","aria-labelledby":c,hidden:!r,id:u,tabIndex:0},a,{ref:i,style:{...t.style,animationDuration:d.current?"0s":void 0}}),r&&o)))}));var Wr=__webpack_require__(1036);function Kr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Yr,Xr,Zr,Qr,Jr,en={exports:{}};Yr=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,Xr=/^(?=([^\/?#]*))\1([^]*)$/,Zr=/(?:\/|^)\.(?=\/)/g,Qr=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,Jr={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;var r=Jr.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=Jr.normalizePath(r.path),Jr.buildURLFromParts(r)}var n=Jr.parseURL(t);if(!n)throw new Error("Error trying to parse relative URL.");if(n.scheme)return i.alwaysNormalize?(n.path=Jr.normalizePath(n.path),Jr.buildURLFromParts(n)):t;var s=Jr.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var o=Xr.exec(s.path);s.netLoc=o[1],s.path=o[2]}s.netLoc&&!s.path&&(s.path="/");var a={scheme:s.scheme,netLoc:n.netLoc,path:null,params:n.params,query:n.query,fragment:n.fragment};if(!n.netLoc&&(a.netLoc=s.netLoc,"/"!==n.path[0]))if(n.path){var l=s.path,c=l.substring(0,l.lastIndexOf("/")+1)+n.path;a.path=Jr.normalizePath(c)}else a.path=s.path,n.params||(a.params=s.params,n.query||(a.query=s.query));return null===a.path&&(a.path=i.alwaysNormalize?Jr.normalizePath(n.path):n.path),Jr.buildURLFromParts(a)},parseURL:function(e){var t=Yr.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(Zr,"");e.length!==(e=e.replace(Qr,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},en.exports=Jr;var tn=en.exports;function rn(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function nn(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?rn(Object(i),!0).forEach((function(t){sn(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):rn(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function sn(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function on(){return on=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},on.apply(this,arguments)}const an=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)};let ln=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e}({}),cn=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),un=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.UNKNOWN="unknown",e}({});const hn=function(){},dn={trace:hn,debug:hn,log:hn,warn:hn,info:hn,error:hn};let fn=dn;const pn=fn,gn=/^(\d+)x(\d+)$/,mn=/(.+?)=(".*?"|.*?)(?:,|$)/g;class vn{constructor(e){"string"==typeof e&&(e=vn.parseAttrList(e));for(const t in e)e.hasOwnProperty(t)&&("X-"===t.substring(0,2)&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(t)),this[t]=e[t])}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const i=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)i[e]=parseInt(t.slice(2*e,2*e+2),16);return i}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}bool(e){return"YES"===this[e]}decimalResolution(e){const t=gn.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;const i={};for(mn.lastIndex=0;null!==(t=mn.exec(e));){let e=t[2];0===e.indexOf('"')&&e.lastIndexOf('"')===e.length-1&&(e=e.slice(1,-1)),i[t[1].trim()]=e}return i}}function yn(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e}class wn{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const i=t.attr;for(const t in i)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==i[t]){pn.warn(`DATERANGE tag attribute: "${t}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=t;break}e=on(new vn({}),i,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const e=new Date(this.attr["END-DATE"]);an(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return null!==e?new Date(this._startDate.getTime()+1e3*e):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(an(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&an(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class En{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var bn="audio",Tn="video",Sn="audiovideo";class xn{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[bn]:null,[Tn]:null,[Sn]:null},this.baseurl=e}setByteRange(e,t){const i=e.split("@",2),r=[];1===i.length?r[0]=t?t.byteRangeEndOffset:0:r[0]=parseInt(i[1]),r[1]=parseInt(i[0])+r[0],this._byteRange=r}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=tn.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class Rn extends xn{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new En,this.urlId=0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{const e=Object.keys(this.levelkeys);if(1===e.length)return this._decryptdata=this.levelkeys[e[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;if(!an(this.programDateTime))return null;const e=an(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){const e=Object.keys(this.levelkeys),t=e.length;if(t>1||1===t&&this.levelkeys[e[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,i,r,n,s=!1){const{elementaryStreams:o}=this,a=o[e];a?(a.startPTS=Math.min(a.startPTS,t),a.endPTS=Math.max(a.endPTS,i),a.startDTS=Math.min(a.startDTS,r),a.endDTS=Math.max(a.endDTS,n)):o[e]={startPTS:t,endPTS:i,startDTS:r,endDTS:n,partial:s}}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[bn]=null,e[Tn]=null,e[Sn]=null}}class Cn extends xn{constructor(e,t,i,r,n){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new En,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const s=e.enumeratedString("BYTERANGE");s&&this.setByteRange(s,n),n&&(this.fragOffset=n.fragOffset+n.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}class An{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&i>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return!!this.fragments.length&&an(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?1e3*(this.driftEnd-this.driftStart)/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function kn(e){return Uint8Array.from(atob(e),(e=>e.charCodeAt(0)))}function Ln(e){return Uint8Array.from(unescape(encodeURIComponent(e)),(e=>e.charCodeAt(0)))}var In={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Pn="org.w3.clearkey",_n="com.apple.streamingkeydelivery",Dn="com.microsoft.playready",On="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function Mn(e){switch(e){case _n:return In.FAIRPLAY;case Dn:return In.PLAYREADY;case On:return In.WIDEVINE;case Pn:return In.CLEARKEY}}var Fn="edef8ba979d64acea3c827dcd51d21ed";function Nn(e){switch(e){case In.FAIRPLAY:return _n;case In.PLAYREADY:return Dn;case In.WIDEVINE:return On;case In.CLEARKEY:return Pn}}function Bn(e){const{drmSystems:t,widevineLicenseUrl:i}=e,r=t?[In.FAIRPLAY,In.WIDEVINE,In.PLAYREADY,In.CLEARKEY].filter((e=>!!t[e])):[];return!r[In.WIDEVINE]&&i&&r.push(In.WIDEVINE),r}const Un="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function $n(e,t,i){return Uint8Array.prototype.slice?e.slice(t,i):new Uint8Array(Array.prototype.slice.call(e,t,i))}const Hn=(e,t)=>t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128,zn=(e,t)=>t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128,jn=(e,t)=>{const i=t;let r=0;for(;Hn(e,t);)r+=10,r+=Gn(e,t+6),zn(e,t+10)&&(r+=10),t+=r;if(r>0)return e.subarray(i,i+r)},Gn=(e,t)=>{let i=0;return i=(127&e[t])<<21,i|=(127&e[t+1])<<14,i|=(127&e[t+2])<<7,i|=127&e[t+3],i},Vn=(e,t)=>Hn(e,t)&&Gn(e,t+6)+10<=e.length-t,qn=e=>e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info,Wn=e=>{const t=String.fromCharCode(e[0],e[1],e[2],e[3]),i=Gn(e,4);return{type:t,size:i,data:e.subarray(10,10+i)}},Kn=e=>{let t=0;const i=[];for(;Hn(e,t);){const r=Gn(e,t+6);t+=10;const n=t+r;for(;t+8<n;){const r=Wn(e.subarray(t)),n=Yn(r);n&&i.push(n),t+=r.size+10}zn(e,t)&&(t+=10)}return i},Yn=e=>"PRIV"===e.type?Xn(e):"W"===e.type[0]?Qn(e):Zn(e),Xn=e=>{if(e.size<2)return;const t=es(e.data,!0),i=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:i.buffer}},Zn=e=>{if(e.size<2)return;if("TXXX"===e.type){let t=1;const i=es(e.data.subarray(t),!0);t+=i.length+1;const r=es(e.data.subarray(t));return{key:e.type,info:i,data:r}}const t=es(e.data.subarray(1));return{key:e.type,data:t}},Qn=e=>{if("WXXX"===e.type){if(e.size<2)return;let t=1;const i=es(e.data.subarray(t),!0);t+=i.length+1;const r=es(e.data.subarray(t));return{key:e.type,info:i,data:r}}const t=es(e.data);return{key:e.type,data:t}},Jn=e=>{if(8===e.data.byteLength){const t=new Uint8Array(e.data),i=1&t[3];let r=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return r/=45,i&&(r+=47721858.84),Math.round(r)}},es=(e,t=!1)=>{const i=is();if(i){const r=i.decode(e);if(t){const e=r.indexOf("\0");return-1!==e?r.substring(0,e):r}return r.replace(/\0/g,"")}const r=e.length;let n,s,o,a="",l=0;for(;l<r;){if(n=e[l++],0===n&&t)return a;if(0!==n&&3!==n)switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(n);break;case 12:case 13:s=e[l++],a+=String.fromCharCode((31&n)<<6|63&s);break;case 14:s=e[l++],o=e[l++],a+=String.fromCharCode((15&n)<<12|(63&s)<<6|(63&o)<<0)}}return a};let ts;function is(){return ts||void 0===self.TextDecoder||(ts=new self.TextDecoder("utf-8")),ts}const rs=function(e){let t="";for(let i=0;i<e.length;i++){let r=e[i].toString(16);r.length<2&&(r="0"+r),t+=r}return t},ns=Math.pow(2,32)-1,ss=[].push,os={video:1,audio:2,id3:3,text:4};function as(e){return String.fromCharCode.apply(null,e)}function ls(e,t){const i=e[t]<<8|e[t+1];return i<0?65536+i:i}function cs(e,t){const i=us(e,t);return i<0?4294967296+i:i}function us(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function hs(e,t,i){e[t]=i>>24,e[t+1]=i>>16&255,e[t+2]=i>>8&255,e[t+3]=255&i}function ds(e,t){const i=[];if(!t.length)return i;const r=e.byteLength;for(let n=0;n<r;){const s=cs(e,n),o=s>1?n+s:r;if(as(e.subarray(n+4,n+8))===t[0])if(1===t.length)i.push(e.subarray(n+8,o));else{const r=ds(e.subarray(n+8,o),t.slice(1));r.length&&ss.apply(i,r)}n=o}return i}function fs(e){const t=[],i=e[0];let r=8;const n=cs(e,r);r+=4,r+=0===i?8:16,r+=2;let s=e.length+0;const o=ls(e,r);r+=2;for(let i=0;i<o;i++){let i=r;const o=cs(e,i);i+=4;const a=2147483647&o;if(1==(2147483648&o)>>>31)return pn.warn("SIDX has hierarchical references (not supported)"),null;const l=cs(e,i);i+=4,t.push({referenceSize:a,subsegmentDuration:l,info:{duration:l/n,start:s,end:s+a-1}}),s+=a,i+=4,r=i}return{earliestPresentationTime:0,timescale:n,version:i,referencesCount:o,references:t}}function ps(e){const t=[],i=ds(e,["moov","trak"]);for(let e=0;e<i.length;e++){const r=i[e],n=ds(r,["tkhd"])[0];if(n){let e=n[0],i=0===e?12:20;const s=cs(n,i),o=ds(r,["mdia","mdhd"])[0];if(o){e=o[0],i=0===e?12:20;const n=cs(o,i),a=ds(r,["mdia","hdlr"])[0];if(a){const e=as(a.subarray(8,12)),i={soun:bn,vide:Tn}[e];if(i){const e=ds(r,["mdia","minf","stbl","stsd"])[0];let o;e&&(o=as(e.subarray(12,16))),t[s]={timescale:n,type:i},t[i]={timescale:n,id:s,codec:o}}}}}}return ds(e,["moov","mvex","trex"]).forEach((e=>{const i=cs(e,4),r=t[i];r&&(r.default={duration:cs(e,12),flags:cs(e,20)})})),t}function gs(e){const t=ds(e,["schm"])[0];if(t){const i=as(t.subarray(4,8));if("cbcs"===i||"cenc"===i)return ds(e,["schi","tenc"])[0]}return pn.error("[eme] missing 'schm' box"),null}function ms(e){const t=cs(e,0);let i=8;1&t&&(i+=4),4&t&&(i+=4);let r=0;const n=cs(e,4);for(let s=0;s<n;s++)256&t&&(r+=cs(e,i),i+=4),512&t&&(i+=4),1024&t&&(i+=4),2048&t&&(i+=4);return r}function vs(e,t){const i=new Uint8Array(e.length+t.length);return i.set(e),i.set(t,e.length),i}function ys(e,t){const i=[],r=t.samples,n=t.timescale,s=t.id;let o=!1;return ds(r,["moof"]).map((a=>{const l=a.byteOffset-8;ds(a,["traf"]).map((a=>{const c=ds(a,["tfdt"]).map((e=>{const t=e[0];let i=cs(e,4);return 1===t&&(i*=Math.pow(2,32),i+=cs(e,8)),i/n}))[0];return void 0!==c&&(e=c),ds(a,["tfhd"]).map((c=>{const u=cs(c,4),h=16777215&cs(c,0);let d=0;const f=0!=(16&h);let p=0;const g=0!=(32&h);let m=8;u===s&&(0!=(1&h)&&(m+=8),0!=(2&h)&&(m+=4),0!=(8&h)&&(d=cs(c,m),m+=4),f&&(p=cs(c,m),m+=4),g&&(m+=4),"video"===t.type&&(o=function(e){if(!e)return!1;const t=e.indexOf("."),i=t<0?e:e.substring(0,t);return"hvc1"===i||"hev1"===i||"dvh1"===i||"dvhe"===i}(t.codec)),ds(a,["trun"]).map((s=>{const a=s[0],c=16777215&cs(s,0),u=0!=(1&c);let h=0;const f=0!=(4&c),g=0!=(256&c);let m=0;const v=0!=(512&c);let y=0;const w=0!=(1024&c),E=0!=(2048&c);let b=0;const T=cs(s,4);let S=8;u&&(h=cs(s,S),S+=4),f&&(S+=4);let x=h+l;for(let l=0;l<T;l++){if(g?(m=cs(s,S),S+=4):m=d,v?(y=cs(s,S),S+=4):y=p,w&&(S+=4),E&&(b=0===a?cs(s,S):us(s,S),S+=4),t.type===Tn){let t=0;for(;t<y;){const s=cs(r,x);x+=4,ws(o,r[x])&&Es(r.subarray(x,x+s),o?2:1,e+b/n,i),x+=s,t+=s+4}}e+=m/n}})))}))}))})),i}function ws(e,t){if(e){const e=t>>1&63;return 39===e||40===e}return 6==(31&t)}function Es(e,t,i,r){const n=bs(e);let s=0;s+=t;let o=0,a=0,l=!1,c=0;for(;s<n.length;){o=0;do{if(s>=n.length)break;c=n[s++],o+=c}while(255===c);a=0;do{if(s>=n.length)break;c=n[s++],a+=c}while(255===c);const e=n.length-s;if(!l&&4===o&&s<n.length){if(l=!0,181===n[s++]){const e=ls(n,s);if(s+=2,49===e){const e=cs(n,s);if(s+=4,1195456820===e){const e=n[s++];if(3===e){const t=n[s++],a=64&t,l=a?2+3*(31&t):0,c=new Uint8Array(l);if(a){c[0]=t;for(let e=1;e<l;e++)c[e]=n[s++]}r.push({type:e,payloadType:o,pts:i,bytes:c})}}}}}else if(5===o&&a<e){if(l=!0,a>16){const e=[];for(let t=0;t<16;t++){const i=n[s++].toString(16);e.push(1==i.length?"0"+i:i),3!==t&&5!==t&&7!==t&&9!==t||e.push("-")}const t=a-16,l=new Uint8Array(t);for(let e=0;e<t;e++)l[e]=n[s++];r.push({payloadType:o,pts:i,uuid:e.join(""),userData:es(l),userDataBytes:l})}}else if(a<e)s+=a;else if(a>e)break}}function bs(e){const t=e.byteLength,i=[];let r=1;for(;r<t-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(i.push(r+2),r+=2):r++;if(0===i.length)return e;const n=t-i.length,s=new Uint8Array(n);let o=0;for(r=0;r<n;o++,r++)o===i[0]&&(o++,i.shift()),s[r]=e[o];return s}let Ts={};class Ss{static clearKeyUriToKeyIdMap(){Ts={}}constructor(e,t,i,r=[1],n=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=r,this.iv=n,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&"AES-128"!==e}isSupported(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case _n:case On:case Dn:case Pn:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof e&&("AES-128"!==this.method||this.iv||pn.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const t=function(e){const t=new Uint8Array(16);for(let i=12;i<16;i++)t[i]=e>>8*(15-i)&255;return t}(e);return new Ss(this.method,this.uri,"identity",this.keyFormatVersions,t)}const t=function(e){const t=e.split(":");let i=null;if("data"===t[0]&&2===t.length){const e=t[1].split(";"),r=e[e.length-1].split(",");if(2===r.length){const t="base64"===r[0],n=r[1];t?(e.splice(-1,1),i=kn(n)):i=function(e){const t=Ln(e).subarray(0,16),i=new Uint8Array(16);return i.set(t,16-t.length),i}(n)}}return i}(this.uri);if(t)switch(this.keyFormat){case On:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case Dn:{const e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=function(e,t,i){if(16!==e.byteLength)throw new RangeError("Invalid system id");let r,n,s;if(t){r=1,n=new Uint8Array(16*t.length);for(let e=0;e<t.length;e++){const i=t[e];if(16!==i.byteLength)throw new RangeError("Invalid key");n.set(i,16*e)}}else r=0,n=new Uint8Array;r>0?(s=new Uint8Array(4),t.length>0&&new DataView(s.buffer).setUint32(0,t.length,!1)):s=new Uint8Array;const o=new Uint8Array(4);return i&&i.byteLength>0&&new DataView(o.buffer).setUint32(0,i.byteLength,!1),function(e,...t){const i=t.length;let r=8,n=i;for(;n--;)r+=t[n].byteLength;const s=new Uint8Array(r);for(s[0]=r>>24&255,s[1]=r>>16&255,s[2]=r>>8&255,s[3]=255&r,s.set(e,4),n=0,r=8;n<i;n++)s.set(t[n],r),r+=t[n].byteLength;return s}([112,115,115,104],new Uint8Array([r,0,0,0]),e,s,n,o,i||new Uint8Array)}(e,null,t);const i=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),r=String.fromCharCode.apply(null,Array.from(i)),n=r.substring(r.indexOf("<"),r.length),s=(new DOMParser).parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(s){const e=s.childNodes[0]?s.childNodes[0].nodeValue:s.getAttribute("VALUE");if(e){const t=kn(e).subarray(0,16);!function(e){const t=function(e,t,i){const r=e[t];e[t]=e[i],e[i]=r};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}(t),this.keyId=t}}break}default:{let e=t.subarray(0,16);if(16!==e.length){const t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e=Ts[this.uri];if(!e){const t=Object.keys(Ts).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16),new DataView(e.buffer,12,4).setUint32(0,t),Ts[this.uri]=e}this.keyId=e}return this}}const xs=/\{\$([a-zA-Z0-9-_]+)\}/g;function Rs(e){return xs.test(e)}function Cs(e,t,i){if(null!==e.variableList||e.hasVariableRefs)for(let r=i.length;r--;){const n=i[r],s=t[n];s&&(t[n]=As(e,s))}}function As(e,t){if(null!==e.variableList||e.hasVariableRefs){const i=e.variableList;return t.replace(xs,(t=>{const r=t.substring(2,t.length-1),n=null==i?void 0:i[r];return void 0===n?(e.playlistParsingError||(e.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),t):n}))}return t}function ks(e,t,i){let r,n,s=e.variableList;if(s||(e.variableList=s={}),"QUERYPARAM"in t){r=t.QUERYPARAM;try{const e=new self.URL(i).searchParams;if(!e.has(r))throw new Error(`"${r}" does not match any query parameter in URI: "${i}"`);n=e.get(r)}catch(t){e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${t.message}`))}}else r=t.NAME,n=t.VALUE;r in s?e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):s[r]=n||""}function Ls(e,t,i){const r=t.IMPORT;if(i&&r in i){let t=e.variableList;t||(e.variableList=t={}),t[r]=i[r]}else e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}function Is(){if("undefined"!=typeof self)return self.MediaSource||self.WebKitMediaSource}const Ps={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},_s=Is();function Ds(e,t){var i;return null!=(i=null==_s?void 0:_s.isTypeSupported(`${t||"video"}/mp4;codecs="${e}"`))&&i}const Os=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Ms=/#EXT-X-MEDIA:(.*)/g,Fs=/^#EXT(?:INF|-X-TARGETDURATION):/m,Ns=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Bs=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Us{static findGroup(e,t){for(let i=0;i<e.length;i++){const r=e[i];if(r.id===t)return r}}static convertAVC1ToAVCOTI(e){const t=e.split(".");if(t.length>2){let e=t.shift()+".";return e+=parseInt(t.shift()).toString(16),e+=("000"+parseInt(t.shift()).toString(16)).slice(-4),e}return e}static resolve(e,t){return tn.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return Fs.test(e)}static parseMasterPlaylist(e,t){const i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:Rs(e)},r=[];let n;for(Os.lastIndex=0;null!=(n=Os.exec(e));)if(n[1]){var s;const e=new vn(n[1]);Cs(i,e,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const o=As(i,n[2]),a={attrs:e,bitrate:e.decimalInteger("AVERAGE-BANDWIDTH")||e.decimalInteger("BANDWIDTH"),name:e.NAME,url:Us.resolve(o,t)},l=e.decimalResolution("RESOLUTION");l&&(a.width=l.width,a.height=l.height),zs((e.CODECS||"").split(/[ ,]+/).filter((e=>e)),a),a.videoCodec&&-1!==a.videoCodec.indexOf("avc1")&&(a.videoCodec=Us.convertAVC1ToAVCOTI(a.videoCodec)),null!=(s=a.unknownCodecs)&&s.length||r.push(a),i.levels.push(a)}else if(n[3]){const e=n[3],r=n[4];switch(e){case"SESSION-DATA":{const e=new vn(r);Cs(i,e,["DATA-ID","LANGUAGE","VALUE","URI"]);const t=e["DATA-ID"];t&&(null===i.sessionData&&(i.sessionData={}),i.sessionData[t]=e);break}case"SESSION-KEY":{const e=$s(r,t,i);e.encrypted&&e.isSupported()?(null===i.sessionKeys&&(i.sessionKeys=[]),i.sessionKeys.push(e)):pn.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${r}"`);break}case"DEFINE":{const e=new vn(r);Cs(i,e,["NAME","VALUE","QUERYPARAM"]),ks(i,e,t)}break;case"CONTENT-STEERING":{const e=new vn(r);Cs(i,e,["SERVER-URI","PATHWAY-ID"]),i.contentSteering={uri:Us.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":i.startTimeOffset=Hs(r)}}const o=r.length>0&&r.length<i.levels.length;return i.levels=o?r:i.levels,0===i.levels.length&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,i){let r;const n={},s=i.levels,o={AUDIO:s.map((e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec}))),SUBTITLES:s.map((e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec}))),"CLOSED-CAPTIONS":[]};let a=0;for(Ms.lastIndex=0;null!==(r=Ms.exec(e));){const e=new vn(r[1]),s=e.TYPE;if(s){const r=o[s],l=n[s]||[];n[s]=l,Cs(i,e,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const c={attrs:e,bitrate:0,id:a++,groupId:e["GROUP-ID"]||"",instreamId:e["INSTREAM-ID"],name:e.NAME||e.LANGUAGE||"",type:s,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:e.LANGUAGE,url:e.URI?Us.resolve(e.URI,t):""};if(null!=r&&r.length){const e=Us.findGroup(r,c.groupId)||r[0];js(c,e,"audioCodec"),js(c,e,"textCodec")}l.push(c)}}return n}static parseLevelPlaylist(e,t,i,r,n,s){const o=new An(t),a=o.fragments;let l,c,u,h=null,d=0,f=0,p=0,g=0,m=null,v=new Rn(r,t),y=-1,w=!1;for(Ns.lastIndex=0,o.m3u8=e,o.hasVariableRefs=Rs(e);null!==(l=Ns.exec(e));){w&&(w=!1,v=new Rn(r,t),v.start=p,v.sn=d,v.cc=g,v.level=i,h&&(v.initSegment=h,v.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null));const e=l[1];if(e){v.duration=parseFloat(e);const t=(" "+l[2]).slice(1);v.title=t||null,v.tagList.push(t?["INF",e,t]:["INF",e])}else if(l[3]){if(an(v.duration)){v.start=p,u&&qs(v,u,o),v.sn=d,v.level=i,v.cc=g,v.urlId=n,a.push(v);const e=(" "+l[3]).slice(1);v.relurl=As(o,e),Gs(v,m),m=v,p+=v.duration,d++,f=0,w=!0}}else if(l[4]){const e=(" "+l[4]).slice(1);m?v.setByteRange(e,m):v.setByteRange(e)}else if(l[5])v.rawProgramDateTime=(" "+l[5]).slice(1),v.tagList.push(["PROGRAM-DATE-TIME",v.rawProgramDateTime]),-1===y&&(y=a.length);else{if(l=l[0].match(Bs),!l){pn.warn("No matches on slow regex match for level playlist!");continue}for(c=1;c<l.length&&void 0===l[c];c++);const e=(" "+l[c]).slice(1),n=(" "+l[c+1]).slice(1),p=l[c+2]?(" "+l[c+2]).slice(1):"";switch(e){case"PLAYLIST-TYPE":o.type=n.toUpperCase();break;case"MEDIA-SEQUENCE":d=o.startSN=parseInt(n);break;case"SKIP":{const e=new vn(n);Cs(o,e,["RECENTLY-REMOVED-DATERANGES"]);const t=e.decimalInteger("SKIPPED-SEGMENTS");if(an(t)){o.skippedSegments=t;for(let e=t;e--;)a.unshift(null);d+=t}const i=e.enumeratedString("RECENTLY-REMOVED-DATERANGES");i&&(o.recentlyRemovedDateranges=i.split("\t"));break}case"TARGETDURATION":o.targetduration=Math.max(parseInt(n),1);break;case"VERSION":o.version=parseInt(n);break;case"EXTM3U":break;case"ENDLIST":o.live=!1;break;case"#":(n||p)&&v.tagList.push(p?[n,p]:[n]);break;case"DISCONTINUITY":g++,v.tagList.push(["DIS"]);break;case"GAP":v.gap=!0,v.tagList.push([e]);break;case"BITRATE":v.tagList.push([e,n]);break;case"DATERANGE":{const e=new vn(n);Cs(o,e,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),Cs(o,e,e.clientAttrs);const t=new wn(e,o.dateRanges[e.ID]);t.isValid||o.skippedSegments?o.dateRanges[t.id]=t:pn.warn(`Ignoring invalid DATERANGE tag: "${n}"`),v.tagList.push(["EXT-X-DATERANGE",n]);break}case"DEFINE":{const e=new vn(n);Cs(o,e,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in e?Ls(o,e,s):ks(o,e,t)}break;case"DISCONTINUITY-SEQUENCE":g=parseInt(n);break;case"KEY":{const e=$s(n,t,o);if(e.isSupported()){if("NONE"===e.method){u=void 0;break}u||(u={}),u[e.keyFormat]&&(u=on({},u)),u[e.keyFormat]=e}else pn.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${n}"`);break}case"START":o.startTimeOffset=Hs(n);break;case"MAP":{const e=new vn(n);if(Cs(o,e,["BYTERANGE","URI"]),v.duration){const n=new Rn(r,t);Vs(n,e,i,u),h=n,v.initSegment=h,h.rawProgramDateTime&&!v.rawProgramDateTime&&(v.rawProgramDateTime=h.rawProgramDateTime)}else Vs(v,e,i,u),h=v,w=!0;break}case"SERVER-CONTROL":{const e=new vn(n);o.canBlockReload=e.bool("CAN-BLOCK-RELOAD"),o.canSkipUntil=e.optionalFloat("CAN-SKIP-UNTIL",0),o.canSkipDateRanges=o.canSkipUntil>0&&e.bool("CAN-SKIP-DATERANGES"),o.partHoldBack=e.optionalFloat("PART-HOLD-BACK",0),o.holdBack=e.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const e=new vn(n);o.partTarget=e.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=o.partList;e||(e=o.partList=[]);const i=f>0?e[e.length-1]:void 0,r=f++,s=new vn(n);Cs(o,s,["BYTERANGE","URI"]);const a=new Cn(s,v,t,r,i);e.push(a),v.duration+=a.duration;break}case"PRELOAD-HINT":{const e=new vn(n);Cs(o,e,["URI"]),o.preloadHint=e;break}case"RENDITION-REPORT":{const e=new vn(n);Cs(o,e,["URI"]),o.renditionReports=o.renditionReports||[],o.renditionReports.push(e);break}default:pn.warn(`line parsed but not handled: ${l}`)}}}m&&!m.relurl?(a.pop(),p-=m.duration,o.partList&&(o.fragmentHint=m)):o.partList&&(Gs(v,m),v.cc=g,o.fragmentHint=v,u&&qs(v,u,o));const E=a.length,b=a[0],T=a[E-1];if(p+=o.skippedSegments*o.targetduration,p>0&&E&&T){o.averagetargetduration=p/E;const e=T.sn;o.endSN="initSegment"!==e?e:0,o.live||(T.endList=!0),b&&(o.startCC=b.cc)}else o.endSN=0,o.startCC=0;return o.fragmentHint&&(p+=o.fragmentHint.duration),o.totalduration=p,o.endCC=g,y>0&&function(e,t){let i=e[t];for(let r=t;r--;){const t=e[r];if(!t)return;t.programDateTime=i.programDateTime-1e3*t.duration,i=t}}(a,y),o}}function $s(e,t,i){var r,n;const s=new vn(e);Cs(i,s,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const o=null!=(r=s.METHOD)?r:"",a=s.URI,l=s.hexadecimalInteger("IV"),c=s.KEYFORMATVERSIONS,u=null!=(n=s.KEYFORMAT)?n:"identity";a&&s.IV&&!l&&pn.error(`Invalid IV: ${s.IV}`);const h=a?Us.resolve(a,t):"",d=(c||"1").split("/").map(Number).filter(Number.isFinite);return new Ss(o,h,u,d,l)}function Hs(e){const t=new vn(e).decimalFloatingPoint("TIME-OFFSET");return an(t)?t:null}function zs(e,t){["video","audio","text"].forEach((i=>{const r=e.filter((e=>function(e,t){const i=Ps[t];return!!i&&!0===i[e.slice(0,4)]}(e,i)));if(r.length){const n=r.filter((e=>0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)));t[`${i}Codec`]=n.length>0?n[0]:r[0],e=e.filter((e=>-1===r.indexOf(e)))}})),t.unknownCodecs=e}function js(e,t,i){const r=t[i];r&&(e[i]=r)}function Gs(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),an(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function Vs(e,t,i,r){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=i,e.sn="initSegment",r&&(e.levelkeys=r),e.initSegment=null}function qs(e,t,i){e.levelkeys=t;const{encryptedFragments:r}=i;r.length&&r[r.length-1].levelkeys===t||!Object.keys(t).some((e=>t[e].isCommonEncryption))||r.push(e)}var Ws="manifest",Ks="level",Ys="audioTrack",Xs="subtitleTrack",Zs="main",Qs="audio",Js="subtitle";function eo(e){const{type:t}=e;switch(t){case Ys:return Qs;case Xs:return Js;default:return Zs}}function to(e,t){let i=e.url;return void 0!==i&&0!==i.indexOf("data:")||(i=t.url),i}class io{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ln.LEVEL_LOADING,this.onLevelLoading,this),e.on(ln.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(ln.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ln.LEVEL_LOADING,this.onLevelLoading,this),e.off(ln.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(ln.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const t=this.hls.config,i=t.pLoader,r=t.loader,n=new(i||r)(t);return this.loaders[e.type]=n,n}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ws,url:i,deliveryDirectives:null})}onLevelLoading(e,t){const{id:i,level:r,url:n,deliveryDirectives:s}=t;this.load({id:i,level:r,responseType:"text",type:Ks,url:n,deliveryDirectives:s})}onAudioTrackLoading(e,t){const{id:i,groupId:r,url:n,deliveryDirectives:s}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:Ys,url:n,deliveryDirectives:s})}onSubtitleTrackLoading(e,t){const{id:i,groupId:r,url:n,deliveryDirectives:s}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:Xs,url:n,deliveryDirectives:s})}load(e){var t;const i=this.hls.config;let r,n=this.getInternalLoader(e);if(n){const t=n.context;if(t&&t.url===e.url)return void pn.trace("[playlist-loader]: playlist request ongoing");pn.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),n.abort()}if(r=e.type===Ws?i.manifestLoadPolicy.default:on({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),n=this.createInternalLoader(e),null!=(t=e.deliveryDirectives)&&t.part){let t;if(e.type===Ks&&null!==e.level?t=this.hls.levels[e.level].details:e.type===Ys&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===Xs&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){const e=t.partTarget,i=t.targetduration;if(e&&i){const t=1e3*Math.max(3*e,.8*i);r=on({},r,{maxTimeToFirstByteMs:Math.min(t,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,r.maxTimeToFirstByteMs)})}}}const s=r.errorRetry||r.timeoutRetry||{},o={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:s.maxNumRetry||0,retryDelay:s.retryDelayMs||0,maxRetryDelay:s.maxRetryDelayMs||0},a={onSuccess:(e,t,i,r)=>{const n=this.getInternalLoader(i);this.resetInternalLoader(i.type);const s=e.data;0===s.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),Us.isMediaPlaylist(s)?this.handleTrackOrLevelPlaylist(e,t,i,r||null,n):this.handleMasterPlaylist(e,t,i,r)):this.handleManifestParsingError(e,i,new Error("no EXTM3U delimiter"),r||null,t)},onError:(e,t,i,r)=>{this.handleNetworkError(t,i,!1,e,r)},onTimeout:(e,t,i)=>{this.handleNetworkError(t,i,!0,void 0,e)}};n.load(e,o,a)}handleMasterPlaylist(e,t,i,r){const n=this.hls,s=e.data,o=to(e,i),a=Us.parseMasterPlaylist(s,o);if(a.playlistParsingError)return void this.handleManifestParsingError(e,i,a.playlistParsingError,r,t);const{contentSteering:l,levels:c,sessionData:u,sessionKeys:h,startTimeOffset:d,variableList:f}=a;this.variableList=f;const{AUDIO:p=[],SUBTITLES:g,"CLOSED-CAPTIONS":m}=Us.parseMasterPlaylistMedia(s,o,a);p.length&&(p.some((e=>!e.url))||!c[0].audioCodec||c[0].attrs.AUDIO||(pn.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new vn({}),bitrate:0,url:""}))),n.trigger(ln.MANIFEST_LOADED,{levels:c,audioTracks:p,subtitles:g,captions:m,contentSteering:l,url:o,stats:t,networkDetails:r,sessionData:u,sessionKeys:h,startTimeOffset:d,variableList:f})}handleTrackOrLevelPlaylist(e,t,i,r,n){const s=this.hls,{id:o,level:a,type:l}=i,c=to(e,i),u=an(o)?o:0,h=an(a)?a:u,d=eo(i),f=Us.parseLevelPlaylist(e.data,c,h,d,u,this.variableList);if(l===Ws){const e={attrs:new vn({}),bitrate:0,details:f,name:"",url:c};s.trigger(ln.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:c,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=f,this.handlePlaylistLoaded(f,e,t,i,r,n)}handleManifestParsingError(e,t,i,r,n){this.hls.trigger(ln.ERROR,{type:cn.NETWORK_ERROR,details:un.MANIFEST_PARSING_ERROR,fatal:t.type===Ws,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:r,stats:n})}handleNetworkError(e,t,i=!1,r,n){let s=`A network ${i?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===Ks?s+=`: ${e.level} id: ${e.id}`:e.type!==Ys&&e.type!==Xs||(s+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(s);pn.warn(`[playlist-loader]: ${s}`);let a=un.UNKNOWN,l=!1;const c=this.getInternalLoader(e);switch(e.type){case Ws:a=i?un.MANIFEST_LOAD_TIMEOUT:un.MANIFEST_LOAD_ERROR,l=!0;break;case Ks:a=i?un.LEVEL_LOAD_TIMEOUT:un.LEVEL_LOAD_ERROR,l=!1;break;case Ys:a=i?un.AUDIO_TRACK_LOAD_TIMEOUT:un.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case Xs:a=i?un.SUBTITLE_TRACK_LOAD_TIMEOUT:un.SUBTITLE_LOAD_ERROR,l=!1}c&&this.resetInternalLoader(e.type);const u={type:cn.NETWORK_ERROR,details:a,fatal:l,url:e.url,loader:c,context:e,error:o,networkDetails:t,stats:n};if(r){const i=(null==t?void 0:t.url)||e.url;u.response=nn({url:i,data:void 0},r)}this.hls.trigger(ln.ERROR,u)}handlePlaylistLoaded(e,t,i,r,n,s){const o=this.hls,{type:a,level:l,id:c,groupId:u,deliveryDirectives:h}=r,d=to(t,r),f=eo(r),p="number"==typeof r.level&&f===Zs?l:void 0;if(!e.fragments.length){const e=new Error("No Segments found in Playlist");return void o.trigger(ln.ERROR,{type:cn.NETWORK_ERROR,details:un.LEVEL_EMPTY_ERROR,fatal:!1,url:d,error:e,reason:e.message,response:t,context:r,level:p,parent:f,networkDetails:n,stats:i})}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const g=e.playlistParsingError;if(g)o.trigger(ln.ERROR,{type:cn.NETWORK_ERROR,details:un.LEVEL_PARSING_ERROR,fatal:!1,url:d,error:g,reason:g.message,response:t,context:r,level:p,parent:f,networkDetails:n,stats:i});else switch(e.live&&s&&(s.getCacheAge&&(e.ageHeader=s.getCacheAge()||0),s.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),a){case Ws:case Ks:o.trigger(ln.LEVEL_LOADED,{details:e,level:p||0,id:c||0,stats:i,networkDetails:n,deliveryDirectives:h});break;case Ys:o.trigger(ln.AUDIO_TRACK_LOADED,{details:e,id:c||0,groupId:u||"",stats:i,networkDetails:n,deliveryDirectives:h});break;case Xs:o.trigger(ln.SUBTITLE_TRACK_LOADED,{details:e,id:c||0,groupId:u||"",stats:i,networkDetails:n,deliveryDirectives:h})}}}function ro(e,t){let i;try{i=new Event("addtrack")}catch(e){i=document.createEvent("Event"),i.initEvent("addtrack",!1,!1)}i.track=e,t.dispatchEvent(i)}function no(e,t){const i=e.mode;if("disabled"===i&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(i){pn.debug(`[texttrack-utils]: ${i}`);try{const i=new self.TextTrackCue(t.startTime,t.endTime,t.text);i.id=t.id,e.addCue(i)}catch(e){pn.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${e}`)}}"disabled"===i&&(e.mode=i)}function so(e){const t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(let t=e.cues.length;t--;)e.removeCue(e.cues[t]);"disabled"===t&&(e.mode=t)}function oo(e,t,i,r){const n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues&&e.cues.length>0){const n=function(e,t,i){const r=[],n=function(e,t){if(t<e[0].startTime)return 0;const i=e.length-1;if(t>e[i].endTime)return-1;let r=0,n=i;for(;r<=n;){const s=Math.floor((n+r)/2);if(t<e[s].startTime)n=s-1;else{if(!(t>e[s].startTime&&r<i))return s;r=s+1}}return e[r].startTime-t<t-e[n].startTime?r:n}(e,t);if(n>-1)for(let s=n,o=e.length;s<o;s++){const n=e[s];if(n.startTime>=t&&n.endTime<=i)r.push(n);else if(n.startTime>i)return r}return r}(e.cues,t,i);for(let t=0;t<n.length;t++)r&&!r(n[t])||e.removeCue(n[t])}"disabled"===n&&(e.mode=n)}var ao="org.id3",lo="https://aomedia.org/emsg/ID3";function co(){if("undefined"!=typeof self)return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}const uo=(()=>{const e=co();try{new e(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function ho(e,t){return e.getTime()/1e3-t}class fo{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(ln.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ln.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ln.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(ln.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(ln.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(ln.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ln.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ln.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(ln.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(ln.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(so(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const i=e[t];if("metadata"===i.kind&&"id3"===i.label)return ro(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:i,enableID3MetadataCues:r}}}=this;if(!i&&!r)return;const{samples:n}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const s=co();for(let e=0;e<n.length;e++){const t=n[e].type;if(t===lo&&!i||!r)continue;const o=Kn(n[e].data);if(o){const i=n[e].pts;let r=i+n[e].duration;r>uo&&(r=uo),r-i<=0&&(r=i+.25);for(let e=0;e<o.length;e++){const n=o[e];if(!qn(n)){this.updateId3CueEnds(i,t);const e=new s(i,r,"");e.value=n,t&&(e.type=t),this.id3Track.addCue(e)}}}}}updateId3CueEnds(e,t){var i;const r=null==(i=this.id3Track)?void 0:i.cues;if(r)for(let i=r.length;i--;){const n=r[i];n.type===t&&n.startTime<e&&n.endTime===uo&&(n.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:r}){const{id3Track:n,hls:s}=this;if(!s)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:a}}=s;if(n&&(o||a)){let e;e="audio"===r?e=>e.type===ao&&a:"video"===r?e=>e.type===lo&&o:e=>e.type===ao&&a||e.type===lo&&o,oo(n,t,i,e)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:i,id3Track:r}=this,{dateRanges:n}=t,s=Object.keys(n);if(r){const e=Object.keys(i).filter((e=>!s.includes(e)));for(let t=e.length;t--;){const n=e[t];Object.keys(i[n].cues).forEach((e=>{r.removeCue(i[n].cues[e])})),delete i[n]}}const o=t.fragments[t.fragments.length-1];if(0===s.length||!an(null==o?void 0:o.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=o.programDateTime/1e3-o.start,l=co();for(let e=0;e<s.length;e++){const t=s[e],r=n[t],o=i[t],h=(null==o?void 0:o.cues)||{};let d=(null==o?void 0:o.durationKnown)||!1;const f=ho(r.startDate,a);let p=uo;const g=r.endDate;if(g)p=ho(g,a),d=!0;else if(r.endOnNext&&!d){const e=s.reduce(((e,t)=>{const i=n[t];return i.class===r.class&&i.id!==t&&i.startDate>r.startDate&&e.push(i),e}),[]).sort(((e,t)=>e.startDate.getTime()-t.startDate.getTime()))[0];e&&(p=ho(e.startDate,a),d=!0)}const m=Object.keys(r.attr);for(let e=0;e<m.length;e++){const i=m[e];if("ID"===(u=i)||"CLASS"===u||"START-DATE"===u||"DURATION"===u||"END-DATE"===u||"END-ON-NEXT"===u)continue;let n=h[i];if(n)d&&!o.durationKnown&&(n.endTime=p);else{let e=r.attr[i];n=new l(f,p,""),yn(i)&&(c=e,e=Uint8Array.from(c.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),n.value={key:i,data:e},n.type="com.apple.quicktime.HLS",n.id=t,this.id3Track.addCue(n),h[i]=n}}i[t]={cues:h,dateRange:r,durationKnown:d}}var c,u}}class po{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:t}=this;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(null===e)return null;const{holdBack:t,partHoldBack:i,targetduration:r}=e,{liveSyncDuration:n,liveSyncDurationCount:s,lowLatencyMode:o}=this.config,a=this.hls.userConfig;let l=o&&i||t;(a.liveSyncDuration||a.liveSyncDurationCount||0===l)&&(l=void 0!==n?n:s*r);const c=r;return l+Math.min(1*this.stallCount,c)}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency,i=this.levelDetails;if(null===e||null===t||null===i)return null;const r=i.edge,n=e-t-this.edgeStalled,s=r-i.totalduration,o=r-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(s,n),o)}get drift(){const{levelDetails:e}=this;return null===e?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;if(null===e)return 0;const t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e,levelDetails:t}=this;if(!e||!t)return 0;const i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(ln.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(ln.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(ln.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(ln.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(ln.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(ln.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(ln.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(ln.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(ln.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(ln.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var i;t.details===un.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(i=this.levelDetails)&&i.live&&pn.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const i=this.computeLatency();if(null===i)return;this._latency=i;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:n}=this.config;if(!r||1===n)return;const s=this.targetLatency;if(null===s)return;const o=i-s,a=o<Math.min(this.maxLatency,s+t.targetduration);if(t.live&&a&&o>.05&&this.forwardBufferLength>1){const t=Math.min(2,Math.max(1,n)),i=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;e.playbackRate=Math.min(t,Math.max(1,i))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}const go=["NONE","TYPE-0","TYPE-1",null];class mo{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class vo{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter((e=>e)).join(",").replace(/\.[^.,]+/g,"")}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get attrs(){return this._attrs[this._urlId]}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get uri(){return this.url[this._urlId]||""}get urlId(){return this._urlId}set urlId(e){const t=e%this.url.length;this._urlId!==t&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=t)}get audioGroupId(){var e;return null==(e=this.audioGroupIds)?void 0:e[this.urlId]}get textGroupId(){var e;return null==(e=this.textGroupIds)?void 0:e[this.urlId]}addFallback(e){this.url.push(e.url),this._attrs.push(e.attrs)}}function yo(e,t){const i=t.startPTS;if(an(i)){let r,n=0;t.sn>e.sn?(n=i-e.start,r=e):(n=e.start-i,r=t),r.duration!==n&&(r.duration=n)}else t.sn>e.sn?e.cc===t.cc&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration:t.start=Math.max(e.start-t.duration,0)}function wo(e,t,i,r,n,s){r-i<=0&&(pn.warn("Fragment should have a positive duration",t),r=i+t.duration,s=n+t.duration);let o=i,a=r;const l=t.startPTS,c=t.endPTS;if(an(l)){const e=Math.abs(l-i);an(t.deltaPTS)?t.deltaPTS=Math.max(e,t.deltaPTS):t.deltaPTS=e,o=Math.max(i,l),i=Math.min(i,l),n=Math.min(n,t.startDTS),a=Math.min(r,c),r=Math.max(r,c),s=Math.max(s,t.endDTS)}const u=i-t.start;0!==t.start&&(t.start=i),t.duration=r-t.start,t.startPTS=i,t.maxStartPTS=o,t.startDTS=n,t.endPTS=r,t.minEndPTS=a,t.endDTS=s;const h=t.sn;if(!e||h<e.startSN||h>e.endSN)return 0;let d;const f=h-e.startSN,p=e.fragments;for(p[f]=t,d=f;d>0;d--)yo(p[d],p[d-1]);for(d=f;d<p.length-1;d++)yo(p[d],p[d+1]);return e.fragmentHint&&yo(p[p.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,u}function Eo(e,t){const i=t.startSN+t.skippedSegments-e.startSN,r=e.fragments;i<0||i>=r.length||bo(t,r[i].start)}function bo(e,t){if(t){const i=e.fragments;for(let r=e.skippedSegments;r<i.length;r++)i[r].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function To(e,t,i){var r;return null!=e&&e.details?So(null==(r=e.details)?void 0:r.partList,t,i):null}function So(e,t,i){if(e)for(let r=e.length;r--;){const n=e[r];if(n.index===i&&n.fragment.sn===t)return n}return null}function xo(e){switch(e.details){case un.FRAG_LOAD_TIMEOUT:case un.KEY_LOAD_TIMEOUT:case un.LEVEL_LOAD_TIMEOUT:case un.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Ro(e,t){const i=xo(t);return e.default[(i?"timeout":"error")+"Retry"]}function Co(e,t){const i="linear"===e.backoff?1:Math.pow(2,t);return Math.min(i*e.retryDelayMs,e.maxRetryDelayMs)}function Ao(e){return nn(nn({},e),{errorRetry:null,timeoutRetry:null})}function ko(e,t,i,r){return!!e&&t<e.maxNumRetry&&(function(e){return 0===e&&!1===navigator.onLine||!!e&&(e<400||e>499)}(r)||!!i)}const Lo={search:function(e,t){let i=0,r=e.length-1,n=null,s=null;for(;i<=r;){n=(i+r)/2|0,s=e[n];const o=t(s);if(o>0)i=n+1;else{if(!(o<0))return s;r=n-1}}return null}};function Io(e,t,i=0,r=0){let n=null;if(e?n=t[e.sn-t[0].sn+1]||null:0===i&&0===t[0].start&&(n=t[0]),n&&0===Po(i,r,n))return n;const s=Lo.search(t,Po.bind(null,i,r));return!s||s===e&&n?n:s}function Po(e=0,t=0,i){if(i.start<=e&&i.start+i.duration>e)return 0;const r=Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-r<=e?1:i.start-r>e&&i.start?-1:0}function _o(e,t,i){const r=1e3*Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return(i.endProgramDateTime||0)-r>e}function Do(e,t,i){if(performance.now()-e.lastErrorPerfMs>3e5)return!0;const r=e.details;if(t.details===un.FRAG_GAP&&r&&t.frag){const e=t.frag.start,i=Io(null,r.fragments,e);if(i&&!i.gap)return!0}if(i&&e.errors.length<i.errors.length){const i=e.errors[e.errors.length-1];if(r&&i.frag&&t.frag&&Math.abs(i.frag.start-t.frag.start)>3*r.targetduration)return!0}return!1}class Oo{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=pn.log.bind(pn,`${t}:`),this.warn=pn.warn.bind(pn,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){clearTimeout(this.timer),this.timer=-1}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t){const i=null==t?void 0:t.renditionReports;if(i){let r=-1;for(let n=0;n<i.length;n++){const s=i[n];let o;try{o=new self.URL(s.URI,t.url).href}catch(e){pn.warn(`Could not construct new URL for Rendition Report: ${e}`),o=s.URI||""}if(o===e){r=n;break}o===e.substring(0,o.length)&&(r=n)}if(-1!==r){const e=i[r],n=parseInt(e["LAST-MSN"])||(null==t?void 0:t.lastPartSn);let s=parseInt(e["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const e=Math.min(t.age-t.partTarget,t.targetduration);s>=0&&e>t.partTarget&&(s+=1)}return new mo(n,s>=0?s:void 0,"")}}}loadPlaylist(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,i){const{details:r,stats:n}=t,s=self.performance.now(),o=n.loading.first?Math.max(0,s-n.loading.first):0;if(r.advancedDateTime=Date.now()-o,r.live||null!=i&&i.live){if(r.reloaded(i),i&&this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),i&&r.fragments.length>0&&function(e,t){let i=null;const r=e.fragments;for(let e=r.length-1;e>=0;e--){const t=r[e].initSegment;if(t){i=t;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;let n,s=0;if(function(e,t,i){const r=t.skippedSegments,n=Math.max(e.startSN,t.startSN)-t.startSN,s=(e.fragmentHint?1:0)+(r?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,o=t.startSN-e.startSN,a=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let e=n;e<=s;e++){const n=l[o+e];let s=a[e];r&&!s&&e<r&&(s=t.fragments[e]=n),n&&s&&i(n,s)}}(e,t,((e,r)=>{e.relurl&&(s=e.cc-r.cc),an(e.startPTS)&&an(e.endPTS)&&(r.start=r.startPTS=e.startPTS,r.startDTS=e.startDTS,r.maxStartPTS=e.maxStartPTS,r.endPTS=e.endPTS,r.endDTS=e.endDTS,r.minEndPTS=e.minEndPTS,r.duration=e.endPTS-e.startPTS,r.duration&&(n=r),t.PTSKnown=t.alignedSliding=!0),r.elementaryStreams=e.elementaryStreams,r.loader=e.loader,r.stats=e.stats,r.urlId=e.urlId,e.initSegment&&(r.initSegment=e.initSegment,i=e.initSegment)})),i&&(t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments).forEach((e=>{var t;e.initSegment&&e.initSegment.relurl!==(null==(t=i)?void 0:t.relurl)||(e.initSegment=i)})),t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some((e=>!e)),t.deltaUpdateFailed){pn.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=function(e,t,i){const r=on({},e);return i&&i.forEach((e=>{delete r[e]})),Object.keys(t).forEach((e=>{const i=new wn(t[e].attr,r[e]);i.isValid?r[e]=i:pn.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(t[e].attr)}"`)})),r}(e.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));const o=t.fragments;if(s){pn.warn("discontinuity sliding from playlist, take drift into account");for(let e=0;e<o.length;e++)o[e].cc+=s}t.skippedSegments&&(t.startCC=t.fragments[0].cc),function(e,t,i){if(e&&t){let r=0;for(let n=0,s=e.length;n<=s;n++){const s=e[n],o=t[n+r];s&&o&&s.index===o.index&&s.fragment.sn===o.fragment.sn?i(s,o):r--}}}(e.partList,t.partList,((e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats})),n?wo(t,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):Eo(e,t),o.length&&(t.totalduration=t.edge-o[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;const a=t.advancedDateTime;if(t.advanced&&a){const e=t.edge;t.driftStart||(t.driftStartTime=a,t.driftStart=e),t.driftEndTime=a,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}(i,r),!this.canLoad||!r.live)return;let o,a,l;if(r.canBlockReload&&r.endSN&&r.advanced){const e=this.hls.config.lowLatencyMode,n=r.lastPartSn,s=r.endSN,c=r.lastPartIndex,u=n===s;-1!==c?(a=u?s+1:n,l=u?e?0:c:c+1):a=s+1;const h=r.age,d=h+r.ageHeader;let f=Math.min(d-r.partTarget,1.5*r.targetduration);if(f>0){if(i&&f>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${f} with playlist age: ${r.age}`),f=0;else{const e=Math.floor(f/r.targetduration);a+=e,void 0!==l&&(l+=Math.round(f%r.targetduration/r.partTarget)),this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${h.toFixed(2)}s goal: ${f} skip sn ${e} to part ${l}`)}r.tuneInGoal=f}if(o=this.getDeliveryDirectives(r,t.deliveryDirectives,a,l),e||!u)return void this.loadPlaylist(o)}else(r.canBlockReload||r.canSkipUntil)&&(o=this.getDeliveryDirectives(r,t.deliveryDirectives,a,l));const c=this.hls.mainForwardBufferInfo,u=c?c.end-c.len:0,h=function(e,t=1/0){let i=1e3*e.targetduration;if(e.updated){const r=e.fragments,n=4;if(r.length&&i*n>t){const e=1e3*r[r.length-1].duration;e<i&&(i=e)}}else i/=2;return Math.round(i)}(r,1e3*(r.edge-u));r.updated&&s>this.requestScheduled+h&&(this.requestScheduled=n.loading.start),void 0!==a&&r.canBlockReload?this.requestScheduled=n.loading.first+h-(1e3*r.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+h<s?this.requestScheduled=s:this.requestScheduled-s<=0&&(this.requestScheduled+=h);let d=this.requestScheduled-s;d=Math.max(0,d),this.log(`reload live playlist ${e} in ${Math.round(d)} ms`),this.timer=self.setTimeout((()=>this.loadPlaylist(o)),d)}else this.clearTimer()}getDeliveryDirectives(e,t,i,r){let n=function(e,t){const{canSkipUntil:i,canSkipDateRanges:r,endSN:n}=e;return i&&(void 0!==t?t-n:0)<i?r?"v2":"YES":""}(e,i);return null!=t&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,r=t.part,n=""),new mo(i,r,n)}checkRetry(e){const t=e.details,i=xo(e),r=e.errorAction,{action:n,retryCount:s=0,retryConfig:o}=r||{},a=!!r&&!!o&&(5===n||!r.resolved&&2===n);if(a){var l;if(this.requestScheduled=-1,s>=o.maxNumRetry)return!1;if(i&&null!=(l=e.context)&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${s+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const e=Co(o,s);this.timer=self.setTimeout((()=>this.loadPlaylist()),e),this.warn(`Retrying playlist loading ${s+1}/${o.maxNumRetry} after "${t}" in ${e}ms`)}e.levelRetry=!0,r.resolved=!0}return a}}let Mo;class Fo extends Oo{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ln.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(ln.LEVEL_LOADED,this.onLevelLoaded,this),e.on(ln.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(ln.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(ln.FRAG_LOADED,this.onFragLoaded,this),e.on(ln.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ln.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(ln.LEVEL_LOADED,this.onLevelLoaded,this),e.off(ln.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(ln.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(ln.FRAG_LOADED,this.onFragLoaded,this),e.off(ln.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}startLoad(){this._levels.forEach((e=>{e.loadError=0,e.fragmentError=0})),super.startLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const i=[],r={};let n;t.levels.forEach((e=>{var t;const s=e.attrs;-1!==(null==(t=e.audioCodec)?void 0:t.indexOf("mp4a.40.34"))&&(Mo||(Mo=/chrome|firefox/i.test(navigator.userAgent)),Mo&&(e.audioCodec=void 0));const{AUDIO:o,CODECS:a,"FRAME-RATE":l,"PATHWAY-ID":c,RESOLUTION:u,SUBTITLES:h}=s,d=`${c||"."}-${e.bitrate}-${u}-${l}-${a}`;n=r[d],n?n.addFallback(e):(n=new vo(e),r[d]=n,i.push(n)),No(n,"audio",o),No(n,"text",h)})),this.filterAndSortMediaOptions(i,t)}filterAndSortMediaOptions(e,t){let i=[],r=[],n=!1,s=!1,o=!1,a=e.filter((({audioCodec:e,videoCodec:t,width:i,height:r,unknownCodecs:a})=>(n||(n=!(!i||!r)),s||(s=!!t),o||(o=!!e),!(null!=a&&a.length)&&(!e||Ds(e,"audio"))&&(!t||Ds(t,"video")))));if((n||s)&&o&&(a=a.filter((({videoCodec:e,width:t,height:i})=>!!e||!(!t||!i)))),0===a.length)return void Promise.resolve().then((()=>{if(this.hls){const e=new Error("no level with compatible codecs found in manifest");this.hls.trigger(ln.ERROR,{type:cn.MEDIA_ERROR,details:un.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:e,reason:e.message})}}));t.audioTracks&&(i=t.audioTracks.filter((e=>!e.audioCodec||Ds(e.audioCodec,"audio"))),Bo(i)),t.subtitles&&(r=t.subtitles,Bo(r));const l=a.slice(0);a.sort(((e,t)=>e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"]?(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1:e.bitrate!==t.bitrate?e.bitrate-t.bitrate:e.attrs["FRAME-RATE"]!==t.attrs["FRAME-RATE"]?e.attrs.decimalFloatingPoint("FRAME-RATE")-t.attrs.decimalFloatingPoint("FRAME-RATE"):e.attrs.SCORE!==t.attrs.SCORE?e.attrs.decimalFloatingPoint("SCORE")-t.attrs.decimalFloatingPoint("SCORE"):n&&e.height!==t.height?e.height-t.height:0));let c=l[0];if(this.steering&&(a=this.steering.filterParsedLevels(a),a.length!==l.length))for(let e=0;e<l.length;e++)if(l[e].pathwayId===a[0].pathwayId){c=l[e];break}this._levels=a;for(let e=0;e<a.length;e++)if(a[e]===c){this._firstLevel=e,this.log(`manifest loaded, ${a.length} level(s) found, first bitrate: ${c.bitrate}`);break}const u=o&&!s,h={levels:a,audioTracks:i,subtitleTracks:r,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:o,video:s,altAudio:!u&&i.some((e=>!!e.url))};this.hls.trigger(ln.MANIFEST_PARSED,h),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return 0===this._levels.length?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const i=new Error("invalid level idx"),r=e<0;if(this.hls.trigger(ln.ERROR,{type:cn.OTHER_ERROR,details:un.LEVEL_SWITCH_ERROR,level:e,fatal:r,error:i,reason:i.message}),r)return;e=Math.min(e,t.length-1)}const i=this.currentLevelIndex,r=this.currentLevel,n=r?r.attrs["PATHWAY-ID"]:void 0,s=t[e],o=s.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=s,i===e&&s.details&&r&&n===o)return;this.log(`Switching to level ${e}${o?" with Pathway "+o:""} from level ${i}${n?" with Pathway "+n:""}`);const a=on({},s,{level:e,maxBitrate:s.maxBitrate,attrs:s.attrs,uri:s.uri,urlId:s.urlId});delete a._attrs,delete a._urlId,this.hls.trigger(ln.LEVEL_SWITCHING,a);const l=s.details;if(!l||l.live){const e=this.switchParams(s.uri,null==r?void 0:r.details);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){!t.fatal&&t.context&&t.context.type===Ks&&t.context.level===this.level&&this.checkRetry(t)}onFragLoaded(e,{frag:t}){if(void 0!==t&&t.type===Zs){const e=this._levels[t.level];void 0!==e&&(e.loadError=0)}}onLevelLoaded(e,t){var i;const{level:r,details:n}=t,s=this._levels[r];var o;if(!s)return this.warn(`Invalid level index ${r}`),void(null!=(o=t.deliveryDirectives)&&o.skip&&(n.deltaUpdateFailed=!0));r===this.currentLevelIndex?(0===s.fragmentError&&(s.loadError=0),this.playlistLoaded(r,t,s.details)):null!=(i=t.deliveryDirectives)&&i.skip&&(n.deltaUpdateFailed=!0)}onAudioTrackSwitched(e,t){const i=this.currentLevel;if(!i)return;const r=this.hls.audioTracks[t.id].groupId;if(i.audioGroupIds&&i.audioGroupId!==r){let e=-1;for(let t=0;t<i.audioGroupIds.length;t++)if(i.audioGroupIds[t]===r){e=t;break}-1!==e&&e!==i.urlId&&(i.urlId=e,this.canLoad&&this.startLoad())}}loadPlaylist(e){super.loadPlaylist();const t=this.currentLevelIndex,i=this.currentLevel;if(i&&this.shouldLoadPlaylist(i)){const r=i.urlId;let n=i.uri;if(e)try{n=e.addDirectives(n)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}const s=i.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${void 0!==(null==e?void 0:e.msn)?" at sn "+e.msn+" part "+e.part:""} with${s?" Pathway "+s:""} URI ${r+1}/${i.url.length} ${n}`),this.clearTimer(),this.hls.trigger(ln.LEVEL_LOADING,{url:n,level:t,id:r,deliveryDirectives:e||null})}}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e,t){const i=(e,i)=>i!==t,r=this._levels.filter(((r,n)=>n!==e||(r.url.length>1&&void 0!==t?(r.url=r.url.filter(i),r.audioGroupIds&&(r.audioGroupIds=r.audioGroupIds.filter(i)),r.textGroupIds&&(r.textGroupIds=r.textGroupIds.filter(i)),r.urlId=0,!0):(this.steering&&this.steering.removeLevel(r),!1))));this.hls.trigger(ln.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){t.forEach(((e,t)=>{const{details:i}=e;null!=i&&i.fragments&&i.fragments.forEach((e=>{e.level=t}))})),this._levels=t}}function No(e,t,i){i&&("audio"===t?(e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds[e.url.length-1]=i):"text"===t&&(e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds[e.url.length-1]=i))}function Bo(e){const t={};e.forEach((e=>{const i=e.groupId||"";e.id=t[i]=t[i]||0,t[i]++}))}var Uo="NOT_LOADED",$o="APPENDING",Ho="PARTIAL",zo="OK";class jo{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(ln.BUFFER_APPENDED,this.onBufferAppended,this),e.on(ln.FRAG_BUFFERED,this.onFragBuffered,this),e.on(ln.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(ln.BUFFER_APPENDED,this.onBufferAppended,this),e.off(ln.FRAG_BUFFERED,this.onFragBuffered,this),e.off(ln.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const i=this.activePartLists[t];if(i)for(let t=i.length;t--;){const r=i[t];if(!r)break;const n=r.end;if(r.start<=e&&null!==n&&e<=n)return r}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){const{fragments:i}=this,r=Object.keys(i);for(let n=r.length;n--;){const s=i[r[n]];if((null==s?void 0:s.body.type)===t&&s.buffered){const t=s.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,i,r){this.timeRanges&&(this.timeRanges[e]=t);const n=(null==r?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach((r=>{const s=this.fragments[r];if(!s)return;if(n>=s.body.sn)return;if(!s.buffered&&!s.loaded)return void(s.body.type===i&&this.removeFragment(s.body));const o=s.range[e];o&&o.time.some((e=>{const i=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return i&&this.removeFragment(s.body),i}))}))}detectPartialFragments(e){const t=this.timeRanges,{frag:i,part:r}=e;if(!t||"initSegment"===i.sn)return;const n=Vo(i),s=this.fragments[n];if(!s||s.buffered&&i.gap)return;const o=!i.relurl;Object.keys(t).forEach((e=>{const n=i.elementaryStreams[e];if(!n)return;const a=t[e],l=o||!0===n.partial;s.range[e]=this.getBufferedTimes(i,r,l,a)})),s.loaded=null,Object.keys(s.range).length?(s.buffered=!0,(s.body.endList=i.endList||s.body.endList)&&(this.endListFragments[s.body.type]=s),Go(s)||this.removeParts(i.sn-1,i.type)):this.removeFragment(s.body)}removeParts(e,t){const i=this.activePartLists[t];i&&(this.activePartLists[t]=i.filter((t=>t.fragment.sn>=e)))}fragBuffered(e,t){const i=Vo(e);let r=this.fragments[i];!r&&t&&(r=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)}getBufferedTimes(e,t,i,r){const n={time:[],partial:i},s=e.start,o=e.end,a=e.minEndPTS||o,l=e.maxStartPTS||s;for(let e=0;e<r.length;e++){const t=r.start(e)-this.bufferPadding,i=r.end(e)+this.bufferPadding;if(l>=t&&a<=i){n.time.push({startPTS:Math.max(s,r.start(e)),endPTS:Math.min(o,r.end(e))});break}if(s<i&&o>t)n.partial=!0,n.time.push({startPTS:Math.max(s,r.start(e)),endPTS:Math.min(o,r.end(e))});else if(o<=t)break}return n}getPartialFragment(e){let t,i,r,n=null,s=0;const{bufferPadding:o,fragments:a}=this;return Object.keys(a).forEach((l=>{const c=a[l];c&&Go(c)&&(i=c.body.start-o,r=c.body.end+o,e>=i&&e<=r&&(t=Math.min(e-i,r-e),s<=t&&(n=c.body,s=t)))})),n}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||Go(t))}getState(e){const t=Vo(e),i=this.fragments[t];return i?i.buffered?Go(i)?Ho:zo:$o:Uo}isTimeBuffered(e,t,i){let r,n;for(let s=0;s<i.length;s++){if(r=i.start(s)-this.bufferPadding,n=i.end(s)+this.bufferPadding,e>=r&&t<=n)return!0;if(t<=r)return!1}return!1}onFragLoaded(e,t){const{frag:i,part:r}=t;if("initSegment"===i.sn||i.bitrateTest)return;const n=r?null:t,s=Vo(i);this.fragments[s]={body:i,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:i,part:r,timeRanges:n}=t;if("initSegment"===i.sn)return;const s=i.type;if(r){let e=this.activePartLists[s];e||(this.activePartLists[s]=e=[]),e.push(r)}this.timeRanges=n,Object.keys(n).forEach((e=>{const t=n[e];this.detectEvictedFragments(e,t,s,r)}))}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Vo(e);return!!this.fragments[t]}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,i,r,n){r&&!this.hasGaps||Object.keys(this.fragments).forEach((s=>{const o=this.fragments[s];if(!o)return;const a=o.body;a.type!==i||r&&!a.gap||a.start<t&&a.end>e&&(o.buffered||n)&&this.removeFragment(a)}))}removeFragment(e){const t=Vo(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const i=this.activePartLists[e.type];if(i){const t=e.sn;this.activePartLists[e.type]=i.filter((e=>e.fragment.sn!==t))}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function Go(e){var t,i,r;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(i=e.range.audio)?void 0:i.partial)||(null==(r=e.range.audiovideo)?void 0:r.partial))}function Vo(e){return`${e.type}_${e.level}_${e.urlId}_${e.sn}`}const qo=Math.pow(2,17);class Wo{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const i=e.url;if(!i)return Promise.reject(new Xo({type:cn.NETWORK_ERROR,details:un.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(i?"part list":"url")),networkDetails:null}));this.abort();const r=this.config,n=r.fLoader,s=r.loader;return new Promise(((o,a)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some((e=>"GAP"===e[0])))return void a(Yo(e));e.gap=!1}const l=this.loader=e.loader=n?new n(r):new s(r),c=Ko(e),u=Ao(r.fragLoadPolicy.default),h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:qo};e.stats=l.stats,l.load(c,h,{onSuccess:(t,i,r,n)=>{this.resetLoader(e,l);let s=t.data;r.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(s.slice(0,16)),s=s.slice(16)),o({frag:e,part:null,payload:s,networkDetails:n})},onError:(t,r,n,s)=>{this.resetLoader(e,l),a(new Xo({type:cn.NETWORK_ERROR,details:un.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:nn({url:i,data:void 0},t),error:new Error(`HTTP Error ${t.code} ${t.text}`),networkDetails:n,stats:s}))},onAbort:(t,i,r)=>{this.resetLoader(e,l),a(new Xo({type:cn.NETWORK_ERROR,details:un.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:r,stats:t}))},onTimeout:(t,i,r)=>{this.resetLoader(e,l),a(new Xo({type:cn.NETWORK_ERROR,details:un.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:r,stats:t}))},onProgress:(i,r,n,s)=>{t&&t({frag:e,part:null,payload:n,networkDetails:s})}})}))}loadPart(e,t,i){this.abort();const r=this.config,n=r.fLoader,s=r.loader;return new Promise(((o,a)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void a(Yo(e,t));const l=this.loader=e.loader=n?new n(r):new s(r),c=Ko(e,t),u=Ao(r.fragLoadPolicy.default),h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:qo};t.stats=l.stats,l.load(c,h,{onSuccess:(r,n,s,a)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const c={frag:e,part:t,payload:r.data,networkDetails:a};i(c),o(c)},onError:(i,r,n,s)=>{this.resetLoader(e,l),a(new Xo({type:cn.NETWORK_ERROR,details:un.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:nn({url:c.url,data:void 0},i),error:new Error(`HTTP Error ${i.code} ${i.text}`),networkDetails:n,stats:s}))},onAbort:(i,r,n)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),a(new Xo({type:cn.NETWORK_ERROR,details:un.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:n,stats:i}))},onTimeout:(i,r,n)=>{this.resetLoader(e,l),a(new Xo({type:cn.NETWORK_ERROR,details:un.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:n,stats:i}))}})}))}updateStatsFromPart(e,t){const i=e.stats,r=t.stats,n=r.total;if(i.loaded+=r.loaded,n){const r=Math.round(e.duration/t.duration),s=Math.min(Math.round(i.loaded/n),r),o=(r-s)*Math.round(i.loaded/s);i.total=i.loaded+o}else i.total=Math.max(i.loaded,i.total);const s=i.loading,o=r.loading;s.start?s.first+=o.first-o.start:(s.start=o.start,s.first=o.first),s.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Ko(e,t=null){const i=t||e,r={frag:e,part:t,responseType:"arraybuffer",url:i.url,headers:{},rangeStart:0,rangeEnd:0},n=i.byteRangeStartOffset,s=i.byteRangeEndOffset;if(an(n)&&an(s)){var o;let t=n,i=s;if("initSegment"===e.sn&&"AES-128"===(null==(o=e.decryptdata)?void 0:o.method)){const e=s-n;e%16&&(i=s+(16-e%16)),0!==n&&(r.resetIV=!0,t=n-16)}r.rangeStart=t,r.rangeEnd=i}return r}function Yo(e,t){const i=new Error(`GAP ${e.gap?"tag":"attribute"} found`),r={type:cn.MEDIA_ERROR,details:un.FRAG_GAP,fatal:!1,frag:e,error:i,networkDetails:null};return t&&(r.part=t),(t||e).stats.aborted=!0,new Xo(r)}class Xo extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Zo{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const t in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[t].loader;if(i){if(e&&e!==i.context.frag.type)return;i.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=un.KEY_LOAD_ERROR,i,r,n){return new Xo({type:cn.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:n,error:i,networkDetails:r})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:i,cc:r}=e;for(let e=0;e<t.length;e++){const n=t[e];if(r<=n.cc&&("initSegment"===i||"initSegment"===n.sn||i<n.sn)){this.emeController.selectKeySystemFormat(n).then((e=>{n.setKeyFormat(e)}));break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then((t=>this.loadInternal(e,t))):this.loadInternal(e)}loadInternal(e,t){var i,r;t&&e.setKeyFormat(t);const n=e.decryptdata;if(!n){const i=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,un.KEY_LOAD_ERROR,i))}const s=n.uri;if(!s)return Promise.reject(this.createKeyLoadError(e,un.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${s}"`)));let o=this.keyUriToKeyInfo[s];if(null!=(i=o)&&i.decryptdata.key)return n.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});var a;if(null!=(r=o)&&r.keyLoadPromise)switch(null==(a=o.mediaKeySessionContext)?void 0:a.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return o.keyLoadPromise.then((t=>(n.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:o})))}switch(o=this.keyUriToKeyInfo[s]={decryptdata:n,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},n.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===n.keyFormat?this.loadKeyHTTP(o,e):this.loadKeyEME(o,e);case"AES-128":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,un.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${n.method}"`)))}}loadKeyEME(e,t){const i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const t=this.emeController.loadKey(i);if(t)return(e.keyLoadPromise=t.then((t=>(e.mediaKeySessionContext=t,i)))).catch((t=>{throw e.keyLoadPromise=null,t}))}return Promise.resolve(i)}loadKeyHTTP(e,t){const i=this.config,r=new(0,i.loader)(i);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise(((n,s)=>{const o={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},a=i.keyLoadPolicy.default,l={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,i,r)=>{const{frag:o,keyInfo:a,url:l}=i;if(!o.decryptdata||a!==this.keyUriToKeyInfo[l])return s(this.createKeyLoadError(o,un.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),r));a.decryptdata.key=o.decryptdata.key=new Uint8Array(e.data),o.keyLoader=null,a.loader=null,n({frag:o,keyInfo:a})},onError:(e,i,r,n)=>{this.resetLoader(i),s(this.createKeyLoadError(t,un.KEY_LOAD_ERROR,new Error(`HTTP Error ${e.code} loading key ${e.text}`),r,nn({url:o.url,data:void 0},e)))},onTimeout:(e,i,r)=>{this.resetLoader(i),s(this.createKeyLoadError(t,un.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),r))},onAbort:(e,i,r)=>{this.resetLoader(i),s(this.createKeyLoadError(t,un.INTERNAL_ABORTED,new Error("key loading aborted"),r))}};r.load(o,l,c)}))}resetLoader(e){const{frag:t,keyInfo:i,url:r}=e,n=i.loader;t.keyLoader===n&&(t.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[r],n&&n.destroy()}}class Qo{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}const Jo={length:0,start:()=>0,end:()=>0};class ea{static isBuffered(e,t){try{if(e){const i=ea.getBuffered(e);for(let e=0;e<i.length;e++)if(t>=i.start(e)&&t<=i.end(e))return!0}}catch(e){}return!1}static bufferInfo(e,t,i){try{if(e){const r=ea.getBuffered(e),n=[];let s;for(s=0;s<r.length;s++)n.push({start:r.start(s),end:r.end(s)});return this.bufferedInfo(n,t,i)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.sort((function(e,t){return e.start-t.start||t.end-e.end}));let r=[];if(i)for(let t=0;t<e.length;t++){const n=r.length;if(n){const s=r[n-1].end;e[t].start-s<i?e[t].end>s&&(r[n-1].end=e[t].end):r.push(e[t])}else r.push(e[t])}else r=e;let n,s=0,o=t,a=t;for(let e=0;e<r.length;e++){const l=r[e].start,c=r[e].end;if(t+i>=l&&t<c)o=l,a=c,s=a-t;else if(t+i<l){n=l;break}}return{len:s,start:o||0,end:a||0,nextStart:n}}static getBuffered(e){try{return e.buffered}catch(e){return pn.log("failed to get media.buffered",e),Jo}}}class ta{constructor(e,t,i,r=0,n=-1,s=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=i,this.size=r,this.part=n,this.partial=s}}function ia(e,t){let i=null;for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n&&n.cc===t){i=n;break}}return i}function ra(e,t){if(e){const i=e.start+t;e.start=e.startPTS=i,e.endPTS=i+e.duration}}function na(e,t){const i=t.fragments;for(let t=0,r=i.length;t<r;t++)ra(i[t],e);t.fragmentHint&&ra(t.fragmentHint,e),t.alignedSliding=!0}function sa(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;const i=e.fragments,r=t.fragments;if(!i.length||!r.length)return;const n=r[Math.round(r.length/2)-1],s=ia(i,n.cc)||i[Math.round(i.length/2)-1],o=n.programDateTime,a=s.programDateTime;null!==o&&null!==a&&na((a-o)/1e3-(s.start-n.start),e)}class oa{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class aa{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}class la{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),i=new Uint32Array(4);for(let e=0;e<4;e++)i[e]=t.getUint32(4*e);return i}initTable(){const e=this.sBox,t=this.invSBox,i=this.subMix,r=i[0],n=i[1],s=i[2],o=i[3],a=this.invSubMix,l=a[0],c=a[1],u=a[2],h=a[3],d=new Uint32Array(256);let f=0,p=0,g=0;for(g=0;g<256;g++)d[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){let i=p^p<<1^p<<2^p<<3^p<<4;i=i>>>8^255&i^99,e[f]=i,t[i]=f;const a=d[f],g=d[a],m=d[g];let v=257*d[i]^16843008*i;r[f]=v<<24|v>>>8,n[f]=v<<16|v>>>16,s[f]=v<<8|v>>>24,o[f]=v,v=16843009*m^65537*g^257*a^16843008*f,l[i]=v<<24|v>>>8,c[i]=v<<16|v>>>16,u[i]=v<<8|v>>>24,h[i]=v,f?(f=a^d[d[d[m^a]]],p^=d[d[p]]):f=p=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let i=!0,r=0;for(;r<t.length&&i;)i=t[r]===this.key[r],r++;if(i)return;this.key=t;const n=this.keySize=t.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);const s=this.ksRows=4*(n+6+1);let o,a;const l=this.keySchedule=new Uint32Array(s),c=this.invKeySchedule=new Uint32Array(s),u=this.sBox,h=this.rcon,d=this.invSubMix,f=d[0],p=d[1],g=d[2],m=d[3];let v,y;for(o=0;o<s;o++)o<n?v=l[o]=t[o]:(y=v,o%n==0?(y=y<<8|y>>>24,y=u[y>>>24]<<24|u[y>>>16&255]<<16|u[y>>>8&255]<<8|u[255&y],y^=h[o/n|0]<<24):n>6&&o%n==4&&(y=u[y>>>24]<<24|u[y>>>16&255]<<16|u[y>>>8&255]<<8|u[255&y]),l[o]=v=(l[o-n]^y)>>>0);for(a=0;a<s;a++)o=s-a,y=3&a?l[o]:l[o-4],c[a]=a<4||o<=4?y:f[u[y>>>24]]^p[u[y>>>16&255]]^g[u[y>>>8&255]]^m[u[255&y]],c[a]=c[a]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,i){const r=this.keySize+6,n=this.invKeySchedule,s=this.invSBox,o=this.invSubMix,a=o[0],l=o[1],c=o[2],u=o[3],h=this.uint8ArrayToUint32Array_(i);let d=h[0],f=h[1],p=h[2],g=h[3];const m=new Int32Array(e),v=new Int32Array(m.length);let y,w,E,b,T,S,x,R,C,A,k,L,I,P;const _=this.networkToHostOrderSwap;for(;t<m.length;){for(C=_(m[t]),A=_(m[t+1]),k=_(m[t+2]),L=_(m[t+3]),T=C^n[0],S=L^n[1],x=k^n[2],R=A^n[3],I=4,P=1;P<r;P++)y=a[T>>>24]^l[S>>16&255]^c[x>>8&255]^u[255&R]^n[I],w=a[S>>>24]^l[x>>16&255]^c[R>>8&255]^u[255&T]^n[I+1],E=a[x>>>24]^l[R>>16&255]^c[T>>8&255]^u[255&S]^n[I+2],b=a[R>>>24]^l[T>>16&255]^c[S>>8&255]^u[255&x]^n[I+3],T=y,S=w,x=E,R=b,I+=4;y=s[T>>>24]<<24^s[S>>16&255]<<16^s[x>>8&255]<<8^s[255&R]^n[I],w=s[S>>>24]<<24^s[x>>16&255]<<16^s[R>>8&255]<<8^s[255&T]^n[I+1],E=s[x>>>24]<<24^s[R>>16&255]<<16^s[T>>8&255]<<8^s[255&S]^n[I+2],b=s[R>>>24]<<24^s[T>>16&255]<<16^s[S>>8&255]<<8^s[255&x]^n[I+3],v[t]=_(y^d),v[t+1]=_(b^f),v[t+2]=_(E^p),v[t+3]=_(w^g),d=C,f=A,p=k,g=L,t+=4}return v.buffer}}class ca{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(e){}null===this.subtle&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function(e){const t=e.byteLength,i=t&&new DataView(e.buffer).getUint8(t-1);return i?$n(e,0,t-i):e}(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i){return this.useSoftware?new Promise(((r,n)=>{this.softwareDecrypt(new Uint8Array(e),t,i);const s=this.flush();s?r(s.buffer):n(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(e),t,i)}softwareDecrypt(e,t,i){const{currentIV:r,currentResult:n,remainderData:s}=this;this.logOnce("JS AES decrypt"),s&&(e=vs(s,e),this.remainderData=null);const o=this.getValidChunk(e);if(!o.length)return null;r&&(i=r);let a=this.softwareDecrypter;a||(a=this.softwareDecrypter=new la),a.expandKey(t);const l=n;return this.currentResult=a.decrypt(o.buffer,0,i),this.currentIV=$n(o,-16).buffer,l||null}webCryptoDecrypt(e,t,i){const r=this.subtle;return this.key===t&&this.fastAesKey||(this.key=t,this.fastAesKey=new aa(r,t)),this.fastAesKey.expandKey().then((t=>r?(this.logOnce("WebCrypto AES decrypt"),new oa(r,new Uint8Array(i)).decrypt(e.buffer,t)):Promise.reject(new Error("web crypto not initialized")))).catch((r=>(pn.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(e,t,i))))}onWebCryptoError(e,t,i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i);const r=this.flush();if(r)return r.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;const i=e.length-e.length%16;return i!==e.length&&(t=$n(e,0,i),this.remainderData=$n(e,i)),t}logOnce(e){this.logEnabled&&(pn.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const ua="STOPPED",ha="IDLE",da="KEY_LOADING",fa="FRAG_LOADING",pa="FRAG_LOADING_WAITING_RETRY",ga="WAITING_TRACK",ma="PARSING",va="PARSED",ya="ENDED",wa="ERROR",Ea="WAITING_INIT_PTS",ba="WAITING_LEVEL";class Ta extends Qo{constructor(e,t,i,r,n){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ua,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=n,this.logPrefix=r,this.log=pn.log.bind(pn,`${r}:`),this.warn=pn.warn.bind(pn,`${r}:`),this.hls=e,this.fragmentLoader=new Wo(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new ca(e.config),e.on(ln.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ua}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const i=t.partList;if(null!=i&&i.length){const e=i[i.length-1];return ea.isBuffered(this.media,e.start+e.duration/2)}const r=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(r)}getLevelDetails(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levels[this.levelLastLoaded])?void 0:e.details}onMediaAttached(e,t){const i=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("ended",this.onvended);const r=this.config;this.levels&&r.autoStartLoad&&this.state===ua&&this.startLoad(r.startPosition)}onMediaDetaching(){const e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:t,media:i,mediaBuffer:r,state:n}=this,s=i?i.currentTime:0,o=ea.bufferInfo(r||i,s,e.maxBufferHole);if(this.log(`media seeking to ${an(s)?s.toFixed(3):s}, state: ${n}`),this.state===ya)this.resetLoadingState();else if(t){const i=e.maxFragLookUpTolerance,r=t.start-i,n=t.start+t.duration+i;if(!o.len||n<o.start||r>o.end){const e=s>n;(s<r||e)&&(e&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}i&&(this.fragmentTracker.removeFragmentsInRange(s,1/0,this.playlistType,!0),this.lastCurrentTime=s),this.loadedmetadata||o.len||(this.nextLoadPosition=this.startPosition=s),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.stopLoad(),super.onHandlerDestroying()}onHandlerDestroyed(){this.state=ua,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){this._doFragLoad(e,t,i,(t=>{if(this.fragContextChanged(e))return this.warn(`Fragment ${e.sn}${t.part?" p: "+t.part.index:""} of level ${e.level} was dropped during download.`),void this.fragmentTracker.removeFragment(e);e.stats.chunkCount++,this._handleFragmentLoadProgress(t)})).then((t=>{if(!t)return;const i=this.state;this.fragContextChanged(e)?(i===fa||!this.fragCurrent&&i===ma)&&(this.fragmentTracker.removeFragment(e),this.state=ha):("payload"in t&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(ln.FRAG_LOADED,t)),this._handleFragmentLoadComplete(t))})).catch((t=>{this.state!==ua&&this.state!==wa&&(this.warn(t),this.resetFragmentLoading(e))}))}clearTrackerIfNeeded(e){var t;const{fragmentTracker:i}=this;if(i.getState(e)===$o){const t=e.type,r=this.getFwdBufferInfo(this.mediaBuffer,t),n=Math.max(e.duration,r?r.len:this.config.maxBufferLength);this.reduceMaxBufferLength(n)&&i.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===Ho&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,t,i=null){if(!(e-t))return;const r={startOffset:e,endOffset:t,type:i};this.hls.trigger(ln.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then((t=>{if(!t||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return t})).then((t=>{const{hls:i}=this,{payload:r}=t,n=e.decryptdata;if(r&&r.byteLength>0&&n&&n.key&&n.iv&&"AES-128"===n.method){const s=self.performance.now();return this.decrypter.decrypt(new Uint8Array(r),n.key.buffer,n.iv.buffer).catch((t=>{throw i.trigger(ln.ERROR,{type:cn.MEDIA_ERROR,details:un.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:e}),t})).then((r=>{const n=self.performance.now();return i.trigger(ln.FRAG_DECRYPTED,{frag:e,payload:r,stats:{tstart:s,tdecrypt:n}}),t.payload=r,t}))}return t})).then((i=>{const{fragCurrent:r,hls:n,levels:s}=this;if(!s)throw new Error("init load aborted, missing levels");const o=e.stats;this.state=ha,t.fragmentError=0,e.data=new Uint8Array(i.payload),o.parsing.start=o.buffering.start=self.performance.now(),o.parsing.end=o.buffering.end=self.performance.now(),i.frag===r&&n.trigger(ln.FRAG_BUFFERED,{stats:o,frag:r,part:null,id:e.type}),this.tick()})).catch((t=>{this.state!==ua&&this.state!==wa&&(this.warn(t),this.resetFragmentLoading(e))}))}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId}fragBufferedComplete(e,t){var i,r,n,s;const o=this.mediaBuffer?this.mediaBuffer:this.media;this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===Zs?"level":"track"} ${e.level} (frag:[${(null!=(i=e.startPTS)?i:NaN).toFixed(3)}-${(null!=(r=e.endPTS)?r:NaN).toFixed(3)}] > buffer:${o?function(e){let t="";const i=e.length;for(let r=0;r<i;r++)t+=`[${e.start(r).toFixed(3)}-${e.end(r).toFixed(3)}]`;return t}(ea.getBuffered(o)):"(detached)"})`),this.state=ha,o&&(!this.loadedmetadata&&e.type==Zs&&o.buffered.length&&(null==(n=this.fragCurrent)?void 0:n.sn)===(null==(s=this.fragPrevious)?void 0:s.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:i,part:r,partsLoaded:n}=e,s=!n||0===n.length||n.some((e=>!e)),o=new ta(i.level,i.sn,i.stats.chunkCount+1,0,r?r.index:-1,!s);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,r){var n;const s=null==t?void 0:t.details;if(!this.levels||!s)throw new Error(`frag load aborted, missing level${s?"":" detail"}s`);let o=null;if(!e.encrypted||null!=(n=e.decryptdata)&&n.key?!e.encrypted&&s.encryptedFragments.length&&this.keyLoader.loadClear(e,s.encryptedFragments):(this.log(`Loading key for ${e.sn} of [${s.startSN}-${s.endSN}], ${"[stream-controller]"===this.logPrefix?"level":"track"} ${e.level}`),this.state=da,this.fragCurrent=e,o=this.keyLoader.load(e).then((e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(ln.KEY_LOADED,e),this.state===da&&(this.state=ha),e})),this.hls.trigger(ln.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(o=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),i=Math.max(e.start,i||0),this.config.lowLatencyMode&&"initSegment"!==e.sn){const n=s.partList;if(n&&r){i>e.end&&s.fragmentHint&&(e=s.fragmentHint);const a=this.getNextPart(n,e,i);if(a>-1){const l=n[a];let c;return this.log(`Loading part sn: ${e.sn} p: ${l.index} cc: ${e.cc} of playlist [${s.startSN}-${s.endSN}] parts [0-${a}-${n.length-1}] ${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=l.start+l.duration,this.state=fa,c=o?o.then((i=>!i||this.fragContextChanged(i.frag)?null:this.doFragPartsLoad(e,l,t,r))).catch((e=>this.handleFragLoadError(e))):this.doFragPartsLoad(e,l,t,r).catch((e=>this.handleFragLoadError(e))),this.hls.trigger(ln.FRAG_LOADING,{frag:e,part:l,targetBufferTime:i}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):c}if(!e.url||this.loadedEndOfParts(n,i))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${s?"of ["+s.startSN+"-"+s.endSN+"] ":""}${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(i.toFixed(3))}`),an(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=fa;const a=this.config.progressive;let l;return l=a&&o?o.then((t=>!t||this.fragContextChanged(null==t?void 0:t.frag)?null:this.fragmentLoader.load(e,r))).catch((e=>this.handleFragLoadError(e))):Promise.all([this.fragmentLoader.load(e,a?r:void 0),o]).then((([e])=>(!a&&e&&r&&r(e),e))).catch((e=>this.handleFragLoadError(e))),this.hls.trigger(ln.FRAG_LOADING,{frag:e,targetBufferTime:i}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):l}doFragPartsLoad(e,t,i,r){return new Promise(((n,s)=>{var o;const a=[],l=null==(o=i.details)?void 0:o.partList,c=t=>{this.fragmentLoader.loadPart(e,t,r).then((r=>{a[t.index]=r;const s=r.part;this.hls.trigger(ln.FRAG_LOADED,r);const o=To(i,e.sn,t.index+1)||So(l,e.sn,t.index+1);if(!o)return n({frag:e,part:s,partsLoaded:a});c(o)})).catch(s)};c(t)}))}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===un.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(ln.ERROR,t)}else this.hls.trigger(ln.ERROR,{type:cn.OTHER_ERROR,details:un.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ma)return void(this.fragCurrent||this.state===ua||this.state===wa||(this.state=ha));const{frag:i,part:r,level:n}=t,s=self.performance.now();i.stats.parsing.end=s,r&&(r.stats.parsing.end=s),this.updateLevelTiming(i,r,n,e.partial)}getCurrentContext(e){const{levels:t,fragCurrent:i}=this,{level:r,sn:n,part:s}=e;if(null==t||!t[r])return this.warn(`Levels object was unset while buffering fragment ${n} of level ${r}. The current chunk will not be buffered.`),null;const o=t[r],a=s>-1?To(o,n,s):null,l=a?a.fragment:function(e,t,i){if(null==e||!e.details)return null;const r=e.details;let n=r.fragments[t-r.startSN];return n||(n=r.fragmentHint,n&&n.sn===t?n:t<r.startSN&&i&&i.sn===t?i:null)}(o,n,i);return l?(i&&i!==l&&(l.stats=i.stats),{frag:l,part:a,level:o}):null}bufferFragmentData(e,t,i,r,n){var s;if(!e||this.state!==ma)return;const{data1:o,data2:a}=e;let l=o;if(o&&a&&(l=vs(o,a)),null==(s=l)||!s.length)return;const c={type:e.type,frag:t,part:i,chunkMeta:r,parent:t.type,data:l};if(this.hls.trigger(ln.BUFFER_APPENDING,c),e.dropped&&e.independent&&!i){if(n)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!ea.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const i=t.currentTime,r=ea.bufferInfo(t,i,0),n=e.duration,s=Math.min(2*this.config.maxFragLookUpTolerance,.25*n),o=Math.max(Math.min(e.start-s,r.end-s),i+s);e.start-o>s&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){const i=this.getLoadPosition();return an(i)?this.getFwdBufferInfoAtPos(e,i,t):null}getFwdBufferInfoAtPos(e,t,i){const{config:{maxBufferHole:r}}=this,n=ea.bufferInfo(e,t,r);if(0===n.len&&void 0!==n.nextStart){const s=this.fragmentTracker.getBufferedFrag(t,i);if(s&&n.nextStart<s.end)return ea.bufferInfo(e,t,Math.max(n.nextStart,r))}return n}getMaxBufferLength(e){const{config:t}=this;let i;return i=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e){const t=this.config,i=e||t.maxBufferLength;return t.maxMaxBufferLength>=i&&(t.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${t.maxMaxBufferLength}s`),!0)}getAppendedFrag(e,t=Zs){const i=this.fragmentTracker.getAppendedFrag(e,Zs);return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){const i=t.fragments,r=i.length;if(!r)return null;const{config:n}=this,s=i[0].start;let o;if(t.live){const s=n.initialLiveManifestSize;if(r<s)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${s})`),null;t.PTSKnown||this.startFragRequested||-1!==this.startPosition||(o=this.getInitialLiveFragment(t,i),this.startPosition=o?this.hls.liveSyncPosition||o.start:e)}else e<=s&&(o=i[0]);if(!o){const i=n.lowLatencyMode?t.partEnd:t.fragmentEnd;o=this.getFragmentAtPosition(e,i,t)}return this.mapToInitFragWhenRequired(o)}isLoopLoading(e,t){const i=this.fragmentTracker.getState(e);return(i===zo||i===Ho&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,r,n){const s=e.gap,o=this.getNextFragment(this.nextLoadPosition,t);if(null===o)return o;if(e=o,s&&e&&!e.gap&&i.nextStart){const t=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,r);if(null!==t&&i.len+t.len>=n)return this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,i){let r=-1,n=!1,s=!0;for(let o=0,a=e.length;o<a;o++){const a=e[o];if(s=s&&!a.independent,r>-1&&i<a.start)break;const l=a.loaded;l?r=-1:(n||a.independent||s)&&a.fragment===t&&(r=o),n=l}return r}loadedEndOfParts(e,t){const i=e[e.length-1];return i&&t>i.start&&i.loaded}getInitialLiveFragment(e,t){const i=this.fragPrevious;let r=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),r=function(e,t,i){if(null===t||!Array.isArray(e)||!e.length||!an(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;i=i||0;for(let r=0;r<e.length;++r){const n=e[r];if(_o(t,i,n))return n}return null}(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const n=i.sn+1;if(n>=e.startSN&&n<=e.endSN){const s=t[n-e.startSN];i.cc===s.cc&&(r=s,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=function(e,t){return Lo.search(e,(e=>e.cc<t?1:e.cc>t?-1:0))}(t,i.cc),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const t=this.hls.liveSyncPosition;null!==t&&(r=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,i){const{config:r}=this;let{fragPrevious:n}=this,{fragments:s,endSN:o}=i;const{fragmentHint:a}=i,l=r.maxFragLookUpTolerance,c=i.partList,u=!!(r.lowLatencyMode&&null!=c&&c.length&&a);let h;if(u&&a&&!this.bitrateTest&&(s=s.concat(a),o=a.sn),h=e<t?Io(n,s,e,e>t-l?0:l):s[s.length-1],h){const e=h.sn-i.startSN,t=this.fragmentTracker.getState(h);if((t===zo||t===Ho&&h.gap)&&(n=h),n&&h.sn===n.sn&&(!u||c[0].fragment.sn>h.sn)&&n&&h.level===n.level){const t=s[e+1];h=h.sn<o&&this.fragmentTracker.getState(t)!==zo?t:null}}return h}synchronizeToLiveEdge(e){const{config:t,media:i}=this;if(!i)return;const r=this.hls.liveSyncPosition,n=i.currentTime,s=e.fragments[0].start,o=e.edge,a=n>=s-t.maxFragLookUpTolerance&&n<=o;if(null!==r&&i.duration>r&&(n<r||!a)){const s=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!a&&i.readyState<4||n<o-s)&&(this.loadedmetadata||(this.nextLoadPosition=r),i.readyState&&(this.warn(`Playback: ${n.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${r.toFixed(3)}`),i.currentTime=r))}}alignPlaylists(e,t){const{levels:i,levelLastLoaded:r,fragPrevious:n}=this,s=null!==r?i[r]:null,o=e.fragments.length;if(!o)return this.warn("No fragments in live playlist"),0;const a=e.fragments[0].start,l=!t,c=e.alignedSliding&&an(a);if(l||!c&&!a){!function(e,t,i){t&&(function(e,t,i){if(function(e,t,i){return!(!t.details||!(i.endCC>i.startCC||e&&e.cc<i.startCC))}(e,i,t)){const e=function(e,t,i=0){const r=e.fragments,n=t.fragments;if(!n.length||!r.length)return void pn.log("No fragments to align");const s=ia(r,n[0].cc);if(s&&(!s||s.startPTS))return s;pn.log("No frag in previous level to align on")}(i.details,t);e&&an(e.start)&&(pn.log(`Adjusting PTS using last level due to CC increase within current level ${t.url}`),na(e.start,t))}}(e,i,t),!i.alignedSliding&&t.details&&function(e,t){if(!t.fragments.length||!e.hasProgramDateTime||!t.hasProgramDateTime)return;const i=t.fragments[0].programDateTime,r=e.fragments[0].programDateTime,n=(r-i)/1e3+t.fragments[0].start;n&&an(n)&&(pn.log(`Adjusting PTS using programDateTime delta ${r-i}ms, sliding:${n.toFixed(3)} ${e.url} `),na(n,e))}(i,t.details),i.alignedSliding||!t.details||i.skippedSegments||Eo(t.details,i))}(n,s,e);const i=e.fragments[0].start;return this.log(`Live playlist sliding: ${i.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${n?n.sn:"na"} fragments: ${o}`),i}return a}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let i=this.startPosition;if(i<t&&(i=-1),-1===i||-1===this.lastCurrentTime){const r=null!==this.startTimeOffset,n=r?this.startTimeOffset:e.startTimeOffset;null!==n&&an(n)?(i=t+n,n<0&&(i+=e.totalduration),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Start time offset ${n} found in ${r?"multivariant":"media"} playlist, adjust startPosition to ${i}`),this.startPosition=i):e.live?i=this.hls.liveSyncPosition||t:this.startPosition=i=0,this.lastCurrentTime=i}this.nextLoadPosition=i}getLoadPosition(){const{media:e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===pa)||(this.state=ha)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;var r;if(this.fragContextChanged(i))return void this.warn(`Frag load error must match current frag to retry ${i.url} > ${null==(r=this.fragCurrent)?void 0:r.url}`);const n=t.details===un.FRAG_GAP;n&&this.fragmentTracker.fragBuffered(i,!0);const s=t.errorAction,{action:o,retryCount:a=0,retryConfig:l}=s||{};if(s&&5===o&&l){var c;this.resetStartWhenNotLoaded(null!=(c=this.levelLastLoaded)?c:i.level);const r=Co(l,a);this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${a+1}/${l.maxNumRetry} in ${r}ms`),s.resolved=!0,this.retryDate=self.performance.now()+r,this.state=pa}else l&&s?(this.resetFragmentErrors(e),a<l.maxNumRetry?n||(s.resolved=!0):pn.warn(`${t.details} reached or exceeded max retry (${a})`)):2===(null==s?void 0:s.action)?this.state=ba:this.state=wa;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===ma||this.state===va){const t=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,t),r=i&&i.len>.5;r&&this.reduceMaxBufferLength(i.len);const n=!r;return n&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${t} buffer`),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),n}return!1}resetFragmentErrors(e){e===Qs&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==ua&&(this.state=ha)}afterBufferFlushed(e,t,i){if(!e)return;const r=ea.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,i),this.state===ya&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=ha}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=this.levels?this.levels[e].details:null;null!=t&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){var t;this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(null!=(t=this.levelLastLoaded)?t:e.level),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,r){var n;const s=i.details;if(s){if(Object.keys(e.elementaryStreams).reduce(((t,n)=>{const o=e.elementaryStreams[n];if(o){const a=o.endPTS-o.startPTS;if(a<=0)return this.warn(`Could not parse fragment ${e.sn} ${n} duration reliably (${a})`),t||!1;const l=r?0:wo(s,e,o.startPTS,o.endPTS,o.startDTS,o.endDTS);return this.hls.trigger(ln.LEVEL_PTS_UPDATED,{details:s,level:i,drift:l,type:n,frag:e,start:o.startPTS,end:o.endPTS}),!0}return t}),!1))i.fragmentError=0;else if(null===(null==(n=this.transmuxer)?void 0:n.error)){const t=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(0===i.fragmentError&&(i.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(t.message),this.hls.trigger(ln.ERROR,{type:cn.MEDIA_ERROR,details:un.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:`Found no media in msn ${e.sn} of level "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=va,this.hls.trigger(ln.FRAG_PARSED,{frag:e,part:t})}else this.warn("level.details undefined")}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){var t,i,r;"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(null!=(t=null!=(i=this.levelLastLoaded)?i:null==(r=this.fragCurrent)?void 0:r.level)?t:0),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Sa(){return self.SourceBuffer||self.WebKitSourceBuffer}function xa(e="",t=9e4){return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class Ra{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=vs(this.cachedData,e),this.cachedData=null);let i,r=jn(e,0),n=r?r.length:0;const s=this._audioTrack,o=this._id3Track,a=r?(e=>{const t=Kn(e);for(let e=0;e<t.length;e++){const i=t[e];if(qn(i))return Jn(i)}})(r):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&an(a))&&(this.basePTS=Ca(a,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),r&&r.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:ao,duration:Number.POSITIVE_INFINITY});n<l;){if(this.canParse(e,n)){const t=this.appendFrame(s,e,n);t?(this.frameIndex++,this.lastPTS=t.sample.pts,n+=t.length,i=n):n=l}else Vn(e,n)?(r=jn(e,n),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:ao,duration:Number.POSITIVE_INFINITY}),n+=r.length,i=n):n++;if(n===l&&i!==l){const t=$n(e,i);this.cachedData?this.cachedData=vs(this.cachedData,t):this.cachedData=t}}return{audioTrack:s,videoTrack:xa(),id3Track:o,textTrack:xa()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:xa(),id3Track:this._id3Track,textTrack:xa()}}destroy(){}}const Ca=(e,t,i)=>an(e)?90*e:9e4*t+(i?9e4*i.baseTime/i.timescale:0);function Aa(e,t){return 255===e[t]&&240==(246&e[t+1])}function ka(e,t){return 1&e[t+1]?7:9}function La(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function Ia(e,t){return t+1<e.length&&Aa(e,t)}function Pa(e,t){if(Ia(e,t)){const i=ka(e,t);if(t+i>=e.length)return!1;const r=La(e,t);if(r<=i)return!1;const n=t+r;return n===e.length||Ia(e,n)}return!1}function _a(e,t,i,r,n){if(!e.samplerate){const s=function(e,t,i,r){let n,s,o,a;const l=navigator.userAgent.toLowerCase(),c=r,u=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];n=1+((192&t[i+2])>>>6);const h=(60&t[i+2])>>>2;if(!(h>u.length-1))return o=(1&t[i+2])<<2,o|=(192&t[i+3])>>>6,pn.log(`manifest codec:${r}, ADTS type:${n}, samplingIndex:${h}`),/firefox/i.test(l)?h>=6?(n=5,a=new Array(4),s=h-3):(n=2,a=new Array(2),s=h):-1!==l.indexOf("android")?(n=2,a=new Array(2),s=h):(n=5,a=new Array(4),r&&(-1!==r.indexOf("mp4a.40.29")||-1!==r.indexOf("mp4a.40.5"))||!r&&h>=6?s=h-3:((r&&-1!==r.indexOf("mp4a.40.2")&&(h>=6&&1===o||/vivaldi/i.test(l))||!r&&1===o)&&(n=2,a=new Array(2)),s=h)),a[0]=n<<3,a[0]|=(14&h)>>1,a[1]|=(1&h)<<7,a[1]|=o<<3,5===n&&(a[1]|=(14&s)>>1,a[2]=(1&s)<<7,a[2]|=8,a[3]=0),{config:a,samplerate:u[h],channelCount:o,codec:"mp4a.40."+n,manifestCodec:c};e.trigger(ln.ERROR,{type:cn.MEDIA_ERROR,details:un.FRAG_PARSING_ERROR,fatal:!0,reason:`invalid ADTS sampling index:${h}`})}(t,i,r,n);if(!s)return;e.config=s.config,e.samplerate=s.samplerate,e.channelCount=s.channelCount,e.codec=s.codec,e.manifestCodec=s.manifestCodec,pn.log(`parsed codec:${e.codec}, rate:${s.samplerate}, channels:${s.channelCount}`)}}function Da(e){return 9216e4/e}function Oa(e,t,i,r,n){const s=r+n*Da(e.samplerate),o=function(e,t){const i=ka(e,t);if(t+i<=e.length){const r=La(e,t)-i;if(r>0)return{headerLength:i,frameLength:r}}}(t,i);let a;if(o){const{frameLength:r,headerLength:n}=o,l=n+r,c=Math.max(0,i+l-t.length);c?(a=new Uint8Array(l-n),a.set(t.subarray(i+n,t.length),0)):a=t.subarray(i+n,i+l);const u={unit:a,pts:s};return c||e.samples.push(u),{sample:u,length:l,missing:c}}const l=t.length-i;return a=new Uint8Array(l),a.set(t.subarray(i,t.length),0),{sample:{unit:a,pts:s},length:l,missing:-1}}const Ma=/\/emsg[-/]ID3/i;let Fa=null;const Na=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Ba=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Ua=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],$a=[0,1,1,4];function Ha(e,t,i,r,n){if(i+24>t.length)return;const s=za(t,i);if(s&&i+s.frameLength<=t.length){const o=r+n*(9e4*s.samplesPerFrame/s.sampleRate),a={unit:t.subarray(i,i+s.frameLength),pts:o,dts:o};return e.config=[],e.channelCount=s.channelCount,e.samplerate=s.sampleRate,e.samples.push(a),{sample:a,length:s.frameLength,missing:0}}}function za(e,t){const i=e[t+1]>>3&3,r=e[t+1]>>1&3,n=e[t+2]>>4&15,s=e[t+2]>>2&3;if(1!==i&&0!==n&&15!==n&&3!==s){const o=e[t+2]>>1&1,a=e[t+3]>>6,l=1e3*Na[14*(3===i?3-r:3===r?3:4)+n-1],c=Ba[3*(3===i?0:2===i?1:2)+s],u=3===a?1:2,h=Ua[i][r],d=$a[r],f=8*h*d,p=Math.floor(h*l/c+o)*d;if(null===Fa){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Fa=e?parseInt(e[1]):0}return!!Fa&&Fa<=87&&2===r&&l>=224e3&&0===a&&(e[t+3]=128|e[t+3]),{sampleRate:c,channelCount:u,frameLength:p,samplesPerFrame:f}}}function ja(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])}function Ga(e,t){return t+1<e.length&&ja(e,t)}function Va(e,t){if(t+1<e.length&&ja(e,t)){const i=4,r=za(e,t);let n=i;null!=r&&r.frameLength&&(n=r.frameLength);const s=t+n;return s===e.length||Ga(e,s)}return!1}class qa{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,i=e.byteLength-t,r=new Uint8Array(4),n=Math.min(4,t);if(0===n)throw new Error("no bytes available");r.set(e.subarray(i,i+n)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const i=this.word>>>32-t;if(e>32&&pn.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t,i=8,r=8;for(let n=0;n<e;n++)0!==r&&(t=this.readEG(),r=(i+t+256)%256),i=0===r?i:r}readSPS(){let e,t,i,r=0,n=0,s=0,o=0;const a=this.readUByte.bind(this),l=this.readBits.bind(this),c=this.readUEG.bind(this),u=this.readBoolean.bind(this),h=this.skipBits.bind(this),d=this.skipEG.bind(this),f=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);a();const g=a();if(l(5),h(3),a(),f(),100===g||110===g||122===g||244===g||44===g||83===g||86===g||118===g||128===g){const e=c();if(3===e&&h(1),f(),f(),h(1),u())for(t=3!==e?8:12,i=0;i<t;i++)u()&&p(i<6?16:64)}f();const m=c();if(0===m)c();else if(1===m)for(h(1),d(),d(),e=c(),i=0;i<e;i++)d();f(),h(1);const v=c(),y=c(),w=l(1);0===w&&h(1),h(1),u()&&(r=c(),n=c(),s=c(),o=c());let E=[1,1];if(u()&&u())switch(a()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:E=[a()<<8|a(),a()<<8|a()]}return{width:Math.ceil(16*(v+1)-2*r-2*n),height:(2-w)*(y+1)*16-(w?2:4)*(s+o),pixelRatio:E}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class Wa{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new ca(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,i){const r=e[t].unit;if(r.length<=16)return;const n=r.subarray(16,r.length-r.length%16),s=n.buffer.slice(n.byteOffset,n.byteOffset+n.length);this.decryptBuffer(s).then((n=>{const s=new Uint8Array(n);r.set(s,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)}))}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length)return void i();if(!(e[t].unit.length<32||(this.decryptAacSample(e,t,i),this.decrypter.isSync())))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,i=new Int8Array(t);let r=0;for(let t=32;t<e.length-16;t+=160,r+=16)i.set(e.subarray(t,t+16),r);return i}getAvcDecryptedUnit(e,t){const i=new Uint8Array(t);let r=0;for(let t=32;t<e.length-16;t+=160,r+=16)e.set(i.subarray(r,r+16),t);return e}decryptAvcSample(e,t,i,r,n){const s=bs(n.data),o=this.getAvcEncryptedData(s);this.decryptBuffer(o.buffer).then((o=>{n.data=this.getAvcDecryptedUnit(s,o),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,r)}))}decryptAvcSamples(e,t,i,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length)return void r();const n=e[t].units;for(;!(i>=n.length);i++){const s=n[i];if(!(s.data.length<=48||1!==s.type&&5!==s.type||(this.decryptAvcSample(e,t,i,r,s),this.decrypter.isSync())))return}}}}const Ka=188;class Ya{constructor(e,t,i){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=i}static probe(e){const t=Ya.syncOffset(e);return t>0&&pn.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),-1!==t}static syncOffset(e){const t=e.length;let i=Math.min(940,e.length-Ka)+1,r=0;for(;r<i;){let n=!1,s=-1,o=0;for(let a=r;a<t;a+=Ka){if(71!==e[a]){if(o)return-1;break}if(o++,-1===s&&(s=a,0!==s&&(i=Math.min(s+18612,e.length-Ka)+1)),n||(n=0===Za(e,a)),n&&o>1&&(0===s&&o>2||a+Ka>i))return s}r++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:os[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,i,r){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=Ya.createTrack("video"),this._audioTrack=Ya.createTrack("audio",r),this._id3Track=Ya.createTrack("id3"),this._txtTrack=Ya.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i,this._duration=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_avcTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}demux(e,t,i=!1,r=!1){let n;i||(this.sampleAes=null);const s=this._avcTrack,o=this._audioTrack,a=this._id3Track,l=this._txtTrack;let c=s.pid,u=s.pesData,h=o.pid,d=a.pid,f=o.pesData,p=a.pesData,g=null,m=this.pmtParsed,v=this._pmtId,y=e.length;if(this.remainderData&&(y=(e=vs(this.remainderData,e)).length,this.remainderData=null),y<Ka&&!r)return this.remainderData=e,{audioTrack:o,videoTrack:s,id3Track:a,textTrack:l};const w=Math.max(0,Ya.syncOffset(e));y-=(y-w)%Ka,y<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,y,e.buffer.byteLength-y));let E=0;for(let t=w;t<y;t+=Ka)if(71===e[t]){const r=!!(64&e[t+1]),y=Za(e,t);let E;if((48&e[t+3])>>4>1){if(E=t+5+e[t+4],E===t+Ka)continue}else E=t+4;switch(y){case c:r&&(u&&(n=el(u))&&this.parseAVCPES(s,l,n,!1),u={data:[],size:0}),u&&(u.data.push(e.subarray(E,t+Ka)),u.size+=t+Ka-E);break;case h:if(r){if(f&&(n=el(f)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,n);break;case"mp3":this.parseMPEGPES(o,n)}f={data:[],size:0}}f&&(f.data.push(e.subarray(E,t+Ka)),f.size+=t+Ka-E);break;case d:r&&(p&&(n=el(p))&&this.parseID3PES(a,n),p={data:[],size:0}),p&&(p.data.push(e.subarray(E,t+Ka)),p.size+=t+Ka-E);break;case 0:r&&(E+=e[E]+1),v=this._pmtId=Qa(e,E);break;case v:{r&&(E+=e[E]+1);const n=Ja(e,E,this.typeSupported,i);c=n.avc,c>0&&(s.pid=c),h=n.audio,h>0&&(o.pid=h,o.segmentCodec=n.segmentCodec),d=n.id3,d>0&&(a.pid=d),null===g||m||(pn.warn(`MPEG-TS PMT found at ${t} after unknown PID '${g}'. Backtracking to sync byte @${w} to parse all TS packets.`),g=null,t=w-188),m=this.pmtParsed=!0;break}case 17:case 8191:break;default:g=y}}else E++;if(E>0){const e=new Error(`Found ${E} TS packet/s that do not start with 0x47`);this.observer.emit(ln.ERROR,ln.ERROR,{type:cn.MEDIA_ERROR,details:un.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message})}s.pesData=u,o.pesData=f,a.pesData=p;const b={audioTrack:o,videoTrack:s,id3Track:a,textTrack:l};return r&&this.extractRemainingSamples(b),b}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:i,id3Track:r,textTrack:n}=e,s=i.pesData,o=t.pesData,a=r.pesData;let l;if(s&&(l=el(s))?(this.parseAVCPES(i,n,l,!0),i.pesData=null):i.pesData=s,o&&(l=el(o))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l)}t.pesData=null}else null!=o&&o.size&&pn.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;a&&(l=el(a))?(this.parseID3PES(r,l),r.pesData=null):r.pesData=a}demuxSampleAes(e,t,i){const r=this.demux(e,i,!0,!this.config.progressive),n=this.sampleAes=new Wa(this.observer,this.config,t);return this.decrypt(r,n)}decrypt(e,t){return new Promise((i=>{const{audioTrack:r,videoTrack:n}=e;r.samples&&"aac"===r.segmentCodec?t.decryptAacSamples(r.samples,0,(()=>{n.samples?t.decryptAvcSamples(n.samples,0,0,(()=>{i(e)})):i(e)})):n.samples&&t.decryptAvcSamples(n.samples,0,0,(()=>{i(e)}))}))}destroy(){this._duration=0}parseAVCPES(e,t,i,r){const n=this.parseAVCNALu(e,i.data);let s,o=this.avcSample,a=!1;i.data=null,o&&n.length&&!e.audFound&&(tl(o,e),o=this.avcSample=Xa(!1,i.pts,i.dts,"")),n.forEach((r=>{var n;switch(r.type){case 1:{let t=!1;s=!0;const n=r.data;if(a&&n.length>4){const e=new qa(n).readSliceType();2!==e&&4!==e&&7!==e&&9!==e||(t=!0)}var l;t&&null!=(l=o)&&l.frame&&!o.key&&(tl(o,e),o=this.avcSample=null),o||(o=this.avcSample=Xa(!0,i.pts,i.dts,"")),o.frame=!0,o.key=t;break}case 5:s=!0,null!=(n=o)&&n.frame&&!o.key&&(tl(o,e),o=this.avcSample=null),o||(o=this.avcSample=Xa(!0,i.pts,i.dts,"")),o.key=!0,o.frame=!0;break;case 6:s=!0,Es(r.data,1,i.pts,t.samples);break;case 7:if(s=!0,a=!0,!e.sps){const t=r.data,i=new qa(t).readSPS();e.width=i.width,e.height=i.height,e.pixelRatio=i.pixelRatio,e.sps=[t],e.duration=this._duration;const n=t.subarray(1,4);let s="avc1.";for(let e=0;e<3;e++){let t=n[e].toString(16);t.length<2&&(t="0"+t),s+=t}e.codec=s}break;case 8:s=!0,e.pps||(e.pps=[r.data]);break;case 9:s=!1,e.audFound=!0,o&&tl(o,e),o=this.avcSample=Xa(!1,i.pts,i.dts,"");break;case 12:s=!0;break;default:s=!1,o&&(o.debug+="unknown NAL "+r.type+" ")}o&&s&&o.units.push(r)})),r&&o&&(tl(o,e),this.avcSample=null)}getLastNalUnit(e){var t;let i,r=this.avcSample;if(r&&0!==r.units.length||(r=e[e.length-1]),null!=(t=r)&&t.units){const e=r.units;i=e[e.length-1]}return i}parseAVCNALu(e,t){const i=t.byteLength;let r=e.naluState||0;const n=r,s=[];let o,a,l,c=0,u=-1,h=0;for(-1===r&&(u=0,h=31&t[0],r=0,c=1);c<i;)if(o=t[c++],r)if(1!==r)if(o)if(1===o){if(u>=0){const e={data:t.subarray(u,c-r-1),type:h};s.push(e)}else{const i=this.getLastNalUnit(e.samples);if(i&&(n&&c<=4-n&&i.state&&(i.data=i.data.subarray(0,i.data.byteLength-n)),a=c-r-1,a>0)){const e=new Uint8Array(i.data.byteLength+a);e.set(i.data,0),e.set(t.subarray(0,a),i.data.byteLength),i.data=e,i.state=0}}c<i?(l=31&t[c],u=c,h=l,r=0):r=-1}else r=0;else r=3;else r=o?0:2;else r=o?0:1;if(u>=0&&r>=0){const e={data:t.subarray(u,i),type:h,state:r};s.push(e)}if(0===s.length){const i=this.getLastNalUnit(e.samples);if(i){const e=new Uint8Array(i.data.byteLength+t.byteLength);e.set(i.data,0),e.set(t,i.data.byteLength),i.data=e}}return e.naluState=r,s}parseAACPES(e,t){let i=0;const r=this.aacOverFlow;let n,s,o,a=t.data;if(r){this.aacOverFlow=null;const t=r.missing,n=r.sample.unit.byteLength;if(-1===t){const e=new Uint8Array(n+a.byteLength);e.set(r.sample.unit,0),e.set(a,n),a=e}else{const s=n-t;r.sample.unit.set(a.subarray(0,t),s),e.samples.push(r.sample),i=r.missing}}for(n=i,s=a.length;n<s-1&&!Ia(a,n);n++);if(n!==i){let e;const t=n<s-1;e=t?`AAC PES did not start with ADTS header,offset:${n}`:"No ADTS header found in AAC PES";const i=new Error(e);if(pn.warn(`parsing error: ${e}`),this.observer.emit(ln.ERROR,ln.ERROR,{type:cn.MEDIA_ERROR,details:un.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:i,reason:e}),!t)return}if(_a(e,this.observer,a,n,this.audioCodec),void 0!==t.pts)o=t.pts;else{if(!r)return void pn.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=Da(e.samplerate);o=r.sample.pts+t}}let l,c=0;for(;n<s;){if(l=Oa(e,a,n,o,c),n+=l.length,l.missing){this.aacOverFlow=l;break}for(c++;n<s-1&&!Ia(a,n);n++);}}parseMPEGPES(e,t){const i=t.data,r=i.length;let n=0,s=0;const o=t.pts;if(void 0!==o)for(;s<r;)if(Ga(i,s)){const t=Ha(e,i,s,o,n);if(!t)break;s+=t.length,n++}else s++;else pn.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseID3PES(e,t){if(void 0===t.pts)return void pn.warn("[tsdemuxer]: ID3 PES unknown PTS");const i=on({},t,{type:this._avcTrack?lo:ao,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function Xa(e,t,i,r){return{key:e,frame:!1,pts:t,dts:i,units:[],debug:r,length:0}}function Za(e,t){return((31&e[t+1])<<8)+e[t+2]}function Qa(e,t){return(31&e[t+10])<<8|e[t+11]}function Ja(e,t,i,r){const n={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},s=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<s;){const s=Za(e,t);switch(e[t]){case 207:if(!r){pn.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===n.audio&&(n.audio=s);break;case 21:-1===n.id3&&(n.id3=s);break;case 219:if(!r){pn.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===n.avc&&(n.avc=s);break;case 3:case 4:!0!==i.mpeg&&!0!==i.mp3?pn.log("MPEG audio found, not supported in this browser"):-1===n.audio&&(n.audio=s,n.segmentCodec="mp3");break;case 36:pn.warn("Unsupported HEVC stream type found")}t+=5+((15&e[t+3])<<8|e[t+4])}return n}function el(e){let t,i,r,n,s,o=0;const a=e.data;if(!e||0===e.size)return null;for(;a[0].length<19&&a.length>1;){const e=new Uint8Array(a[0].length+a[1].length);e.set(a[0]),e.set(a[1],a[0].length),a[0]=e,a.splice(1,1)}if(t=a[0],1===(t[0]<<16)+(t[1]<<8)+t[2]){if(i=(t[4]<<8)+t[5],i&&i>e.size-6)return null;const l=t[7];192&l&&(n=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&l?(s=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,n-s>54e5&&(pn.warn(`${Math.round((n-s)/9e4)}s delta between PTS and DTS, align them`),n=s)):s=n),r=t[8];let c=r+9;if(e.size<=c)return null;e.size-=c;const u=new Uint8Array(e.size);for(let e=0,i=a.length;e<i;e++){t=a[e];let i=t.byteLength;if(c){if(c>i){c-=i;continue}t=t.subarray(c),i-=c,c=0}u.set(t,o),o+=i}return i&&(i-=r+3),{data:u,pts:n,dts:s,len:i}}return null}function tl(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){const i=t.samples,r=i.length;if(!r)return void t.dropped++;{const t=i[r-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}e.debug.length&&pn.log(e.pts+"/"+e.dts+":"+e.debug)}class il{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const rl=Math.pow(2,32)-1;class nl{static init(){let e;for(e in nl.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},nl.types)nl.types.hasOwnProperty(e)&&(nl.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);nl.HDLR_TYPES={video:t,audio:i};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);nl.STTS=nl.STSC=nl.STCO=n,nl.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),nl.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),nl.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),nl.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const s=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),a=new Uint8Array([0,0,0,1]);nl.FTYP=nl.box(nl.types.ftyp,s,a,s,o),nl.DINF=nl.box(nl.types.dinf,nl.box(nl.types.dref,r))}static box(e,...t){let i=8,r=t.length;const n=r;for(;r--;)i+=t[r].byteLength;const s=new Uint8Array(i);for(s[0]=i>>24&255,s[1]=i>>16&255,s[2]=i>>8&255,s[3]=255&i,s.set(e,4),r=0,i=8;r<n;r++)s.set(t[r],i),i+=t[r].byteLength;return s}static hdlr(e){return nl.box(nl.types.hdlr,nl.HDLR_TYPES[e])}static mdat(e){return nl.box(nl.types.mdat,e)}static mdhd(e,t){t*=e;const i=Math.floor(t/(rl+1)),r=Math.floor(t%(rl+1));return nl.box(nl.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))}static mdia(e){return nl.box(nl.types.mdia,nl.mdhd(e.timescale,e.duration),nl.hdlr(e.type),nl.minf(e))}static mfhd(e){return nl.box(nl.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?nl.box(nl.types.minf,nl.box(nl.types.smhd,nl.SMHD),nl.DINF,nl.stbl(e)):nl.box(nl.types.minf,nl.box(nl.types.vmhd,nl.VMHD),nl.DINF,nl.stbl(e))}static moof(e,t,i){return nl.box(nl.types.moof,nl.mfhd(e),nl.traf(i,t))}static moov(e){let t=e.length;const i=[];for(;t--;)i[t]=nl.trak(e[t]);return nl.box.apply(null,[nl.types.moov,nl.mvhd(e[0].timescale,e[0].duration)].concat(i).concat(nl.mvex(e)))}static mvex(e){let t=e.length;const i=[];for(;t--;)i[t]=nl.trex(e[t]);return nl.box.apply(null,[nl.types.mvex,...i])}static mvhd(e,t){t*=e;const i=Math.floor(t/(rl+1)),r=Math.floor(t%(rl+1)),n=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return nl.box(nl.types.mvhd,n)}static sdtp(e){const t=e.samples||[],i=new Uint8Array(4+t.length);let r,n;for(r=0;r<t.length;r++)n=t[r].flags,i[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return nl.box(nl.types.sdtp,i)}static stbl(e){return nl.box(nl.types.stbl,nl.stsd(e),nl.box(nl.types.stts,nl.STTS),nl.box(nl.types.stsc,nl.STSC),nl.box(nl.types.stsz,nl.STSZ),nl.box(nl.types.stco,nl.STCO))}static avc1(e){let t,i,r,n=[],s=[];for(t=0;t<e.sps.length;t++)i=e.sps[t],r=i.byteLength,n.push(r>>>8&255),n.push(255&r),n=n.concat(Array.prototype.slice.call(i));for(t=0;t<e.pps.length;t++)i=e.pps[t],r=i.byteLength,s.push(r>>>8&255),s.push(255&r),s=s.concat(Array.prototype.slice.call(i));const o=nl.box(nl.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|e.sps.length].concat(n).concat([e.pps.length]).concat(s))),a=e.width,l=e.height,c=e.pixelRatio[0],u=e.pixelRatio[1];return nl.box(nl.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,a>>8&255,255&a,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,nl.box(nl.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),nl.box(nl.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,u>>24,u>>16&255,u>>8&255,255&u])))}static esds(e){const t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static mp4a(e){const t=e.samplerate;return nl.box(nl.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]),nl.box(nl.types.esds,nl.esds(e)))}static mp3(e){const t=e.samplerate;return nl.box(nl.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]))}static stsd(e){return"audio"===e.type?"mp3"===e.segmentCodec&&"mp3"===e.codec?nl.box(nl.types.stsd,nl.STSD,nl.mp3(e)):nl.box(nl.types.stsd,nl.STSD,nl.mp4a(e)):nl.box(nl.types.stsd,nl.STSD,nl.avc1(e))}static tkhd(e){const t=e.id,i=e.duration*e.timescale,r=e.width,n=e.height,s=Math.floor(i/(rl+1)),o=Math.floor(i%(rl+1));return nl.box(nl.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,n>>8&255,255&n,0,0]))}static traf(e,t){const i=nl.sdtp(e),r=e.id,n=Math.floor(t/(rl+1)),s=Math.floor(t%(rl+1));return nl.box(nl.types.traf,nl.box(nl.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),nl.box(nl.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,s>>24,s>>16&255,s>>8&255,255&s])),nl.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,nl.box(nl.types.trak,nl.tkhd(e),nl.mdia(e))}static trex(e){const t=e.id;return nl.box(nl.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const i=e.samples||[],r=i.length,n=12+16*r,s=new Uint8Array(n);let o,a,l,c,u,h;for(t+=8+n,s.set(["video"===e.type?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),o=0;o<r;o++)a=i[o],l=a.duration,c=a.size,u=a.flags,h=a.cts,s.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,c>>>24&255,c>>>16&255,c>>>8&255,255&c,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.paddingValue<<1|u.isNonSync,61440&u.degradPrio,15&u.degradPrio,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*o);return nl.box(nl.types.trun,s)}static initSegment(e){nl.types||nl.init();const t=nl.moov(e),i=new Uint8Array(nl.FTYP.byteLength+t.byteLength);return i.set(nl.FTYP),i.set(t,nl.FTYP.byteLength),i}}nl.types=void 0,nl.HDLR_TYPES=void 0,nl.STTS=void 0,nl.STSC=void 0,nl.STCO=void 0,nl.STSZ=void 0,nl.VMHD=void 0,nl.SMHD=void 0,nl.STSD=void 0,nl.FTYP=void 0,nl.DINF=void 0;function sl(e,t,i=1,r=!1){const n=e*t*i;return r?Math.round(n):n}function ol(e,t=!1){return sl(e,1e3,1/9e4,t)}let al,ll=null,cl=null;class ul{constructor(e,t,i,r=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,null===ll){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ll=e?parseInt(e[1]):0}if(null===cl){const e=navigator.userAgent.match(/Safari\/(\d+)/i);cl=e?parseInt(e[1]):0}}destroy(){}resetTimeStamp(e){pn.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){pn.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){pn.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}getVideoStartPts(e){let t=!1;const i=e.reduce(((e,i)=>{const r=i.pts-e;return r<-4294967296?(t=!0,hl(e,i.pts)):r>0?e:i.pts}),e[0].pts);return t&&pn.debug("PTS rollover detected"),i}remux(e,t,i,r,n,s,o,a){let l,c,u,h,d,f,p=n,g=n;const m=e.pid>-1,v=t.pid>-1,y=t.samples.length,w=e.samples.length>0,E=o&&y>0||y>1;if((!m||w)&&(!v||E)||this.ISGenerated||o){this.ISGenerated||(u=this.generateIS(e,t,n,s));const i=this.isVideoContiguous;let r,o=-1;if(E&&(o=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!i&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,o>0){pn.warn(`[mp4-remuxer]: Dropped ${o} out of ${y} video samples due to a missing keyframe`);const e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(o),t.dropped+=o,g+=(t.samples[0].pts-e)/t.inputTimeScale,r=g}else-1===o&&(pn.warn(`[mp4-remuxer]: No keyframe found out of ${y} video samples`),f=!1);if(this.ISGenerated){if(w&&E){const i=this.getVideoStartPts(t.samples),r=(hl(e.samples[0].pts,i)-i)/t.inputTimeScale;p+=Math.max(0,r),g+=Math.max(0,-r)}if(w){if(e.samplerate||(pn.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),u=this.generateIS(e,t,n,s)),c=this.remuxAudio(e,p,this.isAudioContiguous,s,v||E||a===Qs?g:void 0),E){const r=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(pn.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),u=this.generateIS(e,t,n,s)),l=this.remuxVideo(t,g,i,r)}}else E&&(l=this.remuxVideo(t,g,i,0));l&&(l.firstKeyFrame=o,l.independent=-1!==o,l.firstKeyFramePTS=r)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(d=dl(i,n,this._initPTS,this._initDTS)),r.samples.length&&(h=fl(r,n,this._initPTS))),{audio:c,video:l,initSegment:u,independent:f,text:h,id3:d}}generateIS(e,t,i,r){const n=e.samples,s=t.samples,o=this.typeSupported,a={},l=this._initPTS;let c,u,h,d=!l||r,f="audio/mp4";if(d&&(c=u=1/0),e.config&&n.length&&(e.timescale=e.samplerate,"mp3"===e.segmentCodec&&(o.mpeg?(f="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3")),a.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&o.mpeg?new Uint8Array(0):nl.initSegment([e]),metadata:{channelCount:e.channelCount}},d&&(h=e.inputTimeScale,l&&h===l.timescale?d=!1:c=u=n[0].pts-Math.round(h*i))),t.sps&&t.pps&&s.length&&(t.timescale=t.inputTimeScale,a.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:nl.initSegment([t]),metadata:{width:t.width,height:t.height}},d))if(h=t.inputTimeScale,l&&h===l.timescale)d=!1;else{const e=this.getVideoStartPts(s),t=Math.round(h*i);u=Math.min(u,hl(s[0].dts,e)-t),c=Math.min(c,e-t)}if(Object.keys(a).length)return this.ISGenerated=!0,d?(this._initPTS={baseTime:c,timescale:h},this._initDTS={baseTime:u,timescale:h}):c=h=void 0,{tracks:a,initPTS:c,timescale:h}}remuxVideo(e,t,i,r){const n=e.inputTimeScale,s=e.samples,o=[],a=s.length,l=this._initPTS;let c,u,h=this.nextAvcDts,d=8,f=this.videoSampleDuration,p=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,m=!1;i&&null!==h||(h=t*n-(s[0].pts-hl(s[0].dts,s[0].pts)));const v=l.baseTime*n/l.timescale;for(let e=0;e<a;e++){const t=s[e];t.pts=hl(t.pts-v,h),t.dts=hl(t.dts-v,h),t.dts<s[e>0?e-1:e].dts&&(m=!0)}m&&s.sort((function(e,t){const i=e.dts-t.dts,r=e.pts-t.pts;return i||r})),c=s[0].dts,u=s[s.length-1].dts;const y=u-c,w=y?Math.round(y/(a-1)):f||e.inputTimeScale/30;if(i){const e=c-h,t=e>w,i=e<-1;if((t||i)&&(t?pn.warn(`AVC: ${ol(e,!0)} ms (${e}dts) hole between fragments detected, filling it`):pn.warn(`AVC: ${ol(-e,!0)} ms (${e}dts) overlapping between fragments detected`),!i||h>=s[0].pts)){c=h;const t=s[0].pts-e;s[0].dts=c,s[0].pts=t,pn.log(`Video: First PTS/DTS adjusted: ${ol(t,!0)}/${ol(c,!0)}, delta: ${ol(e,!0)} ms`)}}c=Math.max(0,c);let E=0,b=0;for(let e=0;e<a;e++){const t=s[e],i=t.units,r=i.length;let n=0;for(let e=0;e<r;e++)n+=i[e].data.length;b+=n,E+=r,t.length=n,t.dts=Math.max(t.dts,c),p=Math.min(t.pts,p),g=Math.max(t.pts,g)}u=s[a-1].dts;const T=b+4*E+8;let S;try{S=new Uint8Array(T)}catch(e){return void this.observer.emit(ln.ERROR,ln.ERROR,{type:cn.MUX_ERROR,details:un.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:T,reason:`fail allocating video mdat ${T}`})}const x=new DataView(S.buffer);x.setUint32(0,T),S.set(nl.types.mdat,4);let R=!1,C=Number.POSITIVE_INFINITY,A=Number.POSITIVE_INFINITY,k=Number.NEGATIVE_INFINITY,L=Number.NEGATIVE_INFINITY;for(let e=0;e<a;e++){const t=s[e],i=t.units;let l,c=0;for(let e=0,t=i.length;e<t;e++){const t=i[e],r=t.data,n=t.data.byteLength;x.setUint32(d,n),d+=4,S.set(r,d),d+=n,c+=4+n}if(e<a-1)f=s[e+1].dts-t.dts,l=s[e+1].pts-t.pts;else{const i=this.config,o=e>0?t.dts-s[e-1].dts:w;if(l=e>0?t.pts-s[e-1].pts:w,i.stretchShortVideoTrack&&null!==this.nextAudioPts){const e=Math.floor(i.maxBufferHole*n),s=(r?p+r*n:this.nextAudioPts)-t.pts;s>e?(f=s-o,f<0?f=o:R=!0,pn.log(`[mp4-remuxer]: It is approximately ${s/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=o}else f=o}const u=Math.round(t.pts-t.dts);C=Math.min(C,f),k=Math.max(k,f),A=Math.min(A,l),L=Math.max(L,l),o.push(new pl(t.key,f,c,u))}if(o.length)if(ll){if(ll<70){const e=o[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(cl&&L-A<k-C&&w/k<.025&&0===o[0].cts){pn.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=c;for(let t=0,i=o.length;t<i;t++){const r=e+o[t].duration,n=e+o[t].cts;if(t<i-1){const e=r+o[t+1].cts;o[t].duration=e-n}else o[t].duration=t?o[t-1].duration:w;o[t].cts=0,e=r}}f=R||!f?w:f,this.nextAvcDts=h=u+f,this.videoSampleDuration=f,this.isVideoContiguous=!0;const I={data1:nl.moof(e.sequenceNumber++,c,on({},e,{samples:o})),data2:S,startPTS:p/n,endPTS:(g+f)/n,startDTS:c/n,endDTS:h/n,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,I}remuxAudio(e,t,i,r,n){const s=e.inputTimeScale,o=s/(e.samplerate?e.samplerate:s),a="aac"===e.segmentCodec?1024:1152,l=a*o,c=this._initPTS,u="mp3"===e.segmentCodec&&this.typeSupported.mpeg,h=[],d=void 0!==n;let f=e.samples,p=u?0:8,g=this.nextAudioPts||-1;const m=t*s,v=c.baseTime*s/c.timescale;if(this.isAudioContiguous=i=i||f.length&&g>0&&(r&&Math.abs(m-g)<9e3||Math.abs(hl(f[0].pts-v,m)-g)<20*l),f.forEach((function(e){e.pts=hl(e.pts-v,m)})),!i||g<0){if(f=f.filter((e=>e.pts>=0)),!f.length)return;g=0===n?0:r&&!d?Math.max(0,m):f[0].pts}if("aac"===e.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let i=0,r=g;i<f.length;i++){const n=f[i],o=n.pts,a=o-r,c=Math.abs(1e3*a/s);if(a<=-t*l&&d)0===i&&(pn.warn(`Audio frame @ ${(o/s).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*a/s)} ms.`),this.nextAudioPts=g=r=o);else if(a>=t*l&&c<1e4&&d){let t=Math.round(a/l);r=o-t*l,r<0&&(t--,r+=l),0===i&&(this.nextAudioPts=g=r),pn.warn(`[mp4-remuxer]: Injecting ${t} audio frame @ ${(r/s).toFixed(3)}s due to ${Math.round(1e3*a/s)} ms gap.`);for(let s=0;s<t;s++){const t=Math.max(r,0);let s=il.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);s||(pn.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),s=n.unit.subarray()),f.splice(i,0,{unit:s,pts:t}),r+=l,i++}}n.pts=r,r+=l}}let y,w=null,E=null,b=0,T=f.length;for(;T--;)b+=f[T].unit.byteLength;for(let t=0,r=f.length;t<r;t++){const r=f[t],n=r.unit;let s=r.pts;if(null!==E)h[t-1].duration=Math.round((s-E)/o);else{if(i&&"aac"===e.segmentCodec&&(s=g),w=s,!(b>0))return;b+=p;try{y=new Uint8Array(b)}catch(e){return void this.observer.emit(ln.ERROR,ln.ERROR,{type:cn.MUX_ERROR,details:un.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:b,reason:`fail allocating audio mdat ${b}`})}u||(new DataView(y.buffer).setUint32(0,b),y.set(nl.types.mdat,4))}y.set(n,p);const l=n.byteLength;p+=l,h.push(new pl(!0,a,l,0)),E=s}const S=h.length;if(!S)return;const x=h[h.length-1];this.nextAudioPts=g=E+o*x.duration;const R=u?new Uint8Array(0):nl.moof(e.sequenceNumber++,w/o,on({},e,{samples:h}));e.samples=[];const C=w/s,A=g/s,k={data1:R,data2:y,startPTS:C,endPTS:A,startDTS:C,endDTS:A,type:"audio",hasAudio:!0,hasVideo:!1,nb:S};return this.isAudioContiguous=!0,k}remuxEmptyAudio(e,t,i,r){const n=e.inputTimeScale,s=n/(e.samplerate?e.samplerate:n),o=this.nextAudioPts,a=this._initDTS,l=9e4*a.baseTime/a.timescale,c=(null!==o?o:r.startDTS*n)+l,u=r.endDTS*n+l,h=1024*s,d=Math.ceil((u-c)/h),f=il.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(pn.warn("[mp4-remuxer]: remux empty Audio"),!f)return void pn.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");const p=[];for(let e=0;e<d;e++){const t=c+e*h;p.push({unit:f,pts:t,dts:t})}return e.samples=p,this.remuxAudio(e,t,i,!1)}}function hl(e,t){let i;if(null===t)return e;for(i=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=i;return e}function dl(e,t,i,r){const n=e.samples.length;if(!n)return;const s=e.inputTimeScale;for(let o=0;o<n;o++){const n=e.samples[o];n.pts=hl(n.pts-i.baseTime*s/i.timescale,t*s)/s,n.dts=hl(n.dts-r.baseTime*s/r.timescale,t*s)/s}const o=e.samples;return e.samples=[],{samples:o}}function fl(e,t,i){const r=e.samples.length;if(!r)return;const n=e.inputTimeScale;for(let s=0;s<r;s++){const r=e.samples[s];r.pts=hl(r.pts-i.baseTime*n/i.timescale,t*n)/n}e.samples.sort(((e,t)=>e.pts-t.pts));const s=e.samples;return e.samples=[],{samples:s}}class pl{constructor(e,t,i,r){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=i,this.cts=r,this.flags=new gl(e)}}class gl{constructor(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1}}function ml(e,t){const i=null==e?void 0:e.codec;return i&&i.length>4?i:"hvc1"===i||"hev1"===i?"hvc1.1.6.L120.90":"av01"===i?"av01.0.04M.08":"avc1"===i||t===Tn?"avc1.42e01e":"mp4a.40.5"}try{al=self.performance.now.bind(self.performance)}catch(e){pn.debug("Unable to use Performance API on this environment"),al="undefined"!=typeof self&&self.Date.now}const vl=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,r){const n=this.videoTrack=xa("video",1),s=this.audioTrack=xa("audio",1),o=this.txtTrack=xa("text",1);if(this.id3Track=xa("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const a=ps(e);if(a.video){const{id:e,timescale:t,codec:i}=a.video;n.id=e,n.timescale=o.timescale=t,n.codec=i}if(a.audio){const{id:e,timescale:t,codec:i}=a.audio;s.id=e,s.timescale=t,s.codec=i}o.id=os.text,n.sampleDuration=0,n.duration=s.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return ds(e=e.length>16384?e.subarray(0,16384):e,["moof"]).length>0}demux(e,t){this.timeOffset=t;let i=e;const r=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=vs(this.remainderData,e));const t=function(e){const t={valid:null,remainder:null},i=ds(e,["moof"]);if(!i)return t;if(i.length<2)return t.remainder=e,t;const r=i[i.length-1];return t.valid=$n(e,0,r.byteOffset-8),t.remainder=$n(e,r.byteOffset-8),t}(i);this.remainderData=t.remainder,r.samples=t.valid||new Uint8Array}else r.samples=i;const s=this.extractID3Track(r,t);return n.samples=ys(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:s,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return i.samples=ys(e,t),{videoTrack:t,audioTrack:xa(),id3Track:r,textTrack:xa()}}extractID3Track(e,t){const i=this.id3Track;if(e.samples.length){const r=ds(e.samples,["emsg"]);r&&r.forEach((e=>{const r=function(e){const t=e[0];let i="",r="",n=0,s=0,o=0,a=0,l=0,c=0;if(0===t){for(;"\0"!==as(e.subarray(c,c+1));)i+=as(e.subarray(c,c+1)),c+=1;for(i+=as(e.subarray(c,c+1)),c+=1;"\0"!==as(e.subarray(c,c+1));)r+=as(e.subarray(c,c+1)),c+=1;r+=as(e.subarray(c,c+1)),c+=1,n=cs(e,12),s=cs(e,16),a=cs(e,20),l=cs(e,24),c=28}else if(1===t){c+=4,n=cs(e,c),c+=4;const t=cs(e,c);c+=4;const s=cs(e,c);for(c+=4,o=2**32*t+s,Number.isSafeInteger(o)||(o=Number.MAX_SAFE_INTEGER,pn.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=cs(e,c),c+=4,l=cs(e,c),c+=4;"\0"!==as(e.subarray(c,c+1));)i+=as(e.subarray(c,c+1)),c+=1;for(i+=as(e.subarray(c,c+1)),c+=1;"\0"!==as(e.subarray(c,c+1));)r+=as(e.subarray(c,c+1)),c+=1;r+=as(e.subarray(c,c+1)),c+=1}return{schemeIdUri:i,value:r,timeScale:n,presentationTime:o,presentationTimeDelta:s,eventDuration:a,id:l,payload:e.subarray(c,e.byteLength)}}(e);if(Ma.test(r.schemeIdUri)){const e=an(r.presentationTime)?r.presentationTime/r.timeScale:t+r.presentationTimeDelta/r.timeScale;let n=4294967295===r.eventDuration?Number.POSITIVE_INFINITY:r.eventDuration/r.timeScale;n<=.001&&(n=Number.POSITIVE_INFINITY);const s=r.payload;i.samples.push({data:s,len:s.byteLength,dts:e,pts:e,type:lo,duration:n})}}))}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}},remux:class{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,i,r){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(function(e,t){if(!e||!t)return e;const i=t.keyId;return i&&t.isCommonEncryption&&ds(e,["moov","trak"]).forEach((e=>{const t=ds(e,["mdia","minf","stbl","stsd"])[0].subarray(8);let r=ds(t,["enca"]);const n=r.length>0;n||(r=ds(t,["encv"])),r.forEach((e=>{ds(n?e.subarray(28):e.subarray(78),["sinf"]).forEach((e=>{const t=gs(e);if(t){const e=t.subarray(8,24);e.some((e=>0!==e))||(pn.log(`[eme] Patching keyId in 'enc${n?"a":"v"}>sinf>>tenc' box: ${rs(e)} -> ${rs(i)}`),t.set(i,8))}}))}))})),e}(e,r)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:i}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const r=this.initData=ps(e);t||(t=ml(r.audio,bn)),i||(i=ml(r.video,Tn));const n={};r.audio&&r.video?n.audiovideo={container:"video/mp4",codec:t+","+i,initSegment:e,id:"main"}:r.audio?n.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:r.video?n.video={container:"video/mp4",codec:i,initSegment:e,id:"main"}:pn.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=n}remux(e,t,i,r,n,s){var o,a;let{initPTS:l,lastEndTime:c}=this;const u={audio:void 0,video:void 0,text:r,id3:i,initSegment:void 0};an(c)||(c=this.lastEndTime=n||0);const h=t.samples;if(null==h||!h.length)return u;const d={initPTS:void 0,timescale:1};let f=this.initData;if(null!=(o=f)&&o.length||(this.generateInitSegment(h),f=this.initData),null==(a=f)||!a.length)return pn.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),u;this.emitInitSegment&&(d.tracks=this.initTracks,this.emitInitSegment=!1);const p=function(e,t){let i=0,r=0,n=0;const s=ds(e,["moof","traf"]);for(let e=0;e<s.length;e++){const o=s[e],a=ds(o,["tfhd"])[0],l=t[cs(a,4)];if(!l)continue;const c=l.default,u=cs(a,0)|(null==c?void 0:c.flags);let h=null==c?void 0:c.duration;8&u&&(h=cs(a,2&u?12:8));const d=l.timescale||9e4,f=ds(o,["trun"]);for(let e=0;e<f.length;e++)i=ms(f[e]),!i&&h&&(i=h*cs(f[e],4)),l.type===Tn?r+=i/d:l.type===bn&&(n+=i/d)}if(0===r&&0===n){let t=0;const i=ds(e,["sidx"]);for(let e=0;e<i.length;e++){const r=fs(i[e]);null!=r&&r.references&&(t+=r.references.reduce(((e,t)=>e+t.info.duration||0),0))}return t}return r||n}(h,f),g=function(e,t){return ds(t,["moof","traf"]).reduce(((t,i)=>{const r=ds(i,["tfdt"])[0],n=r[0],s=ds(i,["tfhd"]).reduce(((t,i)=>{const s=cs(i,4),o=e[s];if(o){let e=cs(r,4);if(1===n){if(e===ns)return pn.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),t;e*=ns+1,e+=cs(r,8)}const i=e/(o.timescale||9e4);if(isFinite(i)&&(null===t||i<t))return i}return t}),null);return null!==s&&isFinite(s)&&(null===t||s<t)?s:t}),null)}(f,h),m=null===g?n:g;(function(e,t,i,r){if(null===e)return!0;const n=Math.max(r,1),s=t-e.baseTime/e.timescale;return Math.abs(s-i)>n}(l,m,n,p)||d.timescale!==l.timescale&&s)&&(d.initPTS=m-n,l&&1===l.timescale&&pn.warn("Adjusting initPTS by "+(d.initPTS-l.baseTime)),this.initPTS=l={baseTime:d.initPTS,timescale:1});const v=e?m-l.baseTime/l.timescale:c,y=v+p;!function(e,t,i){ds(t,["moof","traf"]).forEach((t=>{ds(t,["tfhd"]).forEach((r=>{const n=cs(r,4),s=e[n];if(!s)return;const o=s.timescale||9e4;ds(t,["tfdt"]).forEach((e=>{const t=e[0];let r=cs(e,4);if(0===t)r-=i*o,r=Math.max(r,0),hs(e,4,r);else{r*=Math.pow(2,32),r+=cs(e,8),r-=i*o,r=Math.max(r,0);const t=Math.floor(r/(ns+1)),n=Math.floor(r%(ns+1));hs(e,4,t),hs(e,8,n)}}))}))}))}(f,h,l.baseTime/l.timescale),p>0?this.lastEndTime=y:(pn.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const w=!!f.audio,E=!!f.video;let b="";w&&(b+="audio"),E&&(b+="video");const T={data1:h,startPTS:v,startDTS:v,endPTS:y,endDTS:y,type:b,hasAudio:w,hasVideo:E,nb:1,dropped:0};return u.audio="audio"===T.type?T:void 0,u.video="audio"!==T.type?T:void 0,u.initSegment=d,u.id3=dl(i,n,l,l),r.samples.length&&(u.text=fl(r,n,l)),u}}},{demux:Ya,remux:ul},{demux:class extends Ra{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let t=(jn(e,0)||[]).length;for(let i=e.length;t<i;t++)if(Pa(e,t))return pn.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&Aa(e,t)&&La(e,t)<=e.length-t}(e,t)}appendFrame(e,t,i){_a(e,this.observer,t,i,e.manifestCodec);const r=Oa(e,t,i,this.basePTS,this.frameIndex);if(r&&0===r.missing)return r}},remux:ul},{demux:class extends Ra{resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let t=(jn(e,0)||[]).length;for(let i=e.length;t<i;t++)if(Va(e,t))return pn.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return ja(e,t)&&4<=e.length-t}(e,t)}appendFrame(e,t,i){if(null!==this.basePTS)return Ha(e,t,i,this.basePTS,this.frameIndex)}},remux:ul}];class yl{constructor(e,t,i,r,n){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.vendor=r,this.id=n}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,r){const n=i.transmuxing;n.executeStart=al();let s=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:a}=this;r&&(this.currentTransmuxState=r);const{contiguous:l,discontinuity:c,trackSwitch:u,accurateTimeOffset:h,timeOffset:d,initSegmentChange:f}=r||o,{audioCodec:p,videoCodec:g,defaultInitPts:m,duration:v,initSegmentData:y}=a,w=function(e,t){let i=null;return e.byteLength>0&&null!=t&&null!=t.key&&null!==t.iv&&null!=t.method&&(i=t),i}(s,t);if(w&&"AES-128"===w.method){const e=this.getDecrypter();if(!e.isSync())return this.decryptionPromise=e.webCryptoDecrypt(s,w.key.buffer,w.iv.buffer).then((e=>{const t=this.push(e,null,i);return this.decryptionPromise=null,t})),this.decryptionPromise;{let t=e.softwareDecrypt(s,w.key.buffer,w.iv.buffer);if(i.part>-1&&(t=e.flush()),!t)return n.executeEnd=al(),wl(i);s=new Uint8Array(t)}}const E=this.needsProbing(c,u);if(E){const e=this.configureTransmuxer(s);if(e)return pn.warn(`[transmuxer] ${e.message}`),this.observer.emit(ln.ERROR,ln.ERROR,{type:cn.MEDIA_ERROR,details:un.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),n.executeEnd=al(),wl(i)}(c||u||f||E)&&this.resetInitSegment(y,p,g,v,t),(c||f||E)&&this.resetInitialTimestamp(m),l||this.resetContiguity();const b=this.transmux(s,w,d,h,i),T=this.currentTransmuxState;return T.contiguous=!0,T.discontinuity=!1,T.trackSwitch=!1,n.executeEnd=al(),b}flush(e){const t=e.transmuxing;t.executeStart=al();const{decrypter:i,currentTransmuxState:r,decryptionPromise:n}=this;if(n)return n.then((()=>this.flush(e)));const s=[],{timeOffset:o}=r;if(i){const t=i.flush();t&&s.push(this.push(t,null,e))}const{demuxer:a,remuxer:l}=this;if(!a||!l)return t.executeEnd=al(),[wl(e)];const c=a.flush(o);return El(c)?c.then((t=>(this.flushRemux(s,t,e),s))):(this.flushRemux(s,c,e),s)}flushRemux(e,t,i){const{audioTrack:r,videoTrack:n,id3Track:s,textTrack:o}=t,{accurateTimeOffset:a,timeOffset:l}=this.currentTransmuxState;pn.log(`[transmuxer.ts]: Flushed fragment ${i.sn}${i.part>-1?" p: "+i.part:""} of level ${i.level}`);const c=this.remuxer.remux(r,n,s,o,l,a,!0,this.id);e.push({remuxResult:c,chunkMeta:i}),i.transmuxing.executeEnd=al()}resetInitialTimestamp(e){const{demuxer:t,remuxer:i}=this;t&&i&&(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,r,n){const{demuxer:s,remuxer:o}=this;s&&o&&(s.resetInitSegment(e,t,i,r),o.resetInitSegment(e,t,i,n))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,r,n){let s;return s=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,i,r,n):this.transmuxUnencrypted(e,i,r,n),s}transmuxUnencrypted(e,t,i,r){const{audioTrack:n,videoTrack:s,id3Track:o,textTrack:a}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(n,s,o,a,t,i,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,i,r,n){return this.demuxer.demuxSampleAes(e,t,i).then((e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,i,r,!1,this.id),chunkMeta:n})))}configureTransmuxer(e){const{config:t,observer:i,typeSupported:r,vendor:n}=this;let s;for(let t=0,i=vl.length;t<i;t++)if(vl[t].demux.probe(e)){s=vl[t];break}if(!s)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,a=this.remuxer,l=s.remux,c=s.demux;a&&a instanceof l||(this.remuxer=new l(i,t,r,n)),o&&o instanceof c||(this.demuxer=new c(i,t,r),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new ca(this.config)),e}}const wl=e=>({remuxResult:{},chunkMeta:e});function El(e){return"then"in e&&e.then instanceof Function}class bl{constructor(e,t,i,r,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=r,this.defaultInitPts=n||null}}class Tl{constructor(e,t,i,r,n,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=r,this.timeOffset=n,this.initSegmentChange=s}}var Sl={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,i="~";function r(){}function n(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function s(e,t,r,s,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new n(r,s||e,o),l=i?i+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(i=!1)),a.prototype.eventNames=function(){var e,r,n=[];if(0===this._eventsCount)return n;for(r in e=this._events)t.call(e,r)&&n.push(i?r.slice(1):r);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},a.prototype.listeners=function(e){var t=i?i+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,s=r.length,o=new Array(s);n<s;n++)o[n]=r[n].fn;return o},a.prototype.listenerCount=function(e){var t=i?i+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,n,s,o){var a=i?i+e:e;if(!this._events[a])return!1;var l,c,u=this._events[a],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,n),!0;case 5:return u.fn.call(u.context,t,r,n,s),!0;case 6:return u.fn.call(u.context,t,r,n,s,o),!0}for(c=1,l=new Array(h-1);c<h;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var d,f=u.length;for(c=0;c<f;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),h){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,r);break;case 4:u[c].fn.call(u[c].context,t,r,n);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];u[c].fn.apply(u[c].context,l)}}return!0},a.prototype.on=function(e,t,i){return s(this,e,t,i,!1)},a.prototype.once=function(e,t,i){return s(this,e,t,i,!0)},a.prototype.removeListener=function(e,t,r,n){var s=i?i+e:e;if(!this._events[s])return this;if(!t)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==t||n&&!a.once||r&&a.context!==r||o(this,s);else{for(var l=0,c=[],u=a.length;l<u;l++)(a[l].fn!==t||n&&!a[l].once||r&&a[l].context!==r)&&c.push(a[l]);c.length?this._events[s]=1===c.length?c[0]:c:o(this,s)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&o(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,e.exports=a}(Sl);var xl=Kr(Sl.exports);const Rl=Is()||{isTypeSupported:()=>!1};class Cl{constructor(e,t,i,r){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const n=e.config;this.hls=e,this.id=t,this.useWorker=!!n.enableWorker,this.onTransmuxComplete=i,this.onFlush=r;const s=(e,t)=>{(t=t||{}).frag=this.frag,t.id=this.id,e===ln.ERROR&&(this.error=t.error),this.hls.trigger(e,t)};this.observer=new xl,this.observer.on(ln.FRAG_DECRYPTED,s),this.observer.on(ln.ERROR,s);const o={mp4:Rl.isTypeSupported("video/mp4"),mpeg:Rl.isTypeSupported("audio/mpeg"),mp3:Rl.isTypeSupported('audio/mp4; codecs="mp3"')},a=navigator.vendor;if(!this.useWorker||"undefined"==typeof Worker||!n.workerPath&&"function"!=typeof __HLS_WORKER_BUNDLE__)this.transmuxer=new yl(this.observer,o,n,a,t);else try{n.workerPath?(pn.log(`loading Web Worker ${n.workerPath} for "${t}"`),this.workerContext=function(e){const t=new self.URL(e,self.location.href).href;return{worker:new self.Worker(t),scriptURL:t}}(n.workerPath)):(pn.log(`injecting Web Worker for "${t}"`),this.workerContext=function(){const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e);return{worker:new self.Worker(t),objectURL:t}}()),this.onwmsg=e=>this.onWorkerMessage(e);const{worker:e}=this.workerContext;e.addEventListener("message",this.onwmsg),e.onerror=e=>{const i=new Error(`${e.message}  (${e.filename}:${e.lineno})`);n.enableWorker=!1,pn.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(ln.ERROR,{type:cn.OTHER_ERROR,details:un.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:i})},e.postMessage({cmd:"init",typeSupported:o,vendor:a,id:t,config:JSON.stringify(n)})}catch(e){pn.warn(`Error setting up "${t}" Web Worker, fallback to inline`,e),this.resetWorker(),this.error=null,this.transmuxer=new yl(this.observer,o,n,a,t)}}resetWorker(){if(this.workerContext){const{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,i,r,n,s,o,a,l,c){var u,h;l.transmuxing.start=self.performance.now();const{transmuxer:d}=this,f=s?s.start:n.start,p=n.decryptdata,g=this.frag,m=!(g&&n.cc===g.cc),v=!(g&&l.level===g.level),y=g?l.sn-g.sn:-1,w=this.part?l.part-this.part.index:-1,E=0===y&&l.id>1&&l.id===(null==g?void 0:g.stats.chunkCount),b=!v&&(1===y||0===y&&(1===w||E&&w<=0)),T=self.performance.now();(v||y||0===n.stats.parsing.start)&&(n.stats.parsing.start=T),!s||!w&&b||(s.stats.parsing.start=T);const S=!(g&&(null==(u=n.initSegment)?void 0:u.url)===(null==(h=g.initSegment)?void 0:h.url)),x=new Tl(m,b,a,v,f,S);if(!b||m||S){pn.log(`[transmuxer-interface, ${n.type}]: Starting new transmux session for sn: ${l.sn} p: ${l.part} level: ${l.level} id: ${l.id}\n        discontinuity: ${m}\n        trackSwitch: ${v}\n        contiguous: ${b}\n        accurateTimeOffset: ${a}\n        timeOffset: ${f}\n        initSegmentChange: ${S}`);const e=new bl(i,r,t,o,c);this.configureTransmuxer(e)}if(this.frag=n,this.part=s,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:p,chunkMeta:l,state:x},e instanceof ArrayBuffer?[e]:[]);else if(d){const t=d.push(e,p,l,x);El(t)?(d.async=!0,t.then((e=>{this.handleTransmuxComplete(e)})).catch((e=>{this.transmuxerError(e,l,"transmuxer-interface push error")}))):(d.async=!1,this.handleTransmuxComplete(t))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let i=t.flush(e);El(i)||t.async?(El(i)||(i=Promise.resolve(i)),i.then((t=>{this.handleFlushResult(t,e)})).catch((t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")}))):this.handleFlushResult(i,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(ln.ERROR,{type:cn.MEDIA_ERROR,details:un.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach((e=>{this.handleTransmuxComplete(e)})),this.onFlush(t)}onWorkerMessage(e){const t=e.data,i=this.hls;switch(t.event){case"init":{var r;const e=null==(r=this.workerContext)?void 0:r.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":pn[t.data.logType]&&pn[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data)}}configureTransmuxer(e){const{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class Al{constructor(e,t,i,r){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=i,this.hls=r}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){const{config:i,media:r,stalled:n}=this;if(null===r)return;const{currentTime:s,seeking:o}=r,a=this.seeking&&!o,l=!this.seeking&&o;if(this.seeking=o,s!==e){if(this.moved=!0,null!==n){if(this.stallReported){const e=self.performance.now()-n;pn.warn(`playback not stuck anymore @${s}, after ${Math.round(e)}ms`),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if(l||a)return void(this.stalled=null);if(r.paused&&!o||r.ended||0===r.playbackRate||!ea.getBuffered(r).length)return;const c=ea.bufferInfo(r,s,0),u=c.len>0,h=c.nextStart||0;if(!u&&!h)return;if(o){const e=c.len>2,i=!h||t&&t.start<=s||h-s>2&&!this.fragmentTracker.getPartialFragment(s);if(e||i)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var d;const e=Math.max(h,c.start||0)-s,t=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,i=(null==t||null==(d=t.details)?void 0:d.live)?2*t.details.targetduration:2,r=this.fragmentTracker.getPartialFragment(s);if(e>0&&(e<=i||r))return void this._trySkipBufferHole(r)}const f=self.performance.now();if(null===n)return void(this.stalled=f);const p=f-n;if(!o&&p>=250&&(this._reportStall(c),!this.media))return;const g=ea.bufferInfo(r,s,i.maxBufferHole);this._tryFixBufferStall(g,p)}_tryFixBufferStall(e,t){const{config:i,fragmentTracker:r,media:n}=this;if(null===n)return;const s=n.currentTime,o=r.getPartialFragment(s);(!o||!this._trySkipBufferHole(o)&&this.media)&&(e.len>i.maxBufferHole||e.nextStart&&e.nextStart-s<i.maxBufferHole)&&t>1e3*i.highBufferWatchdogPeriod&&(pn.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:t,media:i,stallReported:r}=this;if(!r&&i){this.stallReported=!0;const r=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${JSON.stringify(e)})`);pn.warn(r.message),t.trigger(ln.ERROR,{type:cn.MEDIA_ERROR,details:un.BUFFER_STALLED_ERROR,fatal:!1,error:r,buffer:e.len})}}_trySkipBufferHole(e){const{config:t,hls:i,media:r}=this;if(null===r)return 0;const n=r.currentTime,s=ea.bufferInfo(r,n,0),o=n<s.start?s.start:s.nextStart;if(o){const a=s.len<=t.maxBufferHole,l=s.len>0&&s.len<1&&r.readyState<3,c=o-n;if(c>0&&(a||l)){if(c>t.maxBufferHole){const{fragmentTracker:t}=this;let i=!1;if(0===n){const e=t.getAppendedFrag(0,Zs);e&&o<e.end&&(i=!0)}if(!i){const i=e||t.getAppendedFrag(n,Zs);if(i){let e=!1,r=i.end;for(;r<o;){const i=t.getPartialFragment(r);if(!i){e=!0;break}r+=i.duration}if(e)return 0}}}const s=Math.max(o+.05,n+.1);if(pn.warn(`skipping hole, adjusting currentTime from ${n} to ${s}`),this.moved=!0,this.stalled=null,r.currentTime=s,e&&!e.gap){const t=new Error(`fragment loaded with buffer holes, seeking from ${n} to ${s}`);i.trigger(ln.ERROR,{type:cn.MEDIA_ERROR,details:un.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:t,reason:t.message,frag:e})}return s}}return 0}_tryNudgeBuffer(){const{config:e,hls:t,media:i,nudgeRetry:r}=this;if(null===i)return;const n=i.currentTime;if(this.nudgeRetry++,r<e.nudgeMaxRetry){const s=n+(r+1)*e.nudgeOffset,o=new Error(`Nudging 'currentTime' from ${n} to ${s}`);pn.warn(o.message),i.currentTime=s,t.trigger(ln.ERROR,{type:cn.MEDIA_ERROR,details:un.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1})}else{const i=new Error(`Playhead still not moving while enough data buffered @${n} after ${e.nudgeMaxRetry} nudges`);pn.error(i.message),t.trigger(ln.ERROR,{type:cn.MEDIA_ERROR,details:un.BUFFER_STALLED_ERROR,error:i,fatal:!0})}}}class kl extends Ta{constructor(e,t,i){super(e,t,i,"[stream-controller]",Zs),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(ln.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ln.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ln.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ln.LEVEL_LOADING,this.onLevelLoading,this),e.on(ln.LEVEL_LOADED,this.onLevelLoaded,this),e.on(ln.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(ln.ERROR,this.onError,this),e.on(ln.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(ln.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(ln.BUFFER_CREATED,this.onBufferCreated,this),e.on(ln.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(ln.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(ln.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(ln.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ln.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ln.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ln.LEVEL_LOADED,this.onLevelLoaded,this),e.off(ln.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(ln.ERROR,this.onError,this),e.off(ln.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(ln.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(ln.BUFFER_CREATED,this.onBufferCreated,this),e.off(ln.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(ln.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(ln.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),this.onMediaDetaching()}startLoad(e){if(this.levels){const{lastCurrentTime:t,hls:i}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=i.startLevel;-1===e&&(i.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=i.nextAutoLevel),this.level=i.nextLoadLevel=e,this.loadedmetadata=!1}t>0&&-1===e&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=ha,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=ua}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ba:{var e;const{levels:t,level:i}=this,r=null==t||null==(e=t[i])?void 0:e.details;if(r&&(!r.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(r))break;this.state=ha;break}if(this.hls.nextLoadLevel!==this.level){this.state=ha;break}break}case pa:{var t;const e=self.performance.now(),i=this.retryDate;(!i||e>=i||null!=(t=this.media)&&t.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=ha)}}this.state===ha&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:i,media:r}=this,{config:n,nextLoadLevel:s}=e;if(null===t||!r&&(this.startFragRequested||!n.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;if(null==i||!i[s])return;const o=i[s],a=this.getMainFwdBufferInfo();if(null===a)return;const l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){const e={};return this.altAudio&&(e.type="video"),this.hls.trigger(ln.BUFFER_EOS,e),void(this.state=ya)}e.loadLevel!==s&&-1===e.manualLevel&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const c=o.details;if(!c||this.state===ba||c.live&&this.levelLastLoaded!==s)return this.level=s,void(this.state=ba);const u=a.len,h=this.getMaxBufferLength(o.maxBitrate);if(u>=h)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const d=this.backtrackFragment?this.backtrackFragment.start:a.end;let f=this.getNextFragment(d,c);if(this.couldBacktrack&&!this.fragPrevious&&f&&"initSegment"!==f.sn&&this.fragmentTracker.getState(f)!==zo){var p;const e=(null!=(p=this.backtrackFragment)?p:f).sn-c.startSN,t=c.fragments[e-1];t&&f.cc===t.cc&&(f=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(f&&this.isLoopLoading(f,d)){if(!f.gap){const e=this.audioOnly&&!this.altAudio?bn:Tn,t=(e===Tn?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,Zs)}f=this.getNextFragmentLoopLoading(f,c,a,Zs,h)}f&&(!f.initSegment||f.initSegment.data||this.bitrateTest||(f=f.initSegment),this.loadFragment(f,o,d))}loadFragment(e,t,i){const r=this.fragmentTracker.getState(e);this.fragCurrent=e,r===Uo||r===Ho?"initSegment"===e.sn?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,i)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Zs)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let i;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const n=this.getLevelDetails();if(null!=n&&n.live){const e=this.getMainFwdBufferInfo();if(!e||e.len<2*n.targetduration)return}if(!t.paused&&e){const t=e[this.hls.nextLoadLevel],r=this.fragLastKbps;i=r&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*r)+1:0}else i=0;const s=this.getBufferedFrag(t.currentTime+i);if(s){const e=this.followingBufferedFrag(s);if(e){this.abortCurrentFrag();const t=e.maxStartPTS?e.maxStartPTS:e.start,i=e.duration,r=Math.max(s.end,t+Math.min(Math.max(i-this.config.maxFragLookUpTolerance,.5*i),.75*i));this.flushMainBuffer(r,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case da:case fa:case pa:case ma:case va:this.state=ha}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const i=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new Al(this.config,i,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,t=e?e.currentTime:null;an(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const i=this.getMainFwdBufferInfo();null!==i&&0!==i.len?this.tick():this.warn(`Main forward buffer length on "seeked" event ${i?i.len:"empty"})`)}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(ln.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1}onManifestParsed(e,t){let i,r=!1,n=!1;t.levels.forEach((e=>{i=e.audioCodec,i&&(-1!==i.indexOf("mp4a.40.2")&&(r=!0),-1!==i.indexOf("mp4a.40.5")&&(n=!0))})),this.audioCodecSwitch=r&&n&&!function(){var e;const t=Sa();return"function"==typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:i}=this;if(!i||this.state!==ha)return;const r=i[t.level];(!r.details||r.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(r.details))&&(this.state=ba)}onLevelLoaded(e,t){var i;const{levels:r}=this,n=t.level,s=t.details,o=s.totalduration;if(!r)return void this.warn(`Levels were reset while loading level ${n}`);this.log(`Level ${n} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""}, cc [${s.startCC}, ${s.endCC}] duration:${o}`);const a=r[n],l=this.fragCurrent;!l||this.state!==fa&&this.state!==pa||l.level===t.level&&l.urlId===a.urlId||!l.loader||this.abortCurrentFrag();let c=0;if(s.live||null!=(i=a.details)&&i.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;c=this.alignPlaylists(s,a.details)}if(a.details=s,this.levelLastLoaded=n,this.hls.trigger(ln.LEVEL_UPDATED,{details:s,level:n}),this.state===ba){if(this.waitForCdnTuneIn(s))return;this.state=ha}this.startFragRequested?s.live&&this.synchronizeToLiveEdge(s):this.setStartPosition(s,c),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:i,part:r,payload:n}=e,{levels:s}=this;if(!s)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);const o=s[i.level],a=o.details;if(!a)return this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),void this.fragmentTracker.removeFragment(i);const l=o.videoCodec,c=a.PTSKnown||!a.live,u=null==(t=i.initSegment)?void 0:t.data,h=this._getAudioCodec(o),d=this.transmuxer=this.transmuxer||new Cl(this.hls,Zs,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=r?r.index:-1,p=-1!==f,g=new ta(i.level,i.sn,i.stats.chunkCount,n.byteLength,f,p),m=this.initPTS[i.cc];d.push(n,u,h,l,i,r,a.totalduration,c,g,m)}onAudioTrackSwitching(e,t){const i=this.altAudio;if(!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const e=this.hls;i&&(e.trigger(ln.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),e.trigger(ln.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const i=t.id,r=!!this.hls.audioTracks[i].url;if(r){const e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=r,this.tick()}onBufferCreated(e,t){const i=t.tracks;let r,n,s=!1;for(const e in i){const t=i[e];if("main"===t.id){if(n=e,r=t,"video"===e){const t=i[e];t&&(this.videoBuffer=t.buffer)}}else s=!0}s&&r?(this.log(`Alternate track found, use ${n}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:i,part:r}=t;if(i&&i.type!==Zs)return;if(this.fragContextChanged(i))return this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),void(this.state===va&&(this.state=ha));const n=r?r.stats:i.stats;this.fragLastKbps=Math.round(8*n.total/(n.buffering.end-n.loading.first)),"initSegment"!==i.sn&&(this.fragPrevious=i),this.fragBufferedComplete(i,r)}onError(e,t){var i;if(t.fatal)this.state=wa;else switch(t.details){case un.FRAG_GAP:case un.FRAG_PARSING_ERROR:case un.FRAG_DECRYPT_ERROR:case un.FRAG_LOAD_ERROR:case un.FRAG_LOAD_TIMEOUT:case un.KEY_LOAD_ERROR:case un.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Zs,t);break;case un.LEVEL_LOAD_ERROR:case un.LEVEL_LOAD_TIMEOUT:case un.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==ba||(null==(i=t.context)?void 0:i.type)!==Ks||(this.state=ha);break;case un.BUFFER_FULL_ERROR:if(!t.parent||"main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case un.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}checkBuffer(){const{media:e,gapController:t}=this;if(e&&t&&e.readyState){if(this.loadedmetadata||!ea.getBuffered(e).length){const e=this.state!==ha?this.fragCurrent:null;t.poll(this.lastCurrentTime,e)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=ha,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==bn||this.audioOnly&&!this.altAudio){const e=(t===Tn?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(e,t,Zs)}}onLevelsUpdated(e,t){this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let i=this.startPosition;if(i>=0&&t<i){if(e.seeking)return void this.log(`could not seek to ${i}, already seeking at ${t}`);const r=ea.getBuffered(e),n=(r.length?r.start(0):0)-i;n>0&&(n<this.config.maxBufferHole||n<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${n} to match buffer start`),i+=n,this.startPosition=i),this.log(`seek to target start position ${i} from current time ${t}`),e.currentTime=i}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then((i=>{const{hls:r}=this;if(!i||this.fragContextChanged(e))return;t.fragmentError=0,this.state=ha,this.startFragRequested=!1,this.bitrateTest=!1;const n=e.stats;n.parsing.start=n.parsing.end=n.buffering.start=n.buffering.end=self.performance.now(),r.trigger(ln.FRAG_LOADED,i),e.bitrateTest=!1}))}_handleTransmuxComplete(e){var t;const i="main",{hls:r}=this,{remuxResult:n,chunkMeta:s}=e,o=this.getCurrentContext(s);if(!o)return void this.resetWhenMissingContext(s);const{frag:a,part:l,level:c}=o,{video:u,text:h,id3:d,initSegment:f}=n,{details:p}=c,g=this.altAudio?void 0:n.audio;if(this.fragContextChanged(a))this.fragmentTracker.removeFragment(a);else{if(this.state=ma,f){if(null!=f&&f.tracks){const e=a.initSegment||a;this._bufferInitSegment(c,f.tracks,e,s),r.trigger(ln.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:i,tracks:f.tracks})}const e=f.initPTS,t=f.timescale;an(e)&&(this.initPTS[a.cc]={baseTime:e,timescale:t},r.trigger(ln.INIT_PTS_FOUND,{frag:a,id:i,initPTS:e,timescale:t}))}if(u&&p&&"initSegment"!==a.sn){const e=p.fragments[a.sn-1-p.startSN],t=a.sn===p.startSN,i=!e||a.cc>e.cc;if(!1!==n.independent){const{startPTS:e,endPTS:r,startDTS:n,endDTS:o}=u;if(l)l.elementaryStreams[u.type]={startPTS:e,endPTS:r,startDTS:n,endDTS:o};else if(u.firstKeyFrame&&u.independent&&1===s.id&&!i&&(this.couldBacktrack=!0),u.dropped&&u.independent){const n=this.getMainFwdBufferInfo(),s=(n?n.end:this.getLoadPosition())+this.config.maxBufferHole,l=u.firstKeyFramePTS?u.firstKeyFramePTS:e;if(!t&&s<l-this.config.maxBufferHole&&!i)return void this.backtrack(a);i&&(a.gap=!0),a.setElementaryStreamInfo(u.type,a.start,r,a.start,o,!0)}a.setElementaryStreamInfo(u.type,e,r,n,o),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(u,a,l,s,t||i)}else{if(!t&&!i)return void this.backtrack(a);a.gap=!0}}if(g){const{startPTS:e,endPTS:t,startDTS:i,endDTS:r}=g;l&&(l.elementaryStreams[bn]={startPTS:e,endPTS:t,startDTS:i,endDTS:r}),a.setElementaryStreamInfo(bn,e,t,i,r),this.bufferFragmentData(g,a,l,s)}if(p&&null!=d&&null!=(t=d.samples)&&t.length){const e={id:i,frag:a,details:p,samples:d.samples};r.trigger(ln.FRAG_PARSING_METADATA,e)}if(p&&h){const e={id:i,frag:a,details:p,samples:h.samples};r.trigger(ln.FRAG_PARSING_USERDATA,e)}}}_bufferInitSegment(e,t,i,r){if(this.state!==ma)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:n,video:s,audiovideo:o}=t;if(n){let t=e.audioCodec;const i=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==n.metadata.channelCount&&-1===i.indexOf("firefox")&&(t="mp4a.40.5")),-1!==i.indexOf("android")&&"audio/mpeg"!==n.container&&(t="mp4a.40.2",this.log(`Android: force audio codec to ${t}`)),e.audioCodec&&e.audioCodec!==t&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${t}"`),n.levelCodec=t,n.id="main",this.log(`Init audio buffer, container:${n.container}, codecs[selected/level/parsed]=[${t||""}/${e.audioCodec||""}/${n.codec}]`)}s&&(s.levelCodec=e.videoCodec,s.id="main",this.log(`Init video buffer, container:${s.container}, codecs[level/parsed]=[${e.videoCodec||""}/${s.codec}]`)),o&&this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.attrs.CODECS||""}/${o.codec}]`),this.hls.trigger(ln.BUFFER_CODECS,t),Object.keys(t).forEach((e=>{const n=t[e].initSegment;null!=n&&n.byteLength&&this.hls.trigger(ln.BUFFER_APPENDING,{type:e,data:n,frag:i,part:null,chunkMeta:r,parent:i.type})})),this.tick()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,Zs)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ha}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const i=e.currentTime;if(ea.isBuffered(e,i)?t=this.getAppendedFrag(i):ea.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,i=t.level;e&&t.sn===e.sn&&e.level===i&&t.urlId===e.urlId||(this.fragPlaying=t,this.hls.trigger(ln.FRAG_CHANGED,{frag:t}),e&&e.level===i||this.hls.trigger(ln.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const t=e.currentTime,i=this.currentFrag;if(i&&an(t)&&an(i.programDateTime)){const e=i.programDateTime+1e3*(t-i.start);return new Date(e)}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Ll{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){const i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class Il{constructor(e,t,i,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ll(e),this.fast_=new Ll(t),this.defaultTTFB_=r,this.ttfb_=new Ll(e)}update(e,t){const{slow_:i,fast_:r,ttfb_:n}=this;i.halfLife!==e&&(this.slow_=new Ll(e,i.getEstimate(),i.getTotalWeight())),r.halfLife!==t&&(this.fast_=new Ll(t,r.getEstimate(),r.getTotalWeight())),n.halfLife!==e&&(this.ttfb_=new Ll(e,n.getEstimate(),n.getTotalWeight()))}sample(e,t){const i=(e=Math.max(e,this.minDelayMs_))/1e3,r=8*t/i;this.fast_.sample(i,r),this.slow_.sample(i,r)}sampleTTFB(e){const t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}class Pl{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let i;return e.length?(i=1===e.length?e[0]:function(e,t){const i=new Uint8Array(t);let r=0;for(let t=0;t<e.length;t++){const n=e[t];i.set(n,r),r+=n.length}return i}(e,t),this.reset(),i):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}function _l(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!Dl(e[i].attrs,t[i].attrs))return!1;return!0}function Dl(e,t){const i=e["STABLE-RENDITION-ID"];return i?i===t["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some((i=>e[i]!==t[i]))}class Ol{constructor(e){this.buffered=void 0;const t=(t,i,r)=>{if((i>>>=0)>r-1)throw new DOMException(`Failed to execute '${t}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${r})`);return e[i][t]};this.buffered={get length(){return e.length},end:i=>t("end",i,e.length),start:i=>t("start",i,e.length)}}}function Ml(e){const t=[];for(let i=0;i<e.length;i++){const r=e[i];"subtitles"!==r.kind&&"captions"!==r.kind||!r.label||t.push(e[i])}return t}class Fl{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t){const i=this.queues[t];i.push(e),1===i.length&&this.buffers[t]&&this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t;const i=new Promise((e=>{t=e})),r={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(r,e),i}executeNext(e){const{buffers:t,queues:i}=this,r=t[e],n=i[e];if(n.length){const t=n[0];try{t.execute()}catch(i){pn.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),t.onError(i),null!=r&&r.updating||(n.shift(),this.executeNext(e))}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const Nl=Is(),Bl=/([ha]vc.)(?:\.[^.,]+)+/,Ul={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},$l=function(e){let t=e;return Ul.hasOwnProperty(e)&&(t=Ul[e]),String.fromCharCode(t)},Hl=15,zl=100,jl={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Gl={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Vl={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},ql={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Wl=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Kl{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const i="function"==typeof t?t():t;pn.log(`${this.time} [${e}] ${i}`)}}}const Yl=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class Xl{constructor(e,t,i,r,n){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=i||!1,this.background=r||"black",this.flash=n||!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){const r=t[i];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Zl{constructor(e,t,i,r,n,s){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new Xl(t,i,r,n,s)}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class Ql{constructor(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(let e=0;e<zl;e++)this.chars.push(new Zl);this.logger=e,this.pos=0,this.currPenState=new Xl}equals(e){let t=!0;for(let i=0;i<zl;i++)if(!this.chars[i].equals(e.chars[i])){t=!1;break}return t}copy(e){for(let t=0;t<zl;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<zl;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>zl&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=zl)}moveCursor(e){const t=this.pos+e;if(e>1)for(let e=this.pos+1;e<t+1;e++)this.chars[e].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=$l(e);this.pos>=zl?this.logger.log(0,(()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!")):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<zl;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let i=0;i<zl;i++){const r=this.chars[i].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Jl{constructor(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(let t=0;t<Hl;t++)this.rows.push(new Ql(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}reset(){for(let e=0;e<Hl;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let i=0;i<Hl;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<Hl;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Hl;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,(()=>"pacData = "+JSON.stringify(e)));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let e=0;e<Hl;e++)this.rows[e].clear();const e=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){const r=i.rows[e].cueStartTime,n=this.logger.time;if(r&&null!==n&&r<n)for(let r=0;r<this.nrRollUpRows;r++)this.rows[t-this.nrRollUpRows+r+1].copy(i.rows[e+r])}}this.currRow=t;const i=this.rows[this.currRow];if(null!==e.indent){const t=e.indent,r=Math.max(t-1,0);i.setCursor(e.indent),e.color=i.chars[r].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,(()=>"bkgData = "+JSON.stringify(e))),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,(()=>this.getDisplayText()));const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let i="",r=-1;for(let i=0;i<Hl;i++){const n=this.rows[i].getTextString();n&&(r=i+1,e?t.push("Row "+r+": '"+n+"'"):t.push(n.trim()))}return t.length>0&&(i=e?"["+t.join(" | ")+"]":t.join("\n")),i}getTextAndFormat(){return this.rows}}class ec{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Jl(i),this.nonDisplayedMemory=new Jl(i),this.lastOutputScreen=new Jl(i),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,(()=>"MODE="+e)),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,(()=>t+": "+this.writeScreen.getDisplayText(!0))),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,(()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0))),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,(()=>"DISP: "+this.displayedMemory.getDisplayText()))}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{const i=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[i]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class tc{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;const r=new Kl;this.channels=[null,new ec(e,t,r),new ec(e+1,i,r)],this.cmdHistory={a:null,b:null},this.logger=r}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){let i,r,n,s=!1;this.logger.time=e;for(let e=0;e<t.length;e+=2)if(r=127&t[e],n=127&t[e+1],0!==r||0!==n){if(this.logger.log(3,"["+Yl([t[e],t[e+1]])+"] -> ("+Yl([r,n])+")"),i=this.parseCmd(r,n),i||(i=this.parseMidrow(r,n)),i||(i=this.parsePAC(r,n)),i||(i=this.parseBackgroundAttributes(r,n)),!i&&(s=this.parseChars(r,n),s)){const e=this.currentChannel;e&&e>0?this.channels[e].insertChars(s):this.logger.log(2,"No channel found yet. TEXT-MODE?")}i||s||this.logger.log(2,"Couldn't parse cleaned data "+Yl([r,n])+" orig: "+Yl([t[e],t[e+1]]))}}parseCmd(e,t){const{cmdHistory:i}=this;if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=33&&t<=35))return!1;if(rc(e,t,i))return ic(null,null,i),this.logger.log(3,"Repeated command ("+Yl([e,t])+") is dropped"),!0;const r=20===e||21===e||23===e?1:2,n=this.channels[r];return 20===e||21===e||28===e||29===e?32===t?n.ccRCL():33===t?n.ccBS():34===t?n.ccAOF():35===t?n.ccAON():36===t?n.ccDER():37===t?n.ccRU(2):38===t?n.ccRU(3):39===t?n.ccRU(4):40===t?n.ccFON():41===t?n.ccRDC():42===t?n.ccTR():43===t?n.ccRTD():44===t?n.ccEDM():45===t?n.ccCR():46===t?n.ccENM():47===t&&n.ccEOC():n.ccTO(t-32),ic(e,t,i),this.currentChannel=r,!0}parseMidrow(e,t){let i=0;if((17===e||25===e)&&t>=32&&t<=47){if(i=17===e?1:2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[i];return!!r&&(r.ccMIDROW(t),this.logger.log(3,"MIDROW ("+Yl([e,t])+")"),!0)}return!1}parsePAC(e,t){let i;const r=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(16===e||24===e)&&t>=64&&t<=95))return!1;if(rc(e,t,r))return ic(null,null,r),!0;const n=e<=23?1:2;i=t>=64&&t<=95?1===n?jl[e]:Vl[e]:1===n?Gl[e]:ql[e];const s=this.channels[n];return!!s&&(s.setPAC(this.interpretPAC(i,t)),ic(e,t,r),this.currentChannel=n,!0)}interpretPAC(e,t){let i;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return i=t>95?t-96:t-64,r.underline=1==(1&i),i<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((i-16)/2),r}parseChars(e,t){let i,r=null,n=null;if(e>=25?(i=2,n=e-8):(i=1,n=e),n>=17&&n<=19){let e;e=17===n?t+80:18===n?t+112:t+144,this.logger.log(2,"Special char '"+$l(e)+"' in channel "+i),r=[e]}else e>=32&&e<=127&&(r=0===t?[e]:[e,t]);if(r){const i=Yl(r);this.logger.log(3,"Char codes =  "+i.join(",")),ic(e,t,this.cmdHistory)}return r}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=45&&t<=47))return!1;let i;const r={};16===e||24===e?(i=Math.floor((t-32)/2),r.background=Wl[i],t%2==1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0));const n=e<=23?1:2;return this.channels[n].setBkgData(r),ic(e,t,this.cmdHistory),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const i=this.channels[t];i&&i.cueSplitAtTime(e)}}}function ic(e,t,i){i.a=e,i.b=t}function rc(e,t,i){return i.a===e&&i.b===t}class nc{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var sc=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;const e=["","lr","rl"],t=["start","middle","end","left","right"];function i(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;const i=t.toLowerCase();return!!~e.indexOf(i)&&i}function r(e){return i(t,e)}function n(e,...t){let i=1;for(;i<arguments.length;i++){const t=arguments[i];for(const i in t)e[i]=t[i]}return e}function s(t,s,o){const a=this,l={enumerable:!0};a.hasBeenReset=!1;let c="",u=!1,h=t,d=s,f=o,p=null,g="",m=!0,v="auto",y="start",w=50,E="middle",b=50,T="middle";Object.defineProperty(a,"id",n({},l,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(a,"pauseOnExit",n({},l,{get:function(){return u},set:function(e){u=!!e}})),Object.defineProperty(a,"startTime",n({},l,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"endTime",n({},l,{get:function(){return d},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"text",n({},l,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(a,"region",n({},l,{get:function(){return p},set:function(e){p=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"vertical",n({},l,{get:function(){return g},set:function(t){const r=function(t){return i(e,t)}(t);if(!1===r)throw new SyntaxError("An invalid or illegal string was specified.");g=r,this.hasBeenReset=!0}})),Object.defineProperty(a,"snapToLines",n({},l,{get:function(){return m},set:function(e){m=!!e,this.hasBeenReset=!0}})),Object.defineProperty(a,"line",n({},l,{get:function(){return v},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"lineAlign",n({},l,{get:function(){return y},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"position",n({},l,{get:function(){return w},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");w=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"positionAlign",n({},l,{get:function(){return E},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"size",n({},l,{get:function(){return b},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"align",n({},l,{get:function(){return T},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");T=t,this.hasBeenReset=!0}})),a.displayState=void 0}return s.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},s}();class oc{decode(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function ac(e){function t(e,t,i,r){return 3600*(0|e)+60*(0|t)+(0|i)+parseFloat(r||0)}const i=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return i?parseFloat(i[2])>59?t(i[2],i[3],0,i[4]):t(i[1],i[2],i[3],i[4]):null}class lc{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let r=0;r<i.length;++r)if(t===i[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function cc(e,t,i,r){const n=r?e.split(r):[e];for(const e in n){if("string"!=typeof n[e])continue;const r=n[e].split(i);2===r.length&&t(r[0],r[1])}}const uc=new sc(0,0,""),hc="middle"===uc.align?"middle":"center";function dc(e,t,i){const r=e;function n(){const t=ac(e);if(null===t)throw new Error("Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function s(){e=e.replace(/^\s+/,"")}if(s(),t.startTime=n(),s(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);e=e.slice(3),s(),t.endTime=n(),s(),function(e,t){const r=new lc;cc(e,(function(e,t){let n;switch(e){case"region":for(let n=i.length-1;n>=0;n--)if(i[n].id===t){r.set(e,i[n].region);break}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":n=t.split(","),r.integer(e,n[0]),r.percent(e,n[0])&&r.set("snapToLines",!1),r.alt(e,n[0],["auto"]),2===n.length&&r.alt("lineAlign",n[1],["start",hc,"end"]);break;case"position":n=t.split(","),r.percent(e,n[0]),2===n.length&&r.alt("positionAlign",n[1],["start",hc,"end","line-left","line-right","auto"]);break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start",hc,"end","left","right"])}}),/:/,/\s/),t.region=r.get("region",null),t.vertical=r.get("vertical","");let n=r.get("line","auto");"auto"===n&&-1===uc.line&&(n=-1),t.line=n,t.lineAlign=r.get("lineAlign","start"),t.snapToLines=r.get("snapToLines",!0),t.size=r.get("size",100),t.align=r.get("align",hc);let s=r.get("position","auto");"auto"===s&&50===uc.position&&(s="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=s}(e,t)}function fc(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class pc{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new oc,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function i(){let e=t.buffer,i=0;for(e=fc(e);i<e.length&&"\r"!==e[i]&&"\n"!==e[i];)++i;const r=e.slice(0,i);return"\r"===e[i]&&++i,"\n"===e[i]&&++i,t.buffer=e.slice(i),r}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=i();const r=e.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(null==r||!r[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let r=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(r?r=!1:e=i(),t.state){case"HEADER":/:/.test(e)?cc(e,(function(e,t){}),/:/):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new sc(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{dc(e,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const i=-1!==e.indexOf("--\x3e");if(!e||i&&(r=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const gc=/\r\n|\n\r|\n|\r/g,mc=function(e,t,i=0){return e.slice(i,i+t.length)===t},vc=function(e){let t=5381,i=e.length;for(;i;)t=33*t^e.charCodeAt(--i);return(t>>>0).toString()};function yc(e,t,i){return vc(e.toString())+vc(t.toString())+vc(i)}const wc="stpp.ttml.im1t",Ec=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,bc=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Tc={left:"start",center:"center",right:"end",start:"start",end:"end"};function Sc(e,t,i,r){const n=ds(new Uint8Array(e),["mdat"]);if(0===n.length)return void r(new Error("Could not parse IMSC1 mdat"));const s=n.map((e=>es(e))),o=function(e,t,i=1,r=!1){return sl(e,t,1/i,r)}(t.baseTime,1,t.timescale);try{s.forEach((e=>i(function(e,t){const i=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},n=Object.keys(r).reduce(((e,t)=>(e[t]=i.getAttribute(`ttp:${t}`)||r[t],e)),{}),s="preserve"!==i.getAttribute("xml:space"),o=Rc(xc(i,"styling","style")),a=Rc(xc(i,"layout","region")),l=xc(i,"body","[begin]");return[].map.call(l,(e=>{const i=Cc(e,s);if(!i||!e.hasAttribute("begin"))return null;const r=Lc(e.getAttribute("begin"),n),l=Lc(e.getAttribute("dur"),n);let c=Lc(e.getAttribute("end"),n);if(null===r)throw kc(e);if(null===c){if(null===l)throw kc(e);c=r+l}const u=new sc(r-t,c-t,i);u.id=yc(u.startTime,u.endTime,u.text);const h=function(e,t,i){const r="http://www.w3.org/ns/ttml#styling";let n=null;const s=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;return s&&i.hasOwnProperty(s)&&(n=i[s]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(((i,s)=>{const o=Ac(t,r,s)||Ac(e,r,s)||Ac(n,r,s);return o&&(i[s]=o),i}),{})}(a[e.getAttribute("region")],o[e.getAttribute("style")],o),{textAlign:d}=h;if(d){const e=Tc[d];e&&(u.lineAlign=e),u.align=d}return on(u,h),u})).filter((e=>null!==e))}(e,o))))}catch(e){r(e)}}function xc(e,t,i){const r=e.getElementsByTagName(t)[0];return r?[].slice.call(r.querySelectorAll(i)):[]}function Rc(e){return e.reduce(((e,t)=>{const i=t.getAttribute("xml:id");return i&&(e[i]=t),e}),{})}function Cc(e,t){return[].slice.call(e.childNodes).reduce(((e,i,r)=>{var n;return"br"===i.nodeName&&r?e+"\n":null!=(n=i.childNodes)&&n.length?Cc(i,t):t?e+i.textContent.trim().replace(/\s+/g," "):e+i.textContent}),"")}function Ac(e,t,i){return e&&e.hasAttributeNS(t,i)?e.getAttributeNS(t,i):null}function kc(e){return new Error(`Could not parse ttml timestamp ${e}`)}function Lc(e,t){if(!e)return null;let i=ac(e);return null===i&&(Ec.test(e)?i=function(e,t){const i=Ec.exec(e),r=(0|i[4])+(0|i[5])/t.subFrameRate;return 3600*(0|i[1])+60*(0|i[2])+(0|i[3])+r/t.frameRate}(e,t):bc.test(e)&&(i=function(e,t){const i=bc.exec(e),r=Number(i[1]);switch(i[2]){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/t.frameRate;case"t":return r/t.tickRate}return r}(e,t))),i}function Ic(e,t){return!!e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}class Pc{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(ln.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(ln.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(ln.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ln.BUFFER_CODECS,this.onBufferCodecs,this),e.on(ln.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(ln.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(ln.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(ln.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ln.BUFFER_CODECS,this.onBufferCodecs,this),e.off(ln.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null}onManifestParsed(e,t){const i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){const e=this.hls.levels;if(e.length){const t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const i=t.filter(((t,i)=>this.isLevelAllowed(t)&&i<=e));return this.clientRect=null,Pc.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,t.width||t.height||(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(e){}return e}isLevelAllowed(e){return!this.restrictedLevels.some((t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height))}static getMaxLevelByMediaSize(e,t,i){if(null==e||!e.length)return-1;let r=e.length-1;for(let o=0;o<e.length;o+=1){const a=e[o];if((a.width>=t||a.height>=i)&&(n=a,!(s=e[o+1])||n.width!==s.width||n.height!==s.height)){r=o;break}}var n,s;return r}}const _c="[eme]";class Dc{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=Dc.CDMCleanupPromise?[Dc.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=pn.debug.bind(pn,_c),this.log=pn.log.bind(pn,_c),this.warn=pn.warn.bind(pn,_c),this.error=pn.error.bind(pn,_c),this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(ln.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(ln.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(ln.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(ln.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(ln.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(ln.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(ln.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(ln.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:i}=this.config,r=t[e];if(r)return r.licenseUrl;if(e===In.WIDEVINE&&i)return i;throw new Error(`no license server URL configured for key-system "${e}"`)}getServerCertificateUrl(e){const{drmSystems:t}=this.config,i=t[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,i=(e,t,i)=>!!e&&i.indexOf(e)===t,r=t.map((e=>e.audioCodec)).filter(i),n=t.map((e=>e.videoCodec)).filter(i);return r.length+n.length===0&&n.push("avc1.42e01e"),new Promise(((t,i)=>{const s=e=>{const o=e.shift();this.getMediaKeysPromise(o,r,n).then((e=>t({keySystem:o,mediaKeys:e}))).catch((t=>{e.length?s(e):i(t instanceof Oc?t:new Oc({type:cn.KEY_SYSTEM_ERROR,details:un.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))}))};s(e)}))}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:i}=this.config;if("function"!=typeof i){let e=`Configured requestMediaKeySystemAccess is not a function ${i}`;return null===Un&&"http:"===self.location.protocol&&(e=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(e))}return i(e,t)}getMediaKeysPromise(e,t,i){const r=function(e,t,i,r){let n;switch(e){case In.FAIRPLAY:n=["cenc","sinf"];break;case In.WIDEVINE:case In.PLAYREADY:n=["cenc"];break;case In.CLEARKEY:n=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${e}`)}return function(e,t,i,r){return[{initDataTypes:e,persistentState:r.persistentState||"not-allowed",distinctiveIdentifier:r.distinctiveIdentifier||"not-allowed",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:t.map((e=>({contentType:`audio/mp4; codecs="${e}"`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null}))),videoCapabilities:i.map((e=>({contentType:`video/mp4; codecs="${e}"`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null})))}]}(n,t,i,r)}(e,t,i,this.config.drmSystemOptions),n=this.keySystemAccessPromises[e];let s=null==n?void 0:n.keySystemAccess;if(!s){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(r)}`),s=this.requestMediaKeySystemAccess(e,r);const t=this.keySystemAccessPromises[e]={keySystemAccess:s};return s.catch((t=>{this.log(`Failed to obtain access to key-system "${e}": ${t}`)})),s.then((i=>{this.log(`Access for key-system "${i.keySystem}" obtained`);const r=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),t.mediaKeys=i.createMediaKeys().then((t=>(this.log(`Media-keys created for "${e}"`),r.then((i=>i?this.setMediaKeysServerCertificate(t,e,i):t))))),t.mediaKeys.catch((t=>{this.error(`Failed to create media-keys for "${e}"}: ${t}`)})),t.mediaKeys}))}return s.then((()=>n.mediaKeys))}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:i}){this.log(`Creating key-system session "${t}" keyId: ${rs(e.keyId||[])}`);const r=i.createSession(),n={decryptdata:e,keySystem:t,mediaKeys:i,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(n),n}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const i=this.createMediaKeySessionContext(e),r=this.getKeyIdString(t),n="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(i,n,t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return rs(e.keyId)}updateKeySession(e,t){var i;const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyID ${rs((null==(i=e.decryptdata)?void 0:i.keyId)||[])}\n      } (data length: ${t?t.byteLength:t})`),r.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise(((t,i)=>{const r=Bn(this.config),n=e.map(Mn).filter((e=>!!e&&-1!==r.indexOf(e)));return this.getKeySystemSelectionPromise(n).then((({keySystem:e})=>{const r=Nn(e);r?t(r):i(new Error(`Unable to find format for key-system "${e}"`))})).catch(i)}))}loadKey(e){const t=e.keyInfo.decryptdata,i=this.getKeyIdString(t),r=`(keyId: ${i} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${r}`);let n=this.keyIdToKeySessionPromise[i];return n||(n=this.keyIdToKeySessionPromise[i]=this.getKeySystemForKeyPromise(t).then((({keySystem:i,mediaKeys:n})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${r}`),this.attemptSetMediaKeys(i,n).then((()=>{this.throwIfDestroyed();const e=this.createMediaKeySessionContext({keySystem:i,mediaKeys:n,decryptdata:t});return this.generateRequestWithPreferredKeySession(e,"cenc",t.pssh,"playlist-key")}))))),n.catch((e=>this.handleError(e)))),n}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof Oc?this.hls.trigger(ln.ERROR,e.data):this.hls.trigger(ln.ERROR,{type:cn.KEY_SYSTEM_ERROR,details:un.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),i=this.keyIdToKeySessionPromise[t];if(!i){const t=Mn(e.keyFormat),i=t?[t]:Bn(this.config);return this.attemptKeySystemAccess(i)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=Bn(this.config)),0===e.length)throw new Oc({type:cn.KEY_SYSTEM_ERROR,details:un.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}_onMediaEncrypted(e){const{initDataType:t,initData:i}=e;if(this.debug(`"${e.type}" event: init data type: "${t}"`),null===i)return;let r,n;if("sinf"===t&&this.config.drmSystems[In.FAIRPLAY]){const e=as(new Uint8Array(i));try{const t=kn(JSON.parse(e).sinf),i=gs(new Uint8Array(t));if(!i)return;r=i.subarray(8,24),n=In.FAIRPLAY}catch(e){return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{const e=function(e){if(!(e instanceof ArrayBuffer)||e.byteLength<32)return null;const t={version:0,systemId:"",kids:null,data:null},i=new DataView(e),r=i.getUint32(0);if(e.byteLength!==r&&r>44)return null;if(1886614376!==i.getUint32(4))return null;if(t.version=i.getUint32(8)>>>24,t.version>1)return null;t.systemId=rs(new Uint8Array(e,12,16));const n=i.getUint32(28);if(0===t.version){if(r-32<n)return null;t.data=new Uint8Array(e,32,n)}else if(1===t.version){t.kids=[];for(let i=0;i<n;i++)t.kids.push(new Uint8Array(e,32+16*i,16))}return t}(i);if(null===e)return;0===e.version&&e.systemId===Fn&&e.data&&(r=e.data.subarray(8,24)),n=function(e){if(e===Fn)return In.WIDEVINE}(e.systemId)}if(!n||!r)return;const s=rs(r),{keyIdToKeySessionPromise:o,mediaKeySessions:a}=this;let l=o[s];for(let e=0;e<a.length;e++){const n=a[e],c=n.decryptdata;if(c.pssh||!c.keyId)continue;const u=rs(c.keyId);if(s===u||-1!==c.uri.replace(/-/g,"").indexOf(s)){l=o[u],delete o[u],c.pssh=new Uint8Array(i),c.keyId=r,l=o[s]=l.then((()=>this.generateRequestWithPreferredKeySession(n,t,i,"encrypted-event-key-match")));break}}l||(l=o[s]=this.getKeySystemSelectionPromise([n]).then((({keySystem:e,mediaKeys:n})=>{var o;this.throwIfDestroyed();const a=new Ss("ISO-23001-7",s,null!=(o=Nn(e))?o:"");return a.pssh=new Uint8Array(i),a.keyId=r,this.attemptSetMediaKeys(e,n).then((()=>{this.throwIfDestroyed();const r=this.createMediaKeySessionContext({decryptdata:a,keySystem:e,mediaKeys:n});return this.generateRequestWithPreferredKeySession(r,t,i,"encrypted-event-no-match")}))}))),l.catch((e=>this.handleError(e)))}_onWaitingForKey(e){this.log(`"${e.type}" event`)}attemptSetMediaKeys(e,t){const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(i).then((()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)}));return this.setMediaKeysQueue.push(r),r.then((()=>{this.log(`Media-keys set for "${e}"`),i.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter((e=>-1===i.indexOf(e)))}))}generateRequestWithPreferredKeySession(e,t,i,r){var n,s;const o=null==(n=this.config.drmSystems)||null==(s=n[e.keySystem])?void 0:s.generateRequest;if(o)try{const r=o.call(this.hls,t,i,e);if(!r)throw new Error("Invalid response from configured generateRequest filter");t=r.initDataType,i=e.decryptdata.pssh=r.initData?new Uint8Array(r.initData):null}catch(e){var a;if(this.warn(e.message),null!=(a=this.hls)&&a.config.debug)throw e}if(null===i)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const l=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${r}": ${l} (init data type: ${t} length: ${i?i.byteLength:null})`);const c=new xl;e.mediaKeysSession.onmessage=t=>{const i=e.mediaKeysSession;if(!i)return void c.emit("error",new Error("invalid state"));const{messageType:r,message:n}=t;this.log(`"${r}" message event for session "${i.sessionId}" message size: ${n.byteLength}`),"license-request"===r||"license-renewal"===r?this.renewLicense(e,n).catch((e=>{this.handleError(e),c.emit("error",e)})):"license-release"===r?e.keySystem===In.FAIRPLAY&&(this.updateKeySession(e,Ln("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${r}"`)},e.mediaKeysSession.onkeystatuseschange=t=>{if(!e.mediaKeysSession)return void c.emit("error",new Error("invalid state"));this.onKeyStatusChange(e);const i=e.keyStatus;c.emit("keyStatus",i),"expired"===i&&(this.warn(`${e.keySystem} expired for key ${l}`),this.renewKeySession(e))};const u=new Promise(((e,t)=>{c.on("error",t),c.on("keyStatus",(i=>{i.startsWith("usable")?e():"output-restricted"===i?t(new Oc({type:cn.KEY_SYSTEM_ERROR,details:un.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===i?t(new Oc({type:cn.KEY_SYSTEM_ERROR,details:un.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${i}"`)):"expired"===i?t(new Error("key expired while generating request")):this.warn(`unhandled key status change "${i}"`)}))}));return e.mediaKeysSession.generateRequest(t,i).then((()=>{var t;this.log(`Request generated for key-session "${null==(t=e.mediaKeysSession)?void 0:t.sessionId}" keyId: ${l}`)})).catch((e=>{throw new Oc({type:cn.KEY_SYSTEM_ERROR,details:un.KEY_SYSTEM_NO_SESSION,error:e,fatal:!1},`Error generating key-session request: ${e}`)})).then((()=>u)).catch((t=>{throw c.removeAllListeners(),this.removeSession(e),t})).then((()=>(c.removeAllListeners(),e)))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach(((t,i)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${rs("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${rs(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t}))}fetchServerCertificate(e){const t=this.config,i=new(0,t.loader)(t),r=this.getServerCertificateUrl(e);return r?(this.log(`Fetching serverCertificate for "${e}"`),new Promise(((n,s)=>{const o={responseType:"arraybuffer",url:r},a=t.certLoadPolicy.default,l={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,i,r)=>{n(e.data)},onError:(t,i,n,a)=>{s(new Oc({type:cn.KEY_SYSTEM_ERROR,details:un.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:n,response:nn({url:o.url,data:void 0},t)},`"${e}" certificate request failed (${r}). Status: ${t.code} (${t.text})`))},onTimeout:(t,i,n)=>{s(new Oc({type:cn.KEY_SYSTEM_ERROR,details:un.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:n,response:{url:o.url,data:void 0}},`"${e}" certificate request timed out (${r})`))},onAbort:(e,t,i)=>{s(new Error("aborted"))}};i.load(o,l,c)}))):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise(((r,n)=>{e.setServerCertificate(i).then((n=>{this.log(`setServerCertificate ${n?"success":"not supported by CDM"} (${null==i?void 0:i.byteLength}) on "${t}"`),r(e)})).catch((e=>{n(new Oc({type:cn.KEY_SYSTEM_ERROR,details:un.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))}))}))}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then((t=>this.updateKeySession(e,new Uint8Array(t)).catch((e=>{throw new Oc({type:cn.KEY_SYSTEM_ERROR,details:un.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:e,fatal:!0},e.message)}))))}setupLicenseXHR(e,t,i,r){const n=this.config.licenseXhrSetup;return n?Promise.resolve().then((()=>{if(!i.decryptdata)throw new Error("Key removed");return n.call(this.hls,e,t,i,r)})).catch((s=>{if(!i.decryptdata)throw s;return e.open("POST",t,!0),n.call(this.hls,e,t,i,r)})).then((i=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:i||r}))):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const i=this.config.keyLoadPolicy.default;return new Promise(((r,n)=>{const s=this.getLicenseServerUrl(e.keySystem);this.log(`Sending license request to URL: ${s}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return n(new Error("invalid state"));if(4===o.readyState)if(200===o.status){this._requestLicenseFailureCount=0;let t=o.response;this.log(`License received ${t instanceof ArrayBuffer?t.byteLength:t}`);const i=this.config.licenseResponseCallback;if(i)try{t=i.call(this.hls,o,s,e)}catch(e){this.error(e)}r(t)}else{const a=i.errorRetry,l=a?a.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||o.status>=400&&o.status<500)n(new Oc({type:cn.KEY_SYSTEM_ERROR,details:un.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:o,response:{url:s,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${s}). Status: ${o.status} (${o.statusText})`));else{const i=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${i} attempts left`),this.requestLicense(e,t).then(r,n)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,s,e,t).then((({xhr:e,licenseChallenge:t})=>{e.send(t)}))}))}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const i=t.media;this.media=i,i.addEventListener("encrypted",this.onMediaEncrypted),i.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Ss.clearKeyUriToKeyIdMap();const i=t.length;Dc.CDMCleanupPromise=Promise.all(t.map((e=>this.removeSession(e))).concat(null==e?void 0:e.setMediaKeys(null).catch((t=>{this.log(`Could not clear media keys: ${t}. media.src: ${null==e?void 0:e.src}`)})))).then((()=>{i&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)})).catch((t=>{this.log(`Could not close sessions and clear media keys: ${t}. media.src: ${null==e?void 0:e.src}`)}))}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(t&&this.config.emeEnabled&&!this.keyFormatPromise){const e=t.reduce(((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e)),[]);this.log(`Selecting key-system from session-keys ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:i}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),t.onmessage=null,t.onkeystatuseschange=null,i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);return r>-1&&this.mediaKeySessions.splice(r,1),t.remove().catch((e=>{this.log(`Could not remove session: ${e}`)})).then((()=>t.close())).catch((e=>{this.log(`Could not close session: ${e}`)}))}}}Dc.CDMCleanupPromise=void 0;class Oc extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}var Mc="a",Fc="av";class Nc{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:"m",su:!this.initialized})}catch(e){pn.warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=e=>{try{const t=e.frag,i=this.hls.levels[t.level],r=this.getObjectType(t),n={d:1e3*t.duration,ot:r};"v"!==r&&r!==Mc&&r!=Fc||(n.br=i.bitrate/1e3,n.tb=this.getTopBandwidth(r)/1e3,n.bl=this.getBufferLength(r)),this.apply(e,n)}catch(e){pn.warn("Could not generate segment CMCD data.",e)}},this.hls=e;const t=this.config=e.config,{cmcd:i}=t;null!=i&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||Nc.uuid(),this.cid=i.contentId,this.useHeaders=!0===i.useHeaders,this.registerListeners())}registerListeners(){const e=this.hls;e.on(ln.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ln.MEDIA_DETACHED,this.onMediaDetached,this),e.on(ln.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(ln.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ln.MEDIA_DETACHED,this.onMediaDetached,this),e.off(ln.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,r;this.audioBuffer=null==(i=t.tracks.audio)?void 0:i.buffer,this.videoBuffer=null==(r=t.tracks.video)?void 0:r.buffer}createData(){var e;return{v:1,sf:"h",sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){on(t,this.createData());const i="i"===t.ot||"v"===t.ot||t.ot===Fc;if(this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering),this.useHeaders){const i=Nc.toHeaders(t);if(!Object.keys(i).length)return;e.headers||(e.headers={}),on(e.headers,i)}else{const i=Nc.toQuery(t);if(!i)return;e.url=Nc.appendQueryToUri(e.url,i)}}getObjectType(e){const{type:t}=e;return"subtitle"===t?"tt":"initSegment"===e.sn?"i":"audio"===t?Mc:"main"===t?this.hls.audioTracks.length?"v":Fc:void 0}getTopBandwidth(e){let t,i=0;const r=this.hls;if(e===Mc)t=r.audioTracks;else{const e=r.maxAutoLevel,i=e>-1?e+1:r.levels.length;t=r.levels.slice(0,i)}for(const e of t)e.bitrate>i&&(i=e.bitrate);return i>0?i:NaN}getBufferLength(e){const t=this.hls.media,i=e===Mc?this.audioBuffer:this.videoBuffer;return i&&t?1e3*ea.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len:NaN}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new i(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,i,r){t(e),this.loader.load(e,i,r)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new i(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,i,r){t(e),this.loader.load(e,i,r)}}}static uuid(){const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}static serialize(e){const t=[],i=e=>!Number.isNaN(e)&&null!=e&&""!==e&&!1!==e,r=e=>Math.round(e),n=e=>100*r(e/100),s={br:r,d:r,bl:n,dl:n,mtp:n,nor:e=>encodeURIComponent(e),rtp:n,tb:r},o=Object.keys(e||{}).sort();for(const r of o){let n=e[r];if(!i(n))continue;if("v"===r&&1===n)continue;if("pr"==r&&1===n)continue;const o=s[r];o&&(n=o(n));const a=typeof n;let l;l="ot"===r||"sf"===r||"st"===r?`${r}=${n}`:"boolean"===a?r:"number"===a?`${r}=${n}`:`${r}=${JSON.stringify(n)}`,t.push(l)}return t.join(",")}static toHeaders(e){const t=Object.keys(e),i={},r=["Object","Request","Session","Status"],n=[{},{},{},{}],s={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(const i of t)n[null!=s[i]?s[i]:1][i]=e[i];for(let e=0;e<n.length;e++){const t=Nc.serialize(n[e]);t&&(i[`CMCD-${r[e]}`]=t)}return i}static toQuery(e){return`CMCD=${encodeURIComponent(Nc.serialize(e))}`}static appendQueryToUri(e,t){if(!t)return e;const i=e.includes("?")?"&":"?";return`${e}${i}${t}`}}function Bc(e,t,i,r){e&&Object.keys(t).forEach((n=>{const s=e.filter((e=>e.groupId===n)).map((e=>{const s=on({},e);return s.details=void 0,s.attrs=new vn(s.attrs),s.url=s.attrs.URI=Uc(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",i),s.groupId=s.attrs["GROUP-ID"]=t[n],s.attrs["PATHWAY-ID"]=r,s}));e.push(...s)}))}function Uc(e,t,i,r){const{HOST:n,PARAMS:s,[i]:o}=r;let a;t&&(a=null==o?void 0:o[t],a&&(e=a));const l=new self.URL(e);return n&&!a&&(l.host=n),s&&Object.keys(s).sort().forEach((e=>{e&&l.searchParams.set(e,s[e])})),l.href}const $c=/^age:\s*[\d.]+\s*$/im;class Hc{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new En,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e)return;const i=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const n=this.xhrSetup;n?Promise.resolve().then((()=>{if(!this.stats.aborted)return n(i,t.url)})).catch((e=>(i.open("GET",t.url,!0),n(i,t.url)))).then((()=>{this.stats.aborted||this.openAndSendXhr(i,t,e)})).catch((e=>{this.callbacks.onError({code:i.status,text:e.message},t,i,r)})):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);const r=this.context.headers,{maxTimeToFirstByteMs:n,maxLoadTimeMs:s}=i.loadPolicy;if(r)for(const t in r)e.setRequestHeader(t,r[t]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=n&&an(n)?n:s,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:i}=this;if(!e||!t)return;const r=t.readyState,n=this.config;if(!i.aborted&&r>=2&&(0===i.loading.first&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),n.timeout!==n.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),n.timeout=n.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),4===r)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const r=t.status,s="text"!==t.responseType;if(r>=200&&r<300&&(s&&t.response||null!==t.responseText)){i.loading.end=Math.max(self.performance.now(),i.loading.first);const n=s?t.response:t.responseText,o="arraybuffer"===t.responseType?n.byteLength:n.length;if(i.loaded=i.total=o,i.bwEstimate=8e3*i.total/(i.loading.end-i.loading.first),!this.callbacks)return;const a=this.callbacks.onProgress;if(a&&a(i,e,n,t),!this.callbacks)return;const l={url:t.responseURL,data:n,code:r};this.callbacks.onSuccess(l,i,e,t)}else{const s=n.loadPolicy.errorRetry;ko(s,i.retry,!1,r)?this.retry(s):(pn.error(`${r} while loading ${e.url}`),this.callbacks.onError({code:r,text:t.statusText},e,t,i))}}}loadtimeout(){var e;const t=null==(e=this.config)?void 0:e.loadPolicy.timeoutRetry;if(ko(t,this.stats.retry,!0))this.retry(t);else{pn.warn(`timeout while loading ${this.context.url}`);const e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:i}=this;this.retryDelay=Co(e,i.retry),i.retry++,pn.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&$c.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const zc=/(\d+)-(\d+)\/(\d+)/;class jc{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Gc,this.controller=new self.AbortController,this.stats=new En}destroy(){this.loader=this.callbacks=null,this.abortInternal()}abortInternal(){const e=this.response;null!=e&&e.ok||(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const n=function(e,t){const i={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(on({},e.headers))};return e.rangeEnd&&i.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)),i}(e,this.controller.signal),s=i.onProgress,o="arraybuffer"===e.responseType,a=o?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,n),self.clearTimeout(this.requestTimeout),t.timeout=l&&an(l)?l:c,this.requestTimeout=self.setTimeout((()=>{this.abortInternal(),i.onTimeout(r,e,this.response)}),t.timeout),self.fetch(this.request).then((n=>{this.response=this.loader=n;const a=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout((()=>{this.abortInternal(),i.onTimeout(r,e,this.response)}),c-(a-r.loading.start)),!n.ok){const{status:e,statusText:t}=n;throw new Vc(t||"fetch, bad network response",e,n)}return r.loading.first=a,r.total=function(e){const t=e.get("Content-Range");if(t){const e=function(e){const t=zc.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(an(e))return e}const i=e.get("Content-Length");if(i)return parseInt(i)}(n.headers)||r.total,s&&an(t.highWaterMark)?this.loadProgressively(n,r,e,t.highWaterMark,s):o?n.arrayBuffer():"json"===e.responseType?n.json():n.text()})).then((n=>{const{response:o}=this;self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const l=n[a];l&&(r.loaded=r.total=l);const c={url:o.url,data:n,code:o.status};s&&!an(t.highWaterMark)&&s(r,e,n,o),i.onSuccess(c,r,e,o)})).catch((t=>{if(self.clearTimeout(this.requestTimeout),r.aborted)return;const n=t&&t.code||0,s=t?t.message:null;i.onError({code:n,text:s},e,t?t.details:null,r)}))}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,r=0,n){const s=new Pl,o=e.body.getReader(),a=()=>o.read().then((o=>{if(o.done)return s.dataLength&&n(t,i,s.flush(),e),Promise.resolve(new ArrayBuffer(0));const l=o.value,c=l.length;return t.loaded+=c,c<r||s.dataLength?(s.push(l),s.dataLength>=r&&n(t,i,s.flush(),e)):n(t,i,l,e),a()})).catch((()=>Promise.reject()));return a()}}function Gc(e,t){return new self.Request(e.url,t)}class Vc extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}const qc=/\s/,Wc={newCue(e,t,i,r){const n=[];let s,o,a,l,c;const u=self.VTTCue||self.TextTrackCue;for(let d=0;d<r.rows.length;d++)if(s=r.rows[d],a=!0,l=0,c="",!s.isEmpty()){var h;for(let e=0;e<s.chars.length;e++)qc.test(s.chars[e].uchar)&&a?l++:(c+=s.chars[e].uchar,a=!1);s.cueStartTime=t,t===i&&(i+=1e-4),l>=16?l--:l++;const r=fc(c.trim()),f=yc(t,i,r);null!=e&&null!=(h=e.cues)&&h.getCueById(f)||(o=new u(t,i,r),o.id=f,o.line=d+1,o.align="left",o.position=10+Math.min(80,10*Math.floor(8*l/32)),n.push(o))}return e&&n.length&&(n.sort(((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line)),n.forEach((t=>no(e,t)))),n}},Kc=nn(nn({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Hc,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;const t=e.config;this.bwEstimator=new Il(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(ln.FRAG_LOADING,this.onFragLoading,this),e.on(ln.FRAG_LOADED,this.onFragLoaded,this),e.on(ln.FRAG_BUFFERED,this.onFragBuffered,this),e.on(ln.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(ln.LEVEL_LOADED,this.onLevelLoaded,this)}unregisterListeners(){const{hls:e}=this;e.off(ln.FRAG_LOADING,this.onFragLoading,this),e.off(ln.FRAG_LOADED,this.onFragLoaded,this),e.off(ln.FRAG_BUFFERED,this.onFragBuffered,this),e.off(ln.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(ln.LEVEL_LOADED,this.onLevelLoaded,this)}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}onFragLoading(e,t){var i;const r=t.frag;this.ignoreFragment(r)||(this.fragCurrent=r,this.partCurrent=null!=(i=t.part)?i:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}onLevelSwitching(e,t){this.clearTimer()}getTimeToLoadFrag(e,t,i,r){return e+i/t+(r?this.lastLevelLoadSec:0)}onLevelLoaded(e,t){const i=this.hls.config,{total:r,bwEstimate:n}=t.stats;an(r)&&an(n)&&(this.lastLevelLoadSec=8*r/n),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD)}_abandonRulesCheck(){const{fragCurrent:e,partCurrent:t,hls:i}=this,{autoLevelEnabled:r,media:n}=i;if(!e||!n)return;const s=performance.now(),o=t?t.stats:e.stats,a=t?t.duration:e.duration,l=s-o.loading.start;if(o.aborted||o.loaded&&o.loaded===o.total||0===e.level)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!r||n.paused||!n.playbackRate||!n.readyState)return;const c=i.mainForwardBufferInfo;if(null===c)return;const u=this.bwEstimator.getEstimateTTFB(),h=Math.abs(n.playbackRate);if(l<=Math.max(u,a/(2*h)*1e3))return;const d=c.len/h;if(d>=2*a/h)return;const f=o.loading.first?o.loading.first-o.loading.start:-1,p=o.loaded&&f>-1,g=this.bwEstimator.getEstimate(),{levels:m,minAutoLevel:v}=i,y=m[e.level],w=o.total||Math.max(o.loaded,Math.round(a*y.maxBitrate/8));let E=l-f;E<1&&p&&(E=Math.min(l,8*o.loaded/g));const b=p?1e3*o.loaded/E:0,T=b?(w-o.loaded)/b:8*w/g+u/1e3;if(T<=d)return;const S=b?8*b:g;let x,R=Number.POSITIVE_INFINITY;for(x=e.level-1;x>v;x--){const e=m[x].maxBitrate;if(R=this.getTimeToLoadFrag(u/1e3,S,a*e,!m[x].details),R<d)break}R>=T||R>10*a||(i.nextLoadLevel=x,p?this.bwEstimator.sample(l-Math.min(u,f),o.loaded):this.bwEstimator.sampleTTFB(l),this.clearTimer(),pn.warn(`[abr] Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} is loading too slowly;\n      Time to underbuffer: ${d.toFixed(3)} s\n      Estimated load time for current fragment: ${T.toFixed(3)} s\n      Estimated load time for down switch fragment: ${R.toFixed(3)} s\n      TTFB estimate: ${f}\n      Current BW estimate: ${an(g)?(g/1024).toFixed(3):"Unknown"} Kb/s\n      New BW estimate: ${(this.bwEstimator.getEstimate()/1024).toFixed(3)} Kb/s\n      Aborting and switching to level ${x}`),e.loader&&(this.fragCurrent=this.partCurrent=null,e.abortRequests()),i.trigger(ln.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:o}))}onFragLoaded(e,{frag:t,part:i}){const r=i?i.stats:t.stats;if(t.type===Zs&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){const e=i?i.duration:t.duration,n=this.hls.levels[t.level],s=(n.loaded?n.loaded.bytes:0)+r.loaded,o=(n.loaded?n.loaded.duration:0)+e;n.loaded={bytes:s,duration:o},n.realBitrate=Math.round(8*s/o)}if(t.bitrateTest){const e={stats:r,frag:t,part:i,id:t.type};this.onFragBuffered(ln.FRAG_BUFFERED,e),t.bitrateTest=!1}}}onFragBuffered(e,t){const{frag:i,part:r}=t,n=null!=r&&r.stats.loaded?r.stats:i.stats;if(n.aborted)return;if(this.ignoreFragment(i))return;const s=n.parsing.end-n.loading.start-Math.min(n.loading.first-n.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(s,n.loaded),n.bwEstimate=this.bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Zs||"initSegment"===e.sn}clearTimer(){self.clearInterval(this.timer)}get nextAutoLevel(){const e=this._nextAutoLevel,t=this.bwEstimator;if(-1!==e&&!t.canEstimate())return e;let i=this.getNextABRAutoLevel();if(-1!==e){const t=this.hls.levels;if(t.length>Math.max(e,i)&&t[e].loadError<=t[i].loadError)return e}return-1!==e&&(i=Math.min(e,i)),i}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:i}=this,{maxAutoLevel:r,config:n,minAutoLevel:s,media:o}=i,a=t?t.duration:e?e.duration:0,l=o&&0!==o.playbackRate?Math.abs(o.playbackRate):1,c=this.bwEstimator?this.bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,u=i.mainForwardBufferInfo,h=(u?u.len:0)/l;let d=this.findBestLevel(c,s,r,h,n.abrBandWidthFactor,n.abrBandWidthUpFactor);if(d>=0)return d;pn.trace(`[abr] ${h?"rebuffering expected":"buffer is empty"}, finding optimal quality level`);let f=a?Math.min(a,n.maxStarvationDelay):n.maxStarvationDelay,p=n.abrBandWidthFactor,g=n.abrBandWidthUpFactor;if(!h){const e=this.bitrateTestDelay;e&&(f=(a?Math.min(a,n.maxLoadingDelay):n.maxLoadingDelay)-e,pn.trace(`[abr] bitrate test took ${Math.round(1e3*e)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),p=g=1)}return d=this.findBestLevel(c,s,r,h+f,p,g),Math.max(d,0)}findBestLevel(e,t,i,r,n,s){var o;const{fragCurrent:a,partCurrent:l,lastLoadedFragLevel:c}=this,{levels:u}=this.hls,h=u[c],d=!(null==h||null==(o=h.details)||!o.live),f=null==h?void 0:h.codecSet,p=l?l.duration:a?a.duration:0,g=this.bwEstimator.getEstimateTTFB()/1e3;let m=t,v=-1;for(let o=i;o>=t;o--){const t=u[o];if(!t||f&&t.codecSet!==f){t&&(m=Math.min(o,m),v=Math.max(o,v));continue}-1!==v&&pn.trace(`[abr] Skipped level(s) ${m}-${v} with CODECS:"${u[v].attrs.CODECS}"; not compatible with "${h.attrs.CODECS}"`);const i=t.details,a=(l?null==i?void 0:i.partTarget:null==i?void 0:i.averagetargetduration)||p;let y;y=o<=c?n*e:s*e;const w=u[o].maxBitrate,E=this.getTimeToLoadFrag(g,y,w*a,void 0===i);if(pn.trace(`[abr] level:${o} adjustedbw-bitrate:${Math.round(y-w)} avgDuration:${a.toFixed(1)} maxFetchDuration:${r.toFixed(1)} fetchDuration:${E.toFixed(1)}`),y>w&&(0===E||!an(E)||d&&!this.bitrateTestDelay||E<r))return o}return-1}set nextAutoLevel(e){this._nextAutoLevel=e}},bufferController:class{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=()=>{const{media:e,mediaSource:t}=this;pn.log("[buffer-controller]: Media source opened"),e&&(e.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(ln.MEDIA_ATTACHED,{media:e})),t&&t.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{pn.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=()=>{pn.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=()=>{const{media:e,_objectUrl:t}=this;e&&e.src!==t&&pn.error(`Media element src was set while attaching MediaSource (${t} > ${e.src})`)},this.hls=e,this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}registerListeners(){const{hls:e}=this;e.on(ln.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(ln.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ln.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ln.BUFFER_RESET,this.onBufferReset,this),e.on(ln.BUFFER_APPENDING,this.onBufferAppending,this),e.on(ln.BUFFER_CODECS,this.onBufferCodecs,this),e.on(ln.BUFFER_EOS,this.onBufferEos,this),e.on(ln.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(ln.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(ln.FRAG_PARSED,this.onFragParsed,this),e.on(ln.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(ln.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(ln.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ln.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ln.BUFFER_RESET,this.onBufferReset,this),e.off(ln.BUFFER_APPENDING,this.onBufferAppending,this),e.off(ln.BUFFER_CODECS,this.onBufferCodecs,this),e.off(ln.BUFFER_EOS,this.onBufferEos,this),e.off(ln.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(ln.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(ln.FRAG_PARSED,this.onFragParsed,this),e.off(ln.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new Fl(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,pn.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){const i=this.media=t.media;if(i&&Nl){const e=this.mediaSource=new Nl;e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),i.src=self.URL.createObjectURL(e),this._objectUrl=i.src,i.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:t,_objectUrl:i}=this;if(t){if(pn.log("[buffer-controller]: media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(e){pn.warn(`[buffer-controller]: onMediaDetaching: ${e.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),i&&self.URL.revokeObjectURL(i),e.src===i?(e.removeAttribute("src"),e.load()):pn.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(ln.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach((e=>{const t=this.sourceBuffer[e];try{t&&(this.removeBufferListeners(e),this.mediaSource&&this.mediaSource.removeSourceBuffer(t),this.sourceBuffer[e]=void 0)}catch(t){pn.warn(`[buffer-controller]: Failed to reset the ${e} buffer`,t)}})),this._initSourceBuffer()}onBufferCodecs(e,t){const i=this.getSourceBufferTypes().length;Object.keys(t).forEach((e=>{if(i){const i=this.tracks[e];if(i&&"function"==typeof i.buffer.changeType){const{id:r,codec:n,levelCodec:s,container:o,metadata:a}=t[e],l=(i.levelCodec||i.codec).replace(Bl,"$1"),c=(s||n).replace(Bl,"$1");if(l!==c){const t=`${o};codecs=${s||n}`;this.appendChangeType(e,t),pn.log(`[buffer-controller]: switching codec ${l} to ${c}`),this.tracks[e]={buffer:i.buffer,codec:n,container:o,levelCodec:s,metadata:a,id:r}}}}else this.pendingTracks[e]=t[e]})),i||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())}appendChangeType(e,t){const{operationQueue:i}=this,r={execute:()=>{const r=this.sourceBuffer[e];r&&(pn.log(`[buffer-controller]: changing ${e} sourceBuffer type to ${t}`),r.changeType(t)),i.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{pn.warn(`[buffer-controller]: Failed to change ${e} SourceBuffer type`,t)}};i.append(r,e)}onBufferAppending(e,t){const{hls:i,operationQueue:r,tracks:n}=this,{data:s,type:o,frag:a,part:l,chunkMeta:c}=t,u=c.buffering[o],h=self.performance.now();u.start=h;const d=a.stats.buffering,f=l?l.stats.buffering:null;0===d.start&&(d.start=h),f&&0===f.start&&(f.start=h);const p=n.audio;let g=!1;"audio"===o&&"audio/mpeg"===(null==p?void 0:p.container)&&(g=!this.lastMpegAudioChunk||1===c.id||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const m=a.start,v={execute:()=>{if(u.executeStart=self.performance.now(),g){const e=this.sourceBuffer[o];if(e){const t=m-e.timestampOffset;Math.abs(t)>=.1&&(pn.log(`[buffer-controller]: Updating audio SourceBuffer timestampOffset to ${m} (delta: ${t}) sn: ${a.sn})`),e.timestampOffset=m)}}this.appendExecutor(s,o)},onStart:()=>{},onComplete:()=>{const e=self.performance.now();u.executeEnd=u.end=e,0===d.first&&(d.first=e),f&&0===f.first&&(f.first=e);const{sourceBuffer:t}=this,i={};for(const e in t)i[e]=ea.getBuffered(t[e]);this.appendError=0,this.hls.trigger(ln.BUFFER_APPENDED,{type:o,frag:a,part:l,chunkMeta:c,parent:a.type,timeRanges:i})},onError:e=>{pn.error(`[buffer-controller]: Error encountered while trying to append to the ${o} SourceBuffer`,e);const t={type:cn.MEDIA_ERROR,parent:a.type,details:un.BUFFER_APPEND_ERROR,frag:a,part:l,chunkMeta:c,error:e,err:e,fatal:!1};e.code===DOMException.QUOTA_EXCEEDED_ERR?t.details=un.BUFFER_FULL_ERROR:(this.appendError++,t.details=un.BUFFER_APPEND_ERROR,this.appendError>i.config.appendErrorMaxRetry&&(pn.error(`[buffer-controller]: Failed ${i.config.appendErrorMaxRetry} times to append segment in sourceBuffer`),t.fatal=!0)),i.trigger(ln.ERROR,t)}};r.append(v,o)}onBufferFlushing(e,t){const{operationQueue:i}=this,r=e=>({execute:this.removeExecutor.bind(this,e,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(ln.BUFFER_FLUSHED,{type:e})},onError:t=>{pn.warn(`[buffer-controller]: Failed to remove from ${e} SourceBuffer`,t)}});t.type?i.append(r(t.type),t.type):this.getSourceBufferTypes().forEach((e=>{i.append(r(e),e)}))}onFragParsed(e,t){const{frag:i,part:r}=t,n=[],s=r?r.elementaryStreams:i.elementaryStreams;s[Sn]?n.push("audiovideo"):(s[bn]&&n.push("audio"),s[Tn]&&n.push("video")),0===n.length&&pn.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers((()=>{const e=self.performance.now();i.stats.buffering.end=e,r&&(r.stats.buffering.end=e);const t=r?r.stats:i.stats;this.hls.trigger(ln.FRAG_BUFFERED,{frag:i,part:r,stats:t,id:i.type})}),n)}onFragChanged(e,t){this.flushBackBuffer()}onBufferEos(e,t){this.getSourceBufferTypes().reduce(((e,i)=>{const r=this.sourceBuffer[i];return!r||t.type&&t.type!==i||(r.ending=!0,r.ended||(r.ended=!0,pn.log(`[buffer-controller]: ${i} sourceBuffer now EOS`))),e&&!(r&&!r.ended)}),!0)&&(pn.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers((()=>{this.getSourceBufferTypes().forEach((e=>{const t=this.sourceBuffer[e];t&&(t.ending=!1)}));const{mediaSource:e}=this;e&&"open"===e.readyState?(pn.log("[buffer-controller]: Calling mediaSource.endOfStream()"),e.endOfStream()):e&&pn.info(`[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: ${e.readyState}`)})))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}flushBackBuffer(){const{hls:e,details:t,media:i,sourceBuffer:r}=this;if(!i||null===t)return;const n=this.getSourceBufferTypes();if(!n.length)return;const s=t.live&&null!==e.config.liveBackBufferLength?e.config.liveBackBufferLength:e.config.backBufferLength;if(!an(s)||s<0)return;const o=i.currentTime,a=t.levelTargetDuration,l=Math.max(s,a),c=Math.floor(o/a)*a-l;n.forEach((i=>{const n=r[i];if(n){const r=ea.getBuffered(n);if(r.length>0&&c>r.start(0)){if(e.trigger(ln.BACK_BUFFER_REACHED,{bufferEnd:c}),t.live)e.trigger(ln.LIVE_BACK_BUFFER_REACHED,{bufferEnd:c});else if(n.ended&&r.end(r.length-1)-o<2*a)return void pn.info(`[buffer-controller]: Cannot flush ${i} back buffer while SourceBuffer is in ended state`);e.trigger(ln.BUFFER_FLUSHING,{startOffset:0,endOffset:c,type:i})}}}))}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||"open"!==this.mediaSource.readyState)return;const{details:e,hls:t,media:i,mediaSource:r}=this,n=e.fragments[0].start+e.totalduration,s=i.duration,o=an(r.duration)?r.duration:0;e.live&&t.config.liveDurationInfinity?(pn.log("[buffer-controller]: Media Source duration is set to Infinity"),r.duration=1/0,this.updateSeekableRange(e)):(n>o&&n>s||!an(s))&&(pn.log(`[buffer-controller]: Updating Media Source duration to ${n.toFixed(3)}`),r.duration=n)}updateSeekableRange(e){const t=this.mediaSource,i=e.fragments;if(i.length&&e.live&&null!=t&&t.setLiveSeekableRange){const r=Math.max(0,i[0].start),n=Math.max(r,r+e.totalduration);t.setLiveSeekableRange(r,n)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:i}=this,r=Object.keys(i).length;if(r&&!e||2===r){this.createSourceBuffers(i),this.pendingTracks={};const e=this.getSourceBufferTypes();if(e.length)this.hls.trigger(ln.BUFFER_CREATED,{tracks:this.tracks}),e.forEach((e=>{t.executeNext(e)}));else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(ln.ERROR,{type:cn.MEDIA_ERROR,details:un.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}}createSourceBuffers(e){const{sourceBuffer:t,mediaSource:i}=this;if(!i)throw Error("createSourceBuffers called when mediaSource was null");for(const r in e)if(!t[r]){const n=e[r];if(!n)throw Error(`source buffer exists for track ${r}, however track does not`);const s=n.levelCodec||n.codec,o=`${n.container};codecs=${s}`;pn.log(`[buffer-controller]: creating sourceBuffer(${o})`);try{const e=t[r]=i.addSourceBuffer(o),a=r;this.addBufferListener(a,"updatestart",this._onSBUpdateStart),this.addBufferListener(a,"updateend",this._onSBUpdateEnd),this.addBufferListener(a,"error",this._onSBUpdateError),this.tracks[r]={buffer:e,codec:s,container:n.container,levelCodec:n.levelCodec,metadata:n.metadata,id:n.id}}catch(e){pn.error(`[buffer-controller]: error while trying to add sourceBuffer: ${e.message}`),this.hls.trigger(ln.ERROR,{type:cn.MEDIA_ERROR,details:un.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,mimeType:o})}}}_onSBUpdateStart(e){const{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){const{operationQueue:t}=this;t.current(e).onComplete(),t.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){const i=new Error(`${e} SourceBuffer error`);pn.error(`[buffer-controller]: ${i}`,t),this.hls.trigger(ln.ERROR,{type:cn.MEDIA_ERROR,details:un.BUFFER_APPENDING_ERROR,error:i,fatal:!1});const r=this.operationQueue.current(e);r&&r.onError(t)}removeExecutor(e,t,i){const{media:r,mediaSource:n,operationQueue:s,sourceBuffer:o}=this,a=o[e];if(!r||!n||!a)return pn.warn(`[buffer-controller]: Attempting to remove from the ${e} SourceBuffer, but it does not exist`),void s.shiftAndExecuteNext(e);const l=an(r.duration)?r.duration:1/0,c=an(n.duration)?n.duration:1/0,u=Math.max(0,t),h=Math.min(i,l,c);h>u&&!a.ending?(a.ended=!1,pn.log(`[buffer-controller]: Removing [${u},${h}] from the ${e} SourceBuffer`),a.remove(u,h)):s.shiftAndExecuteNext(e)}appendExecutor(e,t){const{operationQueue:i,sourceBuffer:r}=this,n=r[t];if(!n)return pn.warn(`[buffer-controller]: Attempting to append to the ${t} SourceBuffer, but it does not exist`),void i.shiftAndExecuteNext(t);n.ended=!1,n.appendBuffer(e)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length)return pn.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);const{operationQueue:i}=this,r=t.map((e=>i.appendBlocker(e)));Promise.all(r).then((()=>{e(),t.forEach((e=>{const t=this.sourceBuffer[e];null!=t&&t.updating||i.shiftAndExecuteNext(e)}))}))}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,i){const r=this.sourceBuffer[e];if(!r)return;const n=i.bind(this,e);this.listeners[e].push({event:t,listener:n}),r.addEventListener(t,n)}removeBufferListeners(e){const t=this.sourceBuffer[e];t&&this.listeners[e].forEach((e=>{t.removeEventListener(e.event,e.listener)}))}},capLevelController:Pc,errorController:class{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=pn.log.bind(pn,"[info]:"),this.warn=pn.warn.bind(pn,"[warning]:"),this.error=pn.error.bind(pn,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(ln.ERROR,this.onError,this),e.on(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ln.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(ln.ERROR,this.onError,this),e.off(ln.ERROR,this.onErrorOut,this),e.off(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ln.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){this.playlistError=0}stopLoad(){}getVariantLevelIndex(e){return(null==e?void 0:e.type)===Zs?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var i,r;if(t.fatal)return;const n=this.hls,s=t.context;switch(t.details){case un.FRAG_LOAD_ERROR:case un.FRAG_LOAD_TIMEOUT:case un.KEY_LOAD_ERROR:case un.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case un.FRAG_PARSING_ERROR:if(null!=(i=t.frag)&&i.gap)return void(t.errorAction={action:0,flags:0});case un.FRAG_GAP:case un.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=2);case un.LEVEL_EMPTY_ERROR:case un.LEVEL_PARSING_ERROR:{var o,a;const e=t.parent===Zs?t.level:n.loadLevel;t.details===un.LEVEL_EMPTY_ERROR&&null!=(o=t.context)&&null!=(a=o.levelDetails)&&a.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case un.LEVEL_LOAD_ERROR:case un.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==s?void 0:s.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level)));case un.AUDIO_TRACK_LOAD_ERROR:case un.AUDIO_TRACK_LOAD_TIMEOUT:case un.SUBTITLE_LOAD_ERROR:case un.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const e=n.levels[n.loadLevel];if(e&&(s.type===Ys&&s.groupId===e.audioGroupId||s.type===Xs&&s.groupId===e.textGroupId))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=2,void(t.errorAction.flags=1)}return;case un.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const e=n.levels[n.loadLevel],i=null==e?void 0:e.attrs["HDCP-LEVEL"];i&&(t.errorAction={action:2,flags:2,hdcpLevel:i})}return;case un.BUFFER_ADD_CODEC_ERROR:case un.REMUX_ALLOC_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,null!=(r=t.level)?r:n.loadLevel));case un.INTERNAL_EXCEPTION:case un.BUFFER_APPENDING_ERROR:case un.BUFFER_APPEND_ERROR:case un.BUFFER_FULL_ERROR:case un.LEVEL_SWITCH_ERROR:case un.BUFFER_STALLED_ERROR:case un.BUFFER_SEEK_OVER_HOLE:case un.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:0,flags:0})}if(t.type===cn.KEY_SYSTEM_ERROR){const e=this.getVariantLevelIndex(t.frag);return t.levelRetry=!1,void(t.errorAction=this.getLevelSwitchAction(t,e))}}getPlaylistRetryOrSwitchAction(e,t){var i;const r=Ro(this.hls.config.playlistLoadPolicy,e),n=this.playlistError++,s=null==(i=e.response)?void 0:i.code;if(ko(r,n,xo(e),s))return{action:5,flags:0,retryConfig:r,retryCount:n};const o=this.getLevelSwitchAction(e,t);return r&&(o.retryConfig=r,o.retryCount=n),o}getFragRetryOrSwitchAction(e){const t=this.hls,i=this.getVariantLevelIndex(e.frag),r=t.levels[i],{fragLoadPolicy:n,keyLoadPolicy:s}=t.config,o=Ro(e.details.startsWith("key")?s:n,e),a=t.levels.reduce(((e,t)=>e+t.fragmentError),0);if(r){var l;e.details!==un.FRAG_GAP&&r.fragmentError++;const t=null==(l=e.response)?void 0:l.code;if(ko(o,a,xo(e),t))return{action:5,flags:0,retryConfig:o,retryCount:a}}const c=this.getLevelSwitchAction(e,i);return o&&(c.retryConfig=o,c.retryCount=a),c}getLevelSwitchAction(e,t){const i=this.hls;null==t&&(t=i.loadLevel);const r=this.hls.levels[t];if(r&&(r.loadError++,i.autoLevelEnabled)){var n,s;let t=-1;const{levels:o,loadLevel:a,minAutoLevel:l,maxAutoLevel:c}=i,u=null==(n=e.frag)?void 0:n.type,{type:h,groupId:d}=null!=(s=e.context)?s:{};for(let i=o.length;i--;){const n=(i+a)%o.length;if(n!==a&&n>=l&&n<=c&&0===o[n].loadError){const i=o[n];if(e.details===un.FRAG_GAP&&e.frag){const t=o[n].details;if(t){const i=Io(e.frag,t.fragments,e.frag.start);if(null!=i&&i.gap)continue}}else{if(h===Ys&&d===i.audioGroupId||h===Xs&&d===i.textGroupId)continue;if(u===Qs&&r.audioGroupId===i.audioGroupId||u===Js&&r.textGroupId===i.textGroupId)continue}t=n;break}}if(t>-1&&i.loadLevel!==t)return e.levelRetry=!0,this.playlistError=0,{action:2,flags:0,nextAutoLevel:t}}return{action:2,flags:1}}onErrorOut(e,t){var i;switch(null==(i=t.errorAction)?void 0:i.action){case 0:break;case 2:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===un.FRAG_GAP||(t.fatal=!0)}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,i=e.errorAction;if(!i)return;const{flags:r,hdcpLevel:n,nextAutoLevel:s}=i;switch(r){case 0:this.switchLevel(e,s);break;case 1:i.resolved||(i.resolved=this.redundantFailover(e));break;case 2:n&&(t.maxHdcpLevel=go[go.indexOf(n)-1],i.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`)}i.resolved||this.switchLevel(e,s)}switchLevel(e,t){void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}redundantFailover(e){const{hls:t,penalizedRenditions:i}=this,r=e.parent===Zs?e.level:t.loadLevel,n=t.levels[r],s=n.url.length,o=e.frag?e.frag.urlId:n.urlId;n.urlId!==o||e.frag&&!n.details||this.penalizeRendition(n,e);for(let a=1;a<s;a++){const l=(o+a)%s,c=i[l];if(!c||Do(c,e,i[o]))return this.warn(`Switching to Redundant Stream ${l+1}/${s}: "${n.url[l]}" after ${e.details}`),this.playlistError=0,t.levels.forEach((e=>{e.urlId=l})),t.nextLoadLevel=r,!0}return!1}penalizeRendition(e,t){const{penalizedRenditions:i}=this,r=i[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};r.lastErrorPerfMs=performance.now(),r.errors.push(t),r.details=e.details,i[e.urlId]=r}},fpsController:class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(ln.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(ln.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const i=this.hls.config;if(i.capLevelOnFPSDrop){const e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,i){const r=performance.now();if(t){if(this.lastTime){const e=r-this.lastTime,n=i-this.lastDroppedFrames,s=t-this.lastDecodedFrames,o=1e3*n/e,a=this.hls;if(a.trigger(ln.FPS_DROP,{currentDropped:n,currentDecoded:s,totalDroppedFrames:i}),o>0&&n>a.config.fpsDroppedMonitoringThreshold*s){let e=a.currentLevel;pn.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===a.autoLevelCapping||a.autoLevelCapping>=e)&&(e-=1,a.trigger(ln.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:a.currentLevel}),a.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Un,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:Wc,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends Ta{constructor(e,t,i){super(e,t,i,"[subtitle-stream-controller]",Js),this.levels=[],this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(ln.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ln.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ln.LEVEL_LOADED,this.onLevelLoaded,this),e.on(ln.ERROR,this.onError,this),e.on(ln.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(ln.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(ln.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(ln.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(ln.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(ln.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(ln.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ln.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ln.LEVEL_LOADED,this.onLevelLoaded,this),e.off(ln.ERROR,this.onError,this),e.off(ln.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(ln.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(ln.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(ln.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(ln.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(ln.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=ha,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:i,success:r}=t;if(this.fragPrevious=i,this.state=ha,!r)return;const n=this.tracksBuffered[this.currentTrackId];if(!n)return;let s;const o=i.start;for(let e=0;e<n.length;e++)if(o>=n[e].start&&o<=n[e].end){s=n[e];break}const a=i.start+i.duration;s?s.end=a:(s={start:o,end:a},n.push(s)),this.fragmentTracker.fragBuffered(i)}onBufferFlushing(e,t){const{startOffset:i,endOffset:r}=t;if(0===i&&r!==Number.POSITIVE_INFINITY){const e=r-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach((t=>{for(let i=0;i<t.length;)if(t[i].end<=e)t.shift();else{if(!(t[i].start<e))break;t[i].start=e,i++}})),this.fragmentTracker.removeFragmentsInRange(i,e,Js)}}onFragBuffered(e,t){var i;this.loadedmetadata||t.frag.type!==Zs||null!=(i=this.media)&&i.buffered.length&&(this.loadedmetadata=!0)}onError(e,t){const i=t.frag;(null==i?void 0:i.type)===Js&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ua&&(this.state=ha))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){_l(this.levels,t)?this.levels=t.map((e=>new vo(e))):(this.tracksBuffered=[],this.levels=t.map((e=>{const t=new vo(e);return this.tracksBuffered[t.id]=[],t})),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Js),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){if(this.currentTrackId=t.id,!this.levels.length||-1===this.currentTrackId)return void this.clearInterval();const i=this.levels[this.currentTrackId];null!=i&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var i;const{details:r,id:n}=t,{currentTrackId:s,levels:o}=this;if(!o.length)return;const a=o[s];if(n>=o.length||n!==s||!a)return;this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(r.live||null!=(i=a.details)&&i.live){const e=this.mainDetails;if(r.deltaUpdateFailed||!e)return;const t=e.fragments[0];a.details?(l=this.alignPlaylists(r,a.details),0===l&&t&&(l=t.start,bo(r,l))):r.hasProgramDateTime&&e.hasProgramDateTime?(sa(r,e),l=r.fragments[0].start):t&&(l=t.start,bo(r,l))}a.details=r,this.levelLastLoaded=n,this.startFragRequested||!this.mainDetails&&r.live||this.setStartPosition(a.details,l),this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===ha&&(Io(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),a.details=void 0))}_handleFragmentLoadComplete(e){const{frag:t,payload:i}=e,r=t.decryptdata,n=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&r&&r.key&&r.iv&&"AES-128"===r.method){const e=performance.now();this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer).catch((e=>{throw n.trigger(ln.ERROR,{type:cn.MEDIA_ERROR,details:un.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e})).then((i=>{const r=performance.now();n.trigger(ln.FRAG_DECRYPTED,{frag:t,payload:i,stats:{tstart:e,tdecrypt:r}})})).catch((e=>{this.warn(`${e.name}: ${e.message}`),this.state=ha}))}}doTick(){if(this.media){if(this.state===ha){const{currentTrackId:e,levels:t}=this,i=t[e];if(!t.length||!i||!i.details)return;const{config:r}=this,n=this.getLoadPosition(),s=ea.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],n,r.maxBufferHole),{end:o,len:a}=s,l=this.getFwdBufferInfo(this.media,Zs),c=i.details;if(a>this.getMaxBufferLength(null==l?void 0:l.len)+c.levelTargetDuration)return;const u=c.fragments,h=u.length,d=c.edge;let f=null;const p=this.fragPrevious;if(o<d){const e=r.maxFragLookUpTolerance,t=o>d-e?0:e;f=Io(p,u,Math.max(u[0].start,o),t),!f&&p&&p.start<u[0].start&&(f=u[0])}else f=u[h-1];if(!f)return;if(f=this.mapToInitFragWhenRequired(f),"initSegment"!==f.sn){const e=u[f.sn-c.startSN-1];e&&e.cc===f.cc&&this.fragmentTracker.getState(e)===Uo&&(f=e)}this.fragmentTracker.getState(f)===Uo&&this.loadFragment(f,i,o)}}else this.state=ha}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,i){this.fragCurrent=e,"initSegment"===e.sn?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,i))}get mediaBufferTimeRanges(){return new Ol(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends Oo{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.trackChangeListener=()=>this.onTextTracksChanged(),this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}registerListeners(){const{hls:e}=this;e.on(ln.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ln.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ln.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ln.LEVEL_LOADING,this.onLevelLoading,this),e.on(ln.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(ln.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(ln.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(ln.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ln.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ln.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ln.LEVEL_LOADING,this.onLevelLoading,this),e.off(ln.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(ln.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(ln.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)}onMediaDetaching(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),Ml(this.media.textTracks).forEach((e=>{so(e)})),this.subtitleTrack=-1,this.media=null)}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:i,details:r}=t,{trackId:n}=this,s=this.tracksInGroup[n];if(!s)return void this.warn(`Invalid subtitle track id ${i}`);const o=s.details;s.details=t.details,this.log(`subtitle track ${i} loaded [${r.startSN}-${r.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(null==t||!t.textGroupIds)return;const i=t.textGroupIds[t.urlId],r=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==i){const e=this.tracks.filter((e=>!i||e.groupId===i));this.tracksInGroup=e;const t=this.findTrackId(null==r?void 0:r.name)||this.findTrackId();this.groupId=i||null;const n={subtitleTracks:e};this.log(`Updating subtitle tracks, ${e.length} track(s) found in "${i}" group-id`),this.hls.trigger(ln.SUBTITLE_TRACKS_UPDATED,n),-1!==t&&this.setSubtitleTrack(t,r)}else this.shouldReloadPlaylist(r)&&this.setSubtitleTrack(this.trackId,r)}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const r=t[i];if((!this.selectDefaultTrack||r.default)&&(!e||e===r.name))return r.id}return-1}onError(e,t){!t.fatal&&t.context&&t.context.type===Xs&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.checkRetry(t)}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1;const t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,t)}loadPlaylist(e){super.loadPlaylist();const t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){const i=t.id,r=t.groupId;let n=t.url;if(e)try{n=e.addDirectives(n)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}this.log(`Loading subtitle playlist for id ${i}`),this.hls.trigger(ln.SUBTITLE_TRACK_LOADING,{url:n,id:i,groupId:r,deliveryDirectives:e||null})}}toggleTrackModes(e){const{media:t,trackId:i}=this;if(!t)return;const r=Ml(t.textTracks),n=r.filter((e=>e.groupId===this.groupId));if(-1===e)[].slice.call(r).forEach((e=>{e.mode="disabled"}));else{const e=n[i];e&&(e.mode="disabled")}const s=n[e];s&&(s.mode=this.subtitleDisplay?"showing":"hidden")}setSubtitleTrack(e,t){var i;const r=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(this.trackId!==e&&this.toggleTrackModes(e),this.trackId===e&&(-1===e||null!=(i=r[e])&&i.details)||e<-1||e>=r.length)return;this.clearTimer();const n=r[e];if(this.log(`Switching to subtitle-track ${e}`+(n?` "${n.name}" lang:${n.lang} group:${n.groupId}`:"")),this.trackId=e,n){const{id:e,groupId:i="",name:r,type:s,url:o}=n;this.hls.trigger(ln.SUBTITLE_TRACK_SWITCH,{id:e,groupId:i,name:r,type:s,url:o});const a=this.switchParams(n.url,null==t?void 0:t.details);this.loadPlaylist(a)}else this.hls.trigger(ln.SUBTITLE_TRACK_SWITCH,{id:e})}onTextTracksChanged(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=-1;const t=Ml(this.media.textTracks);for(let i=0;i<t.length;i++)if("hidden"===t[i].mode)e=i;else if("showing"===t[i].mode){e=i;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},timelineController:class{constructor(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){const e=new nc(this,"textTrack1"),t=new nc(this,"textTrack2"),i=new nc(this,"textTrack3"),r=new nc(this,"textTrack4");this.cea608Parser1=new tc(1,e,t),this.cea608Parser2=new tc(3,i,r)}e.on(ln.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(ln.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ln.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(ln.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(ln.FRAG_LOADING,this.onFragLoading,this),e.on(ln.FRAG_LOADED,this.onFragLoaded,this),e.on(ln.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(ln.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(ln.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(ln.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(ln.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(ln.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(ln.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ln.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(ln.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(ln.FRAG_LOADING,this.onFragLoading,this),e.off(ln.FRAG_LOADED,this.onFragLoaded,this),e.off(ln.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(ln.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(ln.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(ln.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(ln.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}addCues(e,t,i,r,n){let s=!1;for(let e=n.length;e--;){const r=n[e],u=(o=r[0],a=r[1],l=t,c=i,Math.min(a,c)-Math.max(o,l));if(u>=0&&(r[0]=Math.min(r[0],t),r[1]=Math.max(r[1],i),s=!0,u/(i-t)>.5))return}var o,a,l,c;if(s||n.push([t,i]),this.config.renderTextTracksNatively){const n=this.captionsTracks[e];this.Cues.newCue(n,t,i,r)}else{const n=this.Cues.newCue(null,t,i,r);this.hls.trigger(ln.CUES_PARSED,{type:"captions",cues:n,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:n}){const{unparsedVttFrags:s}=this;"main"===i&&(this.initPTS[t.cc]={baseTime:r,timescale:n}),s.length&&(this.unparsedVttFrags=[],s.forEach((e=>{this.onFragLoaded(ln.FRAG_LOADED,e)})))}getExistingTrack(e){const{media:t}=this;if(t)for(let i=0;i<t.textTracks.length;i++){const r=t.textTracks[i];if(r[e])return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:i,media:r}=this,{label:n,languageCode:s}=t[e],o=this.getExistingTrack(e);if(o)i[e]=o,so(i[e]),ro(i[e],r);else{const t=this.createTextTrack("captions",n,s);t&&(t[e]=!0,i[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const i={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(ln.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,i){const r=this.media;if(r)return r.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach((t=>{so(e[t]),delete e[t]})),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let e=0;e<t.length;e++)so(t[e])}onSubtitleTracksUpdated(e,t){const i=t.subtitleTracks||[],r=i.some((e=>e.textCodec===wc));if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(_l(this.tracks,i))return void(this.tracks=i);if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const e=this.media?this.media.textTracks:null;this.tracks.forEach(((t,i)=>{let r;if(e&&i<e.length){let i=null;for(let r=0;r<e.length;r++)if(Ic(e[r],t)){i=e[r];break}i&&(r=i)}if(r)so(r);else{const e=this._captionsOrSubtitlesFromCharacteristics(t);r=this.createTextTrack(e,t.name,t.lang),r&&(r.mode="disabled")}r&&(r.groupId=t.groupId,this.textTracks.push(r))}))}else if(this.tracks.length){const e=this.tracks.map((e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e})));this.hls.trigger(ln.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}_captionsOrSubtitlesFromCharacteristics(e){if(e.attrs.CHARACTERISTICS){const t=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),i=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(t&&i)return"captions"}return"subtitles"}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach((e=>{const t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;const i=`textTrack${t[1]}`,r=this.captionsProperties[i];r&&(r.label=e.name,e.lang&&(r.languageCode=e.lang),r.media=e)}))}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){const{cea608Parser1:i,cea608Parser2:r,lastSn:n,lastPartIndex:s}=this;if(this.enabled&&i&&r&&t.frag.type===Zs){var o,a;const e=t.frag.sn,l=null!=(o=null==t||null==(a=t.part)?void 0:a.index)?o:-1;e===n+1||e===n&&l===s+1||(i.reset(),r.reset()),this.lastSn=e,this.lastPartIndex=l}}onFragLoaded(e,t){const{frag:i,payload:r}=t;if(i.type===Js)if(r.byteLength){const e=i.decryptdata,n="stats"in t;if(null==e||!e.encrypted||n){const e=this.tracks[i.level],n=this.vttCCs;n[i.cc]||(n[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),e&&e.textCodec===wc?this._parseIMSC1(i,r):this._parseVTTs(t)}}else this.hls.trigger(ln.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const i=this.hls;Sc(t,this.initPTS[e.cc],(t=>{this._appendCues(t,e.level),i.trigger(ln.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(t=>{pn.log(`Failed to parse IMSC1: ${t}`),i.trigger(ln.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})}))}_parseVTTs(e){var t;const{frag:i,payload:r}=e,{initPTS:n,unparsedVttFrags:s}=this,o=n.length-1;if(!n[i.cc]&&-1===o)return void s.push(e);const a=this.hls;!function(e,t,i,r,n,s,o){const a=new pc,l=es(new Uint8Array(e)).trim().replace(gc,"\n").split("\n"),c=[],u=t?function(e,t=1){return sl(e,9e4,1/t)}(t.baseTime,t.timescale):0;let h,d="00:00.000",f=0,p=0,g=!0;a.oncue=function(e){const s=i[r];let o=i.ccOffset;const a=(f-u)/9e4;if(null!=s&&s.new&&(void 0!==p?o=i.ccOffset=s.start:function(e,t,i){let r=e[t],n=e[r.prevCC];if(!n||!n.new&&r.new)return e.ccOffset=e.presentationOffset=r.start,void(r.new=!1);for(;null!=(s=n)&&s.new;){var s;e.ccOffset+=r.start-n.start,r.new=!1,r=n,n=e[r.prevCC]}e.presentationOffset=i}(i,r,a)),a){if(!t)return void(h=new Error("Missing initPTS for VTT MPEGTS"));o=a-i.presentationOffset}const l=e.endTime-e.startTime,d=hl(9e4*(e.startTime+o-p),9e4*n)/9e4;e.startTime=Math.max(d,0),e.endTime=Math.max(d+l,0);const g=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(g)),e.id||(e.id=yc(e.startTime,e.endTime,g)),e.endTime>0&&c.push(e)},a.onparsingerror=function(e){h=e},a.onflush=function(){h?o(h):s(c)},l.forEach((e=>{if(g){if(mc(e,"X-TIMESTAMP-MAP=")){g=!1,e.slice(16).split(",").forEach((e=>{mc(e,"LOCAL:")?d=e.slice(6):mc(e,"MPEGTS:")&&(f=parseInt(e.slice(7)))}));try{p=function(e){let t=parseInt(e.slice(-3));const i=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),n=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!(an(t)&&an(i)&&an(r)&&an(n)))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=6e4*r,t+=36e5*n,t}(d)/1e3}catch(e){h=e}return}""===e&&(g=!1)}a.parse(e+"\n")})),a.flush()}(null!=(t=i.initSegment)&&t.data?vs(i.initSegment.data,new Uint8Array(r)):r,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,(e=>{this._appendCues(e,i.level),a.trigger(ln.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})}),(t=>{const n="Missing initPTS for VTT MPEGTS"===t.message;n?s.push(e):this._fallbackToIMSC1(i,r),pn.log(`Failed to parse VTT cue: ${t}`),n&&o>i.cc||a.trigger(ln.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:t})}))}_fallbackToIMSC1(e,t){const i=this.tracks[e.level];i.textCodec||Sc(t,this.initPTS[e.cc],(()=>{i.textCodec=wc,this._parseIMSC1(e,t)}),(()=>{i.textCodec="wvtt"}))}_appendCues(e,t){const i=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||"disabled"===i.mode)return;e.forEach((e=>no(i,e)))}else{const r=this.tracks[t];if(!r)return;const n=r.default?"default":"subtitles"+t;i.trigger(ln.CUES_PARSED,{type:"subtitles",cues:e,track:n})}}onFragDecrypted(e,t){const{frag:i}=t;i.type===Js&&this.onFragLoaded(ln.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){const{cea608Parser1:i,cea608Parser2:r}=this;if(!this.enabled||!i||!r)return;const{frag:n,samples:s}=t;if(n.type!==Zs||"NONE"!==this.closedCaptionsForLevel(n))for(let e=0;e<s.length;e++){const t=s[e].bytes;if(t){const n=this.extractCea608Data(t);i.addData(s[e].pts,n[0]),r.addData(s[e].pts,n[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:r,type:n}){const{media:s}=this;if(s&&!(s.currentTime<i)){if(!n||"video"===n){const{captionsTracks:e}=this;Object.keys(e).forEach((r=>oo(e[r],t,i)))}if(this.config.renderTextTracksNatively&&0===t&&void 0!==r){const{textTracks:e}=this;Object.keys(e).forEach((i=>oo(e[i],t,r)))}}}extractCea608Data(e){const t=[[],[]],i=31&e[0];let r=2;for(let n=0;n<i;n++){const i=e[r++],n=127&e[r++],s=127&e[r++];if((0!==n||0!==s)&&0!=(4&i)){const e=3&i;0!==e&&1!==e||(t[e].push(n),t[e].push(s))}}return t}},audioStreamController:class extends Ta{constructor(e,t,i){super(e,t,i,"[audio-stream-controller]",Qs),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(ln.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(ln.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ln.LEVEL_LOADED,this.onLevelLoaded,this),e.on(ln.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(ln.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(ln.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(ln.ERROR,this.onError,this),e.on(ln.BUFFER_RESET,this.onBufferReset,this),e.on(ln.BUFFER_CREATED,this.onBufferCreated,this),e.on(ln.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(ln.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(ln.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(ln.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(ln.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ln.LEVEL_LOADED,this.onLevelLoaded,this),e.off(ln.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(ln.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(ln.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(ln.ERROR,this.onError,this),e.off(ln.BUFFER_RESET,this.onBufferReset,this),e.off(ln.BUFFER_CREATED,this.onBufferCreated,this),e.off(ln.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(ln.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(ln.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:n}){if("main"===i){const e=t.cc;this.initPTS[t.cc]={baseTime:r,timescale:n},this.log(`InitPTS for cc: ${e} found from main: ${r}`),this.videoTrackCC=e,this.state===Ea&&this.tick()}}startLoad(e){if(!this.levels)return this.startPosition=e,void(this.state=ua);const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),t>0&&-1===e?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=ha):(this.loadedmetadata=!1,this.state=ga),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case ha:this.doTickIdle();break;case ga:{var e;const{levels:t,trackId:i}=this,r=null==t||null==(e=t[i])?void 0:e.details;if(r){if(this.waitForCdnTuneIn(r))break;this.state=Ea}break}case pa:{var t;const e=performance.now(),i=this.retryDate;(!i||e>=i||null!=(t=this.media)&&t.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=ha);break}case Ea:{const e=this.waitingData;if(e){const{frag:t,part:i,cache:r,complete:n}=e;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=fa;const e={frag:t,part:i,payload:r.flush(),networkDetails:null};this._handleFragmentLoadProgress(e),n&&super._handleFragmentLoadComplete(e)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${t.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const e=this.getLoadPosition(),i=ea.bufferInfo(this.mediaBuffer,e,this.config.maxBufferHole);Po(i.end,this.config.maxFragLookUpTolerance,t)<0&&(this.log(`Waiting fragment cc (${t.cc}) @ ${t.start} cancelled because another fragment at ${i.end} is needed`),this.clearWaitingFragment())}}else this.state=ha}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=ha)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:t,media:i,trackId:r}=this,n=e.config;if(null==t||!t[r])return;if(!i&&(this.startFragRequested||!n.startFragPrefetch))return;const s=t[r],o=s.details;if(!o||o.live&&this.levelLastLoaded!==r||this.waitForCdnTuneIn(o))return void(this.state=ga);const a=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&a&&(this.bufferFlushed=!1,this.afterBufferFlushed(a,bn,Qs));const l=this.getFwdBufferInfo(a,Qs);if(null===l)return;const{bufferedTrack:c,switchingTrack:u}=this;if(!u&&this._streamEnded(l,o))return e.trigger(ln.BUFFER_EOS,{type:"audio"}),void(this.state=ya);const h=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,Zs),d=l.len,f=this.getMaxBufferLength(null==h?void 0:h.len);if(d>=f&&!u)return;const p=o.fragments[0].start;let g=l.end;if(u&&i){const e=this.getLoadPosition();c&&u.attrs!==c.attrs&&(g=e),o.PTSKnown&&e<p&&(l.end>p||l.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=p+.05)}let m=this.getNextFragment(g,o),v=!1;if(m&&this.isLoopLoading(m,g)&&(v=!!m.gap,m=this.getNextFragmentLoopLoading(m,o,l,Zs,f)),!m)return void(this.bufferFlushed=!0);const y=h&&m.start>h.end+o.targetduration;if(y||(null==h||!h.len)&&l.len){const e=this.getAppendedFrag(m.start,Zs);if(null===e)return;if(v||(v=!!e.gap||!!y&&0===h.len),y&&!v||v&&l.nextStart&&l.nextStart<e.end)return}this.loadFragment(m,s,g)}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map((e=>new vo(e)))}onAudioTrackSwitching(e,t){const i=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),i?this.setInterval(100):this.resetTransmuxer(),i?(this.switchingTrack=t,this.state=ha):(this.switchingTrack=null,this.bufferedTrack=t,this.state=ua),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(ln.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var i;if(null==this.mainDetails)return void(this.cachedTrackLoadedData=t);const{levels:r}=this,{details:n,id:s}=t;if(!r)return void this.warn(`Audio tracks were reset while loading level ${s}`);this.log(`Track ${s} loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""},duration:${n.totalduration}`);const o=r[s];let a=0;if(n.live||null!=(i=o.details)&&i.live){this.checkLiveUpdate(n);const e=this.mainDetails;if(n.deltaUpdateFailed||!e)return;!o.details&&n.hasProgramDateTime&&e.hasProgramDateTime?(sa(n,e),a=n.fragments[0].start):a=this.alignPlaylists(n,o.details)}o.details=n,this.levelLastLoaded=s,this.startFragRequested||!this.mainDetails&&n.live||this.setStartPosition(o.details,a),this.state!==ga||this.waitForCdnTuneIn(n)||(this.state=ha),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:i,part:r,payload:n}=e,{config:s,trackId:o,levels:a}=this;if(!a)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);const l=a[o];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const c=l.details;if(!c)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(i.start);const u=s.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new Cl(this.hls,Qs,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const d=this.initPTS[i.cc],f=null==(t=i.initSegment)?void 0:t.data;if(void 0!==d){const e=!1,t=r?r.index:-1,s=-1!==t,o=new ta(i.level,i.sn,i.stats.chunkCount,n.byteLength,t,s);h.push(n,f,u,"",i,r,c.totalduration,e,o,d)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${c.startSN} ,${c.endSN}],track ${o}`);const{cache:e}=this.waitingData=this.waitingData||{frag:i,part:r,cache:new Pl,complete:!1};e.push(new Uint8Array(n)),this.waitingVideoCC=this.videoTrackCC,this.state=Ea}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){const i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){const{frag:i,part:r}=t;if(i.type===Qs)if(this.fragContextChanged(i))this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if("initSegment"!==i.sn){this.fragPrevious=i;const e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(ln.AUDIO_TRACK_SWITCHED,nn({},e)))}this.fragBufferedComplete(i,r)}else if(!this.loadedmetadata&&i.type===Zs){const e=this.videoBuffer||this.media;e&&ea.getBuffered(e).length&&(this.loadedmetadata=!0)}}onError(e,t){var i;if(t.fatal)this.state=wa;else switch(t.details){case un.FRAG_GAP:case un.FRAG_PARSING_ERROR:case un.FRAG_DECRYPT_ERROR:case un.FRAG_LOAD_ERROR:case un.FRAG_LOAD_TIMEOUT:case un.KEY_LOAD_ERROR:case un.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Qs,t);break;case un.AUDIO_TRACK_LOAD_ERROR:case un.AUDIO_TRACK_LOAD_TIMEOUT:case un.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==ga||(null==(i=t.context)?void 0:i.type)!==Ys||(this.state=ha);break;case un.BUFFER_FULL_ERROR:if(!t.parent||"audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case un.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushed(e,{type:t}){t===bn&&(this.bufferFlushed=!0,this.state===ya&&(this.state=ha))}_handleTransmuxComplete(e){var t;const i="audio",{hls:r}=this,{remuxResult:n,chunkMeta:s}=e,o=this.getCurrentContext(s);if(!o)return void this.resetWhenMissingContext(s);const{frag:a,part:l,level:c}=o,{details:u}=c,{audio:h,text:d,id3:f,initSegment:p}=n;if(!this.fragContextChanged(a)&&u){if(this.state=ma,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),null!=p&&p.tracks){const e=a.initSegment||a;this._bufferInitSegment(p.tracks,e,s),r.trigger(ln.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:i,tracks:p.tracks})}if(h){const{startPTS:e,endPTS:t,startDTS:i,endDTS:r}=h;l&&(l.elementaryStreams[bn]={startPTS:e,endPTS:t,startDTS:i,endDTS:r}),a.setElementaryStreamInfo(bn,e,t,i,r),this.bufferFragmentData(h,a,l,s)}if(null!=f&&null!=(t=f.samples)&&t.length){const e=on({id:i,frag:a,details:u},f);r.trigger(ln.FRAG_PARSING_METADATA,e)}if(d){const e=on({id:i,frag:a,details:u},d);r.trigger(ln.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(a)}_bufferInitSegment(e,t,i){if(this.state!==ma)return;e.video&&delete e.video;const r=e.audio;if(!r)return;r.levelCodec=r.codec,r.id="audio",this.log(`Init audio buffer, container:${r.container}, codecs[parsed]=[${r.codec}]`),this.hls.trigger(ln.BUFFER_CODECS,e);const n=r.initSegment;if(null!=n&&n.byteLength){const e={type:"audio",frag:t,part:null,chunkMeta:i,parent:t.type,data:n};this.hls.trigger(ln.BUFFER_APPENDING,e)}this.tick()}loadFragment(e,t,i){const r=this.fragmentTracker.getState(e);var n;this.fragCurrent=e,this.switchingTrack||r===Uo||r===Ho?"initSegment"===e.sn?this._loadInitSegment(e,t):null!=(n=t.details)&&n.live&&!this.initPTS[e.cc]?(this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=Ea):(this.startFragRequested=!0,super.loadFragment(e,t,i)):this.clearTrackerIfNeeded(e)}completeAudioSwitch(e){const{hls:t,media:i,bufferedTrack:r}=this,n=null==r?void 0:r.attrs,s=e.attrs;i&&n&&(n.CHANNELS!==s.CHANNELS||n.NAME!==s.NAME||n.LANGUAGE!==s.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(ln.AUDIO_TRACK_SWITCHED,nn({},e))}},audioTrackController:class extends Oo{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ln.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ln.LEVEL_LOADING,this.onLevelLoading,this),e.on(ln.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(ln.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(ln.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ln.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ln.LEVEL_LOADING,this.onLevelLoading,this),e.off(ln.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(ln.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(ln.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:i,groupId:r,details:n}=t,s=this.tracksInGroup[i];if(!s||s.groupId!==r)return void this.warn(`Track with id:${i} and group:${r} not found in active group ${s.groupId}`);const o=s.details;s.details=t.details,this.log(`audio-track ${i} "${s.name}" lang:${s.lang} group:${r} loaded [${n.startSN}-${n.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(null==t||!t.audioGroupIds)return;const i=t.audioGroupIds[t.urlId];if(this.groupId!==i){this.groupId=i||null;const e=this.tracks.filter((e=>!i||e.groupId===i));this.selectDefaultTrack&&!e.some((e=>e.default))&&(this.selectDefaultTrack=!1),this.tracksInGroup=e;const t={audioTracks:e};this.log(`Updating audio tracks, ${e.length} track(s) found in group:${i}`),this.hls.trigger(ln.AUDIO_TRACKS_UPDATED,t),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}onError(e,t){!t.fatal&&t.context&&t.context.type===Ys&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(t))}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn("Invalid id passed to audio-track controller");this.clearTimer();const i=this.currentTrack;t[this.trackId];const r=t[e],{groupId:n,name:s}=r;if(this.log(`Switching to audio-track ${e} "${s}" lang:${r.lang} group:${n}`),this.trackId=e,this.currentTrack=r,this.selectDefaultTrack=!1,this.hls.trigger(ln.AUDIO_TRACK_SWITCHING,nn({},r)),r.details&&!r.details.live)return;const o=this.switchParams(r.url,null==i?void 0:i.details);this.loadPlaylist(o)}selectInitialTrack(){const e=this.tracksInGroup,t=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(-1!==t)this.setAudioTrack(t);else{const t=new Error(`No track found for running audio group-ID: ${this.groupId} track count: ${e.length}`);this.warn(t.message),this.hls.trigger(ln.ERROR,{type:cn.MEDIA_ERROR,details:un.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const r=t[i];if(!this.selectDefaultTrack||r.default){if(!e||void 0!==e.attrs["STABLE-RENDITION-ID"]&&e.attrs["STABLE-RENDITION-ID"]===r.attrs["STABLE-RENDITION-ID"])return r.id;if(e.name===r.name&&e.lang===r.lang)return r.id}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){const i=t.id,r=t.groupId;let n=t.url;if(e)try{n=e.addDirectives(n)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}this.log(`loading audio-track playlist ${i} "${t.name}" lang:${t.lang} group:${r}`),this.clearTimer(),this.hls.trigger(ln.AUDIO_TRACK_LOADING,{url:n,id:i,groupId:r,deliveryDirectives:e||null})}}},emeController:Dc,cmcdController:Nc,contentSteeringController:class{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=pn.log.bind(pn,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.on(ln.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(ln.MANIFEST_PARSED,this.onManifestParsed,this),e.on(ln.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(ln.MANIFEST_LOADING,this.onManifestLoading,this),e.off(ln.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(ln.MANIFEST_PARSED,this.onManifestParsed,this),e.off(ln.ERROR,this.onError,this))}startLoad(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){const e=Math.max(1e3*this.timeToLoad-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,e)}else this.loadSteeringManifest(this.uri)}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter((t=>t!==e)))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:i}=t;null!==i&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:i}=t;if(2===(null==i?void 0:i.action)&&1===i.flags){let e=this.pathwayPriority;const t=this.pathwayId;this.penalizedPathways[t]||(this.penalizedPathways[t]=performance.now()),!e&&this.levels&&(e=this.levels.reduce(((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e)),[])),e&&e.length>1&&(this.updatePathwayPriority(e),i.resolved=this.pathwayId!==t)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length?(this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t):e}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter((t=>e===t.pathwayId))}updatePathwayPriority(e){let t;this.pathwayPriority=e;const i=this.penalizedPathways,r=performance.now();Object.keys(i).forEach((e=>{r-i[e]>3e5&&delete i[e]}));for(let r=0;r<e.length;r++){const n=e[r];if(i[n])continue;if(n===this.pathwayId)return;const s=this.hls.nextLoadLevel,o=this.hls.levels[s];if(t=this.getLevelsForPathway(n),t.length>0){this.log(`Setting Pathway to "${n}"`),this.pathwayId=n,this.hls.trigger(ln.LEVELS_UPDATED,{levels:t});const e=this.hls.levels[s];o&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==o.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==o.bitrate&&this.log(`Unstable Pathways change from bitrate ${o.bitrate} to ${e.bitrate}`),this.hls.nextLoadLevel=s);break}}}clonePathways(e){const t=this.levels;if(!t)return;const i={},r={};e.forEach((e=>{const{ID:n,"BASE-ID":s,"URI-REPLACEMENT":o}=e;if(t.some((e=>e.pathwayId===n)))return;const a=this.getLevelsForPathway(s).map((e=>{const t=on({},e);t.details=void 0,t.url=Uc(e.uri,e.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",o);const s=new vn(e.attrs);s["PATHWAY-ID"]=n;const a=s.AUDIO&&`${s.AUDIO}_clone_${n}`,l=s.SUBTITLES&&`${s.SUBTITLES}_clone_${n}`;a&&(i[s.AUDIO]=a,s.AUDIO=a),l&&(r[s.SUBTITLES]=l,s.SUBTITLES=l),t.attrs=s;const c=new vo(t);return No(c,"audio",a),No(c,"text",l),c}));t.push(...a),Bc(this.audioTracks,i,o,n),Bc(this.subtitleTracks,r,o,n)}))}loadSteeringManifest(e){const t=this.hls.config,i=t.loader;let r;this.loader&&this.loader.destroy(),this.loader=new i(t);try{r=new self.URL(e)}catch(t){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${e}`)}if("data:"!==r.protocol){const e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+e)}const n={responseType:"json",url:r.href},s=t.steeringManifestLoadPolicy.default,o=s.errorRetry||s.timeoutRetry||{},a={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(e,t,i,n)=>{this.log(`Loaded steering manifest: "${r}"`);const s=e.data;if(1!==s.VERSION)return void this.log(`Steering VERSION ${s.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=s.TTL;const{"RELOAD-URI":o,"PATHWAY-CLONES":a,"PATHWAY-PRIORITY":l}=s;if(o)try{this.uri=new self.URL(o,r).href}catch(e){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${o}`)}this.scheduleRefresh(this.uri||i.url),a&&this.clonePathways(a),l&&this.updatePathwayPriority(l)},onError:(e,t,i,r)=>{if(this.log(`Error loading steering manifest: ${e.code} ${e.text} (${t.url})`),this.stopLoad(),410===e.code)return this.enabled=!1,void this.log(`Steering manifest ${t.url} no longer available`);let n=1e3*this.timeToLoad;if(429!==e.code)this.scheduleRefresh(this.uri||t.url,n);else{const e=this.loader;if("function"==typeof(null==e?void 0:e.getResponseHeader)){const t=e.getResponseHeader("Retry-After");t&&(n=1e3*parseFloat(t))}this.log(`Steering manifest ${t.url} rate limited`)}},onTimeout:(e,t,i)=>{this.log(`Timeout loading steering manifest (${t.url})`),this.scheduleRefresh(this.uri||t.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(n,a,l)}scheduleRefresh(e,t=1e3*this.timeToLoad){self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout((()=>{this.loadSteeringManifest(e)}),t)}}});function Yc(e){return e&&"object"==typeof e?Array.isArray(e)?e.map(Yc):Object.keys(e).reduce(((t,i)=>(t[i]=Yc(e[i]),t)),{}):e}class Xc{static get version(){return"1.4.12"}static isSupported(){return function(){const e=Is();if(!e)return!1;const t=Sa(),i=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!i&&!!r}()}static get Events(){return ln}static get ErrorTypes(){return cn}static get ErrorDetails(){return un}static get DefaultConfig(){return Xc.defaultConfig?Xc.defaultConfig:Kc}static set DefaultConfig(e){Xc.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new xl,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,function(e,t){if(self.console&&!0===e||"object"==typeof e){!function(e,...t){t.forEach((function(t){fn[t]=e[t]?e[t].bind(e):function(e){const t=self.console[e];return t?t.bind(self.console,`[${e}] >`):hn}(t)}))}(e,"debug","log","info","warn","error");try{fn.log('Debug logs enabled for "Hls instance" in hls.js version 1.4.12')}catch(e){fn=dn}}else fn=dn}(e.debug||!1);const t=this.config=function(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=Yc(e),r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach((e=>{const n=`${"level"===e?"playlist":e}LoadPolicy`,s=void 0===t[n],o=[];r.forEach((r=>{const a=`${e}Loading${r}`,l=t[a];if(void 0!==l&&s){o.push(a);const e=i[n].default;switch(t[n]={default:e},r){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}})),o.length&&pn.warn(`hls.js config: "${o.join('", "')}" setting(s) are deprecated, use "${n}": ${JSON.stringify(t[n])}`)})),nn(nn({},i),t)}(Xc.DefaultConfig,e);this.userConfig=e,this._autoLevelCapping=-1,t.progressive&&function(e){const t=e.loader;t!==jc&&t!==Hc?(pn.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}()&&(e.loader=jc,e.progressive=!0,e.enableSoftwareAES=!0,pn.log("[config]: Progressive streaming enabled, using FetchLoader"))}(t);const{abrController:i,bufferController:r,capLevelController:n,errorController:s,fpsController:o}=t,a=new s(this),l=this.abrController=new i(this),c=this.bufferController=new r(this),u=this.capLevelController=new n(this),h=new o(this),d=new io(this),f=new fo(this),p=t.contentSteeringController,g=p?new p(this):null,m=this.levelController=new Fo(this,g),v=new jo(this),y=new Zo(this.config),w=this.streamController=new kl(this,v,y);u.setStreamController(w),h.setStreamController(w);const E=[d,m,w];g&&E.splice(1,0,g),this.networkControllers=E;const b=[l,c,u,h,f,v];this.audioTrackController=this.createController(t.audioTrackController,E);const T=t.audioStreamController;T&&E.push(new T(this,v,y)),this.subtitleTrackController=this.createController(t.subtitleTrackController,E);const S=t.subtitleStreamController;S&&E.push(new S(this,v,y)),this.createController(t.timelineController,b),y.emeController=this.emeController=this.createController(t.emeController,b),this.cmcdController=this.createController(t.cmcdController,b),this.latencyController=this.createController(po,b),this.coreComponents=b,E.push(a);const x=a.onErrorOut;"function"==typeof x&&this.on(ln.ERROR,x,a)}createController(e,t){if(e){const i=new e(this);return t&&t.push(i),i}return null}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,r){this._emitter.off(e,t,i,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){pn.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.trigger(ln.ERROR,{type:cn.OTHER_ERROR,details:un.INTERNAL_EXCEPTION,fatal:!1,event:e,error:t})}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){pn.log("destroy"),this.trigger(ln.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((e=>e.destroy())),this.networkControllers.length=0,this.coreComponents.forEach((e=>e.destroy())),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){pn.log("attachMedia"),this._media=e,this.trigger(ln.MEDIA_ATTACHING,{media:e})}detachMedia(){pn.log("detachMedia"),this.trigger(ln.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();const t=this.media,i=this.url,r=this.url=tn.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});pn.log(`loadSource:${r}`),t&&i&&(i!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(ln.MANIFEST_LOADING,{url:e})}startLoad(e=-1){pn.log(`startLoad(${e})`),this.networkControllers.forEach((t=>{t.startLoad(e)}))}stopLoad(){pn.log("stopLoad"),this.networkControllers.forEach((e=>{e.stopLoad()}))}swapAudioCodec(){pn.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){pn.log("recoverMediaError");const e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e,t=0){this.levelController.removeLevel(e,t)}get levels(){return this.levelController.levels||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){pn.log(`set currentLevel:${e}`),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){pn.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){pn.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){pn.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){return this.levelController.startLevel}set startLevel(e){pn.log(`set startLevel:${e}`),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(pn.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e)}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){go.indexOf(e)>-1&&(this._maxHdcpLevel=e)}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const i=e.length;for(let r=0;r<i;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:i}=this;let r;if(r=-1===t&&e&&e.length?e.length-1:t,i)for(let t=r;t--;){const r=e[t].attrs["HDCP-LEVEL"];if(r&&r<=i)return t}return r}get nextAutoLevel(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)}set nextAutoLevel(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Xc.defaultConfig=void 0;const Zc={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let Qc;const Jc=new Uint8Array(16);function eu(){if(!Qc&&(Qc="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Qc))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Qc(Jc)}const tu=[];for(let e=0;e<256;++e)tu.push((e+256).toString(16).slice(1));const iu=function(e,t,i){if(Zc.randomUUID&&!t&&!e)return Zc.randomUUID();const r=(e=e||{}).random||(e.rng||eu)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){i=i||0;for(let e=0;e<16;++e)t[i+e]=r[e];return t}return function(e,t=0){return tu[e[t+0]]+tu[e[t+1]]+tu[e[t+2]]+tu[e[t+3]]+"-"+tu[e[t+4]]+tu[e[t+5]]+"-"+tu[e[t+6]]+tu[e[t+7]]+"-"+tu[e[t+8]]+tu[e[t+9]]+"-"+tu[e[t+10]]+tu[e[t+11]]+tu[e[t+12]]+tu[e[t+13]]+tu[e[t+14]]+tu[e[t+15]]}(r)};function ru(t){const[i,r]=(0,e.useState)(void 0);return $t((()=>{if(t){r({width:t.offsetWidth,height:t.offsetHeight});const e=new ResizeObserver((e=>{if(!Array.isArray(e))return;if(!e.length)return;const i=e[0];let n,s;if("borderBoxSize"in i){const e=i.borderBoxSize,t=Array.isArray(e)?e[0]:e;n=t.inlineSize,s=t.blockSize}else n=t.offsetWidth,s=t.offsetHeight;r({width:n,height:s})}));return e.observe(t,{box:"border-box"}),()=>e.unobserve(t)}r(void 0)}),[t]),i}function nu(t){const i=(0,e.useRef)({value:t,previous:t});return(0,e.useMemo)((()=>(i.current.value!==t&&(i.current.previous=i.current.value,i.current.value=t),i.current.previous)),[t])}const su="Radio",[ou,au]=Ft(su),[lu,cu]=ou(su),uu=(0,e.forwardRef)(((t,i)=>{const{__scopeRadio:r,name:n,checked:s=!1,required:o,disabled:a,value:l="on",onCheck:c,...u}=t,[h,d]=(0,e.useState)(null),f=zt(i,(e=>d(e))),p=(0,e.useRef)(!1),g=!h||Boolean(h.closest("form"));return(0,e.createElement)(lu,{scope:r,checked:s,disabled:a},(0,e.createElement)(Yt.button,Ot({type:"button",role:"radio","aria-checked":s,"data-state":du(s),"data-disabled":a?"":void 0,disabled:a,value:l},u,{ref:f,onClick:Mt(t.onClick,(e=>{s||null==c||c(),g&&(p.current=e.isPropagationStopped(),p.current||e.stopPropagation())}))})),g&&(0,e.createElement)(hu,{control:h,bubbles:!p.current,name:n,value:l,checked:s,required:o,disabled:a,style:{transform:"translateX(-100%)"}}))})),hu=t=>{const{control:i,checked:r,bubbles:n=!0,...s}=t,o=(0,e.useRef)(null),a=nu(r),l=ru(i);return(0,e.useEffect)((()=>{const e=o.current,t=window.HTMLInputElement.prototype,i=Object.getOwnPropertyDescriptor(t,"checked").set;if(a!==r&&i){const t=new Event("click",{bubbles:n});i.call(e,r),e.dispatchEvent(t)}}),[a,r,n]),(0,e.createElement)("input",Ot({type:"radio","aria-hidden":!0,defaultChecked:r},s,{tabIndex:-1,ref:o,style:{...t.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function du(e){return e?"checked":"unchecked"}const fu=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],pu="RadioGroup",[gu,mu]=Ft(pu,[Rr,au]),vu=Rr(),yu=au(),[wu,Eu]=gu(pu),bu=(0,e.forwardRef)(((t,i)=>{const{__scopeRadioGroup:r,name:n,defaultValue:s,value:o,required:a=!1,disabled:l=!1,orientation:c,dir:u,loop:h=!0,onValueChange:d,...f}=t,p=vu(r),g=vr(u),[m,v]=Ut({prop:o,defaultProp:s,onChange:d});return(0,e.createElement)(wu,{scope:r,name:n,required:a,disabled:l,value:m,onValueChange:v},(0,e.createElement)(Dr,Ot({asChild:!0},p,{orientation:c,dir:g,loop:h}),(0,e.createElement)(Yt.div,Ot({role:"radiogroup","aria-required":a,"aria-orientation":c,"data-disabled":l?"":void 0,dir:g},f,{ref:i}))))})),Tu=(0,e.forwardRef)(((t,i)=>{const{__scopeRadioGroup:r,disabled:n,...s}=t,o=Eu("RadioGroupItem",r),a=o.disabled||n,l=vu(r),c=yu(r),u=(0,e.useRef)(null),h=zt(i,u),d=o.value===s.value,f=(0,e.useRef)(!1);return(0,e.useEffect)((()=>{const e=e=>{fu.includes(e.key)&&(f.current=!0)},t=()=>f.current=!1;return document.addEventListener("keydown",e),document.addEventListener("keyup",t),()=>{document.removeEventListener("keydown",e),document.removeEventListener("keyup",t)}}),[]),(0,e.createElement)(Or,Ot({asChild:!0},l,{focusable:!a,active:d}),(0,e.createElement)(uu,Ot({disabled:a,required:o.required,checked:d},c,s,{name:o.name,ref:h,onCheck:()=>o.onValueChange(s.value),onKeyDown:Mt((e=>{"Enter"===e.key&&e.preventDefault()})),onFocus:Mt(s.onFocus,(()=>{var e;f.current&&(null===(e=u.current)||void 0===e||e.click())}))})))}));var Su=__webpack_require__(9821);function xu(t,i=(null===globalThis||void 0===globalThis?void 0:globalThis.document)){const r=Bt(t);(0,e.useEffect)((()=>{const e=e=>{"Escape"===e.key&&r(e)};return i.addEventListener("keydown",e),()=>i.removeEventListener("keydown",e)}),[r,i])}const Ru="dismissableLayer.update";let Cu;const Au=(0,e.createContext)({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),ku=(0,e.forwardRef)(((t,i)=>{var r;const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:s,onPointerDownOutside:o,onFocusOutside:a,onInteractOutside:l,onDismiss:c,...u}=t,h=(0,e.useContext)(Au),[d,f]=(0,e.useState)(null),p=null!==(r=null==d?void 0:d.ownerDocument)&&void 0!==r?r:null===globalThis||void 0===globalThis?void 0:globalThis.document,[,g]=(0,e.useState)({}),m=zt(i,(e=>f(e))),v=Array.from(h.layers),[y]=[...h.layersWithOutsidePointerEventsDisabled].slice(-1),w=v.indexOf(y),E=d?v.indexOf(d):-1,b=h.layersWithOutsidePointerEventsDisabled.size>0,T=E>=w,S=function(t,i=(null===globalThis||void 0===globalThis?void 0:globalThis.document)){const r=Bt(t),n=(0,e.useRef)(!1),s=(0,e.useRef)((()=>{}));return(0,e.useEffect)((()=>{const e=e=>{if(e.target&&!n.current){const t={originalEvent:e};function o(){Iu("dismissableLayer.pointerDownOutside",r,t,{discrete:!0})}"touch"===e.pointerType?(i.removeEventListener("click",s.current),s.current=o,i.addEventListener("click",s.current,{once:!0})):o()}else i.removeEventListener("click",s.current);n.current=!1},t=window.setTimeout((()=>{i.addEventListener("pointerdown",e)}),0);return()=>{window.clearTimeout(t),i.removeEventListener("pointerdown",e),i.removeEventListener("click",s.current)}}),[i,r]),{onPointerDownCapture:()=>n.current=!0}}((e=>{const t=e.target,i=[...h.branches].some((e=>e.contains(t)));T&&!i&&(null==o||o(e),null==l||l(e),e.defaultPrevented||null==c||c())}),p),x=function(t,i=(null===globalThis||void 0===globalThis?void 0:globalThis.document)){const r=Bt(t),n=(0,e.useRef)(!1);return(0,e.useEffect)((()=>{const e=e=>{e.target&&!n.current&&Iu("dismissableLayer.focusOutside",r,{originalEvent:e},{discrete:!1})};return i.addEventListener("focusin",e),()=>i.removeEventListener("focusin",e)}),[i,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}((e=>{const t=e.target;[...h.branches].some((e=>e.contains(t)))||(null==a||a(e),null==l||l(e),e.defaultPrevented||null==c||c())}),p);return xu((e=>{E===h.layers.size-1&&(null==s||s(e),!e.defaultPrevented&&c&&(e.preventDefault(),c()))}),p),(0,e.useEffect)((()=>{if(d)return n&&(0===h.layersWithOutsidePointerEventsDisabled.size&&(Cu=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),h.layersWithOutsidePointerEventsDisabled.add(d)),h.layers.add(d),Lu(),()=>{n&&1===h.layersWithOutsidePointerEventsDisabled.size&&(p.body.style.pointerEvents=Cu)}}),[d,p,n,h]),(0,e.useEffect)((()=>()=>{d&&(h.layers.delete(d),h.layersWithOutsidePointerEventsDisabled.delete(d),Lu())}),[d,h]),(0,e.useEffect)((()=>{const e=()=>g({});return document.addEventListener(Ru,e),()=>document.removeEventListener(Ru,e)}),[]),(0,e.createElement)(Yt.div,Ot({},u,{ref:m,style:{pointerEvents:b?T?"auto":"none":void 0,...t.style},onFocusCapture:Mt(t.onFocusCapture,x.onFocusCapture),onBlurCapture:Mt(t.onBlurCapture,x.onBlurCapture),onPointerDownCapture:Mt(t.onPointerDownCapture,S.onPointerDownCapture)}))}));function Lu(){const e=new CustomEvent(Ru);document.dispatchEvent(e)}function Iu(e,t,i,{discrete:r}){const n=i.originalEvent.target,s=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:i});t&&n.addEventListener(e,t,{once:!0}),r?Xt(n,s):n.dispatchEvent(s)}let Pu=0;function _u(){(0,e.useEffect)((()=>{var e,t;const i=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",null!==(e=i[0])&&void 0!==e?e:Du()),document.body.insertAdjacentElement("beforeend",null!==(t=i[1])&&void 0!==t?t:Du()),Pu++,()=>{1===Pu&&document.querySelectorAll("[data-radix-focus-guard]").forEach((e=>e.remove())),Pu--}}),[])}function Du(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",e}const Ou="focusScope.autoFocusOnMount",Mu="focusScope.autoFocusOnUnmount",Fu={bubbles:!1,cancelable:!0},Nu=(0,e.forwardRef)(((t,i)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:s,onUnmountAutoFocus:o,...a}=t,[l,c]=(0,e.useState)(null),u=Bt(s),h=Bt(o),d=(0,e.useRef)(null),f=zt(i,(e=>c(e))),p=(0,e.useRef)({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;(0,e.useEffect)((()=>{if(n){function e(e){if(p.paused||!l)return;const t=e.target;l.contains(t)?d.current=t:Hu(d.current,{select:!0})}function t(e){if(p.paused||!l)return;const t=e.relatedTarget;null!==t&&(l.contains(t)||Hu(d.current,{select:!0}))}function i(e){if(document.activeElement===document.body)for(const t of e)t.removedNodes.length>0&&Hu(l)}document.addEventListener("focusin",e),document.addEventListener("focusout",t);const r=new MutationObserver(i);return l&&r.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t),r.disconnect()}}}),[n,l,p.paused]),(0,e.useEffect)((()=>{if(l){zu.add(p);const e=document.activeElement;if(!l.contains(e)){const t=new CustomEvent(Ou,Fu);l.addEventListener(Ou,u),l.dispatchEvent(t),t.defaultPrevented||(function(e,{select:t=!1}={}){const i=document.activeElement;for(const r of e)if(Hu(r,{select:t}),document.activeElement!==i)return}(Bu(l).filter((e=>"A"!==e.tagName)),{select:!0}),document.activeElement===e&&Hu(l))}return()=>{l.removeEventListener(Ou,u),setTimeout((()=>{const t=new CustomEvent(Mu,Fu);l.addEventListener(Mu,h),l.dispatchEvent(t),t.defaultPrevented||Hu(null!=e?e:document.body,{select:!0}),l.removeEventListener(Mu,h),zu.remove(p)}),0)}}}),[l,u,h,p]);const g=(0,e.useCallback)((e=>{if(!r&&!n)return;if(p.paused)return;const t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,i=document.activeElement;if(t&&i){const t=e.currentTarget,[n,s]=function(e){const t=Bu(e);return[Uu(t,e),Uu(t.reverse(),e)]}(t);n&&s?e.shiftKey||i!==s?e.shiftKey&&i===n&&(e.preventDefault(),r&&Hu(s,{select:!0})):(e.preventDefault(),r&&Hu(n,{select:!0})):i===t&&e.preventDefault()}}),[r,n,p.paused]);return(0,e.createElement)(Yt.div,Ot({tabIndex:-1},a,{ref:f,onKeyDown:g}))}));function Bu(e){const t=[],i=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;i.nextNode();)t.push(i.currentNode);return t}function Uu(e,t){for(const i of e)if(!$u(i,{upTo:t}))return i}function $u(e,{upTo:t}){if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(void 0!==t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}function Hu(e,{select:t=!1}={}){if(e&&e.focus){const i=document.activeElement;e.focus({preventScroll:!0}),e!==i&&function(e){return e instanceof HTMLInputElement&&"select"in e}(e)&&t&&e.select()}}const zu=function(){let e=[];return{add(t){const i=e[0];t!==i&&(null==i||i.pause()),e=ju(e,t),e.unshift(t)},remove(t){var i;e=ju(e,t),null===(i=e[0])||void 0===i||i.resume()}}}();function ju(e,t){const i=[...e],r=i.indexOf(t);return-1!==r&&i.splice(r,1),i}const Gu=["top","right","bottom","left"],Vu=Math.min,qu=Math.max,Wu=Math.round,Ku=Math.floor,Yu=e=>({x:e,y:e}),Xu={left:"right",right:"left",bottom:"top",top:"bottom"},Zu={start:"end",end:"start"};function Qu(e,t,i){return qu(e,Vu(t,i))}function Ju(e,t){return"function"==typeof e?e(t):e}function eh(e){return e.split("-")[0]}function th(e){return e.split("-")[1]}function ih(e){return"x"===e?"y":"x"}function rh(e){return"y"===e?"height":"width"}function nh(e){return["top","bottom"].includes(eh(e))?"y":"x"}function sh(e){return ih(nh(e))}function oh(e){return e.replace(/start|end/g,(e=>Zu[e]))}function ah(e){return e.replace(/left|right|bottom|top/g,(e=>Xu[e]))}function lh(e){return"number"!=typeof e?function(e){return{top:0,right:0,bottom:0,left:0,...e}}(e):{top:e,right:e,bottom:e,left:e}}function ch(e){return{...e,top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}function uh(e,t,i){let{reference:r,floating:n}=e;const s=nh(t),o=sh(t),a=rh(o),l=eh(t),c="y"===s,u=r.x+r.width/2-n.width/2,h=r.y+r.height/2-n.height/2,d=r[a]/2-n[a]/2;let f;switch(l){case"top":f={x:u,y:r.y-n.height};break;case"bottom":f={x:u,y:r.y+r.height};break;case"right":f={x:r.x+r.width,y:h};break;case"left":f={x:r.x-n.width,y:h};break;default:f={x:r.x,y:r.y}}switch(th(t)){case"start":f[o]-=d*(i&&c?-1:1);break;case"end":f[o]+=d*(i&&c?-1:1)}return f}async function hh(e,t){var i;void 0===t&&(t={});const{x:r,y:n,platform:s,rects:o,elements:a,strategy:l}=e,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:h="floating",altBoundary:d=!1,padding:f=0}=Ju(t,e),p=lh(f),g=a[d?"floating"===h?"reference":"floating":h],m=ch(await s.getClippingRect({element:null==(i=await(null==s.isElement?void 0:s.isElement(g)))||i?g:g.contextElement||await(null==s.getDocumentElement?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),v="floating"===h?{...o.floating,x:r,y:n}:o.reference,y=await(null==s.getOffsetParent?void 0:s.getOffsetParent(a.floating)),w=await(null==s.isElement?void 0:s.isElement(y))&&await(null==s.getScale?void 0:s.getScale(y))||{x:1,y:1},E=ch(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({rect:v,offsetParent:y,strategy:l}):v);return{top:(m.top-E.top+p.top)/w.y,bottom:(E.bottom-m.bottom+p.bottom)/w.y,left:(m.left-E.left+p.left)/w.x,right:(E.right-m.right+p.right)/w.x}}const dh=e=>({name:"arrow",options:e,async fn(t){const{x:i,y:r,placement:n,rects:s,platform:o,elements:a,middlewareData:l}=t,{element:c,padding:u=0}=Ju(e,t)||{};if(null==c)return{};const h=lh(u),d={x:i,y:r},f=sh(n),p=rh(f),g=await o.getDimensions(c),m="y"===f,v=m?"top":"left",y=m?"bottom":"right",w=m?"clientHeight":"clientWidth",E=s.reference[p]+s.reference[f]-d[f]-s.floating[p],b=d[f]-s.reference[f],T=await(null==o.getOffsetParent?void 0:o.getOffsetParent(c));let S=T?T[w]:0;S&&await(null==o.isElement?void 0:o.isElement(T))||(S=a.floating[w]||s.floating[p]);const x=E/2-b/2,R=S/2-g[p]/2-1,C=Vu(h[v],R),A=Vu(h[y],R),k=C,L=S-g[p]-A,I=S/2-g[p]/2+x,P=Qu(k,I,L),_=!l.arrow&&null!=th(n)&&I!=P&&s.reference[p]/2-(I<k?C:A)-g[p]/2<0,D=_?I<k?I-k:I-L:0;return{[f]:d[f]+D,data:{[f]:P,centerOffset:I-P-D,..._&&{alignmentOffset:D}},reset:_}}}),fh=function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var i,r;const{placement:n,middlewareData:s,rects:o,initialPlacement:a,platform:l,elements:c}=t,{mainAxis:u=!0,crossAxis:h=!0,fallbackPlacements:d,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:g=!0,...m}=Ju(e,t);if(null!=(i=s.arrow)&&i.alignmentOffset)return{};const v=eh(n),y=eh(a)===a,w=await(null==l.isRTL?void 0:l.isRTL(c.floating)),E=d||(y||!g?[ah(a)]:function(e){const t=ah(e);return[oh(e),t,oh(t)]}(a));d||"none"===p||E.push(...function(e,t,i,r){const n=th(e);let s=function(e,t,i){const r=["left","right"],n=["right","left"],s=["top","bottom"],o=["bottom","top"];switch(e){case"top":case"bottom":return i?t?n:r:t?r:n;case"left":case"right":return t?s:o;default:return[]}}(eh(e),"start"===i,r);return n&&(s=s.map((e=>e+"-"+n)),t&&(s=s.concat(s.map(oh)))),s}(a,g,p,w));const b=[a,...E],T=await hh(t,m),S=[];let x=(null==(r=s.flip)?void 0:r.overflows)||[];if(u&&S.push(T[v]),h){const e=function(e,t,i){void 0===i&&(i=!1);const r=th(e),n=sh(e),s=rh(n);let o="x"===n?r===(i?"end":"start")?"right":"left":"start"===r?"bottom":"top";return t.reference[s]>t.floating[s]&&(o=ah(o)),[o,ah(o)]}(n,o,w);S.push(T[e[0]],T[e[1]])}if(x=[...x,{placement:n,overflows:S}],!S.every((e=>e<=0))){var R,C;const e=((null==(R=s.flip)?void 0:R.index)||0)+1,t=b[e];if(t)return{data:{index:e,overflows:x},reset:{placement:t}};let i=null==(C=x.filter((e=>e.overflows[0]<=0)).sort(((e,t)=>e.overflows[1]-t.overflows[1]))[0])?void 0:C.placement;if(!i)switch(f){case"bestFit":{var A;const e=null==(A=x.map((e=>[e.placement,e.overflows.filter((e=>e>0)).reduce(((e,t)=>e+t),0)])).sort(((e,t)=>e[1]-t[1]))[0])?void 0:A[0];e&&(i=e);break}case"initialPlacement":i=a}if(n!==i)return{reset:{placement:i}}}return{}}}};function ph(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function gh(e){return Gu.some((t=>e[t]>=0))}const mh=function(e){return void 0===e&&(e={}),{name:"hide",options:e,async fn(t){const{rects:i}=t,{strategy:r="referenceHidden",...n}=Ju(e,t);switch(r){case"referenceHidden":{const e=ph(await hh(t,{...n,elementContext:"reference"}),i.reference);return{data:{referenceHiddenOffsets:e,referenceHidden:gh(e)}}}case"escaped":{const e=ph(await hh(t,{...n,altBoundary:!0}),i.floating);return{data:{escapedOffsets:e,escaped:gh(e)}}}default:return{}}}}},vh=function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(t){const{x:i,y:r}=t,n=await async function(e,t){const{placement:i,platform:r,elements:n}=e,s=await(null==r.isRTL?void 0:r.isRTL(n.floating)),o=eh(i),a=th(i),l="y"===nh(i),c=["left","top"].includes(o)?-1:1,u=s&&l?-1:1,h=Ju(t,e);let{mainAxis:d,crossAxis:f,alignmentAxis:p}="number"==typeof h?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...h};return a&&"number"==typeof p&&(f="end"===a?-1*p:p),l?{x:f*u,y:d*c}:{x:d*c,y:f*u}}(t,e);return{x:i+n.x,y:r+n.y,data:n}}}},yh=function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){const{x:i,y:r,placement:n}=t,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:e=>{let{x:t,y:i}=e;return{x:t,y:i}}},...l}=Ju(e,t),c={x:i,y:r},u=await hh(t,l),h=nh(eh(n)),d=ih(h);let f=c[d],p=c[h];if(s){const e="y"===d?"bottom":"right";f=Qu(f+u["y"===d?"top":"left"],f,f-u[e])}if(o){const e="y"===h?"bottom":"right";p=Qu(p+u["y"===h?"top":"left"],p,p-u[e])}const g=a.fn({...t,[d]:f,[h]:p});return{...g,data:{x:g.x-i,y:g.y-r}}}}},wh=function(e){return void 0===e&&(e={}),{options:e,fn(t){const{x:i,y:r,placement:n,rects:s,middlewareData:o}=t,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=Ju(e,t),u={x:i,y:r},h=nh(n),d=ih(h);let f=u[d],p=u[h];const g=Ju(a,t),m="number"==typeof g?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(l){const e="y"===d?"height":"width",t=s.reference[d]-s.floating[e]+m.mainAxis,i=s.reference[d]+s.reference[e]-m.mainAxis;f<t?f=t:f>i&&(f=i)}if(c){var v,y;const e="y"===d?"width":"height",t=["top","left"].includes(eh(n)),i=s.reference[h]-s.floating[e]+(t&&(null==(v=o.offset)?void 0:v[h])||0)+(t?0:m.crossAxis),r=s.reference[h]+s.reference[e]+(t?0:(null==(y=o.offset)?void 0:y[h])||0)-(t?m.crossAxis:0);p<i?p=i:p>r&&(p=r)}return{[d]:f,[h]:p}}}},Eh=function(e){return void 0===e&&(e={}),{name:"size",options:e,async fn(t){const{placement:i,rects:r,platform:n,elements:s}=t,{apply:o=(()=>{}),...a}=Ju(e,t),l=await hh(t,a),c=eh(i),u=th(i),h="y"===nh(i),{width:d,height:f}=r.floating;let p,g;"top"===c||"bottom"===c?(p=c,g=u===(await(null==n.isRTL?void 0:n.isRTL(s.floating))?"start":"end")?"left":"right"):(g=c,p="end"===u?"top":"bottom");const m=f-l[p],v=d-l[g],y=!t.middlewareData.shift;let w=m,E=v;if(h){const e=d-l.left-l.right;E=u||y?Vu(v,e):e}else{const e=f-l.top-l.bottom;w=u||y?Vu(m,e):e}if(y&&!u){const e=qu(l.left,0),t=qu(l.right,0),i=qu(l.top,0),r=qu(l.bottom,0);h?E=d-2*(0!==e||0!==t?e+t:qu(l.left,l.right)):w=f-2*(0!==i||0!==r?i+r:qu(l.top,l.bottom))}await o({...t,availableWidth:E,availableHeight:w});const b=await n.getDimensions(s.floating);return d!==b.width||f!==b.height?{reset:{rects:!0}}:{}}}};function bh(e){return xh(e)?(e.nodeName||"").toLowerCase():"#document"}function Th(e){var t;return(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function Sh(e){var t;return null==(t=(xh(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function xh(e){return e instanceof Node||e instanceof Th(e).Node}function Rh(e){return e instanceof Element||e instanceof Th(e).Element}function Ch(e){return e instanceof HTMLElement||e instanceof Th(e).HTMLElement}function Ah(e){return"undefined"!=typeof ShadowRoot&&(e instanceof ShadowRoot||e instanceof Th(e).ShadowRoot)}function kh(e){const{overflow:t,overflowX:i,overflowY:r,display:n}=Dh(e);return/auto|scroll|overlay|hidden|clip/.test(t+r+i)&&!["inline","contents"].includes(n)}function Lh(e){return["table","td","th"].includes(bh(e))}function Ih(e){const t=Ph(),i=Dh(e);return"none"!==i.transform||"none"!==i.perspective||!!i.containerType&&"normal"!==i.containerType||!t&&!!i.backdropFilter&&"none"!==i.backdropFilter||!t&&!!i.filter&&"none"!==i.filter||["transform","perspective","filter"].some((e=>(i.willChange||"").includes(e)))||["paint","layout","strict","content"].some((e=>(i.contain||"").includes(e)))}function Ph(){return!("undefined"==typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}function _h(e){return["html","body","#document"].includes(bh(e))}function Dh(e){return Th(e).getComputedStyle(e)}function Oh(e){return Rh(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function Mh(e){if("html"===bh(e))return e;const t=e.assignedSlot||e.parentNode||Ah(e)&&e.host||Sh(e);return Ah(t)?t.host:t}function Fh(e){const t=Mh(e);return _h(t)?e.ownerDocument?e.ownerDocument.body:e.body:Ch(t)&&kh(t)?t:Fh(t)}function Nh(e,t,i){var r;void 0===t&&(t=[]),void 0===i&&(i=!0);const n=Fh(e),s=n===(null==(r=e.ownerDocument)?void 0:r.body),o=Th(n);return s?t.concat(o,o.visualViewport||[],kh(n)?n:[],o.frameElement&&i?Nh(o.frameElement):[]):t.concat(n,Nh(n,[],i))}function Bh(e){const t=Dh(e);let i=parseFloat(t.width)||0,r=parseFloat(t.height)||0;const n=Ch(e),s=n?e.offsetWidth:i,o=n?e.offsetHeight:r,a=Wu(i)!==s||Wu(r)!==o;return a&&(i=s,r=o),{width:i,height:r,$:a}}function Uh(e){return Rh(e)?e:e.contextElement}function $h(e){const t=Uh(e);if(!Ch(t))return Yu(1);const i=t.getBoundingClientRect(),{width:r,height:n,$:s}=Bh(t);let o=(s?Wu(i.width):i.width)/r,a=(s?Wu(i.height):i.height)/n;return o&&Number.isFinite(o)||(o=1),a&&Number.isFinite(a)||(a=1),{x:o,y:a}}const Hh=Yu(0);function zh(e){const t=Th(e);return Ph()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:Hh}function jh(e,t,i,r){void 0===t&&(t=!1),void 0===i&&(i=!1);const n=e.getBoundingClientRect(),s=Uh(e);let o=Yu(1);t&&(r?Rh(r)&&(o=$h(r)):o=$h(e));const a=function(e,t,i){return void 0===t&&(t=!1),!(!i||t&&i!==Th(e))&&t}(s,i,r)?zh(s):Yu(0);let l=(n.left+a.x)/o.x,c=(n.top+a.y)/o.y,u=n.width/o.x,h=n.height/o.y;if(s){const e=Th(s),t=r&&Rh(r)?Th(r):r;let i=e.frameElement;for(;i&&r&&t!==e;){const e=$h(i),t=i.getBoundingClientRect(),r=Dh(i),n=t.left+(i.clientLeft+parseFloat(r.paddingLeft))*e.x,s=t.top+(i.clientTop+parseFloat(r.paddingTop))*e.y;l*=e.x,c*=e.y,u*=e.x,h*=e.y,l+=n,c+=s,i=Th(i).frameElement}}return ch({width:u,height:h,x:l,y:c})}function Gh(e){return jh(Sh(e)).left+Oh(e).scrollLeft}function Vh(e,t,i){let r;if("viewport"===t)r=function(e,t){const i=Th(e),r=Sh(e),n=i.visualViewport;let s=r.clientWidth,o=r.clientHeight,a=0,l=0;if(n){s=n.width,o=n.height;const e=Ph();(!e||e&&"fixed"===t)&&(a=n.offsetLeft,l=n.offsetTop)}return{width:s,height:o,x:a,y:l}}(e,i);else if("document"===t)r=function(e){const t=Sh(e),i=Oh(e),r=e.ownerDocument.body,n=qu(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),s=qu(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight);let o=-i.scrollLeft+Gh(e);const a=-i.scrollTop;return"rtl"===Dh(r).direction&&(o+=qu(t.clientWidth,r.clientWidth)-n),{width:n,height:s,x:o,y:a}}(Sh(e));else if(Rh(t))r=function(e,t){const i=jh(e,!0,"fixed"===t),r=i.top+e.clientTop,n=i.left+e.clientLeft,s=Ch(e)?$h(e):Yu(1);return{width:e.clientWidth*s.x,height:e.clientHeight*s.y,x:n*s.x,y:r*s.y}}(t,i);else{const i=zh(e);r={...t,x:t.x-i.x,y:t.y-i.y}}return ch(r)}function qh(e,t){const i=Mh(e);return!(i===t||!Rh(i)||_h(i))&&("fixed"===Dh(i).position||qh(i,t))}function Wh(e,t,i){const r=Ch(t),n=Sh(t),s="fixed"===i,o=jh(e,!0,s,t);let a={scrollLeft:0,scrollTop:0};const l=Yu(0);if(r||!r&&!s)if(("body"!==bh(t)||kh(n))&&(a=Oh(t)),r){const e=jh(t,!0,s,t);l.x=e.x+t.clientLeft,l.y=e.y+t.clientTop}else n&&(l.x=Gh(n));return{x:o.left+a.scrollLeft-l.x,y:o.top+a.scrollTop-l.y,width:o.width,height:o.height}}function Kh(e,t){return Ch(e)&&"fixed"!==Dh(e).position?t?t(e):e.offsetParent:null}function Yh(e,t){const i=Th(e);if(!Ch(e))return i;let r=Kh(e,t);for(;r&&Lh(r)&&"static"===Dh(r).position;)r=Kh(r,t);return r&&("html"===bh(r)||"body"===bh(r)&&"static"===Dh(r).position&&!Ih(r))?i:r||function(e){let t=Mh(e);for(;Ch(t)&&!_h(t);){if(Ih(t))return t;t=Mh(t)}return null}(e)||i}const Xh={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{rect:t,offsetParent:i,strategy:r}=e;const n=Ch(i),s=Sh(i);if(i===s)return t;let o={scrollLeft:0,scrollTop:0},a=Yu(1);const l=Yu(0);if((n||!n&&"fixed"!==r)&&(("body"!==bh(i)||kh(s))&&(o=Oh(i)),Ch(i))){const e=jh(i);a=$h(i),l.x=e.x+i.clientLeft,l.y=e.y+i.clientTop}return{width:t.width*a.x,height:t.height*a.y,x:t.x*a.x-o.scrollLeft*a.x+l.x,y:t.y*a.y-o.scrollTop*a.y+l.y}},getDocumentElement:Sh,getClippingRect:function(e){let{element:t,boundary:i,rootBoundary:r,strategy:n}=e;const s=[..."clippingAncestors"===i?function(e,t){const i=t.get(e);if(i)return i;let r=Nh(e,[],!1).filter((e=>Rh(e)&&"body"!==bh(e))),n=null;const s="fixed"===Dh(e).position;let o=s?Mh(e):e;for(;Rh(o)&&!_h(o);){const t=Dh(o),i=Ih(o);i||"fixed"!==t.position||(n=null),(s?!i&&!n:!i&&"static"===t.position&&n&&["absolute","fixed"].includes(n.position)||kh(o)&&!i&&qh(e,o))?r=r.filter((e=>e!==o)):n=t,o=Mh(o)}return t.set(e,r),r}(t,this._c):[].concat(i),r],o=s[0],a=s.reduce(((e,i)=>{const r=Vh(t,i,n);return e.top=qu(r.top,e.top),e.right=Vu(r.right,e.right),e.bottom=Vu(r.bottom,e.bottom),e.left=qu(r.left,e.left),e}),Vh(t,o,n));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}},getOffsetParent:Yh,getElementRects:async function(e){let{reference:t,floating:i,strategy:r}=e;const n=this.getOffsetParent||Yh,s=this.getDimensions;return{reference:Wh(t,await n(i),r),floating:{x:0,y:0,...await s(i)}}},getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){return Bh(e)},getScale:$h,isElement:Rh,isRTL:function(e){return"rtl"===Dh(e).direction}};function Zh(e,t,i,r){void 0===r&&(r={});const{ancestorScroll:n=!0,ancestorResize:s=!0,elementResize:o="function"==typeof ResizeObserver,layoutShift:a="function"==typeof IntersectionObserver,animationFrame:l=!1}=r,c=Uh(e),u=n||s?[...c?Nh(c):[],...Nh(t)]:[];u.forEach((e=>{n&&e.addEventListener("scroll",i,{passive:!0}),s&&e.addEventListener("resize",i)}));const h=c&&a?function(e,t){let i,r=null;const n=Sh(e);function s(){clearTimeout(i),r&&r.disconnect(),r=null}return function o(a,l){void 0===a&&(a=!1),void 0===l&&(l=1),s();const{left:c,top:u,width:h,height:d}=e.getBoundingClientRect();if(a||t(),!h||!d)return;const f={rootMargin:-Ku(u)+"px "+-Ku(n.clientWidth-(c+h))+"px "+-Ku(n.clientHeight-(u+d))+"px "+-Ku(c)+"px",threshold:qu(0,Vu(1,l))||1};let p=!0;function g(e){const t=e[0].intersectionRatio;if(t!==l){if(!p)return o();t?o(!1,t):i=setTimeout((()=>{o(!1,1e-7)}),100)}p=!1}try{r=new IntersectionObserver(g,{...f,root:n.ownerDocument})}catch(e){r=new IntersectionObserver(g,f)}r.observe(e)}(!0),s}(c,i):null;let d,f=-1,p=null;o&&(p=new ResizeObserver((e=>{let[r]=e;r&&r.target===c&&p&&(p.unobserve(t),cancelAnimationFrame(f),f=requestAnimationFrame((()=>{p&&p.observe(t)}))),i()})),c&&!l&&p.observe(c),p.observe(t));let g=l?jh(e):null;return l&&function t(){const r=jh(e);!g||r.x===g.x&&r.y===g.y&&r.width===g.width&&r.height===g.height||i(),g=r,d=requestAnimationFrame(t)}(),i(),()=>{u.forEach((e=>{n&&e.removeEventListener("scroll",i),s&&e.removeEventListener("resize",i)})),h&&h(),p&&p.disconnect(),p=null,l&&cancelAnimationFrame(d)}}const Qh=(e,t,i)=>{const r=new Map,n={platform:Xh,...i},s={...n.platform,_c:r};return(async(e,t,i)=>{const{placement:r="bottom",strategy:n="absolute",middleware:s=[],platform:o}=i,a=s.filter(Boolean),l=await(null==o.isRTL?void 0:o.isRTL(t));let c=await o.getElementRects({reference:e,floating:t,strategy:n}),{x:u,y:h}=uh(c,r,l),d=r,f={},p=0;for(let i=0;i<a.length;i++){const{name:s,fn:g}=a[i],{x:m,y:v,data:y,reset:w}=await g({x:u,y:h,initialPlacement:r,placement:d,strategy:n,middlewareData:f,rects:c,platform:o,elements:{reference:e,floating:t}});u=null!=m?m:u,h=null!=v?v:h,f={...f,[s]:{...f[s],...y}},w&&p<=50&&(p++,"object"==typeof w&&(w.placement&&(d=w.placement),w.rects&&(c=!0===w.rects?await o.getElementRects({reference:e,floating:t,strategy:n}):w.rects),({x:u,y:h}=uh(c,d,l))),i=-1)}return{x:u,y:h,placement:d,strategy:n,middlewareData:f}})(e,t,{...n,platform:s})},Jh=e=>({name:"arrow",options:e,fn(t){const{element:i,padding:r}="function"==typeof e?e(t):e;return i&&(n=i,{}.hasOwnProperty.call(n,"current"))?null!=i.current?dh({element:i.current,padding:r}).fn(t):{}:i?dh({element:i,padding:r}).fn(t):{};var n}});var ed="undefined"!=typeof document?e.useLayoutEffect:e.useEffect;function td(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if("function"==typeof e&&e.toString()===t.toString())return!0;let i,r,n;if(e&&t&&"object"==typeof e){if(Array.isArray(e)){if(i=e.length,i!=t.length)return!1;for(r=i;0!=r--;)if(!td(e[r],t[r]))return!1;return!0}if(n=Object.keys(e),i=n.length,i!==Object.keys(t).length)return!1;for(r=i;0!=r--;)if(!{}.hasOwnProperty.call(t,n[r]))return!1;for(r=i;0!=r--;){const i=n[r];if(!("_owner"===i&&e.$$typeof||td(e[i],t[i])))return!1}return!0}return e!=e&&t!=t}function id(e){return"undefined"==typeof window?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function rd(e,t){const i=id(e);return Math.round(t*i)/i}function nd(t){const i=e.useRef(t);return ed((()=>{i.current=t})),i}function sd(t){void 0===t&&(t={});const{placement:i="bottom",strategy:r="absolute",middleware:n=[],platform:s,elements:{reference:o,floating:a}={},transform:l=!0,whileElementsMounted:c,open:u}=t,[h,d]=e.useState({x:0,y:0,strategy:r,placement:i,middlewareData:{},isPositioned:!1}),[f,p]=e.useState(n);td(f,n)||p(n);const[g,m]=e.useState(null),[v,y]=e.useState(null),w=e.useCallback((e=>{e!=S.current&&(S.current=e,m(e))}),[m]),E=e.useCallback((e=>{e!==x.current&&(x.current=e,y(e))}),[y]),b=o||g,T=a||v,S=e.useRef(null),x=e.useRef(null),R=e.useRef(h),C=nd(c),A=nd(s),k=e.useCallback((()=>{if(!S.current||!x.current)return;const e={placement:i,strategy:r,middleware:f};A.current&&(e.platform=A.current),Qh(S.current,x.current,e).then((e=>{const t={...e,isPositioned:!0};L.current&&!td(R.current,t)&&(R.current=t,jt.flushSync((()=>{d(t)})))}))}),[f,i,r,A]);ed((()=>{!1===u&&R.current.isPositioned&&(R.current.isPositioned=!1,d((e=>({...e,isPositioned:!1}))))}),[u]);const L=e.useRef(!1);ed((()=>(L.current=!0,()=>{L.current=!1})),[]),ed((()=>{if(b&&(S.current=b),T&&(x.current=T),b&&T){if(C.current)return C.current(b,T,k);k()}}),[b,T,k,C]);const I=e.useMemo((()=>({reference:S,floating:x,setReference:w,setFloating:E})),[w,E]),P=e.useMemo((()=>({reference:b,floating:T})),[b,T]),_=e.useMemo((()=>{const e={position:r,left:0,top:0};if(!P.floating)return e;const t=rd(P.floating,h.x),i=rd(P.floating,h.y);return l?{...e,transform:"translate("+t+"px, "+i+"px)",...id(P.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:t,top:i}}),[r,l,P.floating,h.x,h.y]);return e.useMemo((()=>({...h,update:k,refs:I,elements:P,floatingStyles:_})),[h,k,I,P,_])}const od=(0,e.forwardRef)(((t,i)=>{const{children:r,width:n=10,height:s=5,...o}=t;return(0,e.createElement)(Yt.svg,Ot({},o,{ref:i,width:n,height:s,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),t.asChild?r:(0,e.createElement)("polygon",{points:"0,0 30,0 15,10"}))})),ad="Popper",[ld,cd]=Ft(ad),[ud,hd]=ld(ad),dd=(0,e.forwardRef)(((t,i)=>{const{__scopePopper:r,virtualRef:n,...s}=t,o=hd("PopperAnchor",r),a=(0,e.useRef)(null),l=zt(i,a);return(0,e.useEffect)((()=>{o.onAnchorChange((null==n?void 0:n.current)||a.current)})),n?null:(0,e.createElement)(Yt.div,Ot({},s,{ref:l}))})),fd="PopperContent",[pd,gd]=ld(fd),md=(0,e.forwardRef)(((t,i)=>{var r,n,s,o,a,l,c,u;const{__scopePopper:h,side:d="bottom",sideOffset:f=0,align:p="center",alignOffset:g=0,arrowPadding:m=0,avoidCollisions:v=!0,collisionBoundary:y=[],collisionPadding:w=0,sticky:E="partial",hideWhenDetached:b=!1,updatePositionStrategy:T="optimized",onPlaced:S,...x}=t,R=hd(fd,h),[C,A]=(0,e.useState)(null),k=zt(i,(e=>A(e))),[L,I]=(0,e.useState)(null),P=ru(L),_=null!==(r=null==P?void 0:P.width)&&void 0!==r?r:0,D=null!==(n=null==P?void 0:P.height)&&void 0!==n?n:0,O=d+("center"!==p?"-"+p:""),M="number"==typeof w?w:{top:0,right:0,bottom:0,left:0,...w},F=Array.isArray(y)?y:[y],N=F.length>0,B={padding:M,boundary:F.filter(yd),altBoundary:N},{refs:U,floatingStyles:$,placement:H,isPositioned:z,middlewareData:j}=sd({strategy:"fixed",placement:O,whileElementsMounted:(...e)=>Zh(...e,{animationFrame:"always"===T}),elements:{reference:R.anchor},middleware:[vh({mainAxis:f+D,alignmentAxis:g}),v&&yh({mainAxis:!0,crossAxis:!1,limiter:"partial"===E?wh():void 0,...B}),v&&fh({...B}),Eh({...B,apply:({elements:e,rects:t,availableWidth:i,availableHeight:r})=>{const{width:n,height:s}=t.reference,o=e.floating.style;o.setProperty("--radix-popper-available-width",`${i}px`),o.setProperty("--radix-popper-available-height",`${r}px`),o.setProperty("--radix-popper-anchor-width",`${n}px`),o.setProperty("--radix-popper-anchor-height",`${s}px`)}}),L&&Jh({element:L,padding:m}),wd({arrowWidth:_,arrowHeight:D}),b&&mh({strategy:"referenceHidden",...B})]}),[G,V]=Ed(H),q=Bt(S);$t((()=>{z&&(null==q||q())}),[z,q]);const W=null===(s=j.arrow)||void 0===s?void 0:s.x,K=null===(o=j.arrow)||void 0===o?void 0:o.y,Y=0!==(null===(a=j.arrow)||void 0===a?void 0:a.centerOffset),[X,Z]=(0,e.useState)();return $t((()=>{C&&Z(window.getComputedStyle(C).zIndex)}),[C]),(0,e.createElement)("div",{ref:U.setFloating,"data-radix-popper-content-wrapper":"",style:{...$,transform:z?$.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:X,"--radix-popper-transform-origin":[null===(l=j.transformOrigin)||void 0===l?void 0:l.x,null===(c=j.transformOrigin)||void 0===c?void 0:c.y].join(" ")},dir:t.dir},(0,e.createElement)(pd,{scope:h,placedSide:G,onArrowChange:I,arrowX:W,arrowY:K,shouldHideArrow:Y},(0,e.createElement)(Yt.div,Ot({"data-side":G,"data-align":V},x,{ref:k,style:{...x.style,animation:z?void 0:"none",opacity:null!==(u=j.hide)&&void 0!==u&&u.referenceHidden?0:void 0}}))))})),vd={top:"bottom",right:"left",bottom:"top",left:"right"};function yd(e){return null!==e}const wd=e=>({name:"transformOrigin",options:e,fn(t){var i,r,n,s,o;const{placement:a,rects:l,middlewareData:c}=t,u=0!==(null===(i=c.arrow)||void 0===i?void 0:i.centerOffset),h=u?0:e.arrowWidth,d=u?0:e.arrowHeight,[f,p]=Ed(a),g={start:"0%",center:"50%",end:"100%"}[p],m=(null!==(r=null===(n=c.arrow)||void 0===n?void 0:n.x)&&void 0!==r?r:0)+h/2,v=(null!==(s=null===(o=c.arrow)||void 0===o?void 0:o.y)&&void 0!==s?s:0)+d/2;let y="",w="";return"bottom"===f?(y=u?g:`${m}px`,w=-d+"px"):"top"===f?(y=u?g:`${m}px`,w=`${l.floating.height+d}px`):"right"===f?(y=-d+"px",w=u?g:`${v}px`):"left"===f&&(y=`${l.floating.width+d}px`,w=u?g:`${v}px`),{data:{x:y,y:w}}}});function Ed(e){const[t,i="center"]=e.split("-");return[t,i]}const bd=t=>{const{__scopePopper:i,children:r}=t,[n,s]=(0,e.useState)(null);return(0,e.createElement)(ud,{scope:i,anchor:n,onAnchorChange:s},r)},Td=dd,Sd=md,xd=(0,e.forwardRef)((function(t,i){const{__scopePopper:r,...n}=t,s=gd("PopperArrow",r),o=vd[s.placedSide];return(0,e.createElement)("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0}},(0,e.createElement)(od,Ot({},n,{ref:i,style:{...n.style,display:"block"}})))}));var Rd=new WeakMap,Cd=new WeakMap,Ad={},kd=0,Ld=function(e){return e&&(e.host||Ld(e.parentNode))},Id=function(e,t,i){void 0===i&&(i="data-aria-hidden");var r=Array.from(Array.isArray(e)?e:[e]),n=t||function(e){return"undefined"==typeof document?null:(Array.isArray(e)?e[0]:e).ownerDocument.body}(e);return n?(r.push.apply(r,Array.from(n.querySelectorAll("[aria-live]"))),function(e,t,i,r){var n=function(e,t){return t.map((function(t){if(e.contains(t))return t;var i=Ld(t);return i&&e.contains(i)?i:(console.error("aria-hidden",t,"in not contained inside",e,". Doing nothing"),null)})).filter((function(e){return Boolean(e)}))}(t,Array.isArray(e)?e:[e]);Ad[i]||(Ad[i]=new WeakMap);var s=Ad[i],o=[],a=new Set,l=new Set(n),c=function(e){e&&!a.has(e)&&(a.add(e),c(e.parentNode))};n.forEach(c);var u=function(e){e&&!l.has(e)&&Array.prototype.forEach.call(e.children,(function(e){if(a.has(e))u(e);else{var t=e.getAttribute(r),n=null!==t&&"false"!==t,l=(Rd.get(e)||0)+1,c=(s.get(e)||0)+1;Rd.set(e,l),s.set(e,c),o.push(e),1===l&&n&&Cd.set(e,!0),1===c&&e.setAttribute(i,"true"),n||e.setAttribute(r,"true")}}))};return u(t),a.clear(),kd++,function(){o.forEach((function(e){var t=Rd.get(e)-1,n=s.get(e)-1;Rd.set(e,t),s.set(e,n),t||(Cd.has(e)||e.removeAttribute(r),Cd.delete(e)),n||e.removeAttribute(i)})),--kd||(Rd=new WeakMap,Rd=new WeakMap,Cd=new WeakMap,Ad={})}}(r,n,i,"aria-hidden")):function(){return null}},Pd=function(){return Pd=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},Pd.apply(this,arguments)};function _d(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]])}return i}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var Dd="right-scroll-bar-position",Od="width-before-scroll-bar";function Md(e){return e}var Fd=function(e){void 0===e&&(e={});var t=function(e,t){void 0===t&&(t=Md);var i=[],r=!1,n={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:e},useMedium:function(e){var n=t(e,r);return i.push(n),function(){i=i.filter((function(e){return e!==n}))}},assignSyncMedium:function(e){for(r=!0;i.length;){var t=i;i=[],t.forEach(e)}i={push:function(t){return e(t)},filter:function(){return i}}},assignMedium:function(e){r=!0;var t=[];if(i.length){var n=i;i=[],n.forEach(e),t=i}var s=function(){var i=t;t=[],i.forEach(e)},o=function(){return Promise.resolve().then(s)};o(),i={push:function(e){t.push(e),o()},filter:function(e){return t=t.filter(e),i}}}};return n}(null);return t.options=Pd({async:!0,ssr:!1},e),t}(),Nd=function(){},Bd=e.forwardRef((function(t,i){var r=e.useRef(null),n=e.useState({onScrollCapture:Nd,onWheelCapture:Nd,onTouchMoveCapture:Nd}),s=n[0],o=n[1],a=t.forwardProps,l=t.children,c=t.className,u=t.removeScrollBar,h=t.enabled,d=t.shards,f=t.sideCar,p=t.noIsolation,g=t.inert,m=t.allowPinchZoom,v=t.as,y=void 0===v?"div":v,w=_d(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),E=f,b=function(t,i){return r=i||null,n=function(e){return t.forEach((function(t){return function(e,t){return"function"==typeof e?e(t):e&&(e.current=t),e}(t,e)}))},(s=(0,e.useState)((function(){return{value:r,callback:n,facade:{get current(){return s.value},set current(e){var t=s.value;t!==e&&(s.value=e,s.callback(e,t))}}}}))[0]).callback=n,s.facade;var r,n,s}([r,i]),T=Pd(Pd({},w),s);return e.createElement(e.Fragment,null,h&&e.createElement(E,{sideCar:Fd,removeScrollBar:u,shards:d,noIsolation:p,inert:g,setCallbacks:o,allowPinchZoom:!!m,lockRef:r}),a?e.cloneElement(e.Children.only(l),Pd(Pd({},T),{ref:b})):e.createElement(y,Pd({},T,{className:c,ref:b}),l))}));Bd.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},Bd.classNames={fullWidth:Od,zeroRight:Dd};var Ud=function(t){var i=t.sideCar,r=_d(t,["sideCar"]);if(!i)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=i.read();if(!n)throw new Error("Sidecar medium not found");return e.createElement(n,Pd({},r))};Ud.isSideCarExport=!0;var $d=function(){var e=0,t=null;return{add:function(i){var r,n;0==e&&(t=function(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=__webpack_require__.nc;return t&&e.setAttribute("nonce",t),e}())&&(n=i,(r=t).styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n)),function(e){(document.head||document.getElementsByTagName("head")[0]).appendChild(e)}(t)),e++},remove:function(){! --e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},Hd=function(){var t,i=(t=$d(),function(i,r){e.useEffect((function(){return t.add(i),function(){t.remove()}}),[i&&r])});return function(e){var t=e.styles,r=e.dynamic;return i(t,r),null}},zd={left:0,top:0,right:0,gap:0},jd=function(e){return parseInt(e||"",10)||0},Gd=Hd(),Vd=function(e,t,i,r){var n=e.left,s=e.top,o=e.right,a=e.gap;return void 0===i&&(i="margin"),"\n  .".concat("with-scroll-bars-hidden"," {\n   overflow: hidden ").concat(r,";\n   padding-right: ").concat(a,"px ").concat(r,";\n  }\n  body {\n    overflow: hidden ").concat(r,";\n    overscroll-behavior: contain;\n    ").concat([t&&"position: relative ".concat(r,";"),"margin"===i&&"\n    padding-left: ".concat(n,"px;\n    padding-top: ").concat(s,"px;\n    padding-right: ").concat(o,"px;\n    margin-left:0;\n    margin-top:0;\n    margin-right: ").concat(a,"px ").concat(r,";\n    "),"padding"===i&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),"\n  }\n  \n  .").concat(Dd," {\n    right: ").concat(a,"px ").concat(r,";\n  }\n  \n  .").concat(Od," {\n    margin-right: ").concat(a,"px ").concat(r,";\n  }\n  \n  .").concat(Dd," .").concat(Dd," {\n    right: 0 ").concat(r,";\n  }\n  \n  .").concat(Od," .").concat(Od," {\n    margin-right: 0 ").concat(r,";\n  }\n  \n  body {\n    ").concat("--removed-body-scroll-bar-size",": ").concat(a,"px;\n  }\n")},qd=function(t){var i=t.noRelative,r=t.noImportant,n=t.gapMode,s=void 0===n?"margin":n,o=e.useMemo((function(){return function(e){if(void 0===e&&(e="margin"),"undefined"==typeof window)return zd;var t=function(e){var t=window.getComputedStyle(document.body),i=t["padding"===e?"paddingLeft":"marginLeft"],r=t["padding"===e?"paddingTop":"marginTop"],n=t["padding"===e?"paddingRight":"marginRight"];return[jd(i),jd(r),jd(n)]}(e),i=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-i+t[2]-t[0])}}(s)}),[s]);return e.createElement(Gd,{styles:Vd(o,!i,s,r?"":"!important")})},Wd=!1;if("undefined"!=typeof window)try{var Kd=Object.defineProperty({},"passive",{get:function(){return Wd=!0,!0}});window.addEventListener("test",Kd,Kd),window.removeEventListener("test",Kd,Kd)}catch(e){Wd=!1}var Yd=!!Wd&&{passive:!1},Xd=function(e,t){var i=window.getComputedStyle(e);return"hidden"!==i[t]&&!(i.overflowY===i.overflowX&&!function(e){return"TEXTAREA"===e.tagName}(e)&&"visible"===i[t])},Zd=function(e,t){var i=t;do{if("undefined"!=typeof ShadowRoot&&i instanceof ShadowRoot&&(i=i.host),Qd(e,i)){var r=Jd(e,i);if(r[1]>r[2])return!0}i=i.parentNode}while(i&&i!==document.body);return!1},Qd=function(e,t){return"v"===e?function(e){return Xd(e,"overflowY")}(t):function(e){return Xd(e,"overflowX")}(t)},Jd=function(e,t){return"v"===e?[(i=t).scrollTop,i.scrollHeight,i.clientHeight]:function(e){return[e.scrollLeft,e.scrollWidth,e.clientWidth]}(t);var i},ef=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},tf=function(e){return[e.deltaX,e.deltaY]},rf=function(e){return e&&"current"in e?e.current:e},nf=function(e){return"\n  .block-interactivity-".concat(e," {pointer-events: none;}\n  .allow-interactivity-").concat(e," {pointer-events: all;}\n")},sf=0,of=[];const af=(lf=function(t){var i=e.useRef([]),r=e.useRef([0,0]),n=e.useRef(),s=e.useState(sf++)[0],o=e.useState((function(){return Hd()}))[0],a=e.useRef(t);e.useEffect((function(){a.current=t}),[t]),e.useEffect((function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(s));var e=function(e,t,i){if(i||2===arguments.length)for(var r,n=0,s=t.length;n<s;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))}([t.lockRef.current],(t.shards||[]).map(rf),!0).filter(Boolean);return e.forEach((function(e){return e.classList.add("allow-interactivity-".concat(s))})),function(){document.body.classList.remove("block-interactivity-".concat(s)),e.forEach((function(e){return e.classList.remove("allow-interactivity-".concat(s))}))}}}),[t.inert,t.lockRef.current,t.shards]);var l=e.useCallback((function(e,t){if("touches"in e&&2===e.touches.length)return!a.current.allowPinchZoom;var i,s=ef(e),o=r.current,l="deltaX"in e?e.deltaX:o[0]-s[0],c="deltaY"in e?e.deltaY:o[1]-s[1],u=e.target,h=Math.abs(l)>Math.abs(c)?"h":"v";if("touches"in e&&"h"===h&&"range"===u.type)return!1;var d=Zd(h,u);if(!d)return!0;if(d?i=h:(i="v"===h?"h":"v",d=Zd(h,u)),!d)return!1;if(!n.current&&"changedTouches"in e&&(l||c)&&(n.current=i),!i)return!0;var f=n.current||i;return function(e,t,i,r,n){var s=function(e,t){return"h"===e&&"rtl"===t?-1:1}(e,window.getComputedStyle(t).direction),o=s*r,a=i.target,l=t.contains(a),c=!1,u=o>0,h=0,d=0;do{var f=Jd(e,a),p=f[0],g=f[1]-f[2]-s*p;(p||g)&&Qd(e,a)&&(h+=g,d+=p),a=a.parentNode}while(!l&&a!==document.body||l&&(t.contains(a)||t===a));return(u&&(0===h||!1)||!u&&(0===d||!1))&&(c=!0),c}(f,t,e,"h"===f?l:c)}),[]),c=e.useCallback((function(e){var t=e;if(of.length&&of[of.length-1]===o){var r="deltaY"in t?tf(t):ef(t),n=i.current.filter((function(e){return e.name===t.type&&e.target===t.target&&function(e,t){return e[0]===t[0]&&e[1]===t[1]}(e.delta,r)}))[0];if(n&&n.should)t.cancelable&&t.preventDefault();else if(!n){var s=(a.current.shards||[]).map(rf).filter(Boolean).filter((function(e){return e.contains(t.target)}));(s.length>0?l(t,s[0]):!a.current.noIsolation)&&t.cancelable&&t.preventDefault()}}}),[]),u=e.useCallback((function(e,t,r,n){var s={name:e,delta:t,target:r,should:n};i.current.push(s),setTimeout((function(){i.current=i.current.filter((function(e){return e!==s}))}),1)}),[]),h=e.useCallback((function(e){r.current=ef(e),n.current=void 0}),[]),d=e.useCallback((function(e){u(e.type,tf(e),e.target,l(e,t.lockRef.current))}),[]),f=e.useCallback((function(e){u(e.type,ef(e),e.target,l(e,t.lockRef.current))}),[]);e.useEffect((function(){return of.push(o),t.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:f}),document.addEventListener("wheel",c,Yd),document.addEventListener("touchmove",c,Yd),document.addEventListener("touchstart",h,Yd),function(){of=of.filter((function(e){return e!==o})),document.removeEventListener("wheel",c,Yd),document.removeEventListener("touchmove",c,Yd),document.removeEventListener("touchstart",h,Yd)}}),[]);var p=t.removeScrollBar,g=t.inert;return e.createElement(e.Fragment,null,g?e.createElement(o,{styles:nf(s)}):null,p?e.createElement(qd,{gapMode:"margin"}):null)},Fd.useMedium(lf),Ud);var lf,cf=e.forwardRef((function(t,i){return e.createElement(Bd,Pd({},t,{ref:i,sideCar:af}))}));cf.classNames=Bd.classNames;const uf=cf,hf="Popover",[df,ff]=Ft(hf,[cd]),pf=cd(),[gf,mf]=df(hf),vf=(0,e.forwardRef)(((t,i)=>{const{__scopePopover:r,...n}=t,s=mf("PopoverTrigger",r),o=pf(r),a=zt(i,s.triggerRef),l=(0,e.createElement)(Yt.button,Ot({type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":Rf(s.open)},n,{ref:a,onClick:Mt(t.onClick,s.onOpenToggle)}));return s.hasCustomAnchor?l:(0,e.createElement)(Td,Ot({asChild:!0},o),l)})),[yf,wf]=df("PopoverPortal",{forceMount:void 0}),Ef="PopoverContent",bf=(0,e.forwardRef)(((t,i)=>{const r=wf(Ef,t.__scopePopover),{forceMount:n=r.forceMount,...s}=t,o=mf(Ef,t.__scopePopover);return(0,e.createElement)(Zt,{present:n||o.open},o.modal?(0,e.createElement)(Tf,Ot({},s,{ref:i})):(0,e.createElement)(Sf,Ot({},s,{ref:i})))})),Tf=(0,e.forwardRef)(((t,i)=>{const r=mf(Ef,t.__scopePopover),n=(0,e.useRef)(null),s=zt(i,n),o=(0,e.useRef)(!1);return(0,e.useEffect)((()=>{const e=n.current;if(e)return Id(e)}),[]),(0,e.createElement)(uf,{as:Gt,allowPinchZoom:!0},(0,e.createElement)(xf,Ot({},t,{ref:s,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Mt(t.onCloseAutoFocus,(e=>{var t;e.preventDefault(),o.current||null===(t=r.triggerRef.current)||void 0===t||t.focus()})),onPointerDownOutside:Mt(t.onPointerDownOutside,(e=>{const t=e.detail.originalEvent,i=0===t.button&&!0===t.ctrlKey,r=2===t.button||i;o.current=r}),{checkForDefaultPrevented:!1}),onFocusOutside:Mt(t.onFocusOutside,(e=>e.preventDefault()),{checkForDefaultPrevented:!1})})))})),Sf=(0,e.forwardRef)(((t,i)=>{const r=mf(Ef,t.__scopePopover),n=(0,e.useRef)(!1),s=(0,e.useRef)(!1);return(0,e.createElement)(xf,Ot({},t,{ref:i,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:e=>{var i,o;null===(i=t.onCloseAutoFocus)||void 0===i||i.call(t,e),e.defaultPrevented||(n.current||null===(o=r.triggerRef.current)||void 0===o||o.focus(),e.preventDefault()),n.current=!1,s.current=!1},onInteractOutside:e=>{var i,o;null===(i=t.onInteractOutside)||void 0===i||i.call(t,e),e.defaultPrevented||(n.current=!0,"pointerdown"===e.detail.originalEvent.type&&(s.current=!0));const a=e.target;(null===(o=r.triggerRef.current)||void 0===o?void 0:o.contains(a))&&e.preventDefault(),"focusin"===e.detail.originalEvent.type&&s.current&&e.preventDefault()}}))})),xf=(0,e.forwardRef)(((t,i)=>{const{__scopePopover:r,trapFocus:n,onOpenAutoFocus:s,onCloseAutoFocus:o,disableOutsidePointerEvents:a,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:u,onInteractOutside:h,...d}=t,f=mf(Ef,r),p=pf(r);return _u(),(0,e.createElement)(Nu,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:s,onUnmountAutoFocus:o},(0,e.createElement)(ku,{asChild:!0,disableOutsidePointerEvents:a,onInteractOutside:h,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:u,onDismiss:()=>f.onOpenChange(!1)},(0,e.createElement)(Sd,Ot({"data-state":Rf(f.open),role:"dialog",id:f.contentId},p,d,{ref:i,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}}))))}));function Rf(e){return e?"open":"closed"}const Cf=t=>{const{__scopePopover:i,children:r,open:n,defaultOpen:s,onOpenChange:o,modal:a=!1}=t,l=pf(i),c=(0,e.useRef)(null),[u,h]=(0,e.useState)(!1),[d=!1,f]=Ut({prop:n,defaultProp:s,onChange:o});return(0,e.createElement)(bd,l,(0,e.createElement)(gf,{scope:i,contentId:ti(),triggerRef:c,open:d,onOpenChange:f,onOpenToggle:(0,e.useCallback)((()=>f((e=>!e))),[f]),hasCustomAnchor:u,onCustomAnchorAdd:(0,e.useCallback)((()=>h(!0)),[]),onCustomAnchorRemove:(0,e.useCallback)((()=>h(!1)),[]),modal:a},r))},Af=vf,kf=bf,Lf=(0,e.forwardRef)(((t,i)=>{const{__scopePopover:r,...n}=t,s=mf("PopoverClose",r);return(0,e.createElement)(Yt.button,Ot({type:"button"},n,{ref:i,onClick:Mt(t.onClick,(()=>s.onOpenChange(!1)))}))})),If=(0,e.forwardRef)(((t,i)=>{const{__scopePopover:r,...n}=t,s=pf(r);return(0,e.createElement)(xd,Ot({},s,n,{ref:i}))}));var Pf=__webpack_require__(9203);function _f(e,[t,i]){return Math.min(i,Math.max(t,e))}const Df="dismissableLayer.update";let Of;const Mf=(0,e.createContext)({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Ff=(0,e.forwardRef)(((t,i)=>{var r;const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:s,onPointerDownOutside:o,onFocusOutside:a,onInteractOutside:l,onDismiss:c,...u}=t,h=(0,e.useContext)(Mf),[d,f]=(0,e.useState)(null),p=null!==(r=null==d?void 0:d.ownerDocument)&&void 0!==r?r:null===globalThis||void 0===globalThis?void 0:globalThis.document,[,g]=(0,e.useState)({}),m=zt(i,(e=>f(e))),v=Array.from(h.layers),[y]=[...h.layersWithOutsidePointerEventsDisabled].slice(-1),w=v.indexOf(y),E=d?v.indexOf(d):-1,b=h.layersWithOutsidePointerEventsDisabled.size>0,T=E>=w,S=function(t,i=(null===globalThis||void 0===globalThis?void 0:globalThis.document)){const r=Bt(t),n=(0,e.useRef)(!1),s=(0,e.useRef)((()=>{}));return(0,e.useEffect)((()=>{const e=e=>{if(e.target&&!n.current){const t={originalEvent:e};function o(){Bf("dismissableLayer.pointerDownOutside",r,t,{discrete:!0})}"touch"===e.pointerType?(i.removeEventListener("click",s.current),s.current=o,i.addEventListener("click",s.current,{once:!0})):o()}n.current=!1},t=window.setTimeout((()=>{i.addEventListener("pointerdown",e)}),0);return()=>{window.clearTimeout(t),i.removeEventListener("pointerdown",e),i.removeEventListener("click",s.current)}}),[i,r]),{onPointerDownCapture:()=>n.current=!0}}((e=>{const t=e.target,i=[...h.branches].some((e=>e.contains(t)));T&&!i&&(null==o||o(e),null==l||l(e),e.defaultPrevented||null==c||c())}),p),x=function(t,i=(null===globalThis||void 0===globalThis?void 0:globalThis.document)){const r=Bt(t),n=(0,e.useRef)(!1);return(0,e.useEffect)((()=>{const e=e=>{e.target&&!n.current&&Bf("dismissableLayer.focusOutside",r,{originalEvent:e},{discrete:!1})};return i.addEventListener("focusin",e),()=>i.removeEventListener("focusin",e)}),[i,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}((e=>{const t=e.target;[...h.branches].some((e=>e.contains(t)))||(null==a||a(e),null==l||l(e),e.defaultPrevented||null==c||c())}),p);return xu((e=>{E===h.layers.size-1&&(null==s||s(e),!e.defaultPrevented&&c&&(e.preventDefault(),c()))}),p),(0,e.useEffect)((()=>{if(d)return n&&(0===h.layersWithOutsidePointerEventsDisabled.size&&(Of=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),h.layersWithOutsidePointerEventsDisabled.add(d)),h.layers.add(d),Nf(),()=>{n&&1===h.layersWithOutsidePointerEventsDisabled.size&&(p.body.style.pointerEvents=Of)}}),[d,p,n,h]),(0,e.useEffect)((()=>()=>{d&&(h.layers.delete(d),h.layersWithOutsidePointerEventsDisabled.delete(d),Nf())}),[d,h]),(0,e.useEffect)((()=>{const e=()=>g({});return document.addEventListener(Df,e),()=>document.removeEventListener(Df,e)}),[]),(0,e.createElement)(Yt.div,Ot({},u,{ref:m,style:{pointerEvents:b?T?"auto":"none":void 0,...t.style},onFocusCapture:Mt(t.onFocusCapture,x.onFocusCapture),onBlurCapture:Mt(t.onBlurCapture,x.onBlurCapture),onPointerDownCapture:Mt(t.onPointerDownCapture,S.onPointerDownCapture)}))}));function Nf(){const e=new CustomEvent(Df);document.dispatchEvent(e)}function Bf(e,t,i,{discrete:r}){const n=i.originalEvent.target,s=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:i});t&&n.addEventListener(e,t,{once:!0}),r?Xt(n,s):n.dispatchEvent(s)}const Uf="focusScope.autoFocusOnMount",$f="focusScope.autoFocusOnUnmount",Hf={bubbles:!1,cancelable:!0},zf=(0,e.forwardRef)(((t,i)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:s,onUnmountAutoFocus:o,...a}=t,[l,c]=(0,e.useState)(null),u=Bt(s),h=Bt(o),d=(0,e.useRef)(null),f=zt(i,(e=>c(e))),p=(0,e.useRef)({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;(0,e.useEffect)((()=>{if(n){function e(e){if(p.paused||!l)return;const t=e.target;l.contains(t)?d.current=t:qf(d.current,{select:!0})}function t(e){if(p.paused||!l)return;const t=e.relatedTarget;null!==t&&(l.contains(t)||qf(d.current,{select:!0}))}function i(e){const t=document.activeElement;for(const i of e)i.removedNodes.length>0&&(null!=l&&l.contains(t)||qf(l))}document.addEventListener("focusin",e),document.addEventListener("focusout",t);const r=new MutationObserver(i);return l&&r.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t),r.disconnect()}}}),[n,l,p.paused]),(0,e.useEffect)((()=>{if(l){Wf.add(p);const e=document.activeElement;if(!l.contains(e)){const t=new CustomEvent(Uf,Hf);l.addEventListener(Uf,u),l.dispatchEvent(t),t.defaultPrevented||(function(e,{select:t=!1}={}){const i=document.activeElement;for(const r of e)if(qf(r,{select:t}),document.activeElement!==i)return}(jf(l).filter((e=>"A"!==e.tagName)),{select:!0}),document.activeElement===e&&qf(l))}return()=>{l.removeEventListener(Uf,u),setTimeout((()=>{const t=new CustomEvent($f,Hf);l.addEventListener($f,h),l.dispatchEvent(t),t.defaultPrevented||qf(null!=e?e:document.body,{select:!0}),l.removeEventListener($f,h),Wf.remove(p)}),0)}}}),[l,u,h,p]);const g=(0,e.useCallback)((e=>{if(!r&&!n)return;if(p.paused)return;const t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,i=document.activeElement;if(t&&i){const t=e.currentTarget,[n,s]=function(e){const t=jf(e);return[Gf(t,e),Gf(t.reverse(),e)]}(t);n&&s?e.shiftKey||i!==s?e.shiftKey&&i===n&&(e.preventDefault(),r&&qf(s,{select:!0})):(e.preventDefault(),r&&qf(n,{select:!0})):i===t&&e.preventDefault()}}),[r,n,p.paused]);return(0,e.createElement)(Yt.div,Ot({tabIndex:-1},a,{ref:f,onKeyDown:g}))}));function jf(e){const t=[],i=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;i.nextNode();)t.push(i.currentNode);return t}function Gf(e,t){for(const i of e)if(!Vf(i,{upTo:t}))return i}function Vf(e,{upTo:t}){if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(void 0!==t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}function qf(e,{select:t=!1}={}){if(e&&e.focus){const i=document.activeElement;e.focus({preventScroll:!0}),e!==i&&function(e){return e instanceof HTMLInputElement&&"select"in e}(e)&&t&&e.select()}}const Wf=function(){let e=[];return{add(t){const i=e[0];t!==i&&(null==i||i.pause()),e=Kf(e,t),e.unshift(t)},remove(t){var i;e=Kf(e,t),null===(i=e[0])||void 0===i||i.resume()}}}();function Kf(e,t){const i=[...e],r=i.indexOf(t);return-1!==r&&i.splice(r,1),i}const Yf="Popper",[Xf,Zf]=Ft(Yf),[Qf,Jf]=Xf(Yf),ep=(0,e.forwardRef)(((t,i)=>{const{__scopePopper:r,virtualRef:n,...s}=t,o=Jf("PopperAnchor",r),a=(0,e.useRef)(null),l=zt(i,a);return(0,e.useEffect)((()=>{o.onAnchorChange((null==n?void 0:n.current)||a.current)})),n?null:(0,e.createElement)(Yt.div,Ot({},s,{ref:l}))})),tp="PopperContent",[ip,rp]=Xf(tp),np=(0,e.forwardRef)(((t,i)=>{var r,n,s,o,a,l,c,u;const{__scopePopper:h,side:d="bottom",sideOffset:f=0,align:p="center",alignOffset:g=0,arrowPadding:m=0,collisionBoundary:v=[],collisionPadding:y=0,sticky:w="partial",hideWhenDetached:E=!1,avoidCollisions:b=!0,onPlaced:T,...S}=t,x=Jf(tp,h),[R,C]=(0,e.useState)(null),A=zt(i,(e=>C(e))),[k,L]=(0,e.useState)(null),I=ru(k),P=null!==(r=null==I?void 0:I.width)&&void 0!==r?r:0,_=null!==(n=null==I?void 0:I.height)&&void 0!==n?n:0,D=d+("center"!==p?"-"+p:""),O="number"==typeof y?y:{top:0,right:0,bottom:0,left:0,...y},M=Array.isArray(v)?v:[v],F=M.length>0,N={padding:O,boundary:M.filter(sp),altBoundary:F},{refs:B,floatingStyles:U,placement:$,isPositioned:H,middlewareData:z}=sd({strategy:"fixed",placement:D,whileElementsMounted:Zh,elements:{reference:x.anchor},middleware:[vh({mainAxis:f+_,alignmentAxis:g}),b&&yh({mainAxis:!0,crossAxis:!1,limiter:"partial"===w?wh():void 0,...N}),b&&fh({...N}),Eh({...N,apply:({elements:e,rects:t,availableWidth:i,availableHeight:r})=>{const{width:n,height:s}=t.reference,o=e.floating.style;o.setProperty("--radix-popper-available-width",`${i}px`),o.setProperty("--radix-popper-available-height",`${r}px`),o.setProperty("--radix-popper-anchor-width",`${n}px`),o.setProperty("--radix-popper-anchor-height",`${s}px`)}}),k&&Jh({element:k,padding:m}),op({arrowWidth:P,arrowHeight:_}),E&&mh({strategy:"referenceHidden"})]}),[j,G]=ap($),V=Bt(T);$t((()=>{H&&(null==V||V())}),[H,V]);const q=null===(s=z.arrow)||void 0===s?void 0:s.x,W=null===(o=z.arrow)||void 0===o?void 0:o.y,K=0!==(null===(a=z.arrow)||void 0===a?void 0:a.centerOffset),[Y,X]=(0,e.useState)();return $t((()=>{R&&X(window.getComputedStyle(R).zIndex)}),[R]),(0,e.createElement)("div",{ref:B.setFloating,"data-radix-popper-content-wrapper":"",style:{...U,transform:H?U.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Y,"--radix-popper-transform-origin":[null===(l=z.transformOrigin)||void 0===l?void 0:l.x,null===(c=z.transformOrigin)||void 0===c?void 0:c.y].join(" ")},dir:t.dir},(0,e.createElement)(ip,{scope:h,placedSide:j,onArrowChange:L,arrowX:q,arrowY:W,shouldHideArrow:K},(0,e.createElement)(Yt.div,Ot({"data-side":j,"data-align":G},S,{ref:A,style:{...S.style,animation:H?void 0:"none",opacity:null!==(u=z.hide)&&void 0!==u&&u.referenceHidden?0:void 0}}))))}));function sp(e){return null!==e}const op=e=>({name:"transformOrigin",options:e,fn(t){var i,r,n,s,o;const{placement:a,rects:l,middlewareData:c}=t,u=0!==(null===(i=c.arrow)||void 0===i?void 0:i.centerOffset),h=u?0:e.arrowWidth,d=u?0:e.arrowHeight,[f,p]=ap(a),g={start:"0%",center:"50%",end:"100%"}[p],m=(null!==(r=null===(n=c.arrow)||void 0===n?void 0:n.x)&&void 0!==r?r:0)+h/2,v=(null!==(s=null===(o=c.arrow)||void 0===o?void 0:o.y)&&void 0!==s?s:0)+d/2;let y="",w="";return"bottom"===f?(y=u?g:`${m}px`,w=-d+"px"):"top"===f?(y=u?g:`${m}px`,w=`${l.floating.height+d}px`):"right"===f?(y=-d+"px",w=u?g:`${v}px`):"left"===f&&(y=`${l.floating.width+d}px`,w=u?g:`${v}px`),{data:{x:y,y:w}}}});function ap(e){const[t,i="center"]=e.split("-");return[t,i]}const lp=t=>{const{__scopePopper:i,children:r}=t,[n,s]=(0,e.useState)(null);return(0,e.createElement)(Qf,{scope:i,anchor:n,onAnchorChange:s},r)},cp=ep,up=np,hp=(0,e.forwardRef)(((t,i)=>(0,e.createElement)(Yt.span,Ot({},t,{ref:i,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...t.style}})))),dp=[" ","Enter","ArrowUp","ArrowDown"],fp=[" ","Enter"],pp="Select",[gp,mp,vp]=gr(pp),[yp,wp]=Ft(pp,[vp,Zf]),Ep=Zf(),[bp,Tp]=yp(pp),[Sp,xp]=yp(pp),Rp=(0,e.forwardRef)(((t,i)=>{const{__scopeSelect:r,disabled:n=!1,...s}=t,o=Ep(r),a=Tp("SelectTrigger",r),l=a.disabled||n,c=zt(i,a.onTriggerChange),u=mp(r),[h,d,f]=rg((e=>{const t=u().filter((e=>!e.disabled)),i=t.find((e=>e.value===a.value)),r=ng(t,e,i);void 0!==r&&a.onValueChange(r.value)})),p=()=>{l||(a.onOpenChange(!0),f())};return(0,e.createElement)(cp,Ot({asChild:!0},o),(0,e.createElement)(Yt.button,Ot({type:"button",role:"combobox","aria-controls":a.contentId,"aria-expanded":a.open,"aria-required":a.required,"aria-autocomplete":"none",dir:a.dir,"data-state":a.open?"open":"closed",disabled:l,"data-disabled":l?"":void 0,"data-placeholder":void 0===a.value?"":void 0},s,{ref:c,onClick:Mt(s.onClick,(e=>{e.currentTarget.focus()})),onPointerDown:Mt(s.onPointerDown,(e=>{const t=e.target;t.hasPointerCapture(e.pointerId)&&t.releasePointerCapture(e.pointerId),0===e.button&&!1===e.ctrlKey&&(p(),a.triggerPointerDownPosRef.current={x:Math.round(e.pageX),y:Math.round(e.pageY)},e.preventDefault())})),onKeyDown:Mt(s.onKeyDown,(e=>{const t=""!==h.current;e.ctrlKey||e.altKey||e.metaKey||1!==e.key.length||d(e.key),t&&" "===e.key||dp.includes(e.key)&&(p(),e.preventDefault())}))})))})),Cp=(0,e.forwardRef)(((t,i)=>{const{__scopeSelect:r,className:n,style:s,children:o,placeholder:a,...l}=t,c=Tp("SelectValue",r),{onValueNodeHasChildrenChange:u}=c,h=void 0!==o,d=zt(i,c.onValueNodeChange);return $t((()=>{u(h)}),[u,h]),(0,e.createElement)(Yt.span,Ot({},l,{ref:d,style:{pointerEvents:"none"}}),void 0===c.value&&void 0!==a?a:o)})),Ap=(0,e.forwardRef)(((t,i)=>{const{__scopeSelect:r,children:n,...s}=t;return(0,e.createElement)(Yt.span,Ot({"aria-hidden":!0},s,{ref:i}),n||"▼")})),kp="SelectContent",Lp=(0,e.forwardRef)(((t,i)=>{const r=Tp(kp,t.__scopeSelect),[n,s]=(0,e.useState)();if($t((()=>{s(new DocumentFragment)}),[]),!r.open){const i=n;return i?(0,jt.createPortal)((0,e.createElement)(Pp,{scope:t.__scopeSelect},(0,e.createElement)(gp.Slot,{scope:t.__scopeSelect},(0,e.createElement)("div",null,t.children))),i):null}return(0,e.createElement)(Dp,Ot({},t,{ref:i}))})),Ip=10,[Pp,_p]=yp(kp),Dp=(0,e.forwardRef)(((t,i)=>{const{__scopeSelect:r,position:n="item-aligned",onCloseAutoFocus:s,onEscapeKeyDown:o,onPointerDownOutside:a,side:l,sideOffset:c,align:u,alignOffset:h,arrowPadding:d,collisionBoundary:f,collisionPadding:p,sticky:g,hideWhenDetached:m,avoidCollisions:v,...y}=t,w=Tp(kp,r),[E,b]=(0,e.useState)(null),[T,S]=(0,e.useState)(null),x=zt(i,(e=>b(e))),[R,C]=(0,e.useState)(null),[A,k]=(0,e.useState)(null),L=mp(r),[I,P]=(0,e.useState)(!1),_=(0,e.useRef)(!1);(0,e.useEffect)((()=>{if(E)return Id(E)}),[E]),_u();const D=(0,e.useCallback)((e=>{const[t,...i]=L().map((e=>e.ref.current)),[r]=i.slice(-1),n=document.activeElement;for(const i of e){if(i===n)return;if(null==i||i.scrollIntoView({block:"nearest"}),i===t&&T&&(T.scrollTop=0),i===r&&T&&(T.scrollTop=T.scrollHeight),null==i||i.focus(),document.activeElement!==n)return}}),[L,T]),O=(0,e.useCallback)((()=>D([R,E])),[D,R,E]);(0,e.useEffect)((()=>{I&&O()}),[I,O]);const{onOpenChange:M,triggerPointerDownPosRef:F}=w;(0,e.useEffect)((()=>{if(E){let e={x:0,y:0};const t=t=>{var i,r,n,s;e={x:Math.abs(Math.round(t.pageX)-(null!==(i=null===(r=F.current)||void 0===r?void 0:r.x)&&void 0!==i?i:0)),y:Math.abs(Math.round(t.pageY)-(null!==(n=null===(s=F.current)||void 0===s?void 0:s.y)&&void 0!==n?n:0))}},i=i=>{e.x<=10&&e.y<=10?i.preventDefault():E.contains(i.target)||M(!1),document.removeEventListener("pointermove",t),F.current=null};return null!==F.current&&(document.addEventListener("pointermove",t),document.addEventListener("pointerup",i,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",t),document.removeEventListener("pointerup",i,{capture:!0})}}}),[E,M,F]),(0,e.useEffect)((()=>{const e=()=>M(!1);return window.addEventListener("blur",e),window.addEventListener("resize",e),()=>{window.removeEventListener("blur",e),window.removeEventListener("resize",e)}}),[M]);const[N,B]=rg((e=>{const t=L().filter((e=>!e.disabled)),i=t.find((e=>e.ref.current===document.activeElement)),r=ng(t,e,i);r&&setTimeout((()=>r.ref.current.focus()))})),U=(0,e.useCallback)(((e,t,i)=>{const r=!_.current&&!i;(void 0!==w.value&&w.value===t||r)&&(C(e),r&&(_.current=!0))}),[w.value]),$=(0,e.useCallback)((()=>null==E?void 0:E.focus()),[E]),H=(0,e.useCallback)(((e,t,i)=>{const r=!_.current&&!i;(void 0!==w.value&&w.value===t||r)&&k(e)}),[w.value]),z="popper"===n?Mp:Op,j=z===Mp?{side:l,sideOffset:c,align:u,alignOffset:h,arrowPadding:d,collisionBoundary:f,collisionPadding:p,sticky:g,hideWhenDetached:m,avoidCollisions:v}:{};return(0,e.createElement)(Pp,{scope:r,content:E,viewport:T,onViewportChange:S,itemRefCallback:U,selectedItem:R,onItemLeave:$,itemTextRefCallback:H,focusSelectedItem:O,selectedItemText:A,position:n,isPositioned:I,searchRef:N},(0,e.createElement)(uf,{as:Gt,allowPinchZoom:!0},(0,e.createElement)(zf,{asChild:!0,trapped:w.open,onMountAutoFocus:e=>{e.preventDefault()},onUnmountAutoFocus:Mt(s,(e=>{var t;null===(t=w.trigger)||void 0===t||t.focus({preventScroll:!0}),e.preventDefault()}))},(0,e.createElement)(Ff,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:o,onPointerDownOutside:a,onFocusOutside:e=>e.preventDefault(),onDismiss:()=>w.onOpenChange(!1)},(0,e.createElement)(z,Ot({role:"listbox",id:w.contentId,"data-state":w.open?"open":"closed",dir:w.dir,onContextMenu:e=>e.preventDefault()},y,j,{onPlaced:()=>P(!0),ref:x,style:{display:"flex",flexDirection:"column",outline:"none",...y.style},onKeyDown:Mt(y.onKeyDown,(e=>{const t=e.ctrlKey||e.altKey||e.metaKey;if("Tab"===e.key&&e.preventDefault(),t||1!==e.key.length||B(e.key),["ArrowUp","ArrowDown","Home","End"].includes(e.key)){let t=L().filter((e=>!e.disabled)).map((e=>e.ref.current));if(["ArrowUp","End"].includes(e.key)&&(t=t.slice().reverse()),["ArrowUp","ArrowDown"].includes(e.key)){const i=e.target,r=t.indexOf(i);t=t.slice(r+1)}setTimeout((()=>D(t))),e.preventDefault()}}))}))))))})),Op=(0,e.forwardRef)(((t,i)=>{const{__scopeSelect:r,onPlaced:n,...s}=t,o=Tp(kp,r),a=_p(kp,r),[l,c]=(0,e.useState)(null),[u,h]=(0,e.useState)(null),d=zt(i,(e=>h(e))),f=mp(r),p=(0,e.useRef)(!1),g=(0,e.useRef)(!0),{viewport:m,selectedItem:v,selectedItemText:y,focusSelectedItem:w}=a,E=(0,e.useCallback)((()=>{if(o.trigger&&o.valueNode&&l&&u&&m&&v&&y){const e=o.trigger.getBoundingClientRect(),t=u.getBoundingClientRect(),i=o.valueNode.getBoundingClientRect(),r=y.getBoundingClientRect();if("rtl"!==o.dir){const n=r.left-t.left,s=i.left-n,o=e.left-s,a=e.width+o,c=Math.max(a,t.width),u=window.innerWidth-Ip,h=_f(s,[Ip,u-c]);l.style.minWidth=a+"px",l.style.left=h+"px"}else{const n=t.right-r.right,s=window.innerWidth-i.right-n,o=window.innerWidth-e.right-s,a=e.width+o,c=Math.max(a,t.width),u=window.innerWidth-Ip,h=_f(s,[Ip,u-c]);l.style.minWidth=a+"px",l.style.right=h+"px"}const s=f(),a=window.innerHeight-2*Ip,c=m.scrollHeight,h=window.getComputedStyle(u),d=parseInt(h.borderTopWidth,10),g=parseInt(h.paddingTop,10),w=parseInt(h.borderBottomWidth,10),E=d+g+c+parseInt(h.paddingBottom,10)+w,b=Math.min(5*v.offsetHeight,E),T=window.getComputedStyle(m),S=parseInt(T.paddingTop,10),x=parseInt(T.paddingBottom,10),R=e.top+e.height/2-Ip,C=a-R,A=v.offsetHeight/2,k=d+g+(v.offsetTop+A),L=E-k;if(k<=R){const e=v===s[s.length-1].ref.current;l.style.bottom="0px";const t=u.clientHeight-m.offsetTop-m.offsetHeight,i=k+Math.max(C,A+(e?x:0)+t+w);l.style.height=i+"px"}else{const e=v===s[0].ref.current;l.style.top="0px";const t=Math.max(R,d+m.offsetTop+(e?S:0)+A)+L;l.style.height=t+"px",m.scrollTop=k-R+m.offsetTop}l.style.margin=`${Ip}px 0`,l.style.minHeight=b+"px",l.style.maxHeight=a+"px",null==n||n(),requestAnimationFrame((()=>p.current=!0))}}),[f,o.trigger,o.valueNode,l,u,m,v,y,o.dir,n]);$t((()=>E()),[E]);const[b,T]=(0,e.useState)();$t((()=>{u&&T(window.getComputedStyle(u).zIndex)}),[u]);const S=(0,e.useCallback)((e=>{e&&!0===g.current&&(E(),null==w||w(),g.current=!1)}),[E,w]);return(0,e.createElement)(Fp,{scope:r,contentWrapper:l,shouldExpandOnScrollRef:p,onScrollButtonChange:S},(0,e.createElement)("div",{ref:c,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:b}},(0,e.createElement)(Yt.div,Ot({},s,{ref:d,style:{boxSizing:"border-box",maxHeight:"100%",...s.style}}))))})),Mp=(0,e.forwardRef)(((t,i)=>{const{__scopeSelect:r,align:n="start",collisionPadding:s=Ip,...o}=t,a=Ep(r);return(0,e.createElement)(up,Ot({},a,o,{ref:i,align:n,collisionPadding:s,style:{boxSizing:"border-box",...o.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}}))})),[Fp,Np]=yp(kp,{}),Bp="SelectViewport",Up=(0,e.forwardRef)(((t,i)=>{const{__scopeSelect:r,...n}=t,s=_p(Bp,r),o=Np(Bp,r),a=zt(i,s.onViewportChange),l=(0,e.useRef)(0);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"}}),(0,e.createElement)(gp.Slot,{scope:r},(0,e.createElement)(Yt.div,Ot({"data-radix-select-viewport":"",role:"presentation"},n,{ref:a,style:{position:"relative",flex:1,overflow:"auto",...n.style},onScroll:Mt(n.onScroll,(e=>{const t=e.currentTarget,{contentWrapper:i,shouldExpandOnScrollRef:r}=o;if(null!=r&&r.current&&i){const e=Math.abs(l.current-t.scrollTop);if(e>0){const r=window.innerHeight-2*Ip,n=parseFloat(i.style.minHeight),s=parseFloat(i.style.height),o=Math.max(n,s);if(o<r){const n=o+e,s=Math.min(r,n),a=n-s;i.style.height=s+"px","0px"===i.style.bottom&&(t.scrollTop=a>0?a:0,i.style.justifyContent="flex-end")}}}l.current=t.scrollTop}))}))))})),[$p,Hp]=yp("SelectGroup"),zp=(0,e.forwardRef)(((t,i)=>{const{__scopeSelect:r,...n}=t,s=ti();return(0,e.createElement)($p,{scope:r,id:s},(0,e.createElement)(Yt.div,Ot({role:"group","aria-labelledby":s},n,{ref:i})))})),jp=(0,e.forwardRef)(((t,i)=>{const{__scopeSelect:r,...n}=t,s=Hp("SelectLabel",r);return(0,e.createElement)(Yt.div,Ot({id:s.id},n,{ref:i}))})),Gp="SelectItem",[Vp,qp]=yp(Gp),Wp=(0,e.forwardRef)(((t,i)=>{const{__scopeSelect:r,value:n,disabled:s=!1,textValue:o,...a}=t,l=Tp(Gp,r),c=_p(Gp,r),u=l.value===n,[h,d]=(0,e.useState)(null!=o?o:""),[f,p]=(0,e.useState)(!1),g=zt(i,(e=>{var t;return null===(t=c.itemRefCallback)||void 0===t?void 0:t.call(c,e,n,s)})),m=ti(),v=()=>{s||(l.onValueChange(n),l.onOpenChange(!1))};return(0,e.createElement)(Vp,{scope:r,value:n,disabled:s,textId:m,isSelected:u,onItemTextChange:(0,e.useCallback)((e=>{d((t=>{var i;return t||(null!==(i=null==e?void 0:e.textContent)&&void 0!==i?i:"").trim()}))}),[])},(0,e.createElement)(gp.ItemSlot,{scope:r,value:n,disabled:s,textValue:h},(0,e.createElement)(Yt.div,Ot({role:"option","aria-labelledby":m,"data-highlighted":f?"":void 0,"aria-selected":u&&f,"data-state":u?"checked":"unchecked","aria-disabled":s||void 0,"data-disabled":s?"":void 0,tabIndex:s?void 0:-1},a,{ref:g,onFocus:Mt(a.onFocus,(()=>p(!0))),onBlur:Mt(a.onBlur,(()=>p(!1))),onPointerUp:Mt(a.onPointerUp,v),onPointerMove:Mt(a.onPointerMove,(e=>{var t;s?null===(t=c.onItemLeave)||void 0===t||t.call(c):e.currentTarget.focus({preventScroll:!0})})),onPointerLeave:Mt(a.onPointerLeave,(e=>{var t;e.currentTarget===document.activeElement&&(null===(t=c.onItemLeave)||void 0===t||t.call(c))})),onKeyDown:Mt(a.onKeyDown,(e=>{var t;""!==(null===(t=c.searchRef)||void 0===t?void 0:t.current)&&" "===e.key||(fp.includes(e.key)&&v()," "===e.key&&e.preventDefault())}))}))))})),Kp="SelectItemText",Yp=(0,e.forwardRef)(((t,i)=>{const{__scopeSelect:r,className:n,style:s,...o}=t,a=Tp(Kp,r),l=_p(Kp,r),c=qp(Kp,r),u=xp(Kp,r),[h,d]=(0,e.useState)(null),f=zt(i,(e=>d(e)),c.onItemTextChange,(e=>{var t;return null===(t=l.itemTextRefCallback)||void 0===t?void 0:t.call(l,e,c.value,c.disabled)})),p=null==h?void 0:h.textContent,g=(0,e.useMemo)((()=>(0,e.createElement)("option",{key:c.value,value:c.value,disabled:c.disabled},p)),[c.disabled,c.value,p]),{onNativeOptionAdd:m,onNativeOptionRemove:v}=u;return $t((()=>(m(g),()=>v(g))),[m,v,g]),(0,e.createElement)(e.Fragment,null,(0,e.createElement)(Yt.span,Ot({id:c.textId},o,{ref:f})),c.isSelected&&a.valueNode&&!a.valueNodeHasChildren?(0,jt.createPortal)(o.children,a.valueNode):null)})),Xp=(0,e.forwardRef)(((t,i)=>{const{__scopeSelect:r,...n}=t;return qp("SelectItemIndicator",r).isSelected?(0,e.createElement)(Yt.span,Ot({"aria-hidden":!0},n,{ref:i})):null})),Zp="SelectScrollUpButton",Qp=(0,e.forwardRef)(((t,i)=>{const r=_p(Zp,t.__scopeSelect),n=Np(Zp,t.__scopeSelect),[s,o]=(0,e.useState)(!1),a=zt(i,n.onScrollButtonChange);return $t((()=>{if(r.viewport&&r.isPositioned){const e=r.viewport;function t(){const t=e.scrollTop>0;o(t)}return t(),e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)}}),[r.viewport,r.isPositioned]),s?(0,e.createElement)(tg,Ot({},t,{ref:a,onAutoScroll:()=>{const{viewport:e,selectedItem:t}=r;e&&t&&(e.scrollTop=e.scrollTop-t.offsetHeight)}})):null})),Jp="SelectScrollDownButton",eg=(0,e.forwardRef)(((t,i)=>{const r=_p(Jp,t.__scopeSelect),n=Np(Jp,t.__scopeSelect),[s,o]=(0,e.useState)(!1),a=zt(i,n.onScrollButtonChange);return $t((()=>{if(r.viewport&&r.isPositioned){const e=r.viewport;function t(){const t=e.scrollHeight-e.clientHeight,i=Math.ceil(e.scrollTop)<t;o(i)}return t(),e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)}}),[r.viewport,r.isPositioned]),s?(0,e.createElement)(tg,Ot({},t,{ref:a,onAutoScroll:()=>{const{viewport:e,selectedItem:t}=r;e&&t&&(e.scrollTop=e.scrollTop+t.offsetHeight)}})):null})),tg=(0,e.forwardRef)(((t,i)=>{const{__scopeSelect:r,onAutoScroll:n,...s}=t,o=_p("SelectScrollButton",r),a=(0,e.useRef)(null),l=mp(r),c=(0,e.useCallback)((()=>{null!==a.current&&(window.clearInterval(a.current),a.current=null)}),[]);return(0,e.useEffect)((()=>()=>c()),[c]),$t((()=>{var e;const t=l().find((e=>e.ref.current===document.activeElement));null==t||null===(e=t.ref.current)||void 0===e||e.scrollIntoView({block:"nearest"})}),[l]),(0,e.createElement)(Yt.div,Ot({"aria-hidden":!0},s,{ref:i,style:{flexShrink:0,...s.style},onPointerDown:Mt(s.onPointerDown,(()=>{null===a.current&&(a.current=window.setInterval(n,50))})),onPointerMove:Mt(s.onPointerMove,(()=>{var e;null===(e=o.onItemLeave)||void 0===e||e.call(o),null===a.current&&(a.current=window.setInterval(n,50))})),onPointerLeave:Mt(s.onPointerLeave,(()=>{c()}))}))})),ig=(0,e.forwardRef)(((t,i)=>{const{value:r,...n}=t,s=(0,e.useRef)(null),o=zt(i,s),a=nu(r);return(0,e.useEffect)((()=>{const e=s.current,t=window.HTMLSelectElement.prototype,i=Object.getOwnPropertyDescriptor(t,"value").set;if(a!==r&&i){const t=new Event("change",{bubbles:!0});i.call(e,r),e.dispatchEvent(t)}}),[a,r]),(0,e.createElement)(hp,{asChild:!0},(0,e.createElement)("select",Ot({},n,{ref:o,defaultValue:r})))}));function rg(t){const i=Bt(t),r=(0,e.useRef)(""),n=(0,e.useRef)(0),s=(0,e.useCallback)((e=>{const t=r.current+e;i(t),function e(t){r.current=t,window.clearTimeout(n.current),""!==t&&(n.current=window.setTimeout((()=>e("")),1e3))}(t)}),[i]),o=(0,e.useCallback)((()=>{r.current="",window.clearTimeout(n.current)}),[]);return(0,e.useEffect)((()=>()=>window.clearTimeout(n.current)),[]),[r,s,o]}function ng(e,t,i){const r=t.length>1&&Array.from(t).every((e=>e===t[0]))?t[0]:t,n=i?e.indexOf(i):-1;let s=(o=e,a=Math.max(n,0),o.map(((e,t)=>o[(a+t)%o.length])));var o,a;1===r.length&&(s=s.filter((e=>e!==i)));const l=s.find((e=>e.textValue.toLowerCase().startsWith(r.toLowerCase())));return l!==i?l:void 0}ig.displayName="BubbleSelect";const sg=t=>{const{__scopeSelect:i,children:r,open:n,defaultOpen:s,onOpenChange:o,value:a,defaultValue:l,onValueChange:c,dir:u,name:h,autoComplete:d,disabled:f,required:p}=t,g=Ep(i),[m,v]=(0,e.useState)(null),[y,w]=(0,e.useState)(null),[E,b]=(0,e.useState)(!1),T=vr(u),[S=!1,x]=Ut({prop:n,defaultProp:s,onChange:o}),[R,C]=Ut({prop:a,defaultProp:l,onChange:c}),A=(0,e.useRef)(null),k=!m||Boolean(m.closest("form")),[L,I]=(0,e.useState)(new Set),P=Array.from(L).map((e=>e.props.value)).join(";");return(0,e.createElement)(lp,g,(0,e.createElement)(bp,{required:p,scope:i,trigger:m,onTriggerChange:v,valueNode:y,onValueNodeChange:w,valueNodeHasChildren:E,onValueNodeHasChildrenChange:b,contentId:ti(),value:R,onValueChange:C,open:S,onOpenChange:x,dir:T,triggerPointerDownPosRef:A,disabled:f},(0,e.createElement)(gp.Provider,{scope:i},(0,e.createElement)(Sp,{scope:t.__scopeSelect,onNativeOptionAdd:(0,e.useCallback)((e=>{I((t=>new Set(t).add(e)))}),[]),onNativeOptionRemove:(0,e.useCallback)((e=>{I((t=>{const i=new Set(t);return i.delete(e),i}))}),[])},r)),k?(0,e.createElement)(ig,{key:P,"aria-hidden":!0,required:p,tabIndex:-1,name:h,autoComplete:d,value:R,onChange:e=>C(e.target.value),disabled:f},void 0===R?(0,e.createElement)("option",{value:""}):null,Array.from(L)):null))},og=Rp,ag=Cp,lg=Ap,cg=Lp,ug=Up,hg=zp,dg=jp,fg=Wp,pg=Yp,gg=Xp,mg=Qp,vg=eg,yg="Switch",[wg,Eg]=Ft(yg),[bg,Tg]=wg(yg),Sg=(0,e.forwardRef)(((t,i)=>{const{__scopeSwitch:r,name:n,checked:s,defaultChecked:o,required:a,disabled:l,value:c="on",onCheckedChange:u,...h}=t,[d,f]=(0,e.useState)(null),p=zt(i,(e=>f(e))),g=(0,e.useRef)(!1),m=!d||Boolean(d.closest("form")),[v=!1,y]=Ut({prop:s,defaultProp:o,onChange:u});return(0,e.createElement)(bg,{scope:r,checked:v,disabled:l},(0,e.createElement)(Yt.button,Ot({type:"button",role:"switch","aria-checked":v,"aria-required":a,"data-state":Rg(v),"data-disabled":l?"":void 0,disabled:l,value:c},h,{ref:p,onClick:Mt(t.onClick,(e=>{y((e=>!e)),m&&(g.current=e.isPropagationStopped(),g.current||e.stopPropagation())}))})),m&&(0,e.createElement)(xg,{control:d,bubbles:!g.current,name:n,value:c,checked:v,required:a,disabled:l,style:{transform:"translateX(-100%)"}}))})),xg=t=>{const{control:i,checked:r,bubbles:n=!0,...s}=t,o=(0,e.useRef)(null),a=nu(r),l=ru(i);return(0,e.useEffect)((()=>{const e=o.current,t=window.HTMLInputElement.prototype,i=Object.getOwnPropertyDescriptor(t,"checked").set;if(a!==r&&i){const t=new Event("click",{bubbles:n});i.call(e,r),e.dispatchEvent(t)}}),[a,r,n]),(0,e.createElement)("input",Ot({type:"checkbox","aria-hidden":!0,defaultChecked:r},s,{tabIndex:-1,ref:o,style:{...t.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function Rg(e){return e?"checked":"unchecked"}const Cg=Sg,Ag=(0,e.forwardRef)(((t,i)=>{const{__scopeSwitch:r,...n}=t,s=Tg("SwitchThumb",r);return(0,e.createElement)(Yt.span,Ot({"data-state":Rg(s.checked),"data-disabled":s.disabled?"":void 0},n,{ref:i}))})),kg=e=>(e=>{var t=e.toString().split(":"),i=Math.ceil(parseInt(t[0])),r=Math.ceil(parseInt(t[1])),n=Pg(Math.ceil(parseInt(t[2])),2);let s=`${0!==i&&r<10?(r+"").padStart(2,"0"):r}:${n}`;return 0!==i&&(s=`${i}:${s}`),s})(new Date(1e3*e).toISOString().substr(11,8)),Lg=(e,t)=>{if("object"!=typeof e||null===e)return t;for(const i in t)"object"!=typeof t[i]||null===t[i]||Array.isArray(t[i])?e[i]=t[i]:(e[i]||(e[i]={}),e[i]=Lg(e[i],t[i]));return e},Ig=(e,t)=>Object.hasOwn(e,t)?e[t].toString():void 0,Pg=(e,t)=>String(e).padStart(t,"0"),_g={background:"transparent",canvasBackgroundColor:"#6662",canvasHeight:"61.8vh",ignoreCaptionLabels:[],informationPanel:{open:!0,renderAbout:!0,renderSupplementing:!0,renderToggle:!0},openSeadragon:{},requestHeaders:{"Content-Type":"application/json"},showIIIFBadge:!0,showTitle:!0,withCredentials:!1};var Dg;const Og={activeCanvas:"",activeManifest:"",collection:{},configOptions:_g,informationOpen:null==(Dg=null==_g?void 0:_g.informationPanel)?void 0:Dg.open,isLoaded:!1,vault:new Dt},Mg=e.createContext(Og),Fg=e.createContext(Og);function Ng(e,t){switch(t.type){case"updateActiveCanvas":return t.canvasId||(t.canvasId=""),{...e,activeCanvas:t.canvasId};case"updateActiveManifest":return{...e,activeManifest:t.manifestId};case"updateCollection":return{...e,collection:t.collection};case"updateConfigOptions":return{...e,configOptions:Lg(e.configOptions,t.configOptions)};case"updateInformationOpen":return{...e,informationOpen:t.informationOpen};case"updateIsLoaded":return{...e,isLoaded:t.isLoaded};default:throw new Error(`Unhandled action type: ${t.type}`)}}const Bg=({initialState:t=Og,children:i})=>{const[r,n]=(0,e.useReducer)(Ng,t);return e.createElement(Mg.Provider,{value:r},e.createElement(Fg.Provider,{value:n},i))};function Ug(){const t=e.useContext(Mg);if(void 0===t)throw new Error("useViewerState must be used within a ViewerProvider");return t}function $g(){const t=e.useContext(Fg);if(void 0===t)throw new Error("useViewerDispatch must be used within a ViewerProvider");return t}const Hg=(e,t,i,r)=>{var n,s;const o={canvas:void 0,accompanyingCanvas:void 0,annotationPage:void 0,annotations:[]};return o.canvas=e.get(t),o.canvas&&(o.annotationPage=e.get(o.canvas.items[0]),o.accompanyingCanvas=null!=(n=o.canvas)&&n.accompanyingCanvas?e.get(null==(s=o.canvas)?void 0:s.accompanyingCanvas):void 0),o.annotationPage&&(o.annotations=e.get(o.annotationPage.items).filter((n=>{if(n){if(!n.body||!n.motivation)return void console.error("Invalid annotation after Hyperion parsing: missing either 'body' or 'motivation'",n);let s=n.body;Array.isArray(s)&&(s=s[0]);const o=e.get(s.id);if(!o)return;switch(i){case"painting":return n.target===t.id&&n.motivation&&"painting"===n.motivation[0]&&r.includes(o.type)&&(n.body=o),!!n;case"supplementing":return;default:throw new Error("Invalid annotation motivation.")}}}))),o},zg=(e,t="en")=>{if(!e)return"";if(!e[t]){const t=Object.getOwnPropertyNames(e);if(t.length>0)return e[t[0]]}return e[t]},jg=(e,t)=>{const i=Hg(e,{id:t,type:"Canvas"},"painting",["Image","Sound","Video"]);if(0!==i.annotations.length&&i.annotations[0]&&i.annotations[0].body)return i.annotations[0].body},Gg=(e,t,i,r)=>{let n=[];if(t.canvas&&t.canvas.thumbnail.length>0){const i=e.get(t.canvas.thumbnail[0]);n.push(i)}if(t.annotations[0]){if(t.annotations[0].thumbnail&&t.annotations[0].thumbnail.length>0){const i=e.get(t.annotations[0].thumbnail[0]);n.push(i)}if(!t.annotations[0].body)return;const i=t.annotations[0].body;"Image"===i.type&&n.push(i)}return 0===n.length?void 0:{id:n[0].id,format:n[0].format,type:n[0].type,width:i,height:r}},Vg={xxs:"(max-width: 349px)",xs:"(max-width: 575px)",sm:"(max-width: 767px)",md:"(max-width: 991px)",lg:"(max-width: 90rem)",xl:"(min-width: calc(90rem + 1px))"},{styled:qg,css:Wg,keyframes:Kg,createTheme:Yg}=pr({theme:{colors:{primary:"#1a1d1e",primaryMuted:"#26292b",primaryAlt:"#151718",accent:"hsl(209 100% 38.2%)",accentMuted:"hsl(209 80% 61.8%)",accentAlt:"hsl(209 80% 30%)",secondary:"#FFFFFF",secondaryMuted:"#e6e8eb",secondaryAlt:"#c1c8cd"},fontSizes:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},lineHeights:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},sizes:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},space:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},radii:{1:"4px",2:"6px",3:"8px",4:"12px",round:"50%",pill:"9999px"},transitions:{all:"all 300ms cubic-bezier(0.16, 1, 0.3, 1)"},zIndices:{1:"100",2:"200",3:"300",4:"400",max:"999"}},media:Vg}),Xg=qg("div",{display:"flex",flexDirection:"column",alignItems:"center"}),Zg=qg("p",{fontWeight:"bold",fontSize:"x-large"}),Qg=qg("span",{fontSize:"medium"}),Jg=({error:t})=>{const{message:i}=t;return e.createElement(Xg,{role:"alert"},e.createElement(Zg,{"data-testid":"headline"},"Something went wrong"),i&&e.createElement(Qg,null,`Error message: ${i}`," "))},em=qg("div",{position:"relative",zIndex:"0"}),tm=qg("div",{display:"flex",flexDirection:"row",overflow:"hidden","@sm":{flexDirection:"column"}}),im=qg("div",{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",width:"61.8%","@sm":{width:"100%"}}),rm=qg(pi,{display:"none",border:"none",padding:"0",transition:"$all",opacity:"1",background:"#6663",margin:"1rem 0",borderRadius:"6px","&[data-information-panel='false']":{opacity:"0",marginTop:"-59px"},"@sm":{display:"flex","> span":{display:"flex",flexGrow:"1",fontSize:"0.8333em",justifyContent:"center",padding:"0.5rem",fontFamily:"inherit"}}}),nm=qg(gi,{width:"100%",display:"flex"}),sm=qg("aside",{display:"flex",flexGrow:"1",flexShrink:"0",width:"38.2%",maxHeight:"100%","@sm":{width:"100%"}}),om=qg("div",{display:"flex",flexDirection:"column",fontSmooth:"auto",webkitFontSmoothing:"antialiased","> div":{display:"flex",flexDirection:"column",flexGrow:"1",justifyContent:"flex-start","@sm":{[`& ${tm}`]:{flexGrow:"1"},[`& ${im}`]:{flexGrow:"0"}}},"@sm":{padding:"0"},"&[data-information-panel-open='true']":{"@sm":{position:"fixed",height:"100%",width:"100%",top:"0",left:"0",zIndex:"2500000000",[`& ${em}`]:{display:"none"},[`& ${rm}`]:{margin:"1rem"},[`& ${nm}`]:{height:"100%"}}}}),am=qg(jr,{display:"flex",flexDirection:"column",width:"100%",height:"100%",flexGrow:"1",flexShrink:"0",position:"relative",zIndex:"1",maskImage:"linear-gradient(180deg, rgba(0, 0, 0, 1) calc(100% - 2rem), transparent 100%)","@sm":{marginTop:"0.5rem",boxShadow:"none"}}),lm=qg(Gr,{display:"flex",flexGrow:"0",margin:"0 1.618rem",borderBottom:"4px solid #6663","@sm":{margin:"0 1rem"}}),cm=qg(Vr,{display:"flex",position:"relative",padding:"0.5rem 1rem",background:"none",backgroundColor:"transparent",fontFamily:"inherit",border:"none",opacity:"0.7",fontSize:"1rem",marginRight:"1rem",lineHeight:"1rem",whiteSpace:"nowrap",cursor:"pointer",fontWeight:400,transition:"$all","&::after":{width:"0",height:"4px",content:"",position:"absolute",bottom:"-4px",left:"0",transition:"$all"},"&[data-state='active']":{opacity:"1",fontWeight:700,"&::after":{width:"100%",backgroundColor:"$accent"}}}),um=qg(qr,{display:"flex",flexGrow:"1",flexShrink:"0",position:"absolute",top:"0",left:"0","&[data-state='active']":{width:"100%",height:"calc(100% - 2rem)",padding:"1.618rem 0"}}),hm=qg("div",{position:"relative",height:"100%",width:"100%",overflowY:"scroll"}),dm=qg("div",{padding:" 0 1.618rem 2rem",display:"flex",flexDirection:"column",overflow:"scroll",position:"absolute",fontWeight:"400",fontSize:"1rem",zIndex:"0",img:{maxWidth:"100px",maxHeight:"100px",objectFit:"contain",color:"transparent",margin:"0 0 1rem",borderRadius:"3px",backgroundColor:"$secondaryMuted"},video:{display:"none"},"a, a:visited":{color:"$accent"},p:{fontSize:"1rem",lineHeight:"1.45em",margin:"0"},dl:{margin:"0",dt:{fontWeight:"700",margin:"1rem 0 0.25rem"},dd:{margin:"0"}},".manifest-property-title":{fontWeight:"700",margin:"1rem 0 0.25rem"},"ul, ol":{padding:"0",margin:"0",li:{fontSize:"1rem",lineHeight:"1.45em",listStyle:"none",margin:"0.25rem 0 0.25rem"}}}),fm=qg("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),pm=(e,t="none")=>{if(!e)return null;if("string"==typeof e)return[e];if(!e[t]){const t=Object.getOwnPropertyNames(e);if(t.length>0)return e[t[0]]}return e[t]&&Array.isArray(e[t])?e[t]:null},gm=(e,t="none",i=", ")=>{const r=pm(e,t);return Array.isArray(r)?r.join(`${i}`):r};function mm(e,t){const i=Object.keys(e).filter((e=>t.includes(e)?null:e));let r=new Object;return i.forEach((t=>{r[t]=e[t]})),r}function vm(e){return Wr(e,{allowedAttributes:{a:["href"],img:["alt","src","height","width"]},allowedSchemes:["http","https","mailto"],allowedTags:["a","b","br","i","img","p","small","span","sub","sup"]})}const ym=qg("span",{}),wm=t=>{const{as:i,label:r}=t;let n=mm(t,["as","label"]);return e.createElement(ym,{as:i,...n},gm(r,n.lang))},Em=qg("img",{objectFit:"cover"}),bm=t=>{const i=(0,e.useRef)(null),{contentResource:r,altAsLabel:n,region:s="full"}=t;let o;n&&(o=gm(n));const a=mm(t,["contentResource","altAsLabel"]),{type:l,id:c,width:u=200,height:h=200,format:d,duration:f}=r;(0,e.useEffect)((()=>{if(!c&&!i.current||["Image"].includes(l)||!c.includes("m3u8"))return;const e=new Xc;return i.current&&(e.attachMedia(i.current),e.on(Xc.Events.MEDIA_ATTACHED,(function(){e.loadSource(c)}))),e.on(Xc.Events.ERROR,(function(t,i){if(i.fatal)switch(i.type){case Xc.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${t} network error encountered, try to recover`),e.startLoad();break;case Xc.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${t} media error encountered, try to recover`),e.recoverMediaError();break;default:e.destroy()}})),()=>{e&&(e.detachMedia(),e.destroy())}}),[]),(0,e.useEffect)((()=>p()),[]);const p=()=>{if(!i.current)return;let e=0,t=30;if(f&&(t=f),!c.split("#t=")&&f&&(e=.1*f),c.split("#t=").pop()){const t=c.split("#t=").pop();t&&(e=parseInt(t.split(",")[0]))}const r=i.current;r.autoplay=!0,r.currentTime=e,setTimeout((()=>p()),1e3*t)};switch(l){case"Image":const t=((e,t="200,",i="full")=>{Array.isArray(e)&&(e=e[0]);const{id:r,service:n}=e;let s;if(!n)return r;if(Array.isArray(e.service)&&e.service.length>0&&(s=n[0]),s){if(s["@id"])return`${s["@id"]}/${i}/${t}/0/default.jpg`;if(s.id)return`${s.id}/${i}/${t}/0/default.jpg`}})(r,`${u},${h}`,s);return e.createElement(Em,{as:"img",alt:o,css:{width:u,height:h},key:c,src:t,...a});case"Video":return e.createElement(Em,{as:"video",css:{width:u,height:h},disablePictureInPicture:!0,key:c,loop:!0,muted:!0,onPause:p,ref:i,src:c});default:return console.warn(`Resource type: ${l} is not valid or not yet supported in Primitives.`),e.createElement(e.Fragment,null)}},Tm=qg("a",{}),Sm=t=>{const{children:i,homepage:r}=t,n=mm(t,["children","homepage"]);return e.createElement(e.Fragment,null,r&&r.map((t=>{const r=gm(t.label,n.lang);return e.createElement(Tm,{"aria-label":i?r:void 0,href:t.id,key:t.id,...n},i||r)})))},xm={delimiter:", "},Rm=(0,e.createContext)(void 0),Cm=()=>{const t=(0,e.useContext)(Rm);if(void 0===t)throw new Error("usePrimitivesContext must be used with a PrimitivesProvider");return t},Am=({children:t,initialState:i=xm})=>{const r=km(i,"delimiter");return e.createElement(Rm.Provider,{value:{delimiter:r}},t)},km=(e,t)=>Object.hasOwn(e,t)?e[t].toString():void 0,Lm=qg("span",{}),Im=t=>{const{as:i,markup:r}=t,{delimiter:n}=Cm();if(!r)return e.createElement(e.Fragment,null);let s=mm(t,["as","markup"]);const o=function(e){return{__html:vm(e)}}(gm(r,s.lang,n));return e.createElement(Lm,{as:i,...s,dangerouslySetInnerHTML:o})},Pm=t=>e.useContext(Rm)?e.createElement(Im,{...t}):e.createElement(Am,null,e.createElement(Im,{...t})),_m=({as:t="dd",lang:i,value:r})=>e.createElement(Pm,{markup:r,as:t,lang:i}),Dm=qg("span",{}),Om=({as:t="dd",customValueContent:i,lang:r,value:n})=>{var s;const{delimiter:o}=Cm(),a=null==(s=pm(n,r))?void 0:s.map((t=>(0,e.cloneElement)(i,{value:t})));return e.createElement(Dm,{as:t,lang:r},null==a?void 0:a.map(((t,i)=>[i>0&&`${o}`,e.createElement(e.Fragment,{key:i},t)])))},Mm=t=>{var i;const{item:r,lang:n,customValueContent:s}=t,{label:o,value:a}=r,l=null==(i=gm(o))?void 0:i.replace(" ","-").toLowerCase();return e.createElement("div",{role:"group","data-label":l},e.createElement(wm,{as:"dt",label:o,lang:n}),s?e.createElement(Om,{as:"dd",customValueContent:s,value:a,lang:n}):e.createElement(_m,{as:"dd",value:a,lang:n}))},Fm=qg("dl",{}),Nm=t=>{const{as:i,customValueContent:r,metadata:n}=t;if(!Array.isArray(n))return e.createElement(e.Fragment,null);const s=Ig(t,"customValueDelimiter");let o=mm(t,["as","customValueContent","customValueDelimiter","metadata"]);return e.createElement(Am,{..."string"==typeof s?{initialState:{delimiter:s}}:void 0},n.length>0&&e.createElement(Fm,{as:i,...o},n.map(((t,i)=>{const n=r?function(e,t){const i=t.filter((t=>{const{matchingLabel:i}=t,r=Object.keys(t.matchingLabel)[0],n=gm(i,r);if(gm(e,r)===n)return!0})).map((e=>e.Content));if(Array.isArray(i))return i[0]}(t.label,r):void 0;return e.createElement(Mm,{customValueContent:n,item:t,key:i,lang:null==o?void 0:o.lang})}))))};qg("li",{}),qg("ul",{});const Bm=qg("dl",{}),Um=t=>{const{as:i,requiredStatement:r}=t;if(!r)return e.createElement(e.Fragment,null);const n=Ig(t,"customValueDelimiter");let s=mm(t,["as","customValueDelimiter","requiredStatement"]);return e.createElement(Am,{..."string"==typeof n?{initialState:{delimiter:n}}:void 0},e.createElement(Bm,{as:i,...s},e.createElement(Mm,{item:r,lang:s.lang})))},$m=qg("li",{}),Hm=qg("ul",{}),zm=t=>{const{as:i,seeAlso:r}=t,n=mm(t,["as","seeAlso"]);return e.createElement(Hm,{as:i},r&&r.map((t=>{const i=gm(t.label,n.lang);return e.createElement($m,{key:t.id},e.createElement("a",{href:t.id,...n},i||t.id))})))},jm=t=>{const{as:i,summary:r}=t;let n=mm(t,["as","customValueDelimiter","summary"]);return e.createElement(Pm,{as:i,markup:r,...n})},Gm=t=>{const{thumbnail:i,region:r}=t,n=mm(t,["thumbnail"]);return e.createElement(e.Fragment,null,i&&i.map((t=>e.createElement(bm,{contentResource:t,key:t.id,region:r,...n}))))},Vm=({homepage:t})=>0===(null==t?void 0:t.length)?e.createElement(e.Fragment,null):e.createElement(e.Fragment,null,e.createElement("span",{className:"manifest-property-title"},"Homepage"),e.createElement(Sm,{homepage:t})),qm=({id:t,htmlLabel:i,parent:r="manifest"})=>e.createElement(e.Fragment,null,e.createElement("span",{className:"manifest-property-title"},i),e.createElement("a",{href:t,target:"_blank",id:`iiif-${r}-id`},t)),Wm=({metadata:t,parent:i="manifest"})=>t?e.createElement(e.Fragment,null,e.createElement(Nm,{metadata:t,id:`iiif-${i}-metadata`})):e.createElement(e.Fragment,null),Km=({requiredStatement:t,parent:i="manifest"})=>t?e.createElement(e.Fragment,null,e.createElement(Um,{requiredStatement:t,id:`iiif-${i}-required-statement`})):e.createElement(e.Fragment,null),Ym=({rights:t})=>t?e.createElement(e.Fragment,null,e.createElement("span",{className:"manifest-property-title"},"Rights"),e.createElement("a",{href:t,target:"_blank"},t)):e.createElement(e.Fragment,null),Xm=({seeAlso:t})=>0===(null==t?void 0:t.length)?e.createElement(e.Fragment,null):e.createElement(e.Fragment,null,e.createElement("span",{className:"manifest-property-title"},"See Also"),e.createElement(zm,{seeAlso:t})),Zm=({summary:t,parent:i="manifest"})=>t?e.createElement(e.Fragment,null,e.createElement(jm,{summary:t,as:"p",id:`iiif-${i}-summary`})):e.createElement(e.Fragment,null),Qm=({label:t,thumbnail:i})=>0===(null==i?void 0:i.length)?e.createElement(e.Fragment,null):e.createElement(e.Fragment,null,e.createElement(Gm,{altAsLabel:t||{none:["resource"]},thumbnail:i,style:{backgroundColor:"#6663",objectFit:"cover"}})),Jm=()=>{const t=Ug(),{activeManifest:i,vault:r}=t,[n,s]=(0,e.useState)(),[o,a]=(0,e.useState)([]),[l,c]=(0,e.useState)([]),[u,h]=(0,e.useState)([]);return(0,e.useEffect)((()=>{var e,t,n;const o=r.get(i);s(o),(null==(e=o.homepage)?void 0:e.length)>0&&a(r.get(o.homepage)),(null==(t=o.seeAlso)?void 0:t.length)>0&&c(r.get(o.seeAlso)),(null==(n=o.thumbnail)?void 0:n.length)>0&&h(r.get(o.thumbnail))}),[i,r]),n?e.createElement(fm,null,e.createElement(dm,null,e.createElement(Qm,{thumbnail:u,label:n.label}),e.createElement(Zm,{summary:n.summary}),e.createElement(Wm,{metadata:n.metadata}),e.createElement(Km,{requiredStatement:n.requiredStatement}),e.createElement(Ym,{rights:n.rights}),e.createElement(Vm,{homepage:o}),e.createElement(Xm,{seeAlso:l}),e.createElement(qm,{id:n.id,htmlLabel:"IIIF Manifest"}))):e.createElement(e.Fragment,null)},ev=Kg({from:{transform:"rotate(360deg)"},to:{transform:"rotate(0deg)"}}),tv=qg(bu,{display:"flex",flexDirection:"column",width:"100%"}),iv=qg(Tu,{position:"relative",cursor:"pointer",display:"flex",width:"100%",justifyContent:"space-between",textAlign:"left",margin:"0",padding:"0.5rem 1.618rem",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",color:"inherit",border:"none",background:"none","@sm":{padding:"0.5rem 1rem",fontSize:"0.8333rem"},"&::before":{content:"",width:"12px",height:"12px",borderRadius:"12px",position:"absolute",backgroundColor:"$primaryMuted",opacity:"0",left:"8px",marginTop:"3px",boxSizing:"content-box","@sm":{content:"unset"}},"&::after":{content:"",width:"4px",height:"6px",position:"absolute",backgroundColor:"$secondary",opacity:"0",clipPath:"polygon(100% 50%, 0 100%, 0 0)",left:"13px",marginTop:"6px",boxSizing:"content-box","@sm":{content:"unset"}},strong:{marginLeft:"1rem"},"&:hover":{color:"$accent","&::before":{backgroundColor:"$accent",opacity:"1"},"&::after":{content:"",width:"4px",height:"6px",position:"absolute",backgroundColor:"$secondary",clipPath:"polygon(100% 50%, 0 100%, 0 0)",opacity:"1"}},"&[aria-checked='true']":{backgroundColor:"#6663","&::before":{content:"",width:"6px",height:"6px",position:"absolute",backgroundColor:"transparent",border:"3px solid $accentMuted",borderRadius:"12px",left:"8px",marginTop:"4px",opacity:"1",animation:"1s linear infinite",animationName:ev,boxSizing:"content-box","@sm":{content:"unset"}},"&::after":{content:"",width:"6px",height:"6px",position:"absolute",backgroundColor:"transparent",border:"3px solid $accent",clipPath:"polygon(100% 0, 100% 100%, 0 0)",borderRadius:"12px",left:"8px",marginTop:"4px",opacity:"1",animation:"1.5s linear infinite",animationName:ev,boxSizing:"content-box","@sm":{content:"unset"}}}}),rv=({label:t,start:i,end:r})=>{const[n,s]=(0,e.useState)(!1),o=document.getElementById("clover-iiif-video");return(0,e.useEffect)((()=>(null==o||o.addEventListener("timeupdate",(()=>{const{currentTime:e}=o;s(i<=e&&e<r)})),()=>document.removeEventListener("timeupdate",(()=>{})))),[o]),e.createElement(iv,{"aria-checked":n,"data-testid":"information-panel-cue",onClick:()=>{o&&(o.pause(),o.currentTime=i,o.play())},value:t},t,e.createElement("strong",null,kg(i)))},nv=qg("ul",{listStyle:"none",paddingLeft:"1rem",position:"relative","&&:first-child":{paddingLeft:"0"},"& li ul":{[`& ${iv}`]:{backgroundColor:"unset","&::before":{content:"none"},"&::after":{content:"none"}}},"&:first-child":{margin:"0 0 1.618rem"}}),sv=({items:t})=>e.createElement(nv,null,t.map((t=>{const{text:i,start:r,end:n,children:s,identifier:o}=t;return e.createElement("li",{key:o},e.createElement(rv,{label:i,start:r,end:n}),s&&e.createElement(sv,{items:s}))}))),ov=({resource:t})=>{const[i,r]=e.useState([]),{id:n,label:s}=t,{createNestedCues:o,orderCuesByTime:a}=(()=>{function e(e){return e.map((e=>{const t=e.identifier||iu();return{...e,identifier:t}}))}return{addIdentifiersToParsedCues:e,createNestedCues:function(t){var i;const r=[],n=[],s=e(t);for(const e of s){for(;n.length>0&&n[n.length-1].end<=e.start;)n.pop();n.length>0?(n[n.length-1].children||(n[n.length-1].children=[]),null==(i=n[n.length-1].children)||i.push(e),n.push(e)):(r.push(e),n.push(e))}return r},isChild:function(e,t=[]){return t.some((t=>e.start>=t.start&&e.end<=t.end))},orderCuesByTime:function(e=[]){return e.sort(((e,t)=>e.start-t.start))}}})();return(0,e.useEffect)((()=>{n&&fetch(n,{headers:{"Content-Type":"text/plain",Accept:"application/json"}}).then((e=>e.text())).then((e=>{const t=(0,Su.parse)(e).cues,i=a(t),n=o(i);r(n)})).catch((e=>console.error(n,e.toString())))}),[n]),e.createElement(tv,{"aria-label":`navigate ${zg(s,"en")}`},e.createElement(sv,{items:i}))},av=({activeCanvas:t,resources:i})=>{const r=Ug(),{configOptions:n}=r,{informationPanel:s}=n,[o,a]=(0,e.useState)(),l=(null==s?void 0:s.renderAbout)||(null==n?void 0:n.renderAbout),c=null==s?void 0:s.renderSupplementing;return(0,e.useEffect)((()=>{l?a("manifest-about"):i&&(null==i?void 0:i.length)>0&&!l&&a(i[0].id)}),[t,i]),i?e.createElement(am,{"data-testid":"information-panel",defaultValue:o,onValueChange:e=>{a(e)},orientation:"horizontal",value:o},e.createElement(lm,{"aria-label":"select chapter","data-testid":"information-panel-list"},l&&e.createElement(cm,{value:"manifest-about"},"About"),c&&i&&i.map((({id:t,label:i})=>e.createElement(cm,{key:t,value:t},e.createElement(wm,{label:i}))))),e.createElement(hm,null,l&&e.createElement(um,{value:"manifest-about"},e.createElement(Jm,null)),c&&i&&i.map((t=>e.createElement(um,{key:t.id,value:t.id},e.createElement(ov,{resource:t})))))):e.createElement(e.Fragment,null)},lv=qg(bu,{display:"flex",flexDirection:"row",flexGrow:"1",padding:"1.618rem",overflowX:"scroll",position:"relative",zIndex:"0"}),cv=qg("svg",{display:"inline-flex",variants:{isLarge:{true:{height:"4rem",width:"4rem"}},isMedium:{true:{height:"2rem",width:"2rem"}},isSmall:{true:{height:"1rem",width:"1rem"}}}}),uv=t=>e.createElement(cv,{...t,"data-testid":"icon-svg",role:"img",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},t.children);uv.Title=({children:t})=>e.createElement("title",null,t),uv.Add=()=>e.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M256 112v288M400 256H112"}),uv.Audio=()=>e.createElement(e.Fragment,null,e.createElement("path",{d:"M232 416a23.88 23.88 0 01-14.2-4.68 8.27 8.27 0 01-.66-.51L125.76 336H56a24 24 0 01-24-24V200a24 24 0 0124-24h69.75l91.37-74.81a8.27 8.27 0 01.66-.51A24 24 0 01256 120v272a24 24 0 01-24 24zm-106.18-80zm-.27-159.86zM320 336a16 16 0 01-14.29-23.19c9.49-18.87 14.3-38 14.3-56.81 0-19.38-4.66-37.94-14.25-56.73a16 16 0 0128.5-14.54C346.19 208.12 352 231.44 352 256c0 23.86-6 47.81-17.7 71.19A16 16 0 01320 336z"}),e.createElement("path",{d:"M368 384a16 16 0 01-13.86-24C373.05 327.09 384 299.51 384 256c0-44.17-10.93-71.56-29.82-103.94a16 16 0 0127.64-16.12C402.92 172.11 416 204.81 416 256c0 50.43-13.06 83.29-34.13 120a16 16 0 01-13.87 8z"}),e.createElement("path",{d:"M416 432a16 16 0 01-13.39-24.74C429.85 365.47 448 323.76 448 256c0-66.5-18.18-108.62-45.49-151.39a16 16 0 1127-17.22C459.81 134.89 480 181.74 480 256c0 64.75-14.66 113.63-50.6 168.74A16 16 0 01416 432z"})),uv.Close=()=>e.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"}),uv.Image=()=>e.createElement("path",{d:"M416 64H96a64.07 64.07 0 00-64 64v256a64.07 64.07 0 0064 64h320a64.07 64.07 0 0064-64V128a64.07 64.07 0 00-64-64zm-80 64a48 48 0 11-48 48 48.05 48.05 0 0148-48zM96 416a32 32 0 01-32-32v-67.63l94.84-84.3a48.06 48.06 0 0165.8 1.9l64.95 64.81L172.37 416zm352-32a32 32 0 01-32 32H217.63l121.42-121.42a47.72 47.72 0 0161.64-.16L448 333.84z"}),uv.Video=()=>e.createElement("path",{d:"M464 384.39a32 32 0 01-13-2.77 15.77 15.77 0 01-2.71-1.54l-82.71-58.22A32 32 0 01352 295.7v-79.4a32 32 0 0113.58-26.16l82.71-58.22a15.77 15.77 0 012.71-1.54 32 32 0 0145 29.24v192.76a32 32 0 01-32 32zM268 400H84a68.07 68.07 0 01-68-68V180a68.07 68.07 0 0168-68h184.48A67.6 67.6 0 01336 179.52V332a68.07 68.07 0 01-68 68z"});const hv=Kg({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),dv=Kg({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),fv=qg(If,{fill:"$secondaryAlt"}),pv=qg(Lf,{position:"absolute",right:"0",top:"0",padding:"0.5rem",margin:"0",cursor:"pointer",border:"none",background:"none",fill:"inherit","&:hover":{opacity:"0.75"}}),gv=qg(kf,{border:"none",backgroundColor:"white",fill:"inhrerit",padding:"1rem 2rem 1rem 1rem",width:"auto",minWidth:"200px",maxWidth:"350px",borderRadius:"3px",boxShadow:"5px 5px 13px #0002",animationDuration:"0.3s",animationTimingFunction:"cubic-bezier(0.16, 1, 0.3, 1)",'&[data-side="top"]':{animationName:dv},'&[data-side="bottom"]':{animationName:hv},'&[data-align="end"]':{[`& ${fv}`]:{margin:"0 0.7rem"}}}),mv=qg(Af,{display:"inline-flex",padding:"0.5rem 0",margin:"0 0.5rem 0 0",cursor:"pointer",border:"none",background:"none","> button, > span":{margin:"0"}}),vv=qg(Cf,{boxSizing:"content-box"}),yv=({children:t})=>e.createElement(vv,null,t);yv.Trigger=t=>e.createElement(mv,{...t},t.children),yv.Content=t=>e.createElement(gv,{...t},e.createElement(fv,null),e.createElement(pv,null,e.createElement(uv,{isSmall:!0},e.createElement(uv.Close,null))),t.children);const wv=qg("div",{boxSizing:"border-box",display:"inline-flex",alignItems:"center",borderRadius:"5px",padding:"$1",marginBottom:"$2",marginRight:"$2",backgroundColor:"$lightGrey",color:"$richBlack50",textTransform:"uppercase",fontSize:"$2",objectFit:"contain",lineHeight:"1em !important","&:last-child":{marginRight:"0"},[`${cv}`]:{position:"absolute",left:"$1",height:"$3",width:"$3"},variants:{isIcon:{true:{position:"relative",paddingLeft:"$5"}}}}),Ev=qg("span",{display:"flex"}),bv=qg("span",{display:"flex",width:"1.2111rem",height:"0.7222rem"}),Tv=qg("span",{display:"inline-flex",marginLeft:"5px",marginBottom:"-1px"}),Sv=qg(Tu,{display:"flex",flexShrink:"0",margin:"0 1.618rem 0 0",padding:"0",cursor:"pointer",background:"none",border:"none",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",textAlign:"left","&:last-child":{marginRight:"1rem"},figure:{margin:"0",width:"161.8px","> div":{position:"relative",display:"flex",backgroundColor:"$secondaryAlt",width:"inherit",height:"100px",overflow:"hidden",borderRadius:"3px",transition:"$all",img:{width:"100%",height:"100%",objectFit:"cover",filter:"blur(0)",transform:"scale3d(1, 1, 1)",transition:"$all",color:"transparent"},[`& ${Ev}`]:{position:"absolute",right:"0",bottom:"0",[`& ${wv}`]:{margin:"0",paddingLeft:"0",fontSize:"0.7222rem",backgroundColor:"#000d",color:"$secondary",fill:"$secondary",borderBottomLeftRadius:"0",borderTopRightRadius:"0"}}},figcaption:{marginTop:"0.5rem",fontWeight:"400",fontSize:"0.8333rem",display:"-webkit-box",overflow:"hidden",MozBoxOrient:"vertical",WebkitBoxOrient:"vertical",WebkitLineClamp:"5","@sm":{fontSize:"0.8333rem"}}},"&[aria-checked='true']":{figure:{"> div":{backgroundColor:"$primaryAlt","&::before":{position:"absolute",zIndex:"1",color:"$secondaryMuted",content:"Active Item",textTransform:"uppercase",fontWeight:"700",fontSize:"0.6111rem",letterSpacing:"0.03rem",display:"flex",width:"100%",height:"100%",flexDirection:"column",justifyContent:"center",textAlign:"center",textShadow:"5px 5px 5px #0003"},img:{opacity:"0.3",transform:"scale3d(1.1, 1.1, 1.1)",filter:"blur(2px)"},[`& ${Ev}`]:{[`& ${wv}`]:{backgroundColor:"$accent"}}}},figcaption:{fontWeight:"700"}}}),xv=({type:t})=>{switch(t){case"Sound":return e.createElement(uv.Audio,null);case"Image":default:return e.createElement(uv.Image,null);case"Video":return e.createElement(uv.Video,null)}},Rv=({canvas:t,canvasIndex:i,isActive:r,thumbnail:n,type:s,handleChange:o})=>e.createElement(Sv,{"aria-checked":r,"data-testid":"media-thumbnail","data-canvas":i,onClick:()=>o(t.id),value:t.id},e.createElement("figure",null,e.createElement("div",null,(null==n?void 0:n.id)&&e.createElement("img",{src:n.id,alt:null!=t&&t.label?zg(t.label):""}),e.createElement(Ev,null,e.createElement(wv,{isIcon:!0,"data-testid":"thumbnail-tag"},e.createElement(bv,null),e.createElement(uv,{"aria-label":s},e.createElement(xv,{type:s})),["Video","Sound"].includes(s)&&e.createElement(Tv,null,kg(t.duration))))),(null==t?void 0:t.label)&&e.createElement("figcaption",{"data-testid":"fig-caption"},e.createElement(wm,{label:t.label})))),Cv=e=>e.body?e.body.type:"Image",Av=qg("div",{position:"absolute",right:"1rem",top:"1rem",display:"flex",justifyContent:"flex-end",zIndex:"1"}),kv=qg("input",{flexGrow:"1",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"2rem",fontFamily:"inherit",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0003","&::placeholder":{color:"$primaryMuted"}}),Lv=qg("button",{display:"flex",background:"none",border:"none",width:"2rem !important",height:"2rem !important",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box !important",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),Iv=qg("div",{display:"flex",marginRight:"0.618rem",backgroundColor:"$accentAlt",borderRadius:"2rem",boxShadow:"5px 5px 5px #0003",color:"$secondary",alignItems:"center","> span":{display:"flex",margin:"0 0.5rem",fontSize:"0.7222rem"}}),Pv=qg("div",{display:"flex",position:"relative",zIndex:"1",width:"100%",padding:"0",transition:"$all",variants:{isToggle:{true:{paddingTop:"2.618rem",[`& ${Av}`]:{width:"calc(100% - 2rem)","@sm":{width:"calc(100% - 2rem)"}}}}}}),_v=()=>e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e.createElement("title",null,"Arrow Back"),e.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M244 400L100 256l144-144M120 256h292"})),Dv=()=>e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e.createElement("title",null,"Arrow Forward"),e.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M268 112l144 144-144 144M392 256H100"})),Ov=()=>e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e.createElement("title",null,"Close"),e.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),Mv=()=>e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e.createElement("title",null,"Search"),e.createElement("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"})),Fv=({handleCanvasToggle:t,handleFilter:i,activeIndex:r,canvasLength:n})=>{const[s,o]=(0,e.useState)(!1),[a,l]=(0,e.useState)(!1),[c,u]=(0,e.useState)(!1);return(0,e.useEffect)((()=>{u(0===r),l(r===n-1)}),[r]),((t,i)=>{(0,e.useEffect)((()=>{function e(e){"Escape"===e.key&&i()}return window.addEventListener("keyup",e),()=>window.removeEventListener("keyup",e)}),[])})(0,(()=>{o(!1),i("")})),e.createElement(Pv,{isToggle:s},e.createElement(Av,null,s&&e.createElement(kv,{autoFocus:!0,onChange:e=>i(e.target.value),placeholder:"Search"}),!s&&e.createElement(Iv,null,e.createElement(Lv,{onClick:()=>t(-1),disabled:c,type:"button"},e.createElement(_v,null)),e.createElement("span",null,r+1," of ",n),e.createElement(Lv,{onClick:()=>t(1),disabled:a,type:"button"},e.createElement(Dv,null))),e.createElement(Lv,{onClick:()=>{o((e=>!e)),i("")},type:"button"},s?e.createElement(Ov,null):e.createElement(Mv,null))))},Nv=({items:t})=>{const i=$g(),r=Ug(),{activeCanvas:n,vault:s}=r,[o,a]=(0,e.useState)(""),[l,c]=(0,e.useState)([]),[u,h]=(0,e.useState)(0),d=e.useRef(null),f=["Image","Sound","Video"],p=e=>{n!==e&&i({type:"updateActiveCanvas",canvasId:e})};return(0,e.useEffect)((()=>{if(!l.length){const e=t.map((e=>Hg(s,e,"painting",f))).filter((e=>e.annotations.length>0));c(e)}}),[]),(0,e.useEffect)((()=>{l.forEach(((e,t)=>{null!=e&&e.canvas&&e.canvas.id===n&&h(t)}))}),[n]),(0,e.useEffect)((()=>{const e=document.querySelector(`[data-canvas="${u}"]`);if(e instanceof HTMLElement&&d.current){const t=e.offsetLeft-d.current.offsetWidth/2+e.offsetWidth/2;d.current.scrollTo({left:t,behavior:"smooth"})}}),[u]),e.createElement(e.Fragment,null,e.createElement(Fv,{handleFilter:e=>a(e),handleCanvasToggle:e=>{const t=l[u+e];null!=t&&t.canvas&&p(t.canvas.id)},activeIndex:u,canvasLength:l.length}),e.createElement(lv,{"aria-label":"select item","data-testid":"media",ref:d},l.filter((e=>{var t;if(null!=(t=e.canvas)&&t.label){const t=zg(e.canvas.label);if(Array.isArray(t))return t[0].toLowerCase().includes(o.toLowerCase())}})).map(((t,i)=>{var r,o;return e.createElement(Rv,{canvas:t.canvas,canvasIndex:i,handleChange:p,isActive:n===(null==(r=null==t?void 0:t.canvas)?void 0:r.id),key:null==(o=null==t?void 0:t.canvas)?void 0:o.id,thumbnail:Gg(s,t,200,200),type:Cv(t.annotations[0])})}))))},Bv=qg("div",{position:"absolute !important",zIndex:"1",top:"1rem",left:"1rem",width:"161.8px",height:"100px",backgroundColor:"#000D",boxShadow:"5px 5px 5px #0002",borderRadius:"3px",".displayregion":{border:" 3px solid $accent !important",boxShadow:"0 0 3px #0006"},"@sm":{width:"123px",height:"76px"},"@xs":{width:"100px",height:"61.8px"}}),Uv=qg("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),$v=qg("div",{width:"100%",height:"61.8vh",maxHeight:"100vh",background:"black",backgroundSize:"contain",color:"white",position:"relative",zIndex:"1",overflow:"hidden"}),Hv=qg("button",{display:"flex",height:"2rem",width:"2rem",borderRadius:"2rem",padding:"0",margin:"0",fontFamily:"inherit",background:"none",border:"none",color:"white",cursor:"pointer",marginLeft:"0.618rem",backgroundColor:"$primary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"content-box !important","&:first-child":{marginLeft:"0"},"@xs":{marginBottom:"0.618rem",marginLeft:"0","&:last-child":{marginBottom:"0"}},svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"inherit"},"&:hover, &:focus":{backgroundColor:"$accent"},"&#rotateRight":{"&:hover, &:focus":{svg:{rotate:"45deg"}}},"&#rotateLeft":{transform:"scaleX(-1)","&:hover, &:focus":{svg:{rotate:"45deg"}}},"&#reset":{"&:hover, &:focus":{svg:{rotate:"-15deg"}}}}),zv=({id:t,label:i,children:r})=>e.createElement(Hv,{id:t,"data-testid":"openseadragon-button"},e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":`${t}-svg-title`,"data-testid":"openseadragon-button-svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},e.createElement("title",{id:`${t}-svg-title`},i),r)),jv=qg("div",{position:"absolute",zIndex:"1",top:"1rem",display:"flex","@xs":{flexDirection:"column",zIndex:"2"},variants:{hasPlaceholder:{true:{right:"3.618rem","@xs":{top:"3.618rem",right:"1rem"}},false:{right:"1rem","@xs":{top:"1rem",right:"1rem"}}}}}),Gv=()=>e.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M256 112v288M400 256H112"}),Vv=()=>e.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 256H112"}),qv=()=>e.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M432 320v112H320M421.8 421.77L304 304M80 192V80h112M90.2 90.23L208 208M320 80h112v112M421.77 90.2L304 208M192 432H80V320M90.23 421.8L208 304"}),Wv=()=>e.createElement("path",{d:"M448 440a16 16 0 01-12.61-6.15c-22.86-29.27-44.07-51.86-73.32-67C335 352.88 301 345.59 256 344.23V424a16 16 0 01-27 11.57l-176-168a16 16 0 010-23.14l176-168A16 16 0 01256 88v80.36c74.14 3.41 129.38 30.91 164.35 81.87C449.32 292.44 464 350.9 464 424a16 16 0 01-16 16z"}),Kv=()=>e.createElement(e.Fragment,null,e.createElement("path",{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 148l-21.12-24.57A191.43 191.43 0 00240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 00181.07-128"}),e.createElement("path",{d:"M464 97.42V208a16 16 0 01-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z"})),Yv=({hasPlaceholder:t,options:i})=>e.createElement(jv,{"data-testid":"openseadragon-controls",hasPlaceholder:t,id:"openseadragon-controls"},i.showZoomControl&&e.createElement(e.Fragment,null,e.createElement(zv,{id:"zoomIn",label:"zoom in"},e.createElement(Gv,null)),e.createElement(zv,{id:"zoomOut",label:"zoom out"},e.createElement(Vv,null))),i.showFullPageControl&&e.createElement(zv,{id:"fullPage",label:"full page"},e.createElement(qv,null)),i.showRotationControl&&e.createElement(e.Fragment,null,e.createElement(zv,{id:"rotateRight",label:"rotate right"},e.createElement(Kv,null)),e.createElement(zv,{id:"rotateLeft",label:"rotate left"},e.createElement(Kv,null))),i.showHomeControl&&e.createElement(zv,{id:"reset",label:"reset"},e.createElement(Wv,null))),Xv=({uri:t,imageType:i,hasPlaceholder:r})=>{const[n,s]=(0,e.useState)(),o=Ug(),{configOptions:a}=o,l=iu(),c={id:`openseadragon-viewport-${l}`,loadTilesWithAjax:!0,fullPageButton:"fullPage",homeButton:"reset",rotateLeftButton:"rotateLeft",rotateRightButton:"rotateRight",zoomInButton:"zoomIn",zoomOutButton:"zoomOut",showNavigator:!0,showFullPageControl:!0,showHomeControl:!0,showRotationControl:!0,showZoomControl:!0,navigatorBorderColor:"transparent",navigatorId:`openseadragon-navigator-${l}`,gestureSettingsMouse:{clickToZoom:!0,dblClickToZoom:!0,pinchToZoom:!0,scrollToZoom:!0},...a.openSeadragon,ajaxWithCredentials:a.withCredentials};return(0,e.useEffect)((()=>{t!==n&&s(t)}),[]),(0,e.useEffect)((()=>{if(n)switch(i){case"simpleImage":Pf(c).addSimpleImage({url:n});break;case"tiledImage":(e=>fetch(`${e.replace(/\/$/,"")}/info.json`).then((e=>e.json())).then((e=>e)).catch((t=>{console.error(`The IIIF tilesource ${e.replace(/\/$/,"")}/info.json failed to load: ${t}`)})))(n).then((e=>Pf(c).addTiledImage({tileSource:e})));break;default:console.warn(`Unable to render ${n} in OpenSeadragon as type: "${i}"`)}}),[n]),e.createElement($v,{css:{backgroundColor:a.canvasBackgroundColor,height:a.canvasHeight}},e.createElement(Yv,{options:c,hasPlaceholder:r}),e.createElement(Bv,{id:`openseadragon-navigator-${l}`}),e.createElement(Uv,{id:`openseadragon-viewport-${l}`}))},Zv=({body:t,hasPlaceholder:i})=>{const[r,n]=(0,e.useState)(),[s,o]=(0,e.useState)();return(0,e.useEffect)((()=>{Array.isArray(t.service)&&t.service.length>0?(n("tiledImage"),o((e=>{let t,i;if(Array.isArray(e)&&(t=e[0],t)){let e;e="@id"in t?t["@id"]:t.id,i=e}return i})(t.service))):(n("simpleImage"),o(t.id))}),[t]),e.createElement(Xv,{uri:s,key:s,imageType:r,hasPlaceholder:i})},Qv=qg("button",{background:"none",border:"none",cursor:"zoom-in",width:"100%",height:"100%",margin:"0",padding:"0",display:"flex",transition:"$all","& img":{width:"100%",height:"100%",objectFit:"contain",color:"transparent",transition:"$all"},variants:{isMedia:{true:{cursor:"pointer"}}}}),Jv=({isMedia:t,label:i,placeholderCanvas:r,setIsInteractive:n})=>{const{vault:s}=Ug(),o=jg(s,r),a=i?zg(i):["placeholder image"];return e.createElement(Qv,{onClick:()=>n(!0),isMedia:t},e.createElement("img",{src:(null==o?void 0:o.id)||"",alt:a.join(),height:null==o?void 0:o.height,width:null==o?void 0:o.width}))},ey=qg(Hv,{position:"absolute",width:"2rem",top:"1rem",right:"1rem",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",transition:"$all",borderRadius:"50%",backgroundColor:"$accent",cursor:"pointer","&:hover, &:focus":{backgroundColor:"$accent !important"},variants:{isInteractive:{true:{"&:hover":{opacity:"1"}},false:{}},isMedia:{true:{cursor:"pointer !important"}}},compoundVariants:[{isInteractive:!1,isMedia:!0,css:{top:"50%",right:"50%",width:"4rem",height:"4rem",transform:"translate(50%,-50%)"}}]}),ty=qg("div",{position:"relative",zIndex:"0","&:hover":{[`${ey}`]:{backgroundColor:"$accent"},[`${Qv}`]:{backgroundColor:"#6662",img:{filter:"brightness(0.85)"}}}}),iy=qg("div",{position:"relative",backgroundColor:"$primaryAlt",display:"flex",flexGrow:"0",flexShrink:"1",maxHeight:"500px",zIndex:"1",video:{backgroundColor:"transparent",objectFit:"contain",width:"100%",height:"100%",position:"relative",zIndex:"1"}}),ry=qg("canvas",{position:"absolute",width:"100%",height:"100%",zIndex:"0"}),ny=e.forwardRef(((t,i)=>{const r=e.useRef(null);function n(){const e=i.current,t=new AudioContext,n=t.createMediaElementSource(e);let s=t.createAnalyser();const o=r.current;if(!o)return;o.width=e.offsetWidth,o.height=e.offsetHeight;const a=o.getContext("2d");n.connect(s),s.connect(t.destination),s.fftSize=256;const l=s.frequencyBinCount,c=new Uint8Array(l);setInterval((function(){!function(e,t,i,r,n,s){let o,a=n/i*2.6,l=0;e.getByteFrequencyData(r),t.fillStyle="#000000",t.fillRect(0,0,n,s);for(let e=0;e<i;e++)o=2*r[e],t.fillStyle="rgba(78, 42, 132, 1)",t.fillRect(l,s-o,a,o),l+=a+6}(s,a,l,c,o.width,o.height)}),20)}return e.useEffect((()=>{i&&(i.current.onplay=n)}),[i]),e.createElement(ry,{ref:r})})),sy=({resource:t,ignoreCaptionLabels:i})=>{const r=zg(t.label,"en");return r.some((e=>i.includes(e)))?null:e.createElement("track",{key:t.id,src:t.id,label:r,srcLang:"en","data-testid":"player-track"})},oy=({resources:t,painting:i})=>{var r;const[n,s]=e.useState(0),[o,a]=e.useState(),l=e.useRef(null),c=null==(r=null==i?void 0:i.format)?void 0:r.includes("audio/"),u=Ug(),{activeCanvas:h,configOptions:d,vault:f}=u;return(0,e.useEffect)((()=>{if(!i.id||!l.current||"m3u8"!==i.id.split(".").pop())return;const e={xhrSetup:function(e,t){e.withCredentials=d.withCredentials}},t=new Xc(e);return t.attachMedia(l.current),t.on(Xc.Events.MEDIA_ATTACHED,(function(){t.loadSource(i.id)})),t.on(Xc.Events.ERROR,(function(e,i){if(i.fatal)switch(i.type){case Xc.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${e} network error encountered, try to recover`),t.startLoad();break;case Xc.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${e} media error encountered, try to recover`),t.recoverMediaError();break;default:t.destroy()}})),()=>{if(t&&l.current){const e=l.current;t.detachMedia(),t.destroy(),e.currentTime=0}}}),[i.id]),(0,e.useEffect)((()=>{var e,t,i,r;const s=f.get(h),o=null!=(e=s.accompanyingCanvas)&&e.id?jg(f,null==(t=s.accompanyingCanvas)?void 0:t.id):null,l=null!=(i=s.placeholderCanvas)&&i.id?jg(f,null==(r=s.placeholderCanvas)?void 0:r.id):null;o&&l?a(0===n?l.id:o.id):(o&&a(o.id),l&&a(l.id))}),[h,n]),(0,e.useEffect)((()=>{if(null!=l&&l.current){const e=l.current;return null==e||e.addEventListener("timeupdate",(()=>s(e.currentTime))),()=>document.removeEventListener("timeupdate",(()=>{}))}}),[null==l?void 0:l.current]),e.createElement(iy,{css:{backgroundColor:d.canvasBackgroundColor,maxHeight:d.canvasHeight}},e.createElement("video",{id:"clover-iiif-video",key:i.id,ref:l,controls:!0,height:i.height,width:i.width,crossOrigin:"anonymous",poster:o,style:{maxHeight:d.canvasHeight}},e.createElement("source",{src:i.id,type:i.format}),t.length>0&&t.map((t=>e.createElement(sy,{resource:t,ignoreCaptionLabels:d.ignoreCaptionLabels,key:t.id}))),"Sorry, your browser doesn't support embedded videos."),c&&e.createElement(ny,{ref:l}))},ay=()=>e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"close-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},e.createElement("title",{id:"close-svg-title"},"close"),e.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),ly=({isMedia:t})=>e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"open-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},e.createElement("title",{id:"open-svg-title"},"open"),t?e.createElement("path",{d:"M133 440a35.37 35.37 0 01-17.5-4.67c-12-6.8-19.46-20-19.46-34.33V111c0-14.37 7.46-27.53 19.46-34.33a35.13 35.13 0 0135.77.45l247.85 148.36a36 36 0 010 61l-247.89 148.4A35.5 35.5 0 01133 440z"}):e.createElement(e.Fragment,null,e.createElement("path",{d:"m456.69,421.39l-94.09-94.09c22.65-30.16,34.88-66.86,34.84-104.58,0-96.34-78.38-174.72-174.72-174.72S48,126.38,48,222.72s78.38,174.72,174.72,174.72c37.72.04,74.42-12.19,104.58-34.84l94.09,94.09c10.29,9.2,26.1,8.32,35.3-1.98,8.48-9.49,8.48-23.83,0-33.32Zm-233.97-73.87c-68.89-.08-124.72-55.91-124.8-124.8h0c0-68.93,55.87-124.8,124.8-124.8s124.8,55.87,124.8,124.8-55.87,124.8-124.8,124.8Z"}),e.createElement("path",{d:"m279.5,197.76h-3.35s-28.47,0-28.47,0v-31.82c-.77-13.79-12.57-24.33-26.36-23.56-12.71.71-22.85,10.86-23.56,23.56v3.35h0v28.47h-31.82c-13.79.77-24.33,12.57-23.56,26.36.71,12.71,10.86,22.85,23.56,23.56h3.35s28.47,0,28.47,0v31.82c.77,13.79,12.57,24.33,26.36,23.56,12.71-.71,22.85-10.86,23.56-23.56v-3.35h0v-28.47h31.82c13.79-.77,24.33-12.57,23.56-26.36-.71-12.71-10.86-22.85-23.56-23.56Z"}))),cy=({handleToggle:t,isInteractive:i,isMedia:r})=>e.createElement(ey,{onClick:t,isInteractive:i,isMedia:r},i?e.createElement(ay,null):e.createElement(ly,{isMedia:r})),uy=({activeCanvas:t,isMedia:i,painting:r,resources:n})=>{var s;const[o,a]=e.useState(!1),{configOptions:l,vault:c}=Ug(),u=c.get(t),h=null==(s=null==u?void 0:u.placeholderCanvas)?void 0:s.id,d=!!h,f=h&&!o&&!i;return e.createElement(ty,{css:{maxHeight:l.canvasHeight,backgroundColor:l.canvasBackgroundColor}},h&&!i&&e.createElement(cy,{handleToggle:()=>a(!o),isInteractive:o,isMedia:i}),f&&!i&&e.createElement(Jv,{isMedia:i,label:null==u?void 0:u.label,placeholderCanvas:h,setIsInteractive:a}),!f&&e.createElement("div",null,i?e.createElement(oy,{painting:r,resources:n}):r&&e.createElement(Zv,{body:r,hasPlaceholder:d,key:t})))},hy=({activeCanvas:t,painting:i,resources:r,items:n,isAudioVideo:s})=>{const{informationOpen:o,configOptions:a}=Ug(),{informationPanel:l}=a,c=(null==l?void 0:l.renderAbout)||(null==l?void 0:l.renderSupplementing)&&r.length>0;return e.createElement(tm,{className:"clover-content"},e.createElement(im,null,e.createElement(uy,{activeCanvas:t,isMedia:s,painting:i,resources:r}),c&&e.createElement(rm,null,e.createElement("span",null,o?"View Items":"More Information")),n.length>1&&e.createElement(em,{className:"clover-canvases"},e.createElement(Nv,{items:n,activeItem:0}))),o&&c&&e.createElement(sm,null,e.createElement(nm,null,e.createElement(av,{activeCanvas:t,resources:r}))))},dy=qg("svg",{height:"19px",color:"$accent",fill:"$accent",stroke:"$accent",display:"flex",margin:"0.25rem 0.85rem"}),fy=qg(og,{fontSize:"1.25rem",fontWeight:"400",fontFamily:"inherit",alignSelf:"flex-start",flexGrow:"1",backgroundColor:"$secondary",cursor:"pointer",transition:"$all",border:"1px solid $secondaryMuted",boxShadow:"2px 2px 5px #0001",borderRadius:"3px",display:"flex",alignItems:"center",paddingLeft:"0.5rem","@sm":{fontSize:"1rem"}}),py=qg(cg,{borderRadius:"3px",boxShadow:"3px 3px 8px #0003",backgroundColor:"$secondary",marginTop:"2.25rem",marginLeft:"6px",paddingBottom:"0.25rem",maxHeight:"calc(61.8vh - 2.5rem) !important",borderTopLeftRadius:"0",border:"1px solid $secondaryMuted",maxWidth:"90vw"}),gy=qg(fg,{display:"flex",alignItems:"center",fontFamily:"inherit",padding:"0.25rem 0.5rem",color:"$primary",fontWeight:"400",fontSize:"0.8333rem",cursor:"pointer",backgroundColor:"$secondary",width:"calc(100% - 1rem)","> span":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},'&[data-state="checked"]':{fontWeight:"700",color:"$primary !important"},"&:hover":{color:"$accent"},img:{width:"31px",height:"31px",marginRight:"0.5rem",borderRadius:"3px"}}),my=qg(dg,{color:"$primaryMuted",fontFamily:"inherit",fontSize:"0.85rem",padding:"0.5rem 1rem 0.5rem 0.5rem",display:"flex",alignItems:"center",marginBottom:"0.25rem",borderRadius:"3px",borderTopLeftRadius:"0",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",backgroundColor:"$secondaryMuted"}),vy=qg("div",{position:"relative",zIndex:"5"}),yy=qg(yv.Trigger,{width:"30px",padding:"5px"}),wy=qg(yv.Content,{display:"flex",flexDirection:"column",fontSize:"0.8333rem",border:"none",boxShadow:"2px 2px 5px #0003",zIndex:"2",button:{display:"flex",textDecoration:"none",marginBottom:"0.5em",color:"$accentAlt",cursor:"pointer",background:"$secondary",border:"none","&:last-child":{marginBottom:"0"}}}),Ey=qg("span",{fontSize:"1.33rem",alignSelf:"flex-start",flexGrow:"0",flexShrink:"1",padding:"1rem","@sm":{fontSize:"1rem"},"&.visually-hidden":{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:"0"}}),by=qg("header",{display:"flex",backgroundColor:"transparent !important",justifyContent:"space-between",alignItems:"flex-start",width:"100%",[`> ${vy}`]:{flexGrow:"1",flexShrink:"0"},form:{flexGrow:"0",flexShrink:"1"}}),Ty=qg("div",{display:"flex",alignItems:"flex-end",justifyContent:"flex-end",padding:"1rem",flexShrink:"0",flexGrow:"1"}),Sy=({direction:t,title:i})=>{const r=()=>e.createElement("path",{d:"M414 321.94L274.22 158.82a24 24 0 00-36.44 0L98 321.94c-13.34 15.57-2.28 39.62 18.22 39.62h279.6c20.5 0 31.56-24.05 18.18-39.62z"}),n=()=>e.createElement("path",{d:"M98 190.06l139.78 163.12a24 24 0 0036.44 0L414 190.06c13.34-15.57 2.28-39.62-18.22-39.62h-279.6c-20.5 0-31.56 24.05-18.18 39.62z"});return e.createElement(dy,{xmlns:"http://www.w3.org/2000/svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},e.createElement("title",null,i),"up"===t&&e.createElement(r,null),"down"===t&&e.createElement(n,null))},xy=()=>{const t=$g(),i=Ug(),{activeManifest:r,collection:n,configOptions:s,vault:o}=i,a=null==s?void 0:s.canvasHeight;return e.createElement(vy,null,e.createElement(sg,{value:r,onValueChange:e=>{t({type:"updateActiveManifest",manifestId:e})}},e.createElement(fy,null,e.createElement(ag,null),e.createElement(lg,null,e.createElement(Sy,{direction:"down",title:"select from collection"}))),e.createElement(py,{css:{maxHeight:`${a} !important`}},e.createElement(mg,null,e.createElement(Sy,{direction:"up",title:"scroll up for more"})),e.createElement(ug,null,e.createElement(hg,null,e.createElement(my,null,e.createElement(wm,{label:n.label})),n.items.map((t=>e.createElement(gy,{value:t.id,key:t.id},(null==t?void 0:t.thumbnail)&&e.createElement(Gm,{thumbnail:o.get(null==t?void 0:t.thumbnail)}),e.createElement(pg,null,e.createElement(wm,{label:t.label})),e.createElement(gg,null)))))),e.createElement(vg,null,e.createElement(Sy,{direction:"down",title:"scroll down for more"})))))},Ry=qg("span",{display:"flex",alignContent:"center",alignItems:"center",padding:"0.125rem 0.25rem 0",marginTop:"-0.125rem",marginLeft:"0.5rem",backgroundColor:"$accent",color:"$secondary",borderRadius:"3px",fontSize:"0.6111rem",textTransform:"uppercase",lineHeight:"1em"}),Cy=({status:t})=>t?e.createElement(Ry,{"data-copy-status":t},t):null,Ay=({textPrompt:t,textToCopy:i})=>{const[r,n]=((t,i=2500)=>{const[r,n]=(0,e.useState)(),s=(0,e.useCallback)((()=>{navigator.clipboard.writeText(t).then((()=>n("copied")),(()=>n("failed")))}),[t]);return(0,e.useEffect)((()=>{if(!r)return;const e=setTimeout((()=>n(void 0)),i);return()=>clearTimeout(e)}),[r]),[r,s]})(i);return e.createElement("button",{onClick:n},t," ",e.createElement(Cy,{status:r}))},ky=()=>{const t="#ed1d33",i="#2873ab";return e.createElement("svg",{viewBox:"0 0 493.35999 441.33334",id:"iiif-logo",version:"1.1"},e.createElement("title",null,"IIIF Manifest Options"),e.createElement("g",{transform:"matrix(1.3333333,0,0,-1.3333333,0,441.33333)"},e.createElement("g",{transform:"scale(0.1)"},e.createElement("path",{style:{fill:i},d:"M 65.2422,2178.75 775.242,1915 773.992,15 65.2422,276.25 v 1902.5"}),e.createElement("path",{style:{fill:i},d:"m 804.145,2640.09 c 81.441,-240.91 -26.473,-436.2 -241.04,-436.2 -214.558,0 -454.511,195.29 -535.9527,436.2 -81.4335,240.89 26.4805,436.18 241.0387,436.18 214.567,0 454.512,-195.29 535.954,-436.18"}),e.createElement("path",{style:{fill:t},d:"M 1678.58,2178.75 968.578,1915 969.828,15 1678.58,276.25 v 1902.5"}),e.createElement("path",{style:{fill:t},d:"m 935.082,2640.09 c -81.437,-240.91 26.477,-436.2 241.038,-436.2 214.56,0 454.51,195.29 535.96,436.2 81.43,240.89 -26.48,436.18 -241.04,436.18 -214.57,0 -454.52,-195.29 -535.958,-436.18"}),e.createElement("path",{style:{fill:i},d:"m 1860.24,2178.75 710,-263.75 -1.25,-1900 -708.75,261.25 v 1902.5"}),e.createElement("path",{style:{fill:i},d:"m 2603.74,2640.09 c 81.45,-240.91 -26.47,-436.2 -241.03,-436.2 -214.58,0 -454.52,195.29 -535.96,436.2 -81.44,240.89 26.48,436.18 241.03,436.18 214.57,0 454.51,-195.29 535.96,-436.18"}),e.createElement("path",{style:{fill:t},d:"m 3700.24,3310 v -652.5 c 0,0 -230,90 -257.5,-142.5 -2.5,-247.5 0,-336.25 0,-336.25 l 257.5,83.75 V 1690 l -258.61,-92.5 V 262.5 L 2735.24,0 v 2360 c 0,0 -15,850 965,950"}))))},Ly=qg(Cg,{all:"unset",height:"2rem",width:"3.236rem",backgroundColor:"#6663",borderRadius:"9999px",position:"relative",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:focus":{boxShadow:"0 0 0 2px $secondaryAlt"},'&[data-state="checked"]':{backgroundColor:"$accent",boxShadow:"inset 2px 2px 5px #0003"}}),Iy=qg(Ag,{display:"block",height:"calc(2rem - 12px)",width:"calc(2rem - 12px)",backgroundColor:"$secondary",borderRadius:"100%",boxShadow:"2px 2px 5px #0001",transition:"$all",transform:"translateX(6px)",willChange:"transform",'&[data-state="checked"]':{transform:"translateX(calc(1.236rem + 6px))"}}),Py=qg("label",{fontSize:"0.8333rem",fontWeight:"400",lineHeight:"1em",userSelect:"none",cursor:"pointer",paddingRight:"0.618rem"}),_y=qg("form",{display:"flex",flexShrink:"0",flexGrow:"1",alignItems:"center",marginLeft:"1.618rem"}),Dy=()=>{var t;const{configOptions:i}=Ug(),r=$g(),[n,s]=(0,e.useState)(null==(t=null==i?void 0:i.informationPanel)?void 0:t.open);return(0,e.useEffect)((()=>{r({type:"updateInformationOpen",informationOpen:n})}),[n]),e.createElement(_y,null,e.createElement(Py,{htmlFor:"information-toggle",css:n?{opacity:"1"}:{}},"More Information"),e.createElement(Ly,{checked:n,onCheckedChange:()=>s(!n),id:"information-toggle","aria-label":"information panel toggle",name:"toggled?"},e.createElement(Iy,null)))},Oy=t=>{const i=()=>!!window.matchMedia&&window.matchMedia(t).matches,[r,n]=(0,e.useState)(i);return(0,e.useEffect)((()=>{const e=()=>n(i);return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)})),r},My=({manifestId:t,manifestLabel:i})=>{const r=Ug(),{collection:n,configOptions:s}=r,{showTitle:o,showIIIFBadge:a,informationPanel:l}=s,c=a||(null==l?void 0:l.renderToggle),u=Oy(Vg.sm);return e.createElement(by,{className:"clover-header"},null!=n&&n.items?e.createElement(xy,null):e.createElement(Ey,{className:o?"":"visually-hidden"},o&&e.createElement(wm,{label:i})),c&&e.createElement(Ty,null,a&&e.createElement(yv,null,e.createElement(yy,null,e.createElement(ky,null)),e.createElement(wy,null,(null==n?void 0:n.items)&&e.createElement("button",{onClick:e=>{e.preventDefault(),window.open(n.id,"_blank")}},"View Collection"),e.createElement("button",{onClick:e=>{e.preventDefault(),window.open(t,"_blank")}},"View Manifest")," ",(null==n?void 0:n.items)&&e.createElement(Ay,{textPrompt:"Copy Collection URL",textToCopy:n.id}),e.createElement(Ay,{textPrompt:"Copy Manifest URL",textToCopy:t}))),l.renderToggle&&!u&&e.createElement(Dy,null)))},Fy=({manifest:t,theme:i})=>{const r=Ug(),n=$g(),{activeCanvas:s,informationOpen:o,vault:a,configOptions:l}=r,[c,u]=(0,e.useState)(!1),[h,d]=(0,e.useState)(!1),[f,p]=(0,e.useState)(void 0),[g,m]=(0,e.useState)([]),[v,y]=((t=!1)=>{const[i,r]=(0,e.useState)(t);return(0,e.useLayoutEffect)((()=>{if(!i)return;const e=document.documentElement.style.overflow;return document.documentElement.style.overflow="hidden",()=>{document.documentElement.style.overflow=e}}),[i]),(0,e.useEffect)((()=>{i!==t&&r(t)}),[t]),[i,r]})(!1),w=Oy(Vg.sm),E=e=>{n({type:"updateInformationOpen",informationOpen:e})};return(0,e.useEffect)((()=>{null!=l&&l.informationPanel.open&&E(!w)}),[w]),(0,e.useEffect)((()=>{y(!!w&&o)}),[o]),(0,e.useEffect)((()=>{const e=jg(a,s),t=((e,t,i)=>{const r=e.get({id:t,type:"Canvas"});if(null==r||!r.annotations||!r.annotations[0])return[];const n=e.get(r.annotations[0]),s=e.get(n.items);return Array.isArray(s)?s.filter((t=>{var i;if(t.body&&null!=(i=t.motivation)&&i.includes("supplementing")){let i=t.body;Array.isArray(i)&&(i=i[0]);const r=e.get(i.id);if("text/vtt"===r.format)return t.body=r,t}})).map((e=>e.body)):[]})(a,s);e&&(d(["Sound","Video"].indexOf(e.type)>-1),p({...e})),m(t),u(0!==t.length)}),[s]),e.createElement(yi,{FallbackComponent:Jg},e.createElement(om,{className:`${i} clover-iiif`,css:{background:null==l?void 0:l.background},"data-body-locked":v,"data-information-panel":c,"data-information-panel-open":o},e.createElement(fi,{open:o,onOpenChange:E},e.createElement(My,{manifestLabel:t.label,manifestId:t.id}),e.createElement(hy,{activeCanvas:s,painting:f,resources:g,items:t.items,isAudioVideo:h}))))},Ny={ignoreCache:!1,headers:{Accept:"application/json, text/javascript, text/plain"},timeout:5e3,withCredentials:!1};function By(e,t=null){return{ok:!1,status:e.status,statusText:e.statusText,headers:e.getAllResponseHeaders(),data:t||e.statusText,json:()=>JSON.parse(t||e.statusText)}}const Uy=({canvasIdCallback:t=(()=>{}),customTheme:i,iiifContent:r,id:n,manifestId:s,options:o})=>{var a;let l=r;return n&&(l=n),s&&(l=s),e.createElement(Bg,{initialState:{...Og,informationOpen:!(null==(a=null==o?void 0:o.informationPanel)||!a.open),vault:new Dt({customFetcher:e=>function(e,t=Ny){const i=t.headers||Ny.headers;return new Promise(((r,n)=>{const s=new XMLHttpRequest;s.open("get",e),s.withCredentials=t.withCredentials,i&&Object.keys(i).forEach((e=>s.setRequestHeader(e,i[e]))),s.onload=()=>{r(function(e){return{ok:e.status>=200&&e.status<300,status:e.status,statusText:e.statusText,headers:e.getAllResponseHeaders(),data:e.responseText,json:()=>JSON.parse(e.responseText)}}(s))},s.onerror=()=>{n(By(s,"Failed to make request."))},s.ontimeout=()=>{n(By(s,"Request took longer than expected."))},s.send()}))}(e,{withCredentials:null==o?void 0:o.withCredentials,headers:null==o?void 0:o.requestHeaders}).then((e=>JSON.parse(e.data)))})}},e.createElement($y,{iiifContent:l,canvasIdCallback:t,customTheme:i,options:o}))},$y=({canvasIdCallback:t,customTheme:i,iiifContent:r,options:n})=>{const s=$g(),o=Ug(),{activeCanvas:a,activeManifest:l,isLoaded:c,vault:u}=o,[h,d]=(0,e.useState)(),[f,p]=(0,e.useState)();let g={};return i&&(g=((...e)=>(wi||(wi=pr())).createTheme(...e))("custom",i)),(0,e.useEffect)((()=>{t&&t(a)}),[a]),(0,e.useEffect)((()=>{l&&u.loadManifest(l).then((e=>{p(e),s({type:"updateActiveCanvas",canvasId:e.items[0]&&e.items[0].id})})).catch((e=>{console.error(`Manifest failed to load: ${e}`)})).finally((()=>{s({type:"updateIsLoaded",isLoaded:!0})}))}),[l]),(0,e.useEffect)((()=>{s({type:"updateConfigOptions",configOptions:n}),u.load(r).then((e=>{d(e)})).catch((e=>{console.error(`The IIIF resource ${r} failed to load: ${e}`)}))}),[r,n]),(0,e.useEffect)((()=>{let e=[];"Collection"===(null==h?void 0:h.type)?(s({type:"updateCollection",collection:h}),e=h.items.filter((e=>"Manifest"===e.type)).map((e=>e.id)),e.length>0&&s({type:"updateActiveManifest",manifestId:e[0]})):"Manifest"===(null==h?void 0:h.type)&&s({type:"updateActiveManifest",manifestId:h.id})}),[h]),c?f&&f.items?0===f.items.length?(console.log(`The IIIF manifest ${r} does not contain canvases.`),e.createElement(e.Fragment,null)):e.createElement(Fy,{manifest:f,theme:g,key:f.id}):(console.log(`The IIIF manifest ${r} failed to load.`),e.createElement(e.Fragment,null)):e.createElement(e.Fragment,null,"Loading")};var Hy=function(e){var t=e.iiifLink;return i().createElement("div",null,i().createElement(Uy,{iiifContent:null!=t?t:"https://api.dc.library.northwestern.edu/api/v2/works/8a833741-74a8-40dc-bd1d-c416a3b1bb38?as=iiif"}))};Hy.defaultProps={},Hy.propTypes={iiifLink:n().string};const zy=Hy})(),window.cloveriiif=__webpack_exports__})();
//# sourceMappingURL=cloveriiif.min.js.map